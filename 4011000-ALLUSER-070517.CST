

' Begin Customization Screen: 4011000  Version: 6 Sequence: 300   Description: "A New All Users Customization" System Administrator: FALSE Secure: 55
Begin SAFTools.SAFButton cmdPrint
'' Version         =   6
   caption         =   "Imp PEDIDO"
   customtabpagenumber=   1
   height          =   21.000000
   left            =   159.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   340
   top             =   345.000000
   width           =   74.000000
End
Begin SAFTools.SAFButton cmdEventHistory
'' Version         =   6
   height          =   21.000000
   left            =   192.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   341
   top             =   568.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdViewOrder
'' Version         =   6
   height          =   21.000000
   left            =   271.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   342
   top             =   568.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdManifest
'' Version         =   6
   height          =   21.000000
   left            =   348.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   343
   top             =   568.000000
   width           =   73.000000
End
Begin Label lcaption
   Index           =   10
'' Version         =   6
   customtabpagenumber=   1
   height          =   13.000000
   left            =   596.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   344
   top             =   568.000000
   width           =   81.000000
End
Begin SAFFloat cCuryBalDue_0
'' Version         =   6
   height          =   21.000000
   left            =   685.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   345
   top             =   568.000000
   width           =   112.000000
End
Begin SSTab.1 SSTab1
'' Version         =   6
   height          =   422
   left            =   10
'' parent          =   "Form1"
'' parentform      =   "Form1"
   top             =   129
   width           =   801
End
Begin SAFTools.SAFButton cmdFindItem
   Index           =   1
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   4.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   199
   top             =   345.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdAvailability
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   83.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   200
   top             =   345.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdLotSerial
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   238.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   201
   top             =   345.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdSalespeopleItem
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   315.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   202
   top             =   345.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdRMA
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   391.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   203
   top             =   345.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdShipAll
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   467.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   204
   top             =   322.000000
   width           =   81.000000
End
Begin SAFTools.SAFButton cmdClearAll
'' Version         =   6
   customtabpagenumber=   1
   height          =   21.000000
   left            =   630.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   205
   top             =   322.000000
   width           =   81.000000
End
Begin Frame fraItem
'' Version         =   6
   customtabpagenumber=   1
   height          =   284.000000
   left            =   4.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   top             =   32.000000
   width           =   785.000000
End
Begin SAFTools.SAFLabel lblIsan
'' Created         =   True
'' Version         =   6
   caption         =   "Isan:"
   customtabpagenumber=   1
   height          =   17
   left            =   346
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   901
   top             =   210
   visible         =   FALSE
   width           =   56
End
Begin Label lcaption
   Index           =   9
'' Version         =   6
End
Begin SAFTools.SAFLabel lblPrecio
'' Created         =   True
'' Version         =   6
   caption         =   "Precio:"
   customtabpagenumber=   1
   height          =   17
   left            =   11
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   901
   top             =   257
   visible         =   FALSE
   width           =   72
End
Begin SAF.SAFFloat cPrecio
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bsoshipline.user6";2296;2"
   heading         =   "Precio"
   height          =   21.000000
   left            =   112
   level           =   "1"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   43
   top             =   256.000000
   visible         =   FALSE
   width           =   112
End
Begin SAF.SAFFloat cIsan
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bsoshipline.user5";2288;2"
   heading         =   "Isan"
   height          =   21.000000
   left            =   312.000000
   level           =   "1"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   54
   top             =   256.000000
   visible         =   FALSE
   width           =   112
End
Begin Label lcaption
   Index           =   26
'' Version         =   6
   tabindex        =   55
End
Begin SAFMaskedText cWhseLoc_1
'' Version         =   6
   tabindex        =   56
End
Begin Label lcaption
   Index           =   119
'' Version         =   6
   tabindex        =   57
End
Begin SAFMaskedText cIRInvtID_1
'' Version         =   6
   tabindex        =   58
End
Begin SAFCheck ctaxable_1
'' Version         =   6
   default         =   ""
   tabindex        =   59
End
Begin SAFCheck csplitlots_1
'' Version         =   6
   tabindex        =   60
End
Begin SAFCheck csample_1
'' Version         =   6
   tabindex        =   61
End
Begin SAFCheck cIRDemand_1
'' Version         =   6
   tabindex        =   62
End
Begin Label lcaption
   Index           =   15
'' Version         =   6
   tabindex        =   63
End
Begin SAFFloat ccurylistprice_1
'' Version         =   6
   tabindex        =   64
End
Begin Label lcaption
   Index           =   18
'' Version         =   6
   tabindex        =   65
End
Begin SAFFloat ccurycost_1
'' Version         =   6
   tabindex        =   66
End
Begin Label lcaption
   Index           =   17
'' Version         =   6
   tabindex        =   67
End
Begin SAFFloat cqtypick_1
'' Version         =   6
   tabindex        =   68
End
Begin Label lcaption
   Index           =   120
'' Version         =   6
   tabindex        =   69
End
Begin SAFMaskedText cIRSiteID_1
'' Version         =   6
   tabindex        =   70
End
Begin Label lcaption
   Index           =   20
'' Version         =   6
   tabindex        =   71
End
Begin SAFMaskedText crebateid_1
'' Version         =   6
   tabindex        =   72
End
Begin Label lcaption
   Index           =   7
'' Version         =   6
   tabindex        =   73
End
Begin SAFMaskedText cordlineref_1
'' Version         =   6
   tabindex        =   74
End
Begin Label lslsperid_1
'' Version         =   6
   tabindex        =   75
End
Begin SAFMaskedText cslsperid_1
'' Version         =   6
   tabindex        =   76
End
Begin Label dslsperid_1
'' Version         =   6
   tabindex        =   77
End
Begin Label lcaption
   Index           =   16
'' Version         =   6
   tabindex        =   78
End
Begin SAFFloat ccurycommcost_1
'' Version         =   6
   tabindex        =   79
End
Begin Label lcmmnpct_1
'' Version         =   6
   tabindex        =   80
End
Begin SAFFloat ccmmnpct_1
'' Version         =   6
   tabindex        =   81
End
Begin Label lcaption
   Index           =   86
'' Version         =   6
   tabindex        =   82
End
Begin SAFMaskedText cTaxCat_1
'' Version         =   6
   tabindex        =   83
End
Begin Label dTaxCat_1
'' Version         =   6
   tabindex        =   84
End
Begin Label lcaption
   Index           =   22
'' Version         =   6
   tabindex        =   85
End
Begin SAFCombo cdisp_1
'' Version         =   6
   tabindex        =   86
End
Begin Label lcaption
   Index           =   23
'' Version         =   6
   tabindex        =   87
End
Begin SAFMaskedText cinspid_1
'' Version         =   6
   tabindex        =   88
End
Begin Label dinspid_1
'' Version         =   6
   tabindex        =   89
End
Begin Label lprojectid_1
'' Version         =   6
   tabindex        =   90
End
Begin SAFMaskedText cprojectid_1
'' Version         =   6
   tabindex        =   91
End
Begin Label dprojectid_1
'' Version         =   6
   tabindex        =   92
End
Begin Label ltaskid_1
'' Version         =   6
   tabindex        =   93
End
Begin SAFMaskedText ctaskid_1
'' Version         =   6
   tabindex        =   94
End
Begin Label dtaskid_1
'' Version         =   6
   tabindex        =   95
End
Begin Label lcaption
   Index           =   12
'' Version         =   6
   tabindex        =   96
End
Begin SAFMaskedText calternateid_1
'' Version         =   6
   blankerr        =   FALSE
   tabindex        =   97
End
Begin Label lcaption
   Index           =   13
'' Version         =   6
   tabindex        =   98
End
Begin SAFMaskedText cdescr_1
'' Version         =   6
   tabindex        =   99
End
Begin Label dSlsPriceID_0
'' Version         =   6
   tabindex        =   100
End
Begin SAFMaskedText cSlsPriceID_0
'' Version         =   6
   tabindex        =   101
End
Begin SAFGrid Spread1
'' Version         =   6
   tabindex        =   100
End
Begin Frame fraShipInfo
'' Version         =   6
   tabindex        =   103
End
Begin Label lcaption
   Index           =   25
'' Version         =   6
   tabindex        =   104
End
Begin SAFCombo cshiptotype_0
'' Version         =   6
   tabindex        =   105
End
Begin Label lcaption
   Index           =   68
'' Version         =   6
   tabindex        =   106
End
Begin SAFMaskedText cshipcustid_0
'' Version         =   6
   tabindex        =   107
End
Begin Label lcaption
   Index           =   69
'' Version         =   6
   tabindex        =   108
End
Begin SAFMaskedText cshiptoid_0
'' Version         =   6
   height          =   21
   left            =   240
'' parent          =   "fraShipInfo"
'' parentform      =   "Form1"
   tabindex        =   109
   top             =   32
   width           =   77
End
Begin Label dShipToID_0
'' Version         =   6
   tabindex        =   110
End
Begin Label lcaption
   Index           =   73
'' Version         =   6
   tabindex        =   111
End
Begin SAFMaskedText cshipvendid_0
'' Version         =   6
   tabindex        =   112
End
Begin Label lcaption
   Index           =   80
'' Version         =   6
   tabindex        =   113
End
Begin SAFMaskedText cShipVendAddrID_0
'' Version         =   6
   tabindex        =   114
End
Begin Label dShipVendAddrID_0
'' Version         =   6
   tabindex        =   115
End
Begin Label lcaption
   Index           =   77
'' Version         =   6
   tabindex        =   116
End
Begin SAFMaskedText cshipsiteid_0
'' Version         =   6
   tabindex        =   117
End
Begin Label lcaption
   Index           =   78
'' Version         =   6
   tabindex        =   118
End
Begin SAFMaskedText cshipaddrid_0
'' Version         =   6
   tabindex        =   119
End
Begin Label lcaption
   Index           =   31
'' Version         =   6
   tabindex        =   120
End
Begin SAFMaskedText cshipname_0
'' Version         =   6
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
   tabindex        =   121
End
Begin Label lcaption
   Index           =   32
'' Version         =   6
   tabindex        =   122
End
Begin SAFMaskedText cshipattn_0
'' Version         =   6
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
   tabindex        =   123
End
Begin Label lcaption
   Index           =   33
'' Version         =   6
   tabindex        =   124
End
Begin SAFMaskedText cshipaddr1_0
'' Version         =   6
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
   tabindex        =   125
End
Begin Label lcaption
   Index           =   34
'' Version         =   6
   tabindex        =   126
End
Begin SAFMaskedText cshipaddr2_0
'' Version         =   6
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
   tabindex        =   127
End
Begin Label lcaption
   Index           =   35
'' Version         =   6
   tabindex        =   128
End
Begin SAFMaskedText cshipcity_0
'' Version         =   6
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
   tabindex        =   129
End
Begin Label lcaption
   Index           =   36
'' Version         =   6
   tabindex        =   130
End
Begin SAFMaskedText cshipstate_0
'' Version         =   6
   tabindex        =   131
End
Begin Label dshipstate_0
'' Version         =   6
   tabindex        =   132
End
Begin Label lcaption
   Index           =   37
'' Version         =   6
   tabindex        =   133
End
Begin SAFMaskedText cshipzip_0
'' Version         =   6
   tabindex        =   134
End
Begin Label lcaption
   Index           =   38
'' Version         =   6
   tabindex        =   135
End
Begin SAFMaskedText cshipcountry_0
'' Version         =   6
   tabindex        =   136
End
Begin Label dshipcountry_0
'' Version         =   6
   tabindex        =   137
End
Begin Label lcaption
   Index           =   44
'' Version         =   6
   tabindex        =   138
End
Begin SAFMaskedText cShipPhone_0
'' Version         =   6
   tabindex        =   139
End
Begin SAFCheck cDropShip_0
'' Version         =   6
   tabindex        =   140
End
Begin Label lcaption
   Index           =   39
'' Version         =   6
   tabindex        =   141
End
Begin SAFMaskedText cshipviaid_0
'' Version         =   6
   tabindex        =   142
End
Begin Label dshipviaid_0
'' Version         =   6
   height          =   13
   left            =   599
'' parent          =   "_SSTab1_TabPage2"
'' parentform      =   "Form1"
   tabindex        =   143
   top             =   131
   width           =   185
End
Begin Label lcaption
   Index           =   40
'' Version         =   6
   tabindex        =   144
End
Begin SAFMaskedText cfrttermsid_0
'' Version         =   6
   tabindex        =   145
End
Begin Label dfrttermsid_0
'' Version         =   6
   tabindex        =   146
End
Begin Label lcaption
   Index           =   41
'' Version         =   6
   tabindex        =   147
End
Begin SAFMaskedText cfobid_0
'' Version         =   6
   tabindex        =   148
End
Begin Label dfobid_0
'' Version         =   6
   tabindex        =   149
End
Begin SAFCheck cshipcmplt_0
'' Version         =   6
   tabindex        =   150
End
Begin SAFCheck cweekenddelivery_0
'' Version         =   6
   tabindex        =   151
End
Begin Label lcaption
   Index           =   42
'' Version         =   6
   tabindex        =   152
End
Begin SAFDate cshipdateplan_0
'' Version         =   6
   height          =   18
   left            =   480
'' parent          =   "_SSTab1_TabPage2"
'' parentform      =   "Form1"
   tabindex        =   153
   top             =   241
   width           =   77
End
Begin Label lcaption
   Index           =   45
'' Version         =   6
   tabindex        =   154
End
Begin SAFInteger ctransittime_0
'' Version         =   6
   tabindex        =   155
End
Begin Label lcaption
   Index           =   43
'' Version         =   6
   tabindex        =   156
End
Begin SAFDate cshipdateact_0
'' Version         =   6
   tabindex        =   157
End
Begin Label lcaption
   Index           =   46
'' Version         =   6
   tabindex        =   158
End
Begin SAFDate cetadate_0
'' Version         =   6
   tabindex        =   159
End
Begin SAFTools.SAFButton cmdMarkForHeader
'' Version         =   6
   tabindex        =   160
End
Begin Label lcaption
   Index           =   48
'' Version         =   6
   tabindex        =   161
End
Begin SAFMaskedText cbillname_0
'' Version         =   6
   tabindex        =   162
End
Begin Label lcaption
   Index           =   49
'' Version         =   6
   tabindex        =   163
End
Begin SAFMaskedText cbillattn_0
'' Version         =   6
   tabindex        =   164
End
Begin Label lcaption
   Index           =   50
'' Version         =   6
   tabindex        =   165
End
Begin SAFMaskedText cbilladdr1_0
'' Version         =   6
   tabindex        =   166
End
Begin Label lcaption
   Index           =   51
'' Version         =   6
   tabindex        =   167
End
Begin SAFMaskedText cbilladdr2_0
'' Version         =   6
   tabindex        =   168
End
Begin Label lcaption
   Index           =   52
'' Version         =   6
   tabindex        =   169
End
Begin SAFMaskedText cbillcity_0
'' Version         =   6
   tabindex        =   170
End
Begin Label lcaption
   Index           =   53
'' Version         =   6
   tabindex        =   171
End
Begin SAFMaskedText cbillstate_0
'' Version         =   6
   tabindex        =   172
End
Begin Label dbillstate_0
'' Version         =   6
   tabindex        =   173
End
Begin Label lcaption
   Index           =   54
'' Version         =   6
   tabindex        =   174
End
Begin SAFMaskedText cbillzip_0
'' Version         =   6
   tabindex        =   175
End
Begin Label lcaption
   Index           =   55
'' Version         =   6
   tabindex        =   176
End
Begin SAFMaskedText cbillcountry_0
'' Version         =   6
   tabindex        =   177
End
Begin Label dbillcountry_0
'' Version         =   6
   tabindex        =   178
End
Begin Label lcaption
   Index           =   79
'' Version         =   6
   tabindex        =   179
End
Begin SAFMaskedText cBillPhone_0
'' Version         =   6
   tabindex        =   180
End
Begin Label lcaption
   Index           =   56
'' Version         =   6
   tabindex        =   181
End
Begin SAFMaskedText cbuyerid_0
'' Version         =   6
   tabindex        =   182
End
Begin Label lcaption
   Index           =   57
'' Version         =   6
   tabindex        =   183
End
Begin SAFMaskedText cbuyername_0
'' Version         =   6
   tabindex        =   184
End
Begin Label lcaption
   Index           =   58
'' Version         =   6
   tabindex        =   185
End
Begin SAFMaskedText cdiv_0
'' Version         =   6
   tabindex        =   186
End
Begin Label lcaption
   Index           =   59
'' Version         =   6
   tabindex        =   187
End
Begin SAFMaskedText cdept_0
'' Version         =   6
   tabindex        =   188
End
Begin Label lcaption
   Index           =   60
'' Version         =   6
   tabindex        =   189
End
Begin SAFMaskedText ccontractnbr_0
'' Version         =   6
   tabindex        =   190
End
Begin Label lcaption
   Index           =   70
'' Version         =   6
   tabindex        =   191
End
Begin SAFMaskedText cblktordnbr_0
'' Version         =   6
   tabindex        =   192
End
Begin Label lcaption
   Index           =   71
'' Version         =   6
   tabindex        =   193
End
Begin SAFMaskedText cauthnbr_0
'' Version         =   6
   tabindex        =   194
End
Begin Label lcaption
   Index           =   11
'' Version         =   6
   tabindex        =   195
End
Begin SAFMaskedText ctermsid_0
'' Version         =   6
   tabindex        =   196
End
Begin Label dtermsid_0
'' Version         =   6
   tabindex        =   197
End
Begin SAFTools.SAFButton cmdViewCredit
'' Version         =   6
   tabindex        =   198
End
Begin Label lcaption
   Index           =   67
'' Version         =   6
   tabindex        =   206
End
Begin SAFDate corddate_0
'' Version         =   6
   tabindex        =   207
End
Begin Label lslsperid_0
'' Version         =   6
   tabindex        =   208
End
Begin SAFMaskedText cslsperid_0
'' Version         =   6
   enabled         =   TRUE
   tabindex        =   209
End
Begin SAFTools.SAFButton cmdSalespeople
'' Version         =   6
   tabindex        =   210
End
Begin Label dslsperid_0
'' Version         =   6
   tabindex        =   211
End
Begin Label lcmmnpct_0
'' Version         =   6
   tabindex        =   212
End
Begin SAFFloat ccmmnpct_0
'' Version         =   6
   tabindex        =   213
End
Begin Label lcaption
   Index           =   72
'' Version         =   6
   tabindex        =   214
End
Begin SAFMaskedText ccertid_0
'' Version         =   6
   tabindex        =   215
End
Begin Label dcertid_0
'' Version         =   6
   tabindex        =   216
End
Begin Label lprojectid_0
'' Version         =   6
   tabindex        =   217
End
Begin SAFMaskedText cprojectid_0
'' Version         =   6
   tabindex        =   218
End
Begin Label dprojectid_0
'' Version         =   6
   tabindex        =   219
End
Begin Label lcaption
   Index           =   81
'' Version         =   6
   tabindex        =   220
End
Begin SAFMaskedText cinvcnbr_0
'' Version         =   6
   tabindex        =   221
End
Begin SAFDate cInvcDate
'' Version         =   6
   tabindex        =   222
End
Begin Label lcaption
   Index           =   21
'' Version         =   6
   left            =   6.000000
   tabindex        =   223
End
Begin SAFMaskedText cPerPost_0
'' Version         =   6
   tabindex        =   224
End
Begin SAFCheck cRequireStepInsp_0
'' Version         =   6
   tabindex        =   225
End
Begin SAFCheck cRequireStepAssy_0
'' Version         =   6
   tabindex        =   226
End
Begin SAFCheck cedi810_0
'' Version         =   6
   tabindex        =   227
End
Begin Frame fraShipStatus
'' Version         =   6
   tabindex        =   228
End
Begin Label lcaption
   Index           =   66
'' Version         =   6
   tabindex        =   229
End
Begin SAFCombo cstatus_0
'' Version         =   6
   tabindex        =   230
End
Begin Label lcaption
   Index           =   74
'' Version         =   6
   tabindex        =   231
End
Begin SAFDate creldate_0
'' Version         =   6
   tabindex        =   232
End
Begin Label lcaption
   Index           =   75
'' Version         =   6
   tabindex        =   233
End
Begin SAFDate cpickdate_0
'' Version         =   6
   tabindex        =   234
End
Begin Label lcaption
   Index           =   76
'' Version         =   6
   tabindex        =   235
End
Begin SAFDate cpackdate_0
'' Version         =   6
   tabindex        =   236
End
Begin SAFCheck cShippingManifested_0
'' Version         =   6
   tabindex        =   237
End
Begin SAFCheck chold_0
'' Version         =   6
   tabindex        =   238
End
Begin SAFCheck ccredithold_0
'' Version         =   6
   tabindex        =   239
End
Begin SAFDate ccreditholddate_0
'' Version         =   6
   tabindex        =   240
End
Begin SAFCheck ccancelled_0
'' Version         =   6
   tabindex        =   241
   visible         =   TRUE
End
Begin SAFDate cdatecancelled_0
'' Version         =   6
   tabindex        =   242
End
Begin Frame fraNextStep
'' Version         =   6
   tabindex        =   243
End
Begin Label lNextStep
'' Version         =   6
   tabindex        =   244
End
Begin Frame fraTaxID
'' Version         =   6
   height          =   194
   left            =   560
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   tabindex        =   245
   top             =   9
   width           =   225
End
Begin Label lcaption
   Index           =   29
'' Version         =   6
   tabindex        =   246
End
Begin SAFMaskedText ctaxid00_0
   tabindex        =   247
End
Begin Label lcaption
   Index           =   30
'' Version         =   6
   tabindex        =   248
End
Begin SAFMaskedText ctaxid01_0
   tabindex        =   249
End
Begin Label lcaption
   Index           =   47
'' Version         =   6
   tabindex        =   250
End
Begin SAFMaskedText ctaxid02_0
   tabindex        =   251
End
Begin Label lcaption
   Index           =   61
'' Version         =   6
   height          =   13
   left            =   8
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   252
   top             =   96
   width           =   87
End
Begin SAFMaskedText ctaxid03_0
   tabindex        =   253
End
Begin SAFCheck ccancelbo_0
'' Version         =   6
   tabindex        =   254
End
Begin SAFCheck cRelRMARet_0
'' Version         =   6
   tabindex        =   255
End
Begin Frame fraMiscCharges
'' Version         =   6
   height          =   257.000000
   left            =   4.000000
   tabindex        =   256
   top             =   9
   width           =   785.000000
End
Begin Label lcaption
   Index           =   82
'' Version         =   6
   tabindex        =   257
End
Begin SAFMaskedText cmiscchrgid_3
'' Version         =   6
   tabindex        =   258
End
Begin Label lcaption
   Index           =   83
'' Version         =   6
   tabindex        =   259
End
Begin SAFMaskedText cdescr_3
'' Version         =   6
   tabindex        =   260
End
Begin Label lcaption
   Index           =   84
'' Version         =   6
   tabindex        =   261
End
Begin SAFFloat ccurymiscchrg_3
'' Version         =   6
   tabindex        =   262
End
Begin SAFCheck ctaxable_3
'' Version         =   6
   tabindex        =   263
End
Begin Label lcaption
   Index           =   85
'' Version         =   6
   tabindex        =   264
End
Begin SAFMaskedText ctaxcat_3
'' Version         =   6
   tabindex        =   265
End
Begin Label dtaxcat_3
'' Version         =   6
   tabindex        =   266
End
Begin SAFGrid Spread3
'' Version         =   6
   tabindex        =   265
End
Begin Frame fraSalesTax
'' Version         =   6
   height          =   257.000000
   left            =   4.000000
   tabindex        =   268
   top             =   9
   width           =   785.000000
End
Begin Label lcaption
   Index           =   100
'' Version         =   6
   tabindex        =   269
End
Begin SAFMaskedText ctaxid_4
'' Version         =   6
   tabindex        =   270
End
Begin Label dtaxid_4
'' Version         =   6
   tabindex        =   271
End
Begin Label lcaption
   Index           =   101
'' Version         =   6
   tabindex        =   272
End
Begin SAFMaskedText ctaxcat_4
'' Version         =   6
   tabindex        =   273
End
Begin Label dtaxcat_4
'' Version         =   6
   tabindex        =   274
End
Begin Label lcaption
   Index           =   102
'' Version         =   6
   tabindex        =   275
End
Begin SAFFloat ccuryfrttax_4
'' Version         =   6
   tabindex        =   276
End
Begin Label lcaption
   Index           =   104
'' Version         =   6
   tabindex        =   277
End
Begin SAFFloat ccurymerchtax_4
'' Version         =   6
   tabindex        =   278
End
Begin Label lcaption
   Index           =   106
'' Version         =   6
   tabindex        =   279
End
Begin SAFFloat ccurymisctax_4
'' Version         =   6
   tabindex        =   280
End
Begin Label lcaption
   Index           =   108
'' Version         =   6
   tabindex        =   281
End
Begin SAFFloat ccurytottax_4
'' Version         =   6
   tabindex        =   282
End
Begin Label lcaption
   Index           =   103
'' Version         =   6
   tabindex        =   283
End
Begin SAFFloat ccuryfrttxbl_4
'' Version         =   6
   tabindex        =   284
End
Begin Label lcaption
   Index           =   105
'' Version         =   6
   tabindex        =   285
End
Begin SAFFloat ccurymerchtxbl_4
'' Version         =   6
   tabindex        =   286
End
Begin Label lcaption
   Index           =   107
'' Version         =   6
   tabindex        =   287
End
Begin SAFFloat ccurymisctxbl_4
'' Version         =   6
   tabindex        =   288
End
Begin Label lcaption
   Index           =   109
'' Version         =   6
   tabindex        =   289
End
Begin SAFFloat ccurytottxbl_4
'' Version         =   6
   tabindex        =   290
End
Begin Label lcaption
   Index           =   110
'' Version         =   6
   tabindex        =   291
End
Begin SAFFloat ctaxrate_4
'' Version         =   6
   tabindex        =   292
End
Begin SAFGrid Spread4
'' Version         =   6
   tabindex        =   291
End
Begin Frame fraPayments
'' Version         =   6
   height          =   257.000000
   left            =   4.000000
   tabindex        =   294
   top             =   9
   width           =   785.000000
End
Begin Label lcaption
   Index           =   118
'' Version         =   6
   tabindex        =   295
End
Begin SAFMaskedText cpmttypeid_5
'' Version         =   6
   tabindex        =   296
End
Begin Label dpmttypeid_5
'' Version         =   6
   tabindex        =   297
End
Begin Label lcaption
   Index           =   116
'' Version         =   6
   tabindex        =   298
End
Begin SAFFloat ccurypmtamt_5
'' Version         =   6
   tabindex        =   299
End
Begin Label lcaption
   Index           =   117
'' Version         =   6
   tabindex        =   300
End
Begin SAFDate cpmtdate_5
'' Version         =   6
   tabindex        =   301
End
Begin Label lcaption
   Index           =   115
'' Version         =   6
   tabindex        =   302
End
Begin SAFMaskedText cchknbr_5
'' Version         =   6
   tabindex        =   303
End
Begin Label lcaption
   Index           =   114
'' Version         =   6
   tabindex        =   304
End
Begin SAFMaskedText ccardnbr_5
'' Version         =   6
   tabindex        =   305
End
Begin Label lcaption
   Index           =   113
'' Version         =   6
   caption         =   "Banco:"
   tabindex        =   306
End
Begin SAFMaskedText ccardhldrname_5
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   heading         =   "Banco:"
   list            =   "NHSBC;HSBC,SANTANDER;SANTANDER,BBV;BBV BANCOMER,BANAMEX;BANAMEX,BANORTE;BANORTE,INVERLAT;INVERLAT,BAJIO;BAJIO,OTROS;OTROS"
   tabindex        =   307
End
Begin Label lcaption
   Index           =   112
'' Version         =   6
   caption         =   "Fecha Deposito:"
   tabindex        =   308
End
Begin SAFDate ccardexpdate_5
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   heading         =   "Fecha Deposito"
   tabindex        =   309
End
Begin Label lcaption
   Index           =   111
'' Version         =   6
   tabindex        =   310
End
Begin SAFMaskedText ccardauthnbr_5
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   tabindex        =   311
End
Begin SAFGrid Spread5
'' Version         =   6
   tabindex        =   310
End
Begin Label lcaption
   Index           =   96
'' Version         =   6
   tabindex        =   313
End
Begin SAFFloat ctotshipwght_0
'' Version         =   6
   tabindex        =   314
End
Begin Label lcaption
   Index           =   97
'' Version         =   6
   tabindex        =   315
End
Begin SAFInteger ctotboxes_0
'' Version         =   6
   tabindex        =   316
End
Begin Label lcaption
   Index           =   98
'' Version         =   6
   tabindex        =   317
End
Begin SAFInteger ctotpallets_0
'' Version         =   6
   tabindex        =   318
End
Begin Label lcaption
   Index           =   27
'' Version         =   6
   tabindex        =   319
End
Begin SAFFloat cdiscpct_0
'' Version         =   6
   tabindex        =   320
End
Begin Label lcaption
   Index           =   87
'' Version         =   6
   tabindex        =   321
End
Begin SAFFloat ccurytotfrtcost_0
'' Version         =   6
   tabindex        =   322
End
Begin Label lcaption
   Index           =   88
'' Version         =   6
   tabindex        =   323
End
Begin SAFFloat ccurytotmerch_0
'' Version         =   6
   tabindex        =   324
End
Begin Label lcaption
   Index           =   89
'' Version         =   6
   tabindex        =   325
End
Begin SAFFloat cCuryWholeOrdDisc_0
'' Version         =   6
   tabindex        =   326
End
Begin Label lcaption
   Index           =   90
'' Version         =   6
   tabindex        =   327
End
Begin SAFFloat ccurytottax_0
'' Version         =   6
   tabindex        =   328
End
Begin Label lcaption
   Index           =   91
'' Version         =   6
   tabindex        =   329
End
Begin SAFFloat ccurytotfrtinvc_0
'' Version         =   6
   tabindex        =   330
End
Begin Label lcaption
   Index           =   92
'' Version         =   6
   tabindex        =   331
End
Begin SAFFloat ccurypremfrtamt_0
'' Version         =   6
   tabindex        =   332
End
Begin Label lcaption
   Index           =   93
'' Version         =   6
   tabindex        =   333
End
Begin SAFFloat ccurytotmisc_0
'' Version         =   6
   tabindex        =   334
End
Begin Label lcaption
   Index           =   95
'' Version         =   6
   tabindex        =   335
End
Begin SAFFloat ccurytotinvc_0
'' Version         =   6
   height          =   21
   left            =   672
'' parent          =   "_SSTab1_TabPage8"
'' parentform      =   "Form1"
   tabindex        =   336
   top             =   233
   width           =   112
End
Begin Label lcaption
   Index           =   94
'' Version         =   6
   tabindex        =   337
End
Begin SAFFloat ccurytotpmt_0
'' Version         =   6
   tabindex        =   338
End
Begin Frame SAFNewFrame
   height          =   480.000000
   left            =   -2000.000000
   tabindex        =   1
   top             =   1860.000000
   width           =   1200.000000
End
Begin SSTab.1 SAFNewTab
   height          =   480.000000
   left            =   -2000.000000
   tabindex        =   2
   top             =   1860.000000
   width           =   1845.000000
End
Begin Label lcaption
   Index           =   99
'' Version         =   6
   height          =   16
   left            =   8.000000
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   351
   top             =   120
   width           =   104
End
Begin Label lcaption
   Index           =   14
'' Version         =   6
   tabindex        =   44
End
Begin SAFMaskedText cunitdesc_1
'' Version         =   6
   tabindex        =   45
End
Begin Label lcaption
   Index           =   19
'' Version         =   6
   tabindex        =   46
End
Begin SAFFloat ccuryslsprice_1
'' Version         =   6
   enabled         =   TRUE
   height          =   21
   left            =   126
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   separator       =   TRUE
   tabindex        =   47
   top             =   63
   width           =   112
End
Begin Label lcaption
   Index           =   28
'' Version         =   6
   tabindex        =   49
End
Begin SAFFloat cdiscpct_1
'' Version         =   6
   height          =   21
   left            =   118
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   50
   top             =   88
   width           =   49
End
Begin SAFMaskedText cChainDisc_1
'' Version         =   6
   height          =   21
   left            =   130
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   51
   top             =   88
   width           =   112
End
Begin Label lcaption
   Index           =   24
'' Version         =   6
   tabindex        =   52
End
Begin SAFFloat ccurytotinvc_1
'' Version         =   6
   separator       =   TRUE
   tabindex        =   53
End
Begin SAFTools.SAFButton cmdIsan
'' Created         =   True
'' Version         =   6
   caption         =   "Cargar Isan"
   customtabpagenumber=   1
   enabled         =   TRUE
   height          =   21.000000
   left            =   713.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   902
   top             =   345.000000
   visible         =   FALSE
   width           =   77.000000
End
Begin SAFTools.SAFButton bAlta
'' Created         =   True
'' Version         =   6
   caption         =   "Alta de Clientes"
   customtabpagenumber=   2
   height          =   45
   left            =   114
'' parent          =   "_SSTab1_TabPage2"
'' parentform      =   "Form1"
   tabindex        =   903
   top             =   294
   visible         =   TRUE
   width           =   87
End
Begin SAF.SAFMaskedText cRFC
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   customtabpagenumber=   2
   enabled         =   TRUE
   fieldname       =   ""bsoshipheader.user3";3172;0"
   heading         =   "cRFC"
   height          =   17
   left            =   627
   level           =   "0"
   mask            =   "UUUU-999999-UUU"
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   904
   top             =   146
   visible         =   TRUE
   width           =   134
End
Begin SAFTools.SAFLabel lRFC
'' Created         =   True
'' Version         =   6
   caption         =   "RFC:"
   customtabpagenumber=   2
   height          =   17
   left            =   593
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   905
   top             =   149
   visible         =   TRUE
   width           =   28
End
Begin VB.Form Form1
'' Version         =   6
   height          =   682
   left            =   181
   top             =   89
   width           =   826
   windowstate     =   0
End
Begin SAFTools.SAFButton cmdRelease
'' Version         =   6
   height          =   21.000000
   left            =   33.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   337
   top             =   568.000000
   width           =   73.000000
End
Begin SAFTools.SAFLabel lPedido
'' Created         =   True
'' Version         =   6
   caption         =   "Pedido:"
   height          =   17
   left            =   251
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   918
   top             =   90
   visible         =   FALSE
   width           =   33
End
Begin SAF.SAFMaskedText xPedido
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bsoshipheader.custordnbr"; 0; 0; 0"
   heading         =   "xPedido"
   height          =   21
   left            =   286
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "Form1"
'' parentform      =   "Form1"
   pv              =   ""xVTPedido_Embarques","bsoshipheader.custID";0;0;0;0,"
   tabindex        =   917
   top             =   86
   visible         =   FALSE
   width           =   76
End
Begin SAF.SAFMaskedText cRefact
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   customtabpagenumber=   4
   enabled         =   FALSE
   fieldname       =   ""bsoshipheader.user1";3048;0"
   heading         =   "cRefact"
   height          =   20
   left            =   143
   level           =   "0"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   tabindex        =   932
   top             =   241
   visible         =   TRUE
   width           =   71
End
Begin SAFTools.SAFLabel lRefact
'' Created         =   True
'' Version         =   6
   caption         =   "Refacturación:"
   customtabpagenumber=   4
   height          =   17
   left            =   6.000000
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   tabindex        =   933
   top             =   240
   visible         =   TRUE
   width           =   101
End
Begin Label ldefaulttab_1
'' Version         =   6
   height          =   17.000000
   left            =   480.000000
   top             =   111
   width           =   25.000000
End
Begin VB.Form frmLotSerial
'' Version         =   6
   height          =   311
   left            =   131
   top             =   213
   width           =   992
   windowstate     =   0
End
Begin SAF.SAFMaskedText LoteAR
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   FALSE
   fieldname       =   ""bsoshipheader.arbatnbr";54;0"
   heading         =   "Lote CXC:"
   height          =   21.000000
   left            =   128.000000
   level           =   "0"
   mask            =   "xxxxxxxxxx"
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   935
   top             =   142
   visible         =   TRUE
   width           =   77.000000
End
Begin SAF.SAFMaskedText LoteIN
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   FALSE
   fieldname       =   ""bsoshipheader.inbatnbr";1596;0"
   heading         =   "Lote De Inventario:"
   height          =   21
   left            =   128.000000
   level           =   "0"
   mask            =   "xxxxxxxxxx"
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   936
   top             =   166.000000
   visible         =   TRUE
   width           =   77.000000
End
Begin SAFTools.SAFLabel Label1
'' Created         =   True
   caption         =   "Sì Diario de Ventas Esta Vacio No ha generado Polizas Contables"
   forecolor       =   255
   height          =   435
   left            =   60
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   937
   top             =   2730
   visible         =   TRUE
   width           =   3090
End
Begin SAFTools.SAFLabel Label2
'' Created         =   True
   caption         =   "Diario de Ventas:"
   height          =   18
   left            =   2
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   tabindex        =   938
   top             =   289
   visible         =   TRUE
   width           =   136
End
Begin SAFTools.SAFLabel Label3
'' Created         =   True
'' Version         =   6
   caption         =   "Lote de CXC:"
   height          =   17
   left            =   8.000000
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   939
   top             =   141
   visible         =   TRUE
   width           =   96
End
Begin SAFTools.SAFLabel Label4
'' Created         =   True
'' Version         =   6
   caption         =   "Lote de Inventario:"
   height          =   17
   left            =   8.000000
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   tabindex        =   940
   top             =   166.000000
   visible         =   TRUE
   width           =   106
End
Begin SAFTools.SAFButton xImp
'' Created         =   True
'' Version         =   6
   backcolor       =   -2147483633
   caption         =   "Imp. FE"
   customtabpagenumber=   1
   fontbold        =   TRUE
   fontitalic      =   FALSE
   fontname        =   "MS Sans Serif"
   fontsize        =   8
   fontstrikethru  =   FALSE
   fontunderline   =   FALSE
   height          =   21.000000
   left            =   467.000000
   maskcolor       =   12632256
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   907
   top             =   345.000000
   visible         =   TRUE
   width           =   82.000000
End
Begin SAFTools.SAFButton xfrAddenda_OPEN
'' Created         =   True
'' Version         =   6
   caption         =   "Seguros"
   height          =   22
   left            =   434
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   1014
   top             =   567
   visible         =   TRUE
   width           =   89
End
Begin VB.Form xfrAddenda
'' Created         =   True
'' Version         =   6
   caption         =   "Addenda Seguros"
   height          =   526
   left            =   102
   top             =   142
   width           =   844
   windowstate     =   0
End
Begin SAFTools.SAFButton xfrAddenda_CLOSE
'' Created         =   True
'' Version         =   6
   caption         =   "&Aceptar"
   height          =   25
   left            =   496
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   1010
   top             =   409
   visible         =   TRUE
   width           =   75
End
Begin SAFTools.SAFFrame fraGeneral
'' Created         =   True
'' Version         =   6
   caption         =   "General"
   height          =   327
   left            =   1
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   1013
   tabstop         =   FALSE
   top             =   1
   visible         =   TRUE
   width           =   411
End
Begin SAF.SAFMaskedText xcPoliza
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numeropoliza";460;0"
   heading         =   "xcPoliza"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1014
   top             =   22
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText xcSiniestro
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numerosiniestro";540;0"
   heading         =   "xcSiniestro"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1015
   top             =   45
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText xcNoReporte
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numeroreporte";500;0"
   heading         =   "xcNoReporte"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1016
   top             =   68
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText xcNombreAseg
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.nombreasegurado";340;0"
   heading         =   "xcNombreAseg"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1017
   top             =   91
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFCombo xcTipoDoctoRef
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.tdocref";648;0"
   heading         =   "xcTipoDoctoRef"
   height          =   21
   left            =   151
   level           =   "---"
   list            =   "ON;ORDEN DE COMPRA,DQ;REMISIÓN,CT;CONTRATO,NC;NOTA CREDITO,FE;FACTURA ELECTRONICA,OP;ORDEN PRODUCCIÓN,PY;PROYECTO,PO;PÓLIZA,SV;SERVICIO,CO;COTIZACIÓN"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1018
   top             =   114
   visible         =   TRUE
   width           =   167
End
Begin SAF.SAFMaskedText xcNoTramitador
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numerotramitador";580;0"
   heading         =   "xcNoTramitador"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1019
   top             =   137
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText xcTraccion
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.traccion";692;0"
   heading         =   "xcTraccion"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1020
   top             =   161
   visible         =   TRUE
   width           =   88
End
Begin SAF.SAFMaskedText xcTransmision
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.transmision";1008;0"
   heading         =   "xcTransmision"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1021
   top             =   184
   visible         =   TRUE
   width           =   88
End
Begin SAF.SAFMaskedText xcMotorAddenda
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.motor";96;0"
   heading         =   "xcMotorAddenda"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1022
   top             =   207
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFFloat xcDeducible
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   2
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.montodeducible";88;2"
   heading         =   "xcDeducible"
   height          =   21
   left            =   151
   level           =   "---"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1023
   top             =   230
   visible         =   TRUE
   width           =   112
End
Begin SAF.SAFFloat xcPorcDeducible
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   2
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.porcdeducible";916;2"
   heading         =   "xcPorcDeducible"
   height          =   21
   left            =   151
   level           =   "---"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1023
   top             =   253
   visible         =   TRUE
   width           =   112
End
Begin SAF.SAFCombo xcTipoVehiculo
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.tipovehiculo";968;0"
   heading         =   "xcTipoVehiculo"
   height          =   21
   left            =   151
   level           =   "---"
   list            =   "SEDAN;SEDAN,CAMIONETA;CAMIONETA,CARGA;CARGA,PARTICULAR;PARTICULAR"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1024
   top             =   276
   visible         =   TRUE
   width           =   167
End
Begin SAF.SAFCombo xcTipoCliente
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.tipocliente";948;0"
   heading         =   "xcTipoCliente"
   height          =   21
   left            =   151
   level           =   "---"
   list            =   "0;Asegurado,1;Tercero"
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1025
   top             =   300
   visible         =   TRUE
   width           =   167
End
Begin SAFTools.SAFFrame Frame4
'' Created         =   True
'' Version         =   6
   caption         =   "Qualitas Deducible"
   height          =   130
   left            =   420
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   1027
   tabstop         =   FALSE
   top             =   198
   visible         =   TRUE
   width           =   411
End
Begin SAFTools.SAFFrame Frame5
'' Created         =   True
'' Version         =   6
   caption         =   "Qualitas Demerito Recupero"
   height          =   157
   left            =   1
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   1028
   tabstop         =   FALSE
   top             =   332
   visible         =   TRUE
   width           =   411
End
Begin SAF.SAFMaskedText xcFolioElectRef
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qfolioelectref";436;0"
   heading         =   "xcFolioElectRef"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1029
   top             =   22
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFMaskedText xcFolioElectMO
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qfolioelectmo";496;0"
   heading         =   "xcFolioElectMO"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1030
   top             =   45.000000
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFCombo xcBancoDeposito
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qbancodeposito";556;0"
   heading         =   "xcBancoDeposito"
   height          =   21
   left            =   151
   level           =   "---"
   list            =   "Bancomer;Bancomer,Scotiabank;Scotiabank,Santander;Santander,Banamex;Banamex,HSBC;HSBC,Banorte;Banorte,IXE;IXE,Asegurador;Aseguradora,X;X"
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1031
   top             =   68
   visible         =   TRUE
   width           =   167
End
Begin DSLDate xcFechaDeposito
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qfechadeposito";576;3"
   heading         =   "xcFechaDeposito"
   height          =   18
   left            =   151
   level           =   "---"
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1032
   top             =   90
   visible         =   TRUE
   width           =   75
End
Begin SAF.SAFMaskedText xcFolioFichaReferencia
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qfolioficharef";580;0"
   heading         =   "xcFolioFichaReferencia"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1033
   top             =   112
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFFloat xcMontoDemerito
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   2
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qdemeritomonto";640;2"
   heading         =   "xcMontoDemerito"
   height          =   21
   left            =   151
   level           =   "---"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1034
   top             =   22
   visible         =   TRUE
   width           =   112
End
Begin SAF.SAFCombo xcBancoDemerito
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qdbancodeposito";648;0"
   heading         =   "xcBancoDemerito"
   height          =   21
   left            =   151
   level           =   "---"
   list            =   "Bancomer;Bancomer,Scotiabank;Scotiabank,Santander;Santander,Banamex;Banamex,HSBC;HSBC,Banorte;Banorte,IXE;IXE,Asegurador;Aseguradora,X;X"
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1035
   top             =   46
   visible         =   TRUE
   width           =   167
End
Begin DSLDate xcFechaDepositoDemerito
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qdfechadeposito";668;3"
   heading         =   "xcFechaDepositoDemerito"
   height          =   18
   left            =   151
   level           =   "---"
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1036
   top             =   69
   visible         =   TRUE
   width           =   75
End
Begin SAF.SAFMaskedText xcFolioRefDemerito
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.qdoliofecharef";672;0"
   heading         =   "xcFolioRefDemerito"
   height          =   21
   left            =   151
   level           =   "---"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1037
   top             =   91
   visible         =   TRUE
   width           =   248
End
Begin SAFTools.SAFLabel xlPoliza
'' Created         =   True
'' Version         =   6
   caption         =   "Póliza:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1038
   top             =   22
   visible         =   TRUE
   width           =   64
End
Begin SAFTools.SAFLabel xlSiniestro
'' Created         =   True
'' Version         =   6
   caption         =   "Siniestro:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1038
   top             =   45.000000
   visible         =   TRUE
   width           =   88
End
Begin SAFTools.SAFLabel xlNoReporte
'' Created         =   True
'' Version         =   6
   caption         =   "No. de Reporte:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1039
   top             =   68.000000
   visible         =   TRUE
   width           =   88
End
Begin SAFTools.SAFLabel xlNombreAseg
'' Created         =   True
'' Version         =   6
   caption         =   "Nombre Aseguradora:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1040
   top             =   91
   visible         =   TRUE
   width           =   131
End
Begin SAFTools.SAFLabel xlTipoDoctoRef
'' Created         =   True
'' Version         =   6
   caption         =   "Tipo Documento Referencia:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1041
   top             =   114
   visible         =   TRUE
   width           =   145
End
Begin SAFTools.SAFLabel xlNoTramitador
'' Created         =   True
'' Version         =   6
   caption         =   "No. de Tramitador:"
   height          =   17
   left            =   6.000000
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1042
   top             =   137.000000
   visible         =   TRUE
   width           =   112
End
Begin SAFTools.SAFLabel xlTraccion
'' Created         =   True
'' Version         =   6
   caption         =   "Tracción:"
   height          =   17
   left            =   6.000000
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1043
   top             =   160
   visible         =   TRUE
   width           =   80
End
Begin SAFTools.SAFLabel xlTransmision
'' Created         =   True
'' Version         =   6
   caption         =   "Transmisión:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1044
   top             =   183
   visible         =   TRUE
   width           =   104
End
Begin SAFTools.SAFLabel xlMotorAddenda
'' Created         =   True
'' Version         =   6
   caption         =   "Motor:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1045
   top             =   206.000000
   visible         =   TRUE
   width           =   112
End
Begin SAFTools.SAFLabel xlDeducible
'' Created         =   True
'' Version         =   6
   caption         =   "Deducible:"
   height          =   17
   left            =   6.000000
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1046
   top             =   253
   visible         =   TRUE
   width           =   88
End
Begin SAFTools.SAFLabel xlMontoDeducible
'' Created         =   True
'' Version         =   6
   caption         =   "Monto Deducible:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1047
   top             =   230.000000
   visible         =   TRUE
   width           =   128
End
Begin SAFTools.SAFLabel xlTipoVehiculo
'' Created         =   True
'' Version         =   6
   caption         =   "Tipo de Vehículo:"
   height          =   17
   left            =   6
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1048
   top             =   276
   visible         =   TRUE
   width           =   112
End
Begin SAFTools.SAFLabel xltipoCliente
'' Created         =   True
'' Version         =   6
   caption         =   "Tipo de Cliente:"
   height          =   17
   left            =   6.000000
'' parent          =   "fraGeneral"
'' parentform      =   "xfrAddenda"
   tabindex        =   1049
   top             =   300.000000
   visible         =   TRUE
   width           =   104
End
Begin SAFTools.SAFLabel xlFolioElecRef
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Electrónico Refacs:"
   height          =   17
   left            =   6
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1050
   top             =   22
   visible         =   TRUE
   width           =   141
End
Begin SAFTools.SAFLabel xlFolioElectrMO
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Electrónico MO:"
   height          =   17
   left            =   6
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1051
   top             =   45
   visible         =   TRUE
   width           =   120
End
Begin SAFTools.SAFLabel xlBancoDeposito
'' Created         =   True
'' Version         =   6
   caption         =   "Banco Depósito:"
   height          =   17
   left            =   6
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1052
   top             =   68
   visible         =   TRUE
   width           =   120
End
Begin SAFTools.SAFLabel xlFechaDeposito
'' Created         =   True
'' Version         =   6
   caption         =   "Fecha Depósito:"
   height          =   17
   left            =   6
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1053
   top             =   91
   visible         =   TRUE
   width           =   120
End
Begin SAFTools.SAFLabel xlFolioFechaRef
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Fecha Referencia:"
   height          =   17
   left            =   6.000000
'' parent          =   "Frame5"
'' parentform      =   "xfrAddenda"
   tabindex        =   1054
   top             =   114.000000
   visible         =   TRUE
   width           =   120
End
Begin SAFTools.SAFLabel xlMonto
'' Created         =   True
'' Version         =   6
   caption         =   "Monto:"
   height          =   17
   left            =   6.000000
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1055
   top             =   22.000000
   visible         =   TRUE
   width           =   56
End
Begin SAFTools.SAFLabel xlBanco
'' Created         =   True
'' Version         =   6
   caption         =   "Banco:"
   height          =   17
   left            =   6.000000
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1056
   top             =   45.000000
   visible         =   TRUE
   width           =   56
End
Begin SAFTools.SAFLabel xlFechaDepositoQualitas
'' Created         =   True
'' Version         =   6
   caption         =   "Fecha Depósito:"
   height          =   17
   left            =   6
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1057
   top             =   68
   visible         =   TRUE
   width           =   133
End
Begin SAFTools.SAFLabel xlFechaFolioReferencia
'' Created         =   True
'' Version         =   6
   caption         =   "Fecha Folio Referencia:"
   height          =   17
   left            =   6
'' parent          =   "Frame4"
'' parentform      =   "xfrAddenda"
   tabindex        =   1058
   top             =   91
   visible         =   TRUE
   width           =   138
End
Begin SAF.SAFMaskedText xcServiceCallId
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.servicecallid";924;0"
   heading         =   "xcServiceCallId"
   height          =   25
   left            =   597
   level           =   "---"
   mask            =   "xxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   1060
   tabstop         =   FALSE
   top             =   408
   visible         =   TRUE
   width           =   88
End
Begin VB.Form fSEVASA
'' Created         =   True
'' Version         =   6
   caption         =   "Datos de Seguro"
   height          =   546.000000
   left            =   268.000000
   top             =   136.000000
   width           =   833.000000
   windowstate     =   0
End
Begin SAFTools.SAFButton fSEVASA_CLOSE
'' Created         =   True
'' Version         =   6
   caption         =   "OK"
   height          =   21
   left            =   707
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   978
   top             =   487
   visible         =   TRUE
   width           =   75
End
Begin SAFTools.SAFLabel lPoliza
'' Created         =   True
'' Version         =   6
   caption         =   "Poliza * : "
   height          =   13
   left            =   39
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   596
   top             =   12
   visible         =   TRUE
   width           =   51
End
Begin SAFTools.SAFLabel lSiniestro
'' Created         =   True
'' Version         =   6
   caption         =   "Siniestro * : "
   height          =   13
   left            =   39.000000
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   598
   top             =   34
   visible         =   TRUE
   width           =   56
End
Begin SAFTools.SAFLabel lTramite
'' Created         =   True
'' Version         =   6
   autosize        =   TRUE
   caption         =   "Nombre de Aseg * ."
   height          =   20
   left            =   40
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   602
   top             =   110
   visible         =   TRUE
   width           =   96
End
Begin SAFTools.SAFLabel lRiesgo
'' Created         =   True
'' Version         =   6
   caption         =   "No. Tramitador: "
   height          =   13
   left            =   40
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   604
   top             =   158
   visible         =   TRUE
   width           =   82
End
Begin SAFTools.SAFLabel lblConvenio
'' Created         =   True
'' Version         =   6
   caption         =   "Tracción:"
   height          =   17
   left            =   39
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   887
   top             =   182
   visible         =   TRUE
   width           =   55
End
Begin SAFTools.SAFLabel lNoReporte
'' Created         =   True
'' Version         =   6
   caption         =   "No. Reporte * :"
   height          =   17
   left            =   39
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   956
   top             =   56
   visible         =   TRUE
   width           =   72
End
Begin SAFTools.SAFLabel Transmision
'' Created         =   True
'' Version         =   6
   caption         =   "Transmision"
   height          =   17
   left            =   39
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   956
   top             =   209
   visible         =   TRUE
   width           =   88
End
Begin SAFTools.SAFLabel Motor
'' Created         =   True
'' Version         =   6
   caption         =   "Motor"
   height          =   17
   left            =   42
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   956
   top             =   234
   visible         =   TRUE
   width           =   40
End
Begin SAFTools.SAFLabel MontoDeducible
'' Created         =   True
'' Version         =   6
   caption         =   "MontoDeducible"
   height          =   17
   left            =   39
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   956
   top             =   286
   visible         =   TRUE
   width           =   91
End
Begin SAFLabel NoTramitador
   height          =   255
   left            =   2160
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   885
   width           =   1440
End
Begin SAF.SAFMaskedText NumeroPoliza
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numeropoliza";460;0"
   heading         =   "NumeroPoliza"
   height          =   17
   left            =   134
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   953
   top             =   8
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText NumeroSiniestro
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numerosiniestro";540;0"
   heading         =   "NumeroSiniestro"
   height          =   17
   left            =   135
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   954
   top             =   32
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText NoReporte
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numeroreporte";500;0"
   heading         =   "NoReporte"
   height          =   17
   left            =   136
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   955
   top             =   56
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText NomAseg
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.nombreasegurado";340;0"
   heading         =   "NomAseg"
   height          =   17
   left            =   137
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   958
   top             =   108
   visible         =   TRUE
   width           =   298
End
Begin SAF.SAFMaskedText xNoTramitador
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.numerotramitador";580;0"
   heading         =   "xNoTramitador"
   height          =   17
   left            =   138
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   961
   top             =   157
   visible         =   TRUE
   width           =   168
End
Begin SAF.SAFMaskedText Traccion
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.traccion";672;0"
   heading         =   "Traccion"
   height          =   17
   left            =   137
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   962
   top             =   182
   visible         =   TRUE
   width           =   88
End
Begin SAF.SAFMaskedText xTransmision
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.transmision";692;0"
   heading         =   "xTransmision"
   height          =   17
   left            =   137
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   964
   top             =   208
   visible         =   TRUE
   width           =   88
End
Begin SAF.SAFMaskedText xMotor
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.motor";280;0"
   heading         =   "xMotor"
   height          =   17
   left            =   136
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   965
   top             =   233
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFFloat pctDeducible
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.porcdeducible";620;2"
   heading         =   "pctDeducible"
   height          =   17
   left            =   136
   level           =   "NOLEVEL"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   966
   top             =   259
   visible         =   TRUE
   width           =   112
End
Begin SAF.SAFFloat xMontoDeducible
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.montodeducible";272;2"
   heading         =   "xMontoDeducible"
   height          =   17
   left            =   137
   level           =   "NOLEVEL"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   967
   top             =   286
   visible         =   TRUE
   width           =   112
End
Begin SAFMaskedText cPoliza
   height          =   225
   left            =   1095
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   120
   width           =   2520
End
Begin SAFFloat cDeducible
   height          =   315
   left            =   1215
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   1905
   width           =   1680
End
Begin SAFMaskedText cSiniestro
   height          =   240
   left            =   1095
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   480
   width           =   2520
End
Begin SAFMaskedText cTramite
   height          =   315
   left            =   1110
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   2370
   width           =   1920
End
Begin SAFMaskedText cRiesgo
   height          =   315
   left            =   1065
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   2805
   width           =   1320
End
Begin SAFCombo xConvenio
   height          =   315
   left            =   1035
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   3210
   width           =   1530
End
Begin SAFCombo xnombreasegurado
   height          =   270
   left            =   2040
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   964
   top             =   1560
   width           =   1935
End
Begin SAF.SAFCombo xTipoVehiculo
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.TipoVehiculo";868;0"
   heading         =   "xTipoVehiculo"
   height          =   21
   left            =   137
   level           =   "NOLEVEL"
   list            =   "SEDAN;SEDAN,CAMIONETA;CAMIONETA,CARGA;CARGA"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   960
   top             =   130
   visible         =   TRUE
   width           =   101
End
Begin SAF.SAFCombo xTipoCte
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.TipoCliente";868;0"
   heading         =   "xTipoCte"
   height          =   21
   left            =   136
   level           =   "NOLEVEL"
   list            =   "0;ASEGURADO,1;TERCERO"
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   957
   top             =   79
   visible         =   TRUE
   width           =   101
End
Begin SAFLabel Deducible
   height          =   255
   left            =   90
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   961
   top             =   1125
   width           =   960
End
Begin SAFTools.SAFLabel lPorcDeduc
'' Created         =   True
'' Version         =   6
   caption         =   "% Deducible"
   height          =   17
   left            =   39
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   983
   top             =   259
   visible         =   TRUE
   width           =   80
End
Begin SAFTools.SAFLabel lPorc
'' Created         =   True
'' Version         =   6
   caption         =   "%"
   height          =   17
   left            =   249
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   984
   top             =   260
   visible         =   TRUE
   width           =   40
End
Begin SAFLabel lOblig
   height          =   255
   left            =   285
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   180
   width           =   300
End
Begin SAFLabel lOb2
   height          =   255
   left            =   150
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   510
   width           =   480
End
Begin SAFLabel lOb3
   height          =   255
   left            =   90
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   1215
   width           =   480
End
Begin SAFLabel lOb4
   height          =   255
   left            =   60
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   1650
   width           =   480
End
Begin SAFLabel lOb5
   height          =   255
   left            =   60
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   1995
   width           =   480
End
Begin SAFLabel lOb6
   height          =   255
   left            =   60
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   2355
   width           =   480
End
Begin SAFLabel lOb7
   height          =   255
   left            =   45
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   2715
   width           =   480
End
Begin SAFLabel lOb8
   height          =   255
   left            =   0
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   3150
   width           =   480
End
Begin SAFLabel lTipoV
   height          =   255
   left            =   0
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   0
   width           =   720
End
Begin SAFLabel lTipoCte
   height          =   255
   left            =   585
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   1215
   width           =   960
End
Begin SAFLabel lDeducible
   caption         =   "Tipo de Vehiculo:"
   height          =   195
   left            =   600
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   top             =   1995
   width           =   1290
End
Begin SAFTools.SAFLabel lTCte
'' Created         =   True
'' Version         =   6
   caption         =   "Tipo de Cliente * :"
   height          =   17
   left            =   40
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   987
   top             =   80
   visible         =   TRUE
   width           =   91
End
Begin SAFTools.SAFLabel lTVe
'' Created         =   True
'' Version         =   6
   caption         =   "Tipo de Vehiculo *:"
   height          =   17
   left            =   40
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   987
   top             =   133
   visible         =   TRUE
   width           =   95
End
Begin SAFTools.SAFLabel lMarca
'' Created         =   True
'' Version         =   6
   caption         =   "Marca *:"
   height          =   17
   left            =   461
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   11
   visible         =   TRUE
   width           =   48
End
Begin SAFTools.SAFLabel lModelo
'' Created         =   True
'' Version         =   6
   caption         =   "Sub Marca *:"
   height          =   17
   left            =   449
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   34
   visible         =   TRUE
   width           =   68
End
Begin SAFTools.SAFLabel lYear
'' Created         =   True
'' Version         =   6
   caption         =   "Año *:"
   height          =   17
   left            =   461
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   59
   visible         =   TRUE
   width           =   40
End
Begin SAFTools.SAFLabel lColor
'' Created         =   True
'' Version         =   6
   caption         =   "Color *:"
   height          =   17
   left            =   462
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   82
   visible         =   TRUE
   width           =   48
End
Begin SAFTools.SAFLabel lSerie
'' Created         =   True
'' Version         =   6
   caption         =   "Serie *:"
   height          =   17
   left            =   463
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   109
   visible         =   TRUE
   width           =   48
End
Begin SAFTools.SAFLabel lPlacas
'' Created         =   True
'' Version         =   6
   caption         =   "Placas *:"
   height          =   17
   left            =   462
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   130
   visible         =   TRUE
   width           =   56
End
Begin SAFTools.SAFLabel lKms
'' Created         =   True
'' Version         =   6
   caption         =   "Kms:"
   height          =   17
   left            =   463
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   987
   top             =   153
   visible         =   TRUE
   width           =   32
End
Begin SAF.SAFMaskedText xMarca
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   default         =   "NISSAN"
   enabled         =   TRUE
   fieldname       =   ""bauordadic.marca";88;0"
   heading         =   "xMarca"
   height          =   17
   left            =   520
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   968
   top             =   13
   visible         =   TRUE
   width           =   125
End
Begin SAF.SAFMaskedText xModelo
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bauordadic.modelo";148;0"
   heading         =   "xModelo"
   height          =   17
   left            =   520
   level           =   "NOLEVEL"
   list            =   "N50Z;350Z,370Z;370Z,ALMERA;ALMERA,ALTIMA;ALTIMA,APRIO;APRIO,ARMADA;ARMADA,CHASIS;CHASIS,DOBLECAB;DOBLE CABINA,ESTACAS;ESTACAS,FRONTIER;FRONTIER,GSI;TSURU GSI,GSII;TSURU GSII,INFINITI;INFINITI,LUCINO;LUCINO,MARCH;MARCH,MAXIMA;MAXIMA,MICRA;MICRA,MURANO;MURANO,MURANO 09;MURANO 09,PATHFINDER;PATHFINDER,PICKUP;PICKUP,PLATINA;PLATINA,QUEST;QUEST,ROGUE;ROGUE,SENTRA;SENTRA,TIIDA;TIIDA,TITAN;TITAN,TSUBAME;TSUBAME,URVAN;URVAN,VAGONETA;VAGONETA,XTERRA;XTERRA,XTRAIL;XTRAIL,XTRAIL 08;XTRAIL 08,OTROS;OTROS, ; "
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   969
   top             =   34
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFMaskedText xColor
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bauordadic.color";20;0"
   heading         =   "xColor"
   height          =   17
   left            =   520
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   971
   top             =   77
   visible         =   TRUE
   width           =   248
End
Begin SAFMaskedText xYear
   height          =   255
   left            =   7800
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   top             =   870
   width           =   1185
End
Begin SAF.SAFMaskedText xYear1
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bauordadic.year";328;0"
   heading         =   "xYear1"
   height          =   17
   left            =   521
   level           =   "NOLEVEL"
   mask            =   "xxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   970
   top             =   55
   visible         =   TRUE
   width           =   40
End
Begin SAF.SAFMaskedText xPlacas
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bauordadic.placas";208;0"
   heading         =   "xPlacas"
   height          =   17
   left            =   521
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   973
   top             =   122
   visible         =   TRUE
   width           =   248
End
Begin SAFLabel xKms
   height          =   255
   left            =   0
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   top             =   0
   width           =   480
End
Begin SAF.SAFFloat xKms1
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bauordadic.kms";80;2"
   heading         =   "xKms1"
   height          =   17
   left            =   521
   level           =   "NOLEVEL"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   974
   top             =   145
   visible         =   TRUE
   width           =   112
End
Begin SAFCheck xCancel
   height          =   255
   left            =   300
'' parent          =   "fraShipStatus"
'' parentform      =   "Form1"
   top             =   2745
   width           =   1290
End
Begin SAF.SAFMaskedText xSerie
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bauordadic.serie";268;0"
   heading         =   "xSerie"
   height          =   17
   left            =   521
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   972
   top             =   99
   visible         =   TRUE
   width           =   248
End
Begin SAFButton xPbaRef
   customtabpagenumber=   1
   height          =   300
   left            =   7515
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   top             =   4710
   width           =   375
End
Begin SAFTools.SAFButton xvtSerie
'' Created         =   True
'' Version         =   6
   caption         =   "Carga Serie"
   height          =   21.000000
   left            =   790.000000
'' parent          =   "frmLotSerial"
'' parentform      =   "frmLotSerial"
   tabindex        =   990
   top             =   252.000000
   visible         =   TRUE
   width           =   85.000000
End
Begin Frame pnlGrid
'' Version         =   6
   height          =   245.000000
   left            =   .000000
   top             =   .000000
   width           =   981.000000
End
Begin SAF.SAFMaskedText xMod
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bauordadic.otu";576;0"
   heading         =   "xMod"
   height          =   19
   left            =   522
   level           =   "NOLEVEL"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   pv              =   "AuChasis_All"
   tabindex        =   975
   top             =   171
   visible         =   TRUE
   width           =   60
End
Begin SAFTools.SAFLabel Echasis
'' Created         =   True
'' Version         =   6
   caption         =   "Chasis *:"
   height          =   17
   left            =   461
'' parent          =   "xfrAddenda"
'' parentform      =   "xfrAddenda"
   tabindex        =   991
   top             =   178
   visible         =   TRUE
   width           =   47
End
Begin SAFTools.SAFButton xCotizacion
'' Created         =   True
'' Version         =   6
   caption         =   "Cotización"
   height          =   21.000000
   left            =   110.000000
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   994
   top             =   568.000000
   visible         =   TRUE
   width           =   77.000000
End
Begin VB.Form frmSubstitutes
'' Version         =   6
   height          =   156
   left            =   326
   top             =   568
   width           =   260
End
Begin VB.Form frmPriceNegotiator
'' Version         =   6
   height          =   461
   left            =   146
   top             =   211
   width           =   778
End
Begin VB.Form frmMarkForHeader
'' Version         =   6
   height          =   395
   left            =   179
   top             =   329
   width           =   755
End
Begin SAF.SAFFloat cPedida
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   customtabpagenumber=   1
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bsoshipline.qtyord";1260;2"
   heading         =   "C.Pedida"
   height          =   17
   left            =   692
   level           =   "1"
   max             =   9999999999999.00
   min             =   -999999999.990000
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   tabindex        =   43
   top             =   258
   visible         =   FALSE
   width           =   84
End
Begin SAFTools.SAFButton xImpPba
'' Created         =   True
'' Version         =   6
   caption         =   "Re-Imprime"
   customtabpagenumber=   1
   height          =   21.000000
   left            =   630.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   996
   top             =   345.000000
   visible         =   FALSE
   width           =   80.000000
End
Begin VB.Form frmRelease
'' Version         =   6
   height          =   277
   left            =   347
   top             =   295
   width           =   402
   windowstate     =   0
End
Begin VB.Form frmPrint
'' Version         =   6
   height          =   393
   left            =   258
   top             =   209
   width           =   597
   windowstate     =   0
End
Begin VB.Form frmKitExplode
'' Version         =   6
   height          =   177
   left            =   355
   top             =   531
   width           =   269
End
Begin VB.Form frmCreateShipper
'' Version         =   6
   height          =   250
   left            =   465
   top             =   393
   width           =   389
End
Begin SAFTools.SAFButton bBancos_OPEN
'' Created         =   True
'' Version         =   6
   caption         =   "Bancos"
   customtabpagenumber=   1
   height          =   21.000000
   left            =   552.000000
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   tabindex        =   997
   top             =   345.000000
   visible         =   TRUE
   width           =   75.000000
End
Begin VB.Form bBancos
'' Created         =   True
'' Version         =   6
   caption         =   "Datos de la Cuenta Bancaria"
   height          =   240
   left            =   189
   top             =   373
   width           =   454
   windowstate     =   0
End
Begin SAFTools.SAFButton bBancos_CLOSE
'' Created         =   True
'' Version         =   6
   caption         =   "OK"
   height          =   21
   left            =   306
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   995
   top             =   167
   visible         =   TRUE
   width           =   75
End
Begin SAFTools.SAFLabel lBanco
'' Created         =   True
'' Version         =   6
   caption         =   "Banco"
   height          =   17
   left            =   29
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   997
   top             =   61
   visible         =   TRUE
   width           =   48
End
Begin SAFTools.SAFLabel lFPago
'' Created         =   True
'' Version         =   6
   caption         =   "Forma de Pago:"
   height          =   17
   left            =   28
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   997
   top             =   90
   visible         =   TRUE
   width           =   95
End
Begin SAFTools.SAFLabel lCuenta
'' Created         =   True
'' Version         =   6
   caption         =   "Cuenta"
   height          =   17
   left            =   31
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   997
   top             =   121
   visible         =   TRUE
   width           =   56
End
Begin SAF.SAFMaskedText dBanco
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bsoshipheader.s4future01";3112;0"
   heading         =   "dBanco"
   height          =   19
   left            =   134
   level           =   "0"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   997
   top             =   59
   visible         =   TRUE
   width           =   248
End
Begin SAF.SAFMaskedText dCuenta
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bsoshipheader.s4future12";2048;0"
   heading         =   "dCuenta"
   height          =   17
   left            =   134
   level           =   "0"
   mask            =   "9999"
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   997
   top             =   120
   visible         =   TRUE
   width           =   88
End
Begin SAF.SAFCombo dFPagos
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bsoshipheader.s4future02";3232;0"
   heading         =   "dFPagos"
   height          =   21
   left            =   135
   level           =   "0"
   list            =   "01        ;01 Efectivo                   ,02        ;02 Cheque Nominativo          ,03        ;03 Transferencia de Fondos    ,04        ;04 Tarjetas de crédito        ,05        ;05 Monederos electrónicos     ,06        ;06 Dinero electrónico         ,28        ;28 Tarjeta de Debito          ,29        ;29 Tarjeta de Servicio        ,98        ;98 NA                         ,99        ;99 Otros                      "
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   998
   top             =   88
   visible         =   TRUE
   width           =   206
End
Begin SAFTools.SAFLabel Label6
'' Created         =   True
'' Version         =   6
   caption         =   "(Capturar los Ultimos 4 Digitos)"
   height          =   17
   left            =   229
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   tabindex        =   1000
   top             =   121
   visible         =   TRUE
   width           =   174
End
Begin SAFMaskedText dFPago
   height          =   255
   left            =   2355
'' parent          =   "bBancos"
'' parentform      =   "bBancos"
   top             =   1335
   width           =   1320
End
Begin SAF.SAFFloat xcPrice1
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bsoshipline.s4future06"; 0; 0; 0"
   heading         =   "Precio Unitario"
   height          =   21
   left            =   116
   level           =   "1"
   max             =   9999999999999.99
   min             =   .000000
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   separator       =   TRUE
   tabindex        =   48
   top             =   64
   visible         =   TRUE
   width           =   113
End
Begin SAFCombo xPcosto
   height          =   315
   left            =   3675
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   top             =   3870
   width           =   795
End
Begin SAFTools.SAFLabel lxNotas
'' Created         =   True
'' Version         =   6
   caption         =   "* Datos obligatorios para Mapfre"
   height          =   17
   left            =   41
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   1001
   top             =   340
   visible         =   TRUE
   width           =   197
End
Begin SAFTools.SAFLabel lFolioElectronicoR
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Electrónico Refacciones:"
   height          =   17
   left            =   6
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   987
   top             =   20
   visible         =   TRUE
   width           =   144
End
Begin SAFTools.SAFLabel lFolioElectronicoV
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Electrónico MO."
   height          =   17
   left            =   6.000000
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   989
   top             =   45
   visible         =   TRUE
   width           =   144
End
Begin SAF.SAFMaskedText cFolioElectronicoR
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QFolioElectRef";44;0"
   heading         =   "cFolioElectronicoR"
   height          =   17
   left            =   170
   level           =   "NOLEVEL"
   mask            =   "UUUUUUUUUUUU"
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   990
   top             =   20
   visible         =   TRUE
   width           =   165
End
Begin SAF.SAFMaskedText cFolioElectronicoV
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QFolioElectMO";104;0"
   heading         =   "cFolioElectronicoV"
   height          =   17
   left            =   170
   level           =   "NOLEVEL"
   mask            =   "UUUUUUUUUUUU"
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   991
   top             =   45
   visible         =   TRUE
   width           =   165
End
Begin SAFTools.SAFLabel lBancoDepDed
'' Created         =   True
'' Version         =   6
   caption         =   "Banco Depósito:"
   height          =   17
   left            =   6.000000
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   991
   top             =   72
   visible         =   TRUE
   width           =   151
End
Begin SAF.SAFCombo cBancoDepDed
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   default         =   "X"
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QBancoDeposito";180;0"
   heading         =   "cBancoDepDed"
   height          =   21
   left            =   170.000000
   level           =   "NOLEVEL"
   list            =   "Bancomer;Bancomer,Scotiabank;Scotiabank,Santander;Santander,Banamex;Banamex,HSBC;HSBC,Banorte;Banorte,IXE;IXE,Aseguradora;Aseguradora,X;X"
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   992
   top             =   70
   visible         =   TRUE
   width           =   122
End
Begin SAF.SAFDate cFechaDepDed
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QFechaDeposito";220;3"
   heading         =   "cFechaDepDed"
   height          =   17
   left            =   170.000000
   level           =   "NOLEVEL"
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   993
   top             =   98
   visible         =   TRUE
   width           =   75
End
Begin SAFTools.SAFLabel lFechaDepDed
'' Created         =   True
'' Version         =   6
   caption         =   "Fecha Depósito:"
   height          =   17
   left            =   6.000000
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   994
   top             =   96
   visible         =   TRUE
   width           =   140
End
Begin SAFTools.SAFLabel lFolioFichaRefded
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Ficha Referencia:"
   height          =   17
   left            =   6.000000
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   994
   top             =   122
   visible         =   TRUE
   width           =   136
End
Begin SAF.SAFMaskedText cFolioFichaRefDed
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QFolioFichaRef";732;0"
   heading         =   "cFolioFichaRefDed"
   height          =   17
   left            =   170.000000
   level           =   "NOLEVEL"
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
'' parent          =   "Frame2"
'' parentform      =   "fSEVASA"
   tabindex        =   995
   top             =   123
   visible         =   TRUE
   width           =   167.000000
End
Begin SAFTools.SAFLabel lMontoDemRec
'' Created         =   True
'' Version         =   6
   caption         =   "Monto:"
   height          =   17
   left            =   7
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   995
   top             =   19
   visible         =   TRUE
   width           =   93
End
Begin SAF.SAFFloat cMontoDemRec
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   decimalplaces   =   "2"
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QDemeritoMonto";164;2"
   heading         =   "cMontoDemRec"
   height          =   17
   left            =   170
   level           =   "NOLEVEL"
   max             =   9999999999999.99
   min             =   -9999999999999.99
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   996
   top             =   17
   visible         =   TRUE
   width           =   112
End
Begin SAFTools.SAFLabel lBancoDepDemRec
'' Created         =   True
'' Version         =   6
   caption         =   "Banco Depósito:"
   height          =   17
   left            =   7
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   996
   top             =   41
   visible         =   TRUE
   width           =   148
End
Begin SAF.SAFCombo cBancoDepDemRec
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   default         =   "X"
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QDBancoDeposito";200;0"
   heading         =   "cBancoDepDemRec"
   height          =   21
   left            =   170
   level           =   "NOLEVEL"
   list            =   "Bancomer;Bancomer,Scotiabank;Scotiabank,Santander;Santander,Banamex;Banamex,HSBC;HSBC,Banorte;Banorte,IXE;IXE,Aseguradora;Aseguradora,X;X"
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   996
   top             =   38
   visible         =   TRUE
   width           =   122
End
Begin SAFTools.SAFLabel lFechaDepDemRec
'' Created         =   True
'' Version         =   6
   caption         =   "Fecha Depósito:"
   height          =   17
   left            =   6
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   997
   top             =   64
   visible         =   TRUE
   width           =   143
End
Begin SAF.SAFDate cFechaDepDemRec
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QDFechaDeposito";224;3"
   heading         =   "cFechaDepDemRec"
   height          =   17
   left            =   170
   level           =   "NOLEVEL"
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   998
   top             =   62
   visible         =   TRUE
   width           =   75
End
Begin SAFTools.SAFLabel lFolioFichaRefDem
'' Created         =   True
'' Version         =   6
   caption         =   "Folio Ficha Referencia:"
   height          =   17
   left            =   6
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   998
   top             =   85
   visible         =   TRUE
   width           =   136
End
Begin SAF.SAFMaskedText cFolioFichaRefDem
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bxfeaddenda.QDolioFechaRef";792;0"
   heading         =   "cFolioFichaRefDem"
   height          =   17
   left            =   170
   level           =   "NOLEVEL"
   mask            =   "UUUUUUUUUUUUUUUUUUUUUUUUUUUUUU"
'' parent          =   "Frame3"
'' parentform      =   "fSEVASA"
   tabindex        =   999
   top             =   84
   visible         =   TRUE
   width           =   167
End
Begin SAFTools.SAFFrame Frame2
'' Created         =   True
   caption         =   "QUALITAS  Deducible   "
   height          =   2295
   left            =   6555
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   1001
   top             =   3135
   visible         =   TRUE
   width           =   5145
End
Begin SAFTools.SAFFrame Frame3
'' Created         =   True
'' Version         =   6
   caption         =   "QUALITAS  Demérito Recupero   "
   height          =   111
   left            =   440
'' parent          =   "fSEVASA"
'' parentform      =   "fSEVASA"
   tabindex        =   1002
   top             =   365
   visible         =   TRUE
   width           =   341
End
Begin SAF.SAFMaskedText xuser101
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bsoshiplot.user2";736;0"
   heading         =   "xuser101"
   height          =   23
   left            =   566
   level           =   "8"
   mask            =   "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
'' parent          =   "pnlGrid"
'' parentform      =   "frmLotSerial"
   tabindex        =   1005
   top             =   76
   visible         =   TRUE
   width           =   54
End
Begin SAFTools.SAFLabel Label8
'' Created         =   True
'' Version         =   6
   caption         =   "Label8"
   height          =   17
   left            =   446
'' parent          =   "pnlGrid"
'' parentform      =   "frmLotSerial"
   tabindex        =   1005
   top             =   80
   visible         =   TRUE
   width           =   48
End
Begin Timer tmrTimer
End
Begin SAFTools.SAFButton cmdLSOK
'' Version         =   6
   height          =   21.000000
   left            =   564.000000
   top             =   252.000000
   width           =   73.000000
End
Begin SAFTools.SAFButton cmdLSCancel
'' Version         =   6
   height          =   21.000000
   left            =   644.000000
   top             =   252.000000
   width           =   73.000000
End
Begin SAFFloat cQtyShipTotal
'' Version         =   6
   height          =   21.000000
   left            =   292.000000
   top             =   252.000000
   width           =   89.000000
End
Begin SAFMaskedText xuser10
   customtabpagenumber=   3
   height          =   300
   left            =   8265
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   top             =   4455
   width           =   540
End
Begin SAFLabel Label7
   customtabpagenumber=   3
   height          =   255
   left            =   6210
'' parent          =   "SSTab1"
'' parentform      =   "Form1"
   top             =   4905
   width           =   1935
End
Begin Label lcaption
   Index           =   5
'' Version         =   6
   height          =   13
   left            =   611
'' parent          =   "fraHdr"
'' parentform      =   "Form1"
   top             =   31
   visible         =   FALSE
   width           =   34
End
Begin SAFMaskedText ccustordnbr_0
'' Version         =   6
   height          =   21
   left            =   377
'' parent          =   "Form1"
'' parentform      =   "Form1"
   top             =   87
   width           =   79
End
Begin SAFCombo cbInvoiceIn
'' Version         =   6
   height          =   21
   left            =   631
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   top             =   314
   width           =   157
End
Begin Label lInvoiceIn
'' Version         =   6
   height          =   13
   left            =   505
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   top             =   317
   width           =   67
End
Begin SAFCheck cConsolInv_0
'' Version         =   6
   height          =   21
   left            =   560
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   top             =   288
   width           =   114
End
Begin SAFMaskedText DiarioV
'' Version         =   6
   height          =   19
   left            =   532
'' parent          =   "_SSTab1_TabPage4"
'' parentform      =   "Form1"
   top             =   433
   width           =   88
End
Begin SAFMaskedText cShipRegisterID
'' Version         =   6
   height          =   21
   left            =   128
'' parent          =   "fraTaxID"
'' parentform      =   "Form1"
   top             =   119
   width           =   77
End
Begin SAFMaskedText ccustid_0
'' Version         =   6
   height          =   21
   left            =   88
'' parent          =   "Form1"
'' parentform      =   "Form1"
   top             =   87
   width           =   90
End
Begin SAFTools.SAFButton xbDatosAdic
'' Created         =   True
'' Version         =   6
   caption         =   "..."
   fontbold        =   TRUE
   height          =   23.000000
   left            =   180
'' parent          =   "Form1"
'' parentform      =   "Form1"
   tabindex        =   1012
   top             =   86
   visible         =   TRUE
   width           =   24
End
Begin Label dcustid_0
'' Version         =   6
   height          =   13
   left            =   88
'' parent          =   "Form1"
'' parentform      =   "Form1"
   top             =   111
   width           =   185
End
Begin GroupBox fraHdr
'' Version         =   6
   height          =   49
   left            =   0
'' parent          =   "Form1"
'' parentform      =   "Form1"
   top             =   31
   width           =   801
End
Begin SAFMaskedText cinvtid_1
'' Version         =   6
   height          =   21
   left            =   118
'' parent          =   "fraItem"
'' parentform      =   "Form1"
   top             =   16
   width           =   224
End
Begin Button cmdFindCustomer
'' Version         =   6
   height          =   21
   left            =   205
'' parent          =   "Form1"
'' parentform      =   "Form1"
   top             =   87
   width           =   25
End
Begin SAFMaskedText cshipperid_0
'' Version         =   6
   height          =   21
   left            =   88
'' parent          =   "fraHdr"
'' parentform      =   "Form1"
   top             =   16
   width           =   112
End
Begin SAF.SAFMaskedText xtxtOrdenServicio
'' Created         =   True
'' Version         =   6
   blankerr        =   FALSE
   enabled         =   TRUE
   fieldname       =   ""bsoshipheader.s4future11";3908;0"
   heading         =   "xtxtOrdenServicio"
   height          =   25
   left            =   473
   level           =   "0"
   mask            =   "xxxxxxxxxx"
'' parent          =   "_SSTab1_TabPage1"
'' parentform      =   "Form1"
   pv              =   ""AuOrdServ_Rem","bpes.CpnyID";0;0;0;0,"bpes.userid";0;0;0;0,"
   tabindex        =   1061
   top             =   368
   visible         =   TRUE
   width           =   88
End
Begin SAFTools.SAFButton xbtnCargaOrdenServicio1
'' Created         =   True
'' Version         =   6
   caption         =   "Carga Orden de Servicio"
   height          =   25
   left            =   580
'' parent          =   "_SSTab1_TabPage1"
'' parentform      =   "Form1"
   tabindex        =   1062
   top             =   368
   visible         =   TRUE
   width           =   130
End
Begin SAFTools.SAFButton xCorrigeIsan
'' Created         =   True
'' Version         =   6
   caption         =   "CorrigeIsan"
   height          =   25
   left            =   728
'' parent          =   "_SSTab1_TabPage1"
'' parentform      =   "Form1"
   tabindex        =   1068
   top             =   368
   visible         =   TRUE
   width           =   63
End
Begin SAFTools.SAFButton Button1
'' Created         =   True
'' Version         =   6
   caption         =   "..."
   height          =   23
   left            =   319.000000
'' parent          =   "fraShipInfo"
'' parentform      =   "Form1"
   tabindex        =   1074
   top             =   31.000000
   visible         =   FALSE
   width           =   23
End

' Begin Macro Text

Source: 1
' VBComponent: ThisScreen, ComponentType: 100 **********************************************************
Option Explicit
Public xGrabarOK As String
Public bExisteAddenda As Boolean
Public WithEvents SivApp As SIVApplication

Function CalcIsan1(taxrate#, TxblAmt#, TxblMax#, TxblMin#) As Double
Dim Rango#, DifRango#
If TxblAmt >= TxblMin Then
   'Solo si el Precio es Mayor al mínimo se hace el cálculo, si no es 0
      taxrate = FPDiv(taxrate, 100, 4)
      Rango = FPSub(TxblMax, TxblMin, 4)
      If TxblAmt >= TxblMax Then
         CalcIsan1 = FPMult(Rango, taxrate, 4)
      Else
         LI = TxblMin
         TASA = taxrate
         If taxrate < 0 Then
           TE = taxrate
           LE = TxblMin
         End If
      End If
    Else
      CalcIsan1 = 0
    End If
End Function

Function CalcIsan(taxrate#, TxblAmt#, TxblMax#, TxblMin#) As Double
Dim Rango#, DifRango#
   If TxblAmt >= TxblMin Then
   'Solo si el Precio es Mayor al mínimo se hace el cálculo, si no es 0
      taxrate = FPDiv(taxrate, 100, 4)
      Rango = FPSub(TxblMax, TxblMin, 4)
      If TxblAmt >= TxblMax Then
         CalcIsan = FPMult(Rango, taxrate, 4)
      Else
         DifRango = FPSub(TxblAmt, TxblMin, 4)
         CalcIsan = FPMult(DifRango, taxrate, 4)
      End If
    Else
      CalcIsan = 0
    End If
End Function

Private Sub bAlta_Click()
    Dim Sentencia   As String
    Dim Result      As Integer
    Dim FolioNuevo  As String * 10
    
    Call MessBox("Err -" & Trim(sivMyApp.Controls("cCustID_0")), vbOKOnly, "ANTENCIÓN")
    If Trim(sivMyApp.Controls("cCustID_0")) <> "000004" Then
       Call MessBox("Err - El Cliente debe ser el de contado para refacciones", vbOKOnly, "ANTENCIÓN")
       Exit Sub
    End If

    If Trim(sivMyApp.Controls("cShipName_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipAttn_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipAddr1_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipAddr2_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipCity_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipState_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipCountry_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipZip_0")) = "" Or _
       Trim(sivMyApp.Controls("cShipPhone_0")) = "" Then
       Call MessBox("Err - Capturar los datos del cliente", vbOKOnly, "ANTENCIÓN")
       Exit Sub
    End If
       
       
    'INICIO DE BUSQUEDA
       
       
    Sentencia = "Select Max(ShipToID) from SoAddress Where CustID = " & Sparm(sivMyApp.Controls("cCustID_0")) & " And ShipToID <> 'DEFAULT'"
    Result = SqlFetch1(c1, Sentencia, bFolioMax, LenB(bFolioMax))
    
    FolioNuevo = "0000000000"
    
    If Result = 0 Then
       FolioNuevo = bFolioMax.FolioMax
    End If
    
    If FolioNuevo = "          " Then
       FolioNuevo = "0000000000"
    End If
    
    Call IncrStrg(FolioNuevo, Len(Trim(FolioNuevo)), 1)
    
    Sentencia = "Insert SoAddress (CustId, ShipToId, Name, Attn, Addr1, Addr2, City, State, Country, Zip, Phone, TaxLocId)" & _
                " Values(" & Sparm(sivMyApp.Controls("cCustID_0")) & "," & _
                             Sparm(FolioNuevo) & "," & _
                             Sparm(sivMyApp.Controls("cShipName_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipAttn_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipAddr1_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipAddr2_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipCity_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipState_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipCountry_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipZip_0")) & "," & _
                             Sparm(sivMyApp.Controls("cShipPhone_0")) & "," & _
                             Sparm(sivMyApp.Controls("cRFC")) & ")"
                             
    Call TranBeg(True)
    Call sql(c2, Sentencia)
    Call TranEnd
    
    Call SqlFree(c1)
    Call SqlFree(c2)
    
    sivMyApp.Controls("cShipToID_0") = FolioNuevo
    
End Sub

Private Sub bBancos_CLOSE_Click()

Call HideForm("bBancos")

End Sub

Private Sub bBancos_Display()

End Sub

Private Sub bBancos_OPEN_Click()

Call dispform("bBancos", True)

End Sub

Private Sub Button1_Click()

 Dim sSQL As String
    Dim sUserId As String
    Dim sCustId As String
    Dim sShipToId As String
    Dim sShipToIdG As String
    
    sCustId = sivMyApp.Controls("ccustid_0")
    sShipToId = RTrim(sivMyApp.Controls("cshiptoid_0"))
    Call GetBufferValue("bpes.userid", sUserId)
    
    If Trim(sCustId) <> "000004" Then
        Call MessBox("Solo puede modificar al cliente 000004", vbOKOnly, "ADVERTENCIA")
        Exit Sub
    End If
    
    sSQL = "Select GroupID, User1, User2 From VS_UserGrp Where GroupID='VREFACC' and UserID = " + Sparm(sUserId)
    serr1 = SqlFetch1(c1, sSQL, bDatos, LenB(bDatos))
    Call ApplSetParmValue(PRMSECTION_VBRDT, "CustId", sCustId)
    'Stop
    If sShipToId = "DEFAULT" Then
        Call ApplSetParmValue(PRMSECTION_VBRDT, "ShipToId", "<NEW>")
        Else
        Call ApplSetParmValue(PRMSECTION_VBRDT, "ShipToId", sShipToId)
    End If
    
    'Call ApplSetParmValue(PRMSECTION_VBRDT, "ShipToId", "DEFAULT")
    If serr1 <> NOTFOUND Then
        If Trim(sCustId) = "000004" Then
            Call ApplSetParmValue(PRMSECTION_VBRDT, "Existe", "1")
        Else
            Call ApplSetParmValue(PRMSECTION_VBRDT, "Existe", "2")
        End If
    Else
        Call ApplSetParmValue(PRMSECTION_VBRDT, "Existe", "1")
    End If
    serr1 = Launch("0826010", True, True, 1)
    
    sCustId = ApplGetReturnParms()
    sShipToIdG = ApplGetReturnParms()
    Call SetObjectValue("cshiptoid_0", sShipToIdG)

End Sub

Private Sub cauthnbr_0_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub cbuildinvtid_0_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub ccancelled_0_Chk(ChkStrg As String, retval As Integer)
   'Facturacion Electronica
    Dim embarque  As String
    Dim xInvcNbr  As String, xFecha
    Dim Result    As String
    Dim canc$
    Dim Sentnecia As String
    
    Call GetBufferValue("bSoShipHeader.ShipperID", embarque)
    Call GetBufferValue("bsoshipheader.invcnbr", xInvcNbr)
    If ChkStrg = "1" Then
        Call MessBox("¿Estás Totalmente Seguro de cancelar el embarque: " & embarque & "?", vbQuestion + vbYesNo, "Confirmando Cancelación")
        Result = MessResponse
        If Result = vbYes Then
           sivMyApp.Save
           
           'verifica que esté cancelado, de lo contrario, volver a intentarlo
           Sentencia = "Select Cancelled From SoShipHeader Where ShipperID = " & Sparm(embarque)
           serr1 = SqlFetch1(c1, Sentencia, bCancelado, LenB(bCancelado))
           
           If serr1 = 9 Then
              Call MessBox("No encontró el registro del embarque, intentar de nuevo", vbOKOnly, "Atención")
              retval = ErrNoMess
              Exit Sub
           End If
           
           If bCancelado.Cancelled = "0" Then
              Call MessBox("No se canceló el embarque, intentar de nuevo", vbOKOnly, "Atención")
              retval = ErrNoMess
              Exit Sub
          End If
           
          If VBA.Trim$(xInvcNbr) <> "" Then
             Call Imprime_FE_REF("0", sivMyApp.Controls("cdatecancelled_0"), sivMyApp.Controls("cinvcnbr_0"), "")
          End If
       Else
          retval = ErrNoMess
       End If
    End If
  ' Fin Facturacion Electronica
    
    If gRefacciones Then
       canc = Trim(GetObjectValue("ccancelled_0"))
       If Left$(Trim(canc), 1) = "1" Then
          sivMyApp.Controls("cMotivo").Properties("Enabled") = True
       Else
          sivMyApp.Controls("cMotivo").Properties("Enabled") = False
       End If
    End If
End Sub


Private Sub cChainDisc_1_Chk(ChkStrg As String, retval As Integer)
Dim Porcentaje As Double
Porcentaje = Trim(GetObjectValue("cChainDisc_1"))
If Porcentaje > 20 Then
        Call MessBox("No tiene permisos para descuentos mayor a 20", vbOKOnly, "ADVERTENCIA")
      retval = ErrNoMess
End If

End Sub

Private Sub ccuryslsprice_1_Chk(ChkStrg As String, retval As Integer)
  Dim xInvtID$, xsiteid$, Sentencia$, usuario$
  xInvtID = Trim(sivMyApp.Controls("cinvtid_1"))
  xsiteid = Trim(sivMyApp.Controls("csiteid_0"))
  Call GetBufferValue("bpes.Userid", usuario)
'  Stop
If Trim(sivMyApp.Controls("csiteid_0")) <> Trim(Obtiene_Almacen("AUTOSNUEVOS")) And Valida_Usuario("PROMEDIO") = False And sivMyApp.Controls("cqtyship_1") > 0 Then
'If Trim(sivMyApp.Controls("csiteid_0")) <> Trim(Obtiene_Almacen("AUTOSSEMINUEVOS")) Then
  Sentencia = "Select avgcost From itemsite Where Siteid = " & Sparm(xsiteid) & " and Invtid = " & Sparm(xInvtID)
  serr1 = SqlFetch1(c1, Sentencia, bRevCto, LenB(bRevCto))
  If serr1 = 0 And bRevCto.CtoProm >= ChkStrg Then
  'If serr1 = 0 And bRevCto.CtoProm > ChkStrg Then
    Call MessBox("Err - No puede facturar por debajo del Costo", vbOKOnly, "ADVERTENCIA")
'    ChkStrg = 0
    'retval = ErrNoMess
   End If
  End If
End Sub


Private Sub ccustid_0_Chk(ChkStrg As String, retval As Integer)

  Dim Sentencia$
  Dim Valor$
  Dim cliente$
  Dim Habilita%
  Dim usuario As String * 47
  Dim Dato As String
  Dim TODAYSDATE As Sdate
  ' Proyecto xVTPedido -------------------------------------- Inicio
  Dim Reg As Integer
  Dim SqlStr As String
  Dim Result As Integer
  Dim GridHandle As Integer
  Dim TipoOrd As String
  Dim CpnyId  As String
  
  Call GetBufferValue("bpes.UserId", usuario)
  Call GetBufferValue("bpes.CpnyID", CpnyId)
  'If RTrim(usuario) = "SYSADMIN" Then Stop

' Busca Numero de Distribuidor en CustomerEdi
    If RTrim(GetObjectValue("csotypeid_0")) = "NF04" Or RTrim(GetObjectValue("csotypeid_0")) = "NC04" Then
        Sentencia = "Select user8 From CustomerEdi Where Custid =" & Sparm(ChkStrg)
        serr1 = SqlFetch1(c1, Sentencia, bDist, LenB(bDist))
        If serr1 = 0 And RTrim(bDist.User8) = "" Then
            Call MessBox("Err - Debe Seleccionar Numero de Distribuidor en la pantalla de Clientes", vbOKOnly, "ADVERTENCIA")
            retval = ErrNoMess
            Exit Sub
        End If
    End If
'Fin Busca Distribuidor
   
'   If gRefacciones = True Or Valida_Usuario("REFSUPER") = True Then
'     serr9 = CallChks("Form1", "csotypeid_0")
'   End If

  TipoOrd = Trim(GetObjectValue("csotypeid_0"))
  If TipoOrd = "" Then
    Call MessBox("Err - Debe Capturar primero el tipo de Orden", vbOKOnly, "ADVERTENCIA")
    retval = ErrNoMess
    Exit Sub
  End If
  
  If UsaPedido = True Then
     GridHandle = GetGridHandle("Spread1")
     Reg = mrowcnt(GridHandle)

     If Reg = 0 Then
        Call SetBufferValue("bsoshipheader.custordnbr", "")
        'Call DispFields("Form1", "xPedido")
     Else
        Call MessBox("Err - No se permite cambiar de cliente cuando ya existen artículos capturados", vbOKOnly, "ADVERTENCIA")
        retval = ErrNoMess
        Exit Sub
     End If
     
  End If
  
  cliente = Trim(ChkStrg)
  Sentencia = "Select * From Customer Where CustId = " & Sparm(cliente)
  serr1 = SqlFetch1(c1, Sentencia, bCustomer, LenB(bCustomer))
'  serr1 = SetObjectValue("xuser3", bCustomer.TaxLocID)
  If serr1 <> NOTFOUND Then
    If Trim(bCustomer.SlsperId) <> "" Then
      Let VendedorCliente = Trim(bCustomer.SlsperId)
      vCambiaVend = True
      If CpnyId = "CODAO" Then
         sivMyApp.Controls("cslsperid_0") = "CR01"
      Else
         sivMyApp.Controls("cslsperid_0") = VendedorCliente
      End If
      vCambiaVend = False
    End If
  End If
  Call SqlFree(c1)
  If sivMyApp.Controls("cshipperid_0") = "" Then
    If Trim(bCustomer.User1) <> "" Then
        Call SetObjectValue("dbanco", Trim(bCustomer.User1))
    End If
    If Trim(bCustomer.User2) <> "" Then
        Call SetObjectValue("dFPagos", Trim(bCustomer.User2))
    End If
    If Trim(bCustomer.S4Future12) <> "" Then
        Call SetObjectValue("dCuenta", Trim(bCustomer.S4Future12))
    End If
  End If
 
  If UsaPedido = True Then
    Let sivMyApp.Controls("csiteid_0") = bPedidoCtrl.SiteID
    Let sivMyApp.Controls("cshipviaid_0") = "01"
    Call GetSysDate(TODAYSDATE)
    Call SetObjectValue("cInvcDate", DateToStrSep(TODAYSDATE))
    Call ApplSetfocus("xPedido")
  End If
  ' Proyecto xVTPedido -------------------------------------- Final
  'Stop
' Facturacion Electronica
    Dim Habilitab As Boolean
    Sentencia = "Select * From xFEClientes Where Custid =" & Sparm(ChkStrg)
    serr1 = SqlFetch1(csr_xFEClientes, Sentencia, bxFEClientes, LenB(bxFEClientes))
    Habilita = IIf(serr1 = 0 And RTrim(bxFEClientes.CdgIntEmisor) <> "", True, False)
    Call setprop("NumeroSiniestro", PROP_BLANKERR, Habilitab)
    Call setprop("NomAseg", PROP_BLANKERR, Habilitab)
    Call setprop("xNoTramitador", PROP_BLANKERR, Habilitab)
    Call setprop("Traccion", PROP_BLANKERR, Habilitab)
    Call setprop("xTransmision", PROP_BLANKERR, Habilitab)
    Call setprop("xMotor", PROP_BLANKERR, Habilitab)
    Call setprop("xMontoDeducible", PROP_BLANKERR, Habilitab)
    
    Dim embarque As String
    Call GetBufferValue("bsoshipheader.shipperid", embarque)
    bxFEAddenda = nxFEAddenda
    Sentencia = "Select * From xFEAddenda Where ServiceCallID =" & Sparm(embarque)
    serr1 = SqlFetch1(csr_xFEAddenda, Sentencia, bxFEAddenda, LenB(bxFEAddenda))
    Call DispFields("fSEVASA", "NumeroPoliza")
    Call DispFields("fSEVASA", "NumeroSiniestro")
    Call DispFields("fSEVASA", "NoReporte")
    Call DispFields("fSEVASA", "xTipoCte")
    Call DispFields("fSEVASA", "NomAseg")
    Call DispFields("fSEVASA", "xTipoVehiculo")
    Call DispFields("fSEVASA", "xNoTramitador")
    Call DispFields("fSEVASA", "Traccion")
    Call DispFields("fSEVASA", "xTransmision")
    Call DispFields("fSEVASA", "xMotor")
    Call DispFields("fSEVASA", "pctDeducible")
    Call DispFields("fSEVASA", "xMontoDeducible")
    
' Fin Facturacion Electronica
  If gRefacciones Then
'----- Trae RFC
            Dim RFC$
            sivMyApp.Controls("cRFC") = RFC
          
    If Left(Trim(ChkStrg), 1) <> "P" Then
      Call MessBox("Cliente no es de Post-Venta", vbOKOnly, "ADVERTENCIA")
      retval = ErrNoMess
    End If
  End If
  
   '------------------------------------------------------------------------
  Dim SentenciaPago As String
  Dim shiptoid As String
  shiptoid = sivMyApp.Controls("cshiptoid_0")
  If (Trim(shiptoid) = "") Then
    shiptoid = "DEFAULT"
  End If
  SentenciaPago = "SELECT banco.descr,pago.descr,DigitosCuenta FROM xsoaddress addr " & _
                "INNER JOIN xAumetodopago pago ON pago.metodoid=addr.metodopago " & _
                "INNER JOIN xAuBancos banco ON banco.bancoid=addr.banco WHERE " & _
                "custid=" & Sparm(cliente) & " AND shiptoid=" & Sparm(shiptoid)
  serr11 = SqlFetch1(c11, SentenciaPago, bxFormaPago, LenB(bxFormaPago))
  If (serr11 = 0) Then
    sivMyApp.Controls("dBanco") = bxFormaPago.banco
    sivMyApp.Controls("dFPagos") = bxFormaPago.metodoPago
    sivMyApp.Controls("dCuenta") = bxFormaPago.DigitosCuenta
  End If
  
  
End Sub

Private Sub ccustordnbr_0_Chk(ChkStrg As String, retval As Integer)
    
End Sub

Private Sub cdiscpct_1_Chk(ChkStrg As String, retval As Integer)
Dim Porcentaje As Double
Porcentaje = Trim(GetObjectValue("cdiscpct_1"))
If Porcentaje > 20 Then
        Call MessBox("No tiene permisos para descuentos mayor a 20", vbOKOnly, "ADVERTENCIA")
      retval = ErrNoMess
End If

End Sub

Private Sub cinvcnbr_0_Chk(ChkStrg As String, retval As Integer)
   If Valida_Usuario("MODFACTURA") = False Then
     If RTrim(ChkStrg) <> "" Then
        Call MessBox("No se perrmite modificar No de Factura", vbOKOnly, "ADVERTENCIA")
        retval = ErrNoMess
     End If
   End If
End Sub

Private Sub cinvtid_1_Chk(ChkStrg As String, retval As Integer)
  Call SetBufferValue("bsoshipline.taxable", "1")
  
  ' Proyecto xVTPedido -------------------------------------- Inicio
    Dim sqlst$
    Dim SqlStr$
    Dim Result       As Integer
    Dim Sentencia    As String
    Dim Comporta     As String
    Dim usuario$
    Call GetBufferValue("bpes.userid", usuario)
'    If Trim(usuario) = "SYSADMIN" Then Stop
    
    'Utiliza adaptación de NUEVOS
    If UsaPedido = True Then
       Call GetBufferValue("bSoType.Behavior", Comporta)
       
       ' Obtiene los tipos de Orden para NUEVOS
       Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where SiteID = " & Sparm(sivMyApp.Controls("cSiteID_0")) & " And SoTypeID = " & Sparm(sivMyApp.Controls("cSoTypeID_0"))
       Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
       
       ' Si el tipo de orden es factura, valida esté capturado en
       ' el pedido el artículo y la serie
       If Result = 0 And bPedidoCtrl.SoClase = "FA" Then
     
          ' Carga datos del pedido
          sqlst = "Select xVTPedido.Pedido, xVTPedido.LotSerNbr From xVTPedido Where Pedido = " & Sparm(Trim(sivMyApp.Controls("xPedido"))) & " And CustID = " & Sparm(Trim(sivMyApp.Controls("cCustID_0")))
          retval = SqlFetch1(c1, sqlst, bPedido, LenB(bPedido))
          If retval = 0 Then
          
              'Valida la Serie esté capturada
              If Trim(bPedido.LotSerNbr) = "" Then
                  Call MessBox("Capturar el No. de serie en el Pedido Primero", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
              Else
                  
                  'Busca unidad
                  sqlst = "Select InvtID, MfgrLotSerNbr From LotSerMst Where InvtID = " & Sparm(ChkStrg) & " And LotSerNbr = " & Sparm(Trim(bPedido.LotSerNbr)) & " And SiteID = " & Sparm(Trim(sivMyApp.Controls("cSiteID_0")))
                  retval = SqlFetch1(c2, sqlst, bSerie, LenB(bSerie))

                  If retval = 0 Then
                     If Trim(bSerie.invtid) <> Trim(ChkStrg) Then
                        Call MessBox("Unidad no coincide con el seleccionado en el pedido", vbOKOnly, "ADVERTENCIA")
                        retval = ErrNoMess
                        Exit Sub
                     End If
                  Else
                     Call MessBox("No encontró unidad en tabla de series", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
              End If
          Else
             Call MessBox("Capturar el Pedido", vbOKOnly, "ADVERTENCIA")
             retval = ErrNoMess
             Exit Sub
          End If
    
          Call SqlFree(c1)
          Call SqlFree(c2)
          Call SqlFree(c3)
       End If
       
       ' Si el tipo de orden es devolución.
       If Result = 0 And bPedidoCtrl.SoClase = "DF" Then
       End If
       ' Si el tipo de orden es débito por accesorios.
       If Result = 0 And bPedidoCtrl.SoClase = "DB" Then
       End If
       ' Si el tipo de orden es una devolución por accesorios.
       If Result = 0 And bPedidoCtrl.SoClase = "DA" Then
       End If
       ' Si el tipo de orden es crédito por descuento.
       If Result = 0 And bPedidoCtrl.SoClase = "CR" Then
       End If
       ' Si el tipo de orden es una cancelación de descuento.
       If Result = 0 And bPedidoCtrl.SoClase = "DC" Then
       End If
       ' Si el tipo de orden es seguros.
       If Result = 0 And bPedidoCtrl.SoClase = "SA" Then
       End If
       ' Si el tipo de orden es una cancelación de seguros.
       If Result = 0 And bPedidoCtrl.SoClase = "XA" Then
       End If
       ' Si el tipo de orden es trámites
       If Result = 0 And bPedidoCtrl.SoClase = "PT" Then
       End If
       ' Si el tipo de orden es cancelación trámites.
       If Result = 0 And bPedidoCtrl.SoClase = "XT" Then
       End If
       ' Si el tipo de orden es trámites descuento
       If Result = 0 And bPedidoCtrl.SoClase = "TD" Then
       End If
       ' Si el tipo de orden es cancelación trámites descuento.
       If Result = 0 And bPedidoCtrl.SoClase = "XD" Then
       End If
    End If
   ' Proyecto xVTPedido -------------------------------------- Final
If gRefacciones Then
 Dim PRICECLASS$, tipor$, tipoart$
 Dim preciomay As Double
 Dim Sqlst2$, Sqlst3$, Sqlst4$
 Dim Almac$, InveId$, Inter As String * 1, aDescr As String * 60
 Dim Existe As Double, Dispo As Double
 'Dim usuario As String

 Call GetBufferValue("bpes.userid", usuario)
 
         Call setprop("cPedida", "Enabled", True)

' ---- Valida que no se pueda facturar artículos que NO sean refacciones
'    Dim Usuario As String * 47
'    Call GetBufferValue("bpes.userid", Usuario)
        tipoart = Trim(GetObjectValue("cinvtid_1"))
        If Trim(Left$(tipoart, 1)) <> "R" Then
            Call MessBox("FACTURAR SOLO REFACCIONES", vbOKOnly, "ADVERTENCIA")
            retval = ErrNoMess
        End If
    
'----   Valida si tiene Intercambios
        Inter = "0"
        InveId = Trim(GetObjectValue("cinvtid_1"))
        Sqlst3 = "select ItemXref.InvtId,ItemXref.Descr,Inventory.Descr from ItemXref, Inventory where ItemXref.InvtId = Inventory.InvtId and ItemXref.AlternateId = " & Sparm(InveId)
        serr2 = SqlFetch1(c1, Sqlst3, bAltId, LenB(bAltId))
        If serr2 <> NOTFOUND Then
            Inter = "1"
        Else
            InveId = Trim(GetObjectValue("cinvtid_1"))
            Sqlst4 = "select ItemXref.AlternateId,ItemXref.Descr,Inventory.Descr from ItemXref , Inventory  where ItemXref.AlternateId = Inventory.InvtId and ItemXref.InvtId = " & Sparm(InveId)
            serr2 = SqlFetch1(c1, Sqlst4, bAltId, LenB(bAltId))
            If serr2 <> NOTFOUND Then
                Inter = "2"
            Else: Inter = "0"
            End If
        End If
                
        If Inter = "1" Then
            Call MessBox("El Artículo : " & vbCrLf & Trim(InveId) & " - " & sivMyApp.Controls("cdescr_1") & vbCrLf & " Tiene este Intercambio :" & vbCrLf & Trim(bAltId.Alterno) & " - " & Trim(bAltId.DescrI), vbOKOnly, "Tiene Intercambio")
        ElseIf Inter = "2" Then
            Call MessBox("El Artículo : " & vbCrLf & Trim(InveId) & " - " & sivMyApp.Controls("cdescr_1") & vbCrLf & " Es Intercambio de :" & vbCrLf & Trim(bAltId.Alterno) & " - " & Trim(bAltId.DescrI), vbOKOnly, "Es Intercambio")
        End If
        


'----   Valida si hay existencia

        InveId = Trim(GetObjectValue("cinvtid_1"))
        Almac = Obtiene_Almacen("REFACCIONES")

        Sqlst2 = "Select itemsite.QtyOnHand,itemsite.QtyAvail from itemsite where InvtId = " & Sparm(InveId) & " and siteid = " & Sparm(Almac)
        serr2 = SqlFetch1(c1, Sqlst2, bInvent, LenB(bInvent))
        If serr2 <> NOTFOUND Then
            Existe = Round(bInvent.QtyExi, 0)
            Dispo = Round(bInvent.QtyDis, 0)
        Else
            Existe = 0
            Dispo = 0
        End If
        If Dispo < 1 Then
            Call MessBox("NO HAY DISPONIBLE DEL ARTÍCULO " & vbCrLf & InveId & " - " & sivMyApp.Controls("cdescr_1") & vbCrLf & "IMPOSIBLE PERMITIR FACTURAR" & vbCrLf & "BUSCAR OTRA ALTERNATIVA" & vbCrLf & "", vbOKOnly, "NO SE PUEDE FACTURAR")
            retval = ErrNoMess
            sivMyApp.Controls("cdescr_1") = ""
            Call SetStatusBarText("Disponible en Almacen :" & Almac & " :" & Str(Dispo), "ToolTipText")
            Exit Sub
        End If
        Call SetStatusBarText("Disponible en Almacen :" & Almac & " :" & Str(Dispo), "ToolTipText")
        
		'--- Valida Ubicacion por default
			Sqlst2 = " SELECT L.WHSELOC FROM LOCATION L join LocTable lt on l.SiteID = lt.SiteID and l.WhseLoc = lt.WhseLoc WHERE L.INVTID = " & Sparm(InveId) & " AND L.SITEID = " & Sparm(Almac) & " and lt.InclQtyAvail = 1 and (l.QtyAvail + l.QtyAlloc * (1-0) + l.QtyAllocSO * (1-0)) > 0"
			serr13 = SqlFetch1(c13, Sqlst2, bUbica, LenB(bUbica))
			If serr13 = 0 Then
					sivMyApp.Controls("cwhSeloc_1") = bUbica.whseloc
				  
			Else
			Sqlst2 = "Select itemsite.DfltPickBin from itemsite where InvtId = " & Sparm(InveId) & " and siteid = " & Sparm(Almac)
				serr3 = SqlFetch1(c3, Sqlst2, bUbica, LenB(bUbica))
				  If serr3 = 0 Then
					sivMyApp.Controls("cwhSeloc_1") = bUbica.whseloc
				  End If
			End If
		'--- Fin Valida Ubicacion
		
'--- Valida Ubicacion por default
       ' Sqlst2 = "Select itemsite.DfltPickBin from itemsite where InvtId = " & Sparm(InveId) & " and siteid = " & Sparm(Almac)
        'serr3 = SqlFetch1(c3, Sqlst2, bUbica, LenB(bUbica))
        'If serr3 = 0 Then
         '     sivMyApp.Controls("cwhSeloc_1") = bUbica.whseloc
        'End If
'--- Fin Valida Ubicacion
     
    

        
'  ---  Rutina que valida cambio de precios cuando hay promociones
  Dim precio As Double, precun As Double
  Call GetBufferValue("binventory.stkbaseprc", precio)
  precun = Trim(GetObjectValue("ccuryslsprice_1"))
    
' --- Si solomon toma el precio de la lista de precios de promociones
' --- deja este y no acepta cambios en los precios
tipor = Trim(GetObjectValue("csotypeid_0"))

If precio = 0 Or precun = 0 Then
   Call MessBox("No se permite capturar artículo con precio cero", vbOKOnly, "ADVERTENCIA")
   sivMyApp.Controls("cdescr_1") = ""
   retval = ErrNoMess
   Exit Sub
End If

If (precio <> precun) Or (tipor = "ACRM") Then
    sivMyApp.Controls("cdiscpct_1").Properties("Enabled") = True
    sivMyApp.Controls("cdiscpct_1").Properties("Max") = 0
    sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
 '   serr5 = SetObjectValue("cdiscpct_1", 0)
    Call NuevoPrecio(ChkStrg)
 '   Call MessBox("PRECIOS DE MAYOREO , Descuento NO se puede Modificar", vbOKOnly, "PRECIO PROMOCIÓN")
Else
    sivMyApp.Controls("cdiscpct_1").Properties("Enabled") = True
  
    '----   Valida % de descuentos por tipo de orden y clase de precio de artículo

    Call GetBufferValue("binventory.priceclassid", PRICECLASS)
    tipor = Trim(GetObjectValue("csotypeid_0"))
    PRICECLASS = Trim(PRICECLASS)
    If tipor = "ACON" Then
       If PRICECLASS = "A" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 5
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "B" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 10
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "C" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 15
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "D" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 20
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "E" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 25
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        Else
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 0
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        End If
    ElseIf tipor = "ACRE" Then
        If PRICECLASS = "A" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 15
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "B" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 20
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "C" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 25
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "D" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 30
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        ElseIf PRICECLASS = "E" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 35
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        Else
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 15
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
        End If
  
    End If

' ---- PRECIOS DE MAYORISTA CONTADO

    If tipor = "ACOM" Then
        If PRICECLASS = "A" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 5
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 5)
        ElseIf PRICECLASS = "B" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 10
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 10)
        ElseIf PRICECLASS = "C" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 15
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 15)
        ElseIf PRICECLASS = "D" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 20
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 20)
        ElseIf PRICECLASS = "E" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 25
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 25)
        Else
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 5
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 0)
        End If
    ElseIf tipor = "ACRM" Then
        If PRICECLASS = "A" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 15
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 15)
        ElseIf PRICECLASS = "B" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 20
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 20)
        ElseIf PRICECLASS = "C" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 25
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 25)
        ElseIf PRICECLASS = "D" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 30
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 30)
        ElseIf PRICECLASS = "E" Then
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 35
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 35)
        Else
            sivMyApp.Controls("cdiscpct_1").Properties("Max") = 15
            sivMyApp.Controls("cdiscpct_1").Properties("Min") = 0
            serr5 = SetObjectValue("cdiscpct_1", 0)
        End If
             
    End If

End If

  
   Call NuevoPrecio(InveId)
   Call DispFields("Form1", "")
  
  
  
  End If

End Sub

Private Sub cLotSerNbr_8_Chk(ChkStrg As String, retval As Integer)

    If UsaPedido = False Then
      sivMyApp.Controls("cspecificcostid_8") = sivMyApp.Controls("cMfgrLotSerNbr_8")
    '  sivMyApp.Controls("WhSeLoc_8") = sivMyApp.Controls("cMfgrLotSerNbr_8")
    End If
  
  ' Proyecto xVTPedido -------------------------------------- Inicio
    Dim sqlst$
    Dim Result      As Integer
    Dim Sentencia   As String
    Dim Comporta    As String
    
    If UsaPedido = True Then
       
      Call GetBufferValue("bSoType.Behavior", Comporta)
      
      ' Obtiene los tipos de Orden para NUEVOS
       Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where SiteID = " & Sparm(sivMyApp.Controls("cSiteID_0")) & " And SoTypeID = " & Sparm(sivMyApp.Controls("cSoTypeID_0"))
       Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
       
       ' Si el tipo de orden es factura
     '  If Result = 0 And Comporta = "INVC" Then
       If Result = 0 And bPedidoCtrl.SoClase = "FA" Then
          If Trim(sivMyApp.Controls("xPedido")) = "" Then
             Call MessBox("Capturar el No. de pedido primero", vbOKOnly, "ADVERTENCIA")
             retval = ErrNoMess
          End If
          
          sqlst = "Select xVTPedido.Pedido, xVTPedido.LotSerNbr From xVTPedido Where Pedido = " & Sparm(Trim(sivMyApp.Controls("xPedido"))) & " And CustID = " & Sparm(Trim(sivMyApp.Controls("cCustID_0")))
          retval = SqlFetch1(c1, sqlst, bPedido, LenB(bPedido))
       
          If retval = 0 Then
              If Trim(bPedido.LotSerNbr) = "" Then
                  Call MessBox("Capturar el No. de serie de la unidad en el Pedido Primero", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
              Else
                  If Trim(ChkStrg) = Trim(bPedido.LotSerNbr) Then
                     sqlst = "Select InvtID, MfgrLotSerNbr From LotSerMst Where InvtID = " & Sparm(sivMyApp.Controls("cInvtID_1")) & " And LotSerNbr = " & Sparm(Trim(bPedido.LotSerNbr)) & " And SiteID = " & Sparm(Trim(sivMyApp.Controls("cSiteID_0")))
                     retval = SqlFetch1(c2, sqlst, bSerie, LenB(bSerie))
               
                     If retval = 0 Then
                        If Trim(bSerie.invtid) <> Trim(sivMyApp.Controls("cInvtID_1")) Then
                           Call MessBox("No. de serie de la unidad no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                           retval = ErrNoMess
                        End If
                     Else
                        Call MessBox("No encontró serie del artículo", vbOKOnly, "ADVERTENCIA")
                        retval = ErrNoMess
                     End If
                  Else
                     Call MessBox("Serie no coincide con el capturado en el pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                  End If
              End If
          Else
             Call MessBox("Capturar el Pedido", vbOKOnly, "ADVERTENCIA")
             retval = ErrNoMess
          End If
       End If 'INVC
       
       ' Si el tipo de orden es una devolución
       If Result = 0 And bPedidoCtrl.SoClase = "DF" Then
          If Trim(sivMyApp.Controls("xPedido")) = "" Then
             Call MessBox("Capturar el No. de pedido primero", vbOKOnly, "ADVERTENCIA")
             retval = ErrNoMess
          End If
          
          sqlst = "Select xVTPedido.Pedido, xVTPedido.LotSerNbr From xVTPedido Where Pedido = " & Sparm(Trim(sivMyApp.Controls("xPedido"))) & " And CustID = " & Sparm(Trim(sivMyApp.Controls("cCustID_0")))
          retval = SqlFetch1(c1, sqlst, bPedido, LenB(bPedido))
       
          If retval = 0 Then
              If Trim(bPedido.LotSerNbr) = "" Then
                  Call MessBox("Pedido a reverzar con inconsistencias, no tiene el No. de pedido", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
              End If
          Else
             Call MessBox("No existe el pedido al que se reversará", vbOKOnly, "ADVERTENCIA")
             retval = ErrNoMess
          End If
       End If
       
       ' Si el tipo de orden es una Nota de Débito (accesorios)
       If Result = 0 And bPedidoCtrl.SoClase = "DB" Then
       End If
       
       ' Si el tipo de orden es una devulución de accesorios
       If Result = 0 And bPedidoCtrl.SoClase = "DA" Then
       End If
       
       ' Si el tipo de orden es una Nota de Crédito por Descuentos
       If Result = 0 And bPedidoCtrl.SoClase = "CR" Then
       End If
       
       ' Si el tipo de orden es una cancelación de descuentos
       If Result = 0 And bPedidoCtrl.SoClase = "DC" Then
       End If
       ' Si el tipo de orden es Seguros
       If Result = 0 And bPedidoCtrl.SoClase = "SA" Then
       End If
       
       ' Si el tipo de orden es una cancelación de Seguros
       If Result = 0 And bPedidoCtrl.SoClase = "XA" Then
       End If
    
       ' Si el tipo de orden es trámites
       If Result = 0 And bPedidoCtrl.SoClase = "PT" Then
       End If
       
       ' Si el tipo de orden es una cancelación de trámites
       If Result = 0 And bPedidoCtrl.SoClase = "XT" Then
       End If
    
       ' Si el tipo de orden es trámites descuento
       If Result = 0 And bPedidoCtrl.SoClase = "TD" Then
       End If
       
       ' Si el tipo de orden es una cancelación de trámites descuento
       If Result = 0 And bPedidoCtrl.SoClase = "XD" Then
       End If
    
       Call SqlFree(c1)
       Call SqlFree(c2)
    End If
    ' Proyecto xVTPedido -------------------------------------- Final
End Sub


Private Sub cmdLotSerial_Click()
'Stop
   glbNivel = TestLevelChg(LEVEL1)
End Sub

Private Sub cmdLSOK_Click()
'Stop
End Sub

Private Sub cmdPrint_Click()
  Dim almacen As String
  almacen = Trim(sivMyApp.Controls("cSiteid"))
  If almacen = "A01" Or almacen = "A21" Or almacen = "A31" Then
    Dim Prmsep$, Parmstr$, embarque$
    
    Prmsep = Chr(9)
    embarque = Trim(sivMyApp.Controls("cshipperid_0"))
    Parmstr = "ROI.EXE " + Prmsep + "40ACC/RUN" + Prmsep + "{soshipheader.shipperid} =" + Sparm(embarque) + "/WHERE" + Prmsep + "/PSCRN"
    serr1 = Launch(Parmstr, True, True, 0)
  End If

End Sub

Private Sub cPerPost_0_Chk(ChkStrg As String, retval As Integer)
Dim CantPeriodos As Integer

  Call SqlFetch1(c1, "Select * from INSetup", bINSetup, LenB(bINSetup))
  Let CantPeriodos = PeriodMinusPeriod(bINSetup.PerNbr, ChkStrg)
  If PermisoMoverPerCap(CantPeriodos) <> "SI" Then
    If CantPeriodos > 0 Then
      Let retval = 30007
    ElseIf CantPeriodos < 0 Then
      Let retval = 30006
    End If
  End If

  Call SqlFetch1(c1, "Select * from ARSetup", bARSetup, LenB(bARSetup))
  Let CantPeriodos = PeriodMinusPeriod(bARSetup.PerNbr, ChkStrg)
  If PermisoMoverPerCap(CantPeriodos) <> "SI" Then
    If CantPeriodos > 0 Then
      Let retval = 30007
    ElseIf CantPeriodos < 0 Then
      Let retval = 30006
    End If
  End If

End Sub

Private Sub cqtypick_1_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub cshipcustid_0_Chk(ChkStrg As String, retval As Integer)
    If Trim(sivMyApp.Controls("cshiptoid_0")) = "" Then
        sivMyApp.Controls("cshiptoid_0") = "DEFAULT"
    End If
End Sub

Private Sub cshipperid_0_Chk(ChkStrg As String, retval As Integer)
   Dim Cancelado As Integer, shipperid$
   Dim vPedido   As String
   Dim Result1   As Integer
   Dim SqlStr    As String
   Dim usuario$
   Call GetBufferValue("bpes.userid", usuario)
   'If Trim(usuario) = "SYSADMIN" Then Stop
   
   'If (gRefacciones = True Or Valida_Usuario("REFSUPER") = True) And Trim(ChkStrg) = "<NEW>" Then
   If Trim(ChkStrg) = "<NEW>" And Trim(sivMyApp.Controls("csotypeid_0")) <> "" Then
     serr9 = CallChks("Form1", "csotypeid_0")
   End If
' Facturacion Electronica
    Call GetBufferValue("bsoshipheader.cancelled", Cancelado)
    If Cancelado = "1" Then
      Call setprop("ccancelled_0", PROP_ENABLED, False)
      Call setprop("cdatecancelled_0", PROP_ENABLED, False)
    Else
      Call setprop("ccancelled_0", PROP_ENABLED, True)
      Call setprop("cdatecancelled_0", PROP_ENABLED, True)
    End If
    bxFEAddenda = nxFEAddenda
    Call GetBufferValue("bSoShipHeader.OrdNbr", shipperid)
    If RTrim(shipperid) = "" Then
      Sentencia = "Select * From xFEAddenda Where ServiceCallID =" & Sparm(ChkStrg)
    Else
      Sentencia = "Select * From xFEAddenda Where ServiceCallID =" & Sparm(shipperid)
    End If
    serr1 = SqlFetch1(csr_xFEAddenda, Sentencia, bxFEAddenda, LenB(bxFEAddenda))
    
    'Call DispFields("xfrAddenda", "NumeroPoliza")
    'Call DispFields("xfrAddenda", "NumeroSiniestro")
    'Call DispFields("xfrAddenda", "NoReporte")
    'Call DispFields("xfrAddenda", "NomAseg")
    'Call DispFields("xfrAddenda", "xNoTramitador")
    'Call DispFields("xfrAddenda", "Traccion")
    'Call DispFields("xfrAddenda", "xTransmision")
    'Call DispFields("xfrAddenda", "xMotor")
    'Call DispFields("xfrAddenda", "pctDeducible")
    'Call DispFields("xfrAddenda", "xMontoDeducible")
    'Call DispFields("xfrAddenda", "xTipoCte")
    'Call DispFields("xfrAddenda", "xTipoVehiculo")
    Call DispFields("xfrAddenda", "")
    
    bAuOrdAdic = nAuOrdAdic
    Sentencia = "Select * From AuOrdAdic Where ServCallId =" & Sparm(ChkStrg)
    serr2 = SqlFetch1(CSR_AuOrdAdic, Sentencia, bAuOrdAdic, LenB(bAuOrdAdic))
    
    Call DispFields("xfrAddenda", "xMarca")
    Call DispFields("xfrAddenda", "xModelo")
    Call DispFields("xfrAddenda", "xYear1")
    Call DispFields("xfrAddenda", "xColor")
    Call DispFields("xfrAddenda", "xSerie")
    Call DispFields("xfrAddenda", "xPlacas")
    Call DispFields("xfrAddenda", "xKms1")
' Fin Facturacion Electronica
'Stop
 If gRefacciones Then
    Dim Paso$
    Dim cPasob As String
    
    'Dim usuario As String * 47
    
    Call GetBufferValue("bpes.userid", usuario)
    'Stop
    'HEAF cPaso no existe
    ''cPaso = GetObjectValue("cPASO")
    If Trim(sivMyApp.Controls("cPASO")) = "" Then
     'If Trim(cPaso) = "" Then
        Paso = "PEDIDO"
        Else: Paso = Trim(sivMyApp.Controls("cPASO"))
    End If
    If Trim(sivMyApp.Controls("cPASO")) = "" Then
        serr5 = SetObjectValue("cPASO", Paso)
    End If

    If (Valida_Usuario("REFCANCELA") = True Or Valida_Usuario("REFCANCELV") = True) And UCase(Trim(sivMyApp.Controls("cPaso"))) = "PEDIDO" Then
        Call setprop("ccancelled_0", "Enabled", True)
    Else
        Call setprop("ccancelled_0", "Enabled", False)
    End If

    Call SSTAb1_HabDes
    Call Habilita
    Paso = Trim(sivMyApp.Controls("cPASO"))
        
    If Valida_Usuario("REFCANCELA") = True Then
        Call setprop("SSTab1", "TabEnabled(1)", True)
        sivMyApp.Controls("fraItem").Properties("Enabled") = True
    ElseIf Valida_Usuario("REFCANCELV") = True And Trim(Paso) <> "PEDIDO" Then
        Call Deshabilita
    ElseIf Valida_Usuario("REFCANCELA") = True And Trim(Paso) <> "EMBARQUE" Then
        Call Deshabilita
    ElseIf Valida_Usuario("REFCANCELF") = True Then
        Call Deshabilita
        If Trim(Paso) = "FACTURA" Then
            sivMyApp.Controls("cPASO").Properties("Enabled") = True
        End If
    Else
        Call Habilita
    End If
       
 
 '   If Valida_Usuario("REFCANCELV") = True Then
 '     Call SetBufferValue("bsoshipheader.sotypeid", "ACRM")
 '   Else
 '     Call SetBufferValue("bsoshipheader.sotypeid", "ACON")
 '   End If
 ' Call DispFields("Form1", "cSotypeid_0")
 End If

   If UsaPedido = True Then
      Call GetBufferValue("bsoshipheader.custordnbr", vPedido)
      
      SqlStr = "Select * From xVTPedido Where Pedido = " & Sparm(Trim(vPedido))
      Result1 = SqlFetch1(c2, SqlStr, bxVTPedido, LenB(bxVTPedido))
   Else
      bxVTPedido = nxVTPedido
   End If
     
Call DispFields("Form1", "dCuenta")
End Sub


Private Sub csotypeid_0_Chk(ChkStrg As String, retval As Integer)

  ' Proyecto xVTPedido -------------------------------------- Inicio
  Dim Result    As Integer
  Dim Result2   As Integer
  Dim CpnyId    As String
  
  If UsaPedido = True Then
     Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And SoTypeID = " & Sparm(ChkStrg)
     Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
     
     If Result = 0 Then
        sivMyApp.Controls("cShipviaid_0") = "01"
        sivMyApp.Controls("cSiteID_0") = bPedidoCtrl.SiteID
        'Call DispFields("Form1", "xPedido")
        
        Sentencia = "Select Behavior from SoType Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And SoTypeID = " & Sparm(ChkStrg)
        Result2 = SqlFetch1(c9, Sentencia, bBehavior, LenB(bBehavior))
        
        If Result2 = 0 Then
           If Trim(bPedidoCtrl.SoClase) = "FA" Then     'Facuta Unidades
              xPedido.PV = """xVTPedido_Embarques"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DF" Then ' Devolución Unidades
              xPedido.PV = """xVTPedido_Embarques_RMA"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "CR" Then ' Crédito por descuento
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DB" Then ' Débito por Accesorios
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DA" Then ' Devolución Accesorios
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DC" Then ' Cancelación Descuentos
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "SA" Then ' Seguros
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "XA" Then ' Cancelación Seguros
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "PT" Then ' Trámites
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "XT" Then ' Cancelación de trámites
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "TD" Then ' Trámites descuento
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "XD" Then ' Cancelación de trámites descuento
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           End If
        End If
     End If
   End If
  ' Proyecto xVTPedido -------------------------------------- Final
  
' Facturacion Electronica
    Dim xStatus As String
    Dim Habilita As Boolean
    Call GetBufferValue("bsoshipheader.status", xStatus)
    If VBA.Trim$(xStatus) = "O" Then
        Sentencia = "Select Siteid, SoTypeid, Prefijo, TipoDoc, Suc, Documento, SubDocumento From xFEPrefijos Where sotypeid=" & Sparm(ChkStrg)
        serr1 = SqlFetch1(c1, Sentencia, bxFePref, LenB(bxFePref))
        Call SqlFree(c1)
        
        Habilita = IIf(serr1 = 0, False, True)
        Call setprop("SSTab1", "TabVisible(0)", False)
        Call setprop("SSTab1", "TabVisible(2)", False)
        Call setprop("SSTab1", "TabVisible(6)", False)
        Call setprop("SSTab1", "TabVisible(7)", False)
        Call SSTAb1_HabDes
    End If
' Fin Facturacion Electronica

   If gRefacciones Then
      Dim tipor$
      tipor = Trim(ChkStrg)

      If Trim(Left$(tipor, 4)) <> "ACRM" Then
         Call MessBox("SOLO Tipo ACRM : Venta de Mayoreo", vbOKOnly, "Error")
         retval = ErrNoMess
      End If
   End If
End Sub

Private Sub cSpecificCostID_8_Chk(ChkStrg As String, retval As Integer)
  ' Proyecto xVTPedido -------------------------------------- Inicio
   Dim Result       As Integer
   Dim Sentencia    As String
   Dim usuario As String
   Call GetBufferValue("bpes.userid", usuario)
   'If Trim(usuario) = "SYSADMIN" Then Stop

   If UsaPedido = True Then
   
      Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where SiteID = " & Sparm(sivMyApp.Controls("cSiteID_0")) & " And SoTypeID = " & Sparm(sivMyApp.Controls("cSoTypeID_0"))
      Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))

      If Result = 0 And bPedidoCtrl.SoClase = "FA" Then
         If Trim(sivMyApp.Controls("cMfgrLotSerNbr_8")) <> Trim(ChkStrg) Then
            Call MessBox("Costo específico debe ser igual al Lote / Serie del fabricante", vbOKOnly, "ADVERTENCIA")
            retval = ErrNoMess
         End If
      End If
   End If
  ' Proyecto xVTPedido -------------------------------------- Final
End Sub


Private Sub cTaxCat_1_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub ctermsid_0_Chk(ChkStrg As String, retval As Integer)
  ''' Revision de Limite de Credito ..
   Dim RCambCond As Boolean
   Dim LimiteOK As Boolean
   Dim Verif As Boolean
   Dim usuario$
   Call GetBufferValue("bpes.userid", usuario)
   

   Let xGrabarOK = ""
   Let RCambCond = True
   Call Cambia_Condic(RCambCond, ChkStrg)
   If RCambCond Then

     Let LimiteOK = True
     Call Rev_Limite(LimiteOK, ChkStrg)  'Ram

     If LimiteOK Then
     Else
       Call Verifica_Clave(Verif)

       If Verif Then
       Else
         xGrabarOK = "No Cuenta con Autorizacion para Facturar"
       End If
     End If
   Else
     xGrabarOK = "La Condicion de Pago NO coincide con la del Cliente"
   End If
End Sub

Private Sub ctermsid_0_OLEInternal1(parm1 As Integer, parm2 As Integer)

End Sub

Private Sub dBanco_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub dFPagos_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub Form1_Display()
   Call SSTAb1_HabDes
   vCambiaVend = False
   glbNivel = 99
End Sub

Public Sub Retardo(tiempo As Long)
    Dim Inicio As Date
    Dim Fin As Date
    Let Inicio = Now
    Let Fin = Now
    Let Fin = Fin + (tiempo / 86400)
    While Inicio < Fin
       Inicio = Now
       DoEvents
    Wend
End Sub

Private Sub frmLotSerial_Display()
   If glbSerie = True Then
      Call Retardo(1)
      sivMyApp.Controls("xvtSerie") = True
'      Call Retardo(2)
'      SivMyApp.Controls("xvtSerie") = True
   End If
End Sub

Private Sub Spread1_LineChk(action As Integer, maintflg As Integer, retval As Integer)

End Sub

Private Sub Spread1_LineGotFocus(maintflg As Integer, retval As Integer)
   ' Proyecto xVTPedido -------------------------------------- Inicio
   Dim LotSerTrack As String
   Dim Status As Boolean
   '   Stop
   If glbNivel <> 99 Then
      If TestLevelChg(LEVEL1) <> NOTCHANGED And glbNivel = NOTCHANGED And TestLevelChg(LEVEL8) = NOTCHANGED Then
         Call SetLevelChg(LEVEL1, glbNivel)
      End If
      glbNivel = 99
   End If
   
   If UsaPedido = True Then
      Let serr1 = getprop("cwhseloc_1", PROP_ENABLED, Status)
      Call GetBufferValue("binventory.LotSerTrack", LotSerTrack)
      If Status = True And Trim(LotSerTrack) = "SI" Then
         Call setprop("cmdLotSerial", "Enabled", True)
      Else
'         Call setprop("cmdLotSerial", "Enabled", False)
      End If
   End If
   ' Proyecto xVTPedido -------------------------------------- Fin
End Sub

Private Sub cmdIsan_Click()
   On Error Resume Next

   Dim LvlStr As String
   Dim Lvl As Integer
   Dim RecFound      As Integer
   Dim MemMaintFlag  As Integer
   Dim GridHandle    As Integer
   Dim Renglon       As Integer
   Dim IsanID        As String

   GridHandle = GetGridHandle("Spread3")
     
   RecFound = MFirst(GridHandle, MemMaintFlag)
'   Renglon = MGetRowNum(GridHandle)
   While RecFound = 0
 '     Stop
      Call GetBufferValue("bsoshipmisc.miscchrgid", IsanID)
      If Trim(IsanID) = "ISAN" Then
         Call MDelete(GridHandle, MemMaintFlag)
         Call MUpdate(GridHandle)
         Renglon = MGetRowNum(GridHandle)
         If Renglon = 1 Then
            RecFound = MFirst(GridHandle, MemMaintFlag)
         Else
            RecFound = MPrev(GridHandle, MemMaintFlag)
         End If
      Else
         RecFound = MNext(GridHandle, MemMaintFlag)
      End If
   Wend
   Call MFirst(GridHandle, MemMaintFlag)
   Call MDisplay(GridHandle)
   
   Call ApplSetfocus("cmiscchrgid_3")
   ISAN = GetObjectValue("cIsan")
   If GetObjectValue("cCuryBalDue_0") < 0 Then
     ISAN = ISAN * -1
   End If
   serr1 = getprop("cmiscchrgid_3", PROP_LEVEL, LvlStr)
   Lvl = val(LvlStr)
   serr1 = Edit_New(Lvl)
   DoEvents
   serr3 = SetObjectValue("cmiscchrgid_3", "ISAN")
   serr3 = SetObjectValue("ccurymiscchrg_3", ISAN)
   serr1 = Edit_Next(Lvl)
   DoEvents
   sivMyApp.Controls("cmdLotSerial").Properties("Enabled") = True
End Sub

Private Sub cPrecio_Chk(ChkStrg As String, retval As Integer)
'Nuevo calculo del san, reemplazar el nombre
Dim IVA As Double
Dim precio As Double
Dim PrecioBase As Double
Dim invtid As String
Dim Costo As Double

Dim dCuryRate As Double
Dim sMultDiv As String
Dim cImpuesto As String

Dim cliente As String
Dim Sqlst1 As String
Dim usuario As String
Dim almacen As String
Call GetBufferValue("bpes.userid", usuario)
almacen = Trim(GetObjectValue("cSiteid_0"))

'  Dim Usuario As String * 47
'  Call GetBufferValue("bpes.userid", Usuario)

  If (UsaPedido = True Or Nuevos_Ant = True) And Trim(almacen) <> Trim(Obtiene_Almacen("REFACCIONES")) Then
'  If (UsaPedido = True Or Nuevos_Ant = True) Or  Valida_Usuario("REFCANCELV") = True Then
    Let cliente = GetObjectValue("ccustid_0")
    Call GetBufferValue("bsoshipheader.curyrate", dCuryRate)
    Call GetBufferValue("bsoshipheader.curymultdiv", sMultDiv)
    Let sMultDiv = Trim(sMultDiv)

'    Call GetBufferValue("bsoshipheader.taxid00", cImpuesto)
'    Let Sentencia = "Select TaxRate From SalesTax Where TaxID =" & Sparm(Trim(cImpuesto))
'    Let serr1 = SqlFetch1(c1, Sentencia, bDoble, LenB(bDoble))
'    If serr1 = 0 Then
'      Let PorcIVA = bDoble.Dato
'    Else
'      Let PorcIVA = 15
'    End If
'    Call SqlFree(c1)
'    Let PorcIVA = 1 + (PorcIVA / 100)
'
   Sqlst1 = "Select salestax.* from salestax, customer where taxid = taxid00 and custid = " + Sparm(cliente)
   serr4 = SqlFetch1(c3, Sqlst1, bIva, LenB(bIva))
   If serr4 <> NOTFOUND Then
     If bIva.taxrate <> 0 Then
       bAusetup.PorIva = 1 + (bIva.taxrate / 100)
     End If
   End If
   If bAusetup.PorIva = 0 Then
     bAusetup.PorIva = 1.16
   End If
'
    Let PorcIVA = bAusetup.PorIva
'
    Let ISAN = 0
'    Let IEPS = 0
    Let CatImp = sivMyApp.Controls("cTaxCat_1")
    Let invtid = sivMyApp.Controls("cInvtID_1")
    Let precio = val(ChkStrg)
    Let precio = Int((precio + 0.005) * 100) / 100
    Let IVA = FPSub(precio, FPDiv(precio, PorcIVA, 2), 2)
    If Lista = "" Then Call CargaLista

    If Trim(sivMyApp.Controls("csotypeid_0")) = "NF04" Or _
       Trim(sivMyApp.Controls("csotypeid_0")) = "NC04" Then
      Let CatImp = "SINISAN"
      Let PrecioBase = FPSub(precio, IVA, 2)
      Let sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
      Exit Sub
    End If

    If Trim(CatImp) = Trim(bAusetup.CategCa) Or Trim(CatImp) = Trim(bAusetup.CategNu) Or (Trim(CatImp) = "SINISAN" And precio > 156135) Then
'    Select Case Trim(CatImp)
'    Case "AUTOS", "AUTNAC", "AUTIMP"
      If dCuryRate <> 1 Then
        Select Case sMultDiv
        Case "M"
          Let precio = FPMult(precio, dCuryRate, 3)
        Case "D"
          Let precio = FPDiv(precio, dCuryRate, 3)
        End Select
      End If
      Let precio = Int((precio + 0.005) * 100) / 100
      Let IVA = FPSub(precio, FPDiv(precio, PorcIVA, 2), 2)
      Let PonerISAN = 1
      If InStr(1, usuario, "ANTERIOR") Then
        Let ISAN = IsanAnterior(precio, IVA)
      Else
        Let ISAN = IsanFactura(precio, IVA)
      End If
      Let IVA = FPSub(precio, FPDiv(precio, PorcIVA, 2), 2)
      Let PrecioBase = FPSub(precio, IVA, 2)
      Let PrecioBase = FPSub(PrecioBase, ISAN, 2)
      If dCuryRate <> 1 Then
        Select Case sMultDiv
        Case "M"
          Let PrecioBase = FPDiv(PrecioBase, dCuryRate, 2)
          Let ISAN = FPDiv(ISAN, dCuryRate, 2)
        Case "D"
          Let PrecioBase = FPMult(PrecioBase, dCuryRate, 2)
          Let ISAN = FPMult(ISAN, dCuryRate, 2)
        End Select
      End If
      Let sivMyApp.Controls("cISAN") = ISAN
      Let sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
'      Call bIsan_Click

'    ElseIf Trim(CatImp) = Trim(bAusetup.CategCa) Then
'    Case "CAMIONES", "CAMNAC", "CAMIMP"
'      Let Precio = FPSub(Precio, bAusetup.PorIva, 2)
'      Let PrecioBase = FPDiv(Precio, bAusetup.PorIsan, 2)
'      Let Isan = FPSub(Precio, PrecioBase, 2)
'      Let sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
'      Let sivMyApp.Controls("cISAN") = Isan

    ElseIf Trim(CatImp) = Trim(bAusetup.CategPF) Then
 '   Case "USADOSPF"
      Let Costo = sivMyApp.Controls("cCuryCost_1")
      Let IVA = FPSub(precio - Costo, FPDiv(precio - Costo, bAusetup.PorIva, 2), 2)
      Let PrecioBase = FPSub(precio, IVA, 2)
      sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
    Else
'    Case "USADOSPM", "NOISAN"
      Let IVA = FPSub(precio, FPDiv(precio, bAusetup.PorIva, 2), 2)
      Let PrecioBase = FPSub(precio, IVA, 2)
      sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
    End If
'    End Select

'    If PrecioBase > 250000 Then
'      If Trim(sivMyApp.Controls("cRFC_E")) = "" Then
'        Call MessBox("El Cliente no tiene RFC, se añadira el 5% Del IVBSS", vbOKOnly, "Advertencia")
'        Let IEPS = Base * 0.05
'      End If
'    End If

'    Call ApplSetfocus("cqtyship_1")
  End If

End Sub

Private Sub cPrecio_old_Chk(ChkStrg As String, retval As Integer)
Dim IVA#, SumIsan#, precio#, PrecioBase#, Costo#
Dim invtid$, CatImp$, sqlst$
Dim Level As String
Dim dCuryRate#, sMultDiv$
Dim Sqlst1$, cliente$

  
 If UsaPedido Or Nuevos_Ant Then
      
   cliente = GetObjectValue("ccustid_0")
   Call GetBufferValue("bSoShipHeader.curyrate", dCuryRate)
   Call GetBufferValue("bSoShipHeader.CuryMultDiv", sMultDiv)
   sMultDiv = Trim$(sMultDiv)
   'Obtiene la categoria de Impuestos de el Articulo
   CatImp = GetObjectValue("cTaxCat_1")
   
   precio = val(ChkStrg)
   If dCuryRate <> 0 And sMultDiv = "M" Then 'Convierte el precio al tc del documento
         precio = FPMult(precio, dCuryRate, 4)
      End If
      If dCuryRate <> 0 And sMultDiv = "D" Then 'Convierte el precio al tc del documento
         precio = FPDiv(precio, dCuryRate, 4)
   End If
   
   Sqlst1 = "Select salestax.* from salestax,customer where taxid = taxid00 and custid = " + Sparm(cliente)
   serr4 = SqlFetch1(c3, Sqlst1, bIva, LenB(bIva))
   If serr4 <> NOTFOUND Then
     If bIva.taxrate <> 0 Then
       bAusetup.PorIva = 1 + (bIva.taxrate / 100)
     End If
   End If
   If bAusetup.PorIva = 0 Then
     bAusetup.PorIva = 1.16
   End If
   
   
   'Quitar el Iva 15% el precio capturado ya tiene IVA
   IVA = FPSub(precio, FPDiv(precio, bAusetup.PorIva, 2), 2)
   'Precio sin Iva
   PrecioBase = FPSub(precio, IVA, 2)
    
'   If Trim(CatImp) = Trim(bAusetup.CategNu) Or (Trim(CatImp) = "SINISAN" And PrecioBase > 111925) Then
   If Trim(CatImp) = Trim(bAusetup.CategCa) Or Trim(CatImp) = Trim(bAusetup.CategNu) Or (Trim(CatImp) = "SINISAN" And PrecioBase > 111925) Then
   '   Level = sivMyApp.Controls("cmiscchrgid_3").Properties("Level")
       ISAN = 0
'      EXC = 0
'      LE = 0
'      TE = 0
      sqlst = "exec AU_calcisan " + Sparm(PrecioBase)
      serr1 = SqlFetch1(c1, sqlst, ISAN, LenB(ISAN))
      If serr1 = 0 Then
        PrecioBase = FPSub(precio, IVA, 2)
        PrecioBase = FPSub(PrecioBase, ISAN, 2)
      
        If dCuryRate <> 0 And sMultDiv = "M" Then 'Convierte el precio al tc del documento
           PrecioBase = FPDiv(PrecioBase, dCuryRate, 2)
           ISAN = FPDiv(ISAN, dCuryRate, 2)
        End If
        If dCuryRate <> 0 And sMultDiv = "D" Then 'Convierte el precio al tc del documento
           PrecioBase = FPMult(PrecioBase, dCuryRate, 2)
           ISAN = FPDiv(ISAN, dCuryRate, 2)
        End If
      
       'Colocar el Monto de Isan
        sivMyApp.Controls("cIsan") = ISAN

      
        sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
    '  sivMyApp.New Level
    '  sivMyApp.Controls("cmiscchrgid_3") = "ISAN"
      'sivMyApp.Controls("ccurymiscchrg_3") = Str(ISAN)
     End If
'Calculo de Camiones al 5 %
'   ElseIf Trim(CatImp) = Trim(bAusetup.CategCa) Then
'      Precio = FPDiv(Precio, bAusetup.PorIva, 2)
'      PrecioBase = FPDiv(Precio, bAusetup.PorIsan, 2)
'      Isan = FPSub(Precio, PrecioBase, 2)
'      sivMyApp.Controls("cCurySlsPrice_1") = PrecioBase
'      sivMyApp.Controls("cISAN") = Isan
'-------------------------
    ElseIf Trim(CatImp) = Trim(bAusetup.CategPF) Then
      Costo = GetObjectValue("cCuryCost_1")
      IVA = FPSub(precio - Costo, FPDiv(precio - Costo, bAusetup.PorIva, 2), 2)
      PrecioBase = FPSub(precio, IVA, 2)
      'serr2 = SetObjectValue("cCurySlsPrice_1", PrecioBase)
      sivMyApp.Controls("ccuryslsprice_1") = PrecioBase
   Else
      IVA = FPSub(precio, FPDiv(precio, bAusetup.PorIva, 2), 2)
      PrecioBase = FPSub(precio, IVA, 2)
      'serr2 = SetObjectValue("cCurySlsPrice_1", PrecioBase)
      sivMyApp.Controls("ccuryslsprice_1") = PrecioBase
   End If
   

 End If

End Sub

Private Sub cshiptoid_0_Chk(ChkStrg As String, retval As Integer)
   Dim Sentencia As String
   Dim Result As Integer
   Dim cliente$
   Dim CpnyId As String
   
   Call GetBufferValue("bpes.CpnyID", CpnyId)
   
   Sentencia = "Select TaxLocID From SoAddress Where CustID = " & Sparm(sivMyApp.Controls("cCustID_0")) & " And ShipToID = " & Sparm(ChkStrg)
   Result = SqlFetch1(c1, Sentencia, bRFC, LenB(bRFC))
   
   If Result = 9 Then
      Call SetBufferValue("bSoShipHeader.User3", "")
   Else
      Call SetBufferValue("bSoShipHeader.User3", bRFC.RFC)
   End If
   
   Call DispFields("Form1", "cRFC")
   
  cliente = Trim(sivMyApp.Controls("cCustID_0"))
  Sentencia = "Select * From Customer Where CustId = " & Sparm(cliente)
  serr1 = SqlFetch1(c1, Sentencia, bCustomer, LenB(bCustomer))
'  serr1 = SetObjectValue("xuser3", bCustomer.TaxLocID)
  If serr1 <> NOTFOUND Then
    If Trim(bCustomer.SlsperId) <> "" Then
    
      Let VendedorCliente = Trim(bCustomer.SlsperId)
      vCambiaVend = True
      If CpnyId = "CODAO" Then
         Let sivMyApp.Controls("cslsperid_0") = "CR01"
      Else
         Let sivMyApp.Controls("cslsperid_0") = VendedorCliente
      End If
      vCambiaVend = False
    End If
  End If
  Call SqlFree(c1)
   
  ' Proyecto xVTPedido -------------------------------------- Inicio
  Dim Result2   As Integer
  
  If UsaPedido = True Then
     Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And SoTypeID = " & Sparm(ChkStrg)
     Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
     
     If Result = 0 Then
        sivMyApp.Controls("cShipviaid_0") = "UNIDADES"
        sivMyApp.Controls("cSiteID_0") = bPedidoCtrl.SiteID
        'Call DispFields("Form1", "xPedido")
        
        Sentencia = "Select Behavior from SoType Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And SoTypeID = " & Sparm(ChkStrg)
        Result2 = SqlFetch1(c9, Sentencia, bBehavior, LenB(bBehavior))
        
        If Result2 = 0 Then
           If Trim(bPedidoCtrl.SoClase) = "FA" Then     'Facuta Unidades
              xPedido.PV = """xVTPedido_Embarques"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DF" Then ' Devolución Unidades
              xPedido.PV = """xVTPedido_Embarques_RMA"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "CR" Then ' Crédito por descuento
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DB" Then ' Débito por Accesorios
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DA" Then ' Devolución Accesorios
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "DC" Then ' Cancelación Descuentos
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "SA" Then ' Seguros
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "XA" Then ' Cancelación Seguros
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "PT" Then ' Trámites
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "XT" Then ' Cancelación Trámites
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "TD" Then ' Trámites descuento
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           ElseIf Trim(bPedidoCtrl.SoClase) = "XD" Then ' Cancelación Trámites descuento
              xPedido.PV = """xVTPedido_Embarques_NOTAS"",""bsoshipheader.custID"";0;0;0;0,"
           End If
        End If
     End If
   End If
  ' Proyecto xVTPedido -------------------------------------- Final
  
  '------------------------------------------------------------------------
  Dim SentenciaPago As String
  Dim shiptoid As String
  shiptoid = sivMyApp.Controls("cshiptoid_0")
  SentenciaPago = "SELECT banco.descr,pago.descr,DigitosCuenta FROM xsoaddress addr " & _
                "INNER JOIN xAumetodopago pago ON pago.metodoid=addr.metodopago " & _
                "INNER JOIN xAuBancos banco ON banco.bancoid=addr.banco WHERE " & _
                "custid=" & Sparm(cliente) & " AND shiptoid=" & Sparm(shiptoid)
  serr11 = SqlFetch1(c11, SentenciaPago, bxFormaPago, LenB(bxFormaPago))
  If (serr11 = 0) Then
    sivMyApp.Controls("dBanco") = bxFormaPago.banco
    sivMyApp.Controls("dFPagos") = bxFormaPago.metodoPago
    sivMyApp.Controls("dCuenta") = bxFormaPago.DigitosCuenta
  End If
  
End Sub

Private Sub Form1_Load()
'Stop
   Dim sqlst$
   Dim usuario As String * 47
   Let xGrabarOK = ""
   vCambiaVend = False
   glbNivel = 99
   
   Call GetBufferValue("bpes.userid", usuario)
'   If Trim(usuario) = "REFMOSTRADOR2" Then Stop  'Ram
   
   sqlst = "SELECT USERID,zfuture03,zfuture04,zfuture06,zfuture07,zfuture08 FROM VS_USERGRP  INNER JOIN AUSETUP ON ZFUTURE01 = GROUPID AND USERID = " & Sparm(usuario)
   serr1 = SqlFetch1(c5, sqlst, bAusetup, LenB(bAusetup))
  
   If serr1 <> NOTFOUND Then
      Nuevos_Ant = True
   Else
      Nuevos_Ant = False
   End If
  
   ' Proyecto xVTPedido -------------------------------------- Inicio
   Dim Pos As Integer
   Dim Valor As Integer
    
   PonerISAN = 0
   Autos = False
    
   Call VBA_SetAddr("SOShipMisc", bsoshipmisc, nsoshipmisc, LenB(bsoshipmisc))
   Call VBA_SetAddr("bxCondic", bxCondic, nxCondic, Len(bxCondic))
   Call VBA_SetAddr("bxLimite", bxLimite, nxLimite, Len(bxLimite))
   Call VBA_SetAddr("bxCargos", bxCargos, nxCargos, Len(bxCargos))
   Call VBA_SetAddr("bxAbonos", bxAbonos, nxAbonos, Len(bxAbonos))
   Call VBA_SetAddr("bxCteRule", bxCteRule, nxCteRule, Len(bxCteRule))
   Call VBA_SetAddr("bxembAb", bxembAb, nxembAb, Len(bxembAb))
   Call VBA_SetAddr("bxordAb", bxordAb, nxordAb, Len(bxordAb))
   Call VBA_SetAddr("bxVencido", bxVencido, nxVencido, Len(bxVencido))
   Call VBA_SetAddr("bxDiasGr", bxDiasGr, nxDiasGr, Len(bxDiasGr))
   Call VBA_SetAddr("bxCondCte", bxCondCte, nxCondCte, Len(bxCondCte))
   Call VBA_SetAddr("bxCveAut", bxCveAut, nxCveAut, Len(bxCveAut))
      
   Call SqlCursor(c1, NOLEVEL + SqlUpdate)

   BanderaLotSer = False
  
   Call GetBufferValue("bpes.userid", usuario)
   If Valida_Usuario("IMPPBA") = True Then
     Call setprop("xImpPba", PROP_VISIBLE, True)
   Else
     Call setprop("xImpPba", PROP_VISIBLE, False)
   End If
   Call GetBufferValue("bpes.computername", Computadora)
   Let usuario = UCase(Trim(usuario))
   Let gRefacciones = False
   Let Computadora = UCase(Trim(Computadora))
   Let Pos = InStr(1, Computadora, "CONSOLE")
   If Pos Then Let Computadora = Mid(Computadora, 1, Pos - 1)

   Let Sentencia = "Select GroupID, User1, User2 From VS_UserGrp Where UserID =" & Sparm(usuario)
   Let serr1 = SqlFetch1(c1, Sentencia, bDatos, LenB(bDatos))
   While serr1 = 0
     If InStr(1, bDatos.Grupo, "ANGAUTPED00") Then Let Autos = True
     If Autos Then
        If Trim(bDatos.Vendedor) <> "" Then
           Let Vendedor = Trim(bDatos.Vendedor)
           Call SetBufferValue("bsosetup.dfltslspermethod", Vendedor)
        End If
      
        If Trim(bDatos.TipoVenta) <> "" Then
           Let Tipo = Trim(bDatos.TipoVenta)
           Call SetBufferValue("bsosetup.dfltordertype", Tipo)
           Call SetBufferValue("bsosetup.dfltshippertype", Tipo)
        End If
     End If
     
     If InStr(1, bDatos.Grupo, "VREFACC") Then Let gRefacciones = True
     Let serr1 = SFetch1(c1, bDatos, LenB(bDatos))
  Wend
  Call SqlFree(c1)
  
  If Autos = True Then
     Nuevos_Ant = True
     Call MessBox("Seleccione YES Para NUEVOS, NO Para SemiNUEVOS o Autos Anterior", vbYesNo, "Seleccion")
     Valor = MessResponse
     If Valor = vbNo Then
        Autos = False
     End If
  End If
  
  Call setprop("xPedido", PROP_VISIBLE, Autos)
  Call setprop("xPedido", PROP_BLANKERR, Autos)
  Call setprop("lPedido", PROP_VISIBLE, Autos)
  Call setprop("lRefact", PROP_VISIBLE, Autos)
  Call setprop("cRefact", PROP_VISIBLE, Autos)
  'HEAF
  Call setprop("cCustOrdNbr_0", PROP_VISIBLE, Not Autos)
  'Call setprop("cCustOrdNbr_0", PROP_VISIBLE, Autos)

  Let UsaPedido = Autos
  ' Proyecto xVTPedido -------------------------------------- Final
  If Nuevos_Ant = True Then
     sivMyApp.Controls("lblPrecio").Properties("Visible") = True
     sivMyApp.Controls("cPrecio").Properties("Visible") = True
     sivMyApp.Controls("lblIsan").Properties("Visible") = True
     sivMyApp.Controls("cIsan").Properties("Visible") = True
     sivMyApp.Controls("cmdIsan").Properties("Visible") = True
  End If
  
' Facturacion Electrónica
    Dim Result As Integer
    Call VBA_SetAddr("bxFEAddenda", bxFEAddenda, nxFEAddenda, LenB(bxFEAddenda))
'    Call SqlCursor(CSR_xFEAddenda, LEVEL0 + SqlUpdate)
    Call SqlCursor(csr_xFEAddenda, NOLEVEL)
    Call VBA_SetAddr("bAuOrdAdic", bAuOrdAdic, nAuOrdAdic, LenB(bAuOrdAdic))
    Call SqlCursor(CSR_AuOrdAdic, LEVEL0 + SqlUpdate)
    
    Sentencia = "Select * From xFEAddenda where ServiceCallId = 'x'"
    Result = SqlFetch1(csr_xFEAddenda, Sentencia, bxFEAddendaTemp, LenB(bxFEAddendaTemp))
    
    Sentencia = "SELECT TOP 1 * FROM AuOrdAdic WHERE ServCallId = 'x'"
    Result = SqlFetch1(CSR_AuOrdAdic, Sentencia, bAuOrdAdicTemp, LenB(bAuOrdAdicTemp))
'Fin Facturación Electrónica
 
   If gRefacciones Then
      Call SSTAb1_HabDes
    
      Call setprop("cMotivo", PROP_ENABLED, False)
      Call setprop("ccuryslsprice_1", PROP_VISIBLE, False)
      Call setprop("xcPrice1", PROP_VISIBLE, True)
      Call setprop("xcPrice1", PROP_ENABLED, False)
      Call setprop("cPedida", PROP_VISIBLE, True)
      sivMyApp.Controls("cPedida").Properties("Min") = 1
      Call setprop("cmdSalesPeople", PROP_VISIBLE, False)
      Call setprop("lProjectID_0", PROP_VISIBLE, False)
      'HEAF
      'Call setprop("cPASO", PROP_ENABLED, True)
 '     Call Habilita
   Else
      If Valida_Usuario("MOSTRADOR") = True Then
         Call setprop("cmdSalesPeople", PROP_VISIBLE, False)
         Call setprop("lProjectID_0", PROP_VISIBLE, False)
         Call setprop("ccuryslsprice_1", PROP_VISIBLE, False)
         Call setprop("xcPrice1", PROP_VISIBLE, True)
         Call setprop("xcPrice1", PROP_ENABLED, False)
      ElseIf Valida_Usuario("REFSUPER") = True Then
         Call setprop("cmdSalesPeople", PROP_VISIBLE, False)
         Call setprop("lProjectID_0", PROP_VISIBLE, False)
         Call setprop("xcPrice1", PROP_VISIBLE, False)
         Call setprop("xcPrice1", PROP_ENABLED, False)
      Else
         Call setprop("xcPrice1", PROP_VISIBLE, False)
         Call setprop("xcPrice1", PROP_ENABLED, False)
      End If
      
   End If
   
   Call setprop("xbtnCargaOrdenServicio1", PROP_VISIBLE, False)
   Call setprop("xtxtOrdenServicio", PROP_VISIBLE, False)
   
   Sentencia = "SELECT adapta FROM  xvtadaptaciones WHERE pantalla='4011000' AND adapta='REMIS' AND userid= " & Sparm(usuario)
   serr5 = SqlFetch1(c5, Sentencia, bAdaptacion, LenB(bAdaptacion))
   If serr5 = 0 Then
        If Trim(bAdaptacion.adapta) = "REMIS" Then
            Call setprop("xbtnCargaOrdenServicio1", PROP_VISIBLE, True)
            Call setprop("xtxtOrdenServicio", PROP_VISIBLE, True)
            Call setprop("xcPrice1", PROP_ENABLED, True)
        End If
   End If
   
    '------------------metodos de pago desde xaumetodopagos--------------
   Dim SentenciaMetodoPago As String
   Dim listaMetodos As String
   SentenciaMetodoPago = "SELECT metodoid, descr FROM xAuMetodoPago"
   serr10 = SqlFetch1(c10, SentenciaMetodoPago, bxMetodoPago, LenB(bxMetodoPago))
   listaMetodos = ""
   Do While serr10 = 0
        listaMetodos = listaMetodos + bxMetodoPago.metodoid + ";" + bxMetodoPago.descr
        serr10 = SFetch1(c10, bxMetodoPago, LenB(bxMetodoPago))
        If serr10 = 0 Then
            listaMetodos = listaMetodos + ","
        End If
   Loop
   'Call MsgBox(listaMetodos)
   dFPagos.List = listaMetodos
End Sub

Private Sub Update1_OnUpdate(Level As Integer, InsertFlg As Integer, retval As Integer)
   Dim Empresa1 As String
   Dim Empresa2 As String
   Dim Embarque1 As String
   Dim Embarque2 As String
   ' Proyecto xVTPedido -------------------------------------- Inicio
   Dim usuario      As String
   Dim Status       As String * 1
   Dim Cancelado    As Integer
   Dim StatusU      As String * 1
   Dim Pedido       As String
   Dim cliente      As String
   Dim almacen      As String
   Dim tipoOrden    As String
   Dim Comporta     As String
   Dim ISANRes      As Double
   Dim Sentencia    As String
   Dim Result       As Integer
   Dim Result1      As Integer
   Dim Result2      As Integer
   Dim Result3      As Integer
   Dim Result4      As Integer
   Dim Result10     As Integer
   Dim GridHandle   As Integer
   Dim Reg          As Integer
   Dim sDataEntity  As String
   Dim Row          As Integer
   Dim Rows         As Integer
   Dim BanderaISAN  As Boolean
   
   Dim RecFound      As Integer
   Dim MemMaintFlag  As Integer
   Dim RegFetch      As Integer
   Dim Renglon       As Integer
   Dim varInvtID     As String
   '*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
   'HEAF -  GUARDAR ADDENDA
   ' Dim sServiceCallId As String
   ' Dim FechaAdd As Sdate
   ' Dim sUsuario As String
   ' Dim SqlStr As String
   ' Dim sOrdNbr As String
    
   ' sServiceCallId = GetObjectValue("cshipperid_0")
    ''sOrdNbr = sivMyApp.Controls("cordnbr_0")

   ' If Level = 0 Then 'Valida el nivel que sea cero (primero)
      '  If Not bExisteAddenda Then
      '      bxFEAddenda.LUpd_DateTime = FechaAdd
       '     bxFEAddenda.LUpd_Prog = "4011000"
        '    bxFEAddenda.LUpd_User = sUsuario
         '   bxFEAddenda.Crtd_DateTime = FechaAdd
          '  bxFEAddenda.Crtd_Prog = "4011000"
          '  bxFEAddenda.Crtd_User = sUsuario
          '  'bxFEAddenda.OrdNbr = sOrdNbr
          '  bxFEAddenda.ServiceCallId = sServiceCallId
          '  Call SInsert1(csr_xFEAddenda, "xFEAddenda", bxFEAddenda, LenB(bxFEAddenda))
          '  bExisteAddenda = True
       ' Else 'Si no existe registro en la tabla adicional entonces manda a INSERT
         '   bxFEAddenda.LUpd_DateTime = FechaAdd
         '   bxFEAddenda.LUpd_Prog = "4011000"
         '   bxFEAddenda.LUpd_User = sUsuario
         '   bxFEAddenda.ServiceCallId = sServiceCallId
         ' '  bxFEAddenda.OrdNbr = sOrdNbr
         '   Call SUpdate1(csr_xFEAddenda, "xFEAddenda", bxFEAddenda, LenB(bxFEAddenda))
       ' End If
   ' 'ElseIf Level = 32000 Then
    '    'Call sql(c2, "xSP_SoLine_SoLot " + Sparm(sOrdNbr))
   ' End If
    '*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
  
   If Level = 32001 Then
      If TestLevelChg(LEVEL0) = NOTCHANGED And _
         TestLevelChg(LEVEL1) = NOTCHANGED And _
         TestLevelChg(LEVEL2) = NOTCHANGED And _
         TestLevelChg(LEVEL3) = NOTCHANGED And _
         TestLevelChg(LEVEL4) = NOTCHANGED And _
         TestLevelChg(LEVEL5) = NOTCHANGED And _
         TestLevelChg(LEVEL6) = NOTCHANGED And _
         TestLevelChg(LEVEL7) = NOTCHANGED And _
         TestLevelChg(LEVEL8) = NOTCHANGED Then
         Exit Sub
      End If
   End If

   If Level = 32001 And xGrabarOK <> "" Then
     Call MessBox(xGrabarOK, vbInformation + vbOKOnly, "Cuentas por Cobrar")
     retval = ErrNoMess
   Else
     xGrabarOK = ""
   End If
   
   Call GetBufferValue("bpes.UserId", usuario)
   
   If UsaPedido = True Then
      If Level = 32001 Then
         Call GetBufferValue("bSoShipHeader.ShipperID", NoEmbarque)
         Call GetBufferValue("bPes.UserID", usuario)
         Call GetBufferValue("bSoShipHeader.Status", Status)
         Call GetBufferValue("bSoShipHeader.Cancelled", Cancelado)
         Call GetBufferValue("bSoShipHeader.CustOrdNbr", Pedido)
         'Stop
         'Pedido = Trim(sivMyApp.Controls("cCustOrdNbr"))
         Call GetBufferValue("bSoShipHeader.SiteID", almacen)
         Call GetBufferValue("bSoShipHeader.SoTypeID", tipoOrden)
         Call GetBufferValue("bSoShipHeader.CustID", cliente)
         Call GetBufferValue("bSoType.Behavior", Comporta)
          
         If Trim(Pedido) <> "" And Status = "O" And Cancelado = 0 Then
           'Valida se haya capturado un pedido
            If Trim(sivMyApp.Controls("xPedido")) = "" Then
               Call MessBox("Capturar el No. de Pedido", vbOKOnly, "ADVERTENCIA")
               retval = ErrNoMess
               Exit Sub
            End If
         
            'Busca tipos de orden pertenezcan a NUEVOS
            Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where SiteID = " & Sparm(almacen) & " And SoTypeID = " & Sparm(tipoOrden)
            Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
   
            If Result = 0 Then
               'Busca el pedido
               If UCase(Trim(Pedido)) <> "GENERAL" Then
                  Sentencia = "Select * from xVTPedido Where Pedido = " & Sparm(Pedido)
                  Result1 = SqlFetch1(c8, Sentencia, bPedidoVal, LenB(bPedidoVal))
               
                  If Result1 = 9 Then
                     Call MessBox("Pedido capturado no existe", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               
                  'valida que el cliente coincida con el del pedido
                  If Trim(cliente) <> Trim(bPedidoVal.CustId) Then
                     Call MessBox("Cliente no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                  End If
            
                  Sentencia = "Select SiteID From xVTPedUnidad Where Pedido = " & Sparm(Pedido)
                  Result2 = SqlFetch1(c7, Sentencia, bPedidoSite, LenB(bPedidoSite))
            
                  If Result2 = 9 Then
                     Call MessBox("Pedido con inconsistencias, revizar", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
         
                  If Trim(almacen) <> Trim(bPedidoSite.SiteID) Then
                     Call MessBox("Almacén en el pedido diferente al almacén seleccionado", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
         
                  'Localiza parámetros
                  Sentencia = "Select * From xVTEmpresa Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And EmpresaID = " & Sparm(bPedidoVal.EmpresaID)
                  Result3 = SqlFetch1(c6, Sentencia, bxVTEmpresa, LenB(bxVTEmpresa))
          
                  If Result3 = 9 Then
                     Call MessBox("No existe registro de parámetros para la compañía " & bPedidoVal.EmpresaID & ", Checar con el departamento de sistemas", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               
                  'Valida que el tipo de orden sea válido para el tipo de venta usado
                  Sentencia = "Select * from xVTRelTVTO where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And TipoVentaID = " & Sparm(bPedidoVal.TipoVenta) & _
                              " And SOClase = " & Sparm(bPedidoCtrl.SoClase)
                  Result10 = SqlFetch1(c10, Sentencia, bxVTRelTVTO, LenB(bxVTRelTVTO))

                  'Dim usuario$
                  Call GetBufferValue("bpes.userid", usuario)
                  'If Trim(usuario) = "SYSADMIN" Then Stop
                  If Result10 = 9 Then
                     Call MessBox("Tipo de venta no tiene relacionado la clase de tipo de orden: " & bPedidoCtrl.SoClase, vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  Else
                     If Trim(bxVTRelTVTO.sotypeid) <> Trim(tipoOrden) Then
                        Call MessBox("El tipo de orden no coincide con el relacionado al tipo de venta del pedido" & Chr(13) & " Tipo de Orden del pedido debe ser : " & bxVTRelTVTO.sotypeid, vbOKOnly, "ADVERTENCIA")
                        retval = ErrNoMess
                        Exit Sub
                     End If
                  End If
               End If
            End If 'Fin de tipo de orden NUEVOS
         
            ' Si el tipo de orden es factura
            
            If Result = 0 And bPedidoCtrl.SoClase = "FA" Then
               'Valida sea un solo renglón en el grid
               GridHandle = GetGridHandle("Spread1")
               Reg = mrowcnt(GridHandle)
               If Reg = 0 Then
                  Call MessBox("Capturar la unidad", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
               If Reg > 1 Then
                  Call MessBox("Capturar solamente una unidad", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
          
               'Valida Unidad coincida con el del pedido
               GridHandle = GetGridHandle("Spread1")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  If Trim(sivMyApp.Controls("cInvtID_1")) <> Trim(bPedidoVal.invtid) Then
                     Call MessBox("Unidad seleccionada no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If

                 'Valida precio sea igual al total de la factura por diferencia de 1 peso
             '    If Abs(sivMyApp.Controls("cPrecio") - Abs(sivMyApp.Controls("cCuryTotInvc_0"))) > 1 Then
             '       Call MessBox("Total factura diferente al precio de la unidad", vbOKOnly, "ADVERTENCIA")
             '       retval = ErrNoMess
             '       Exit Sub
             '    End If

                 'Valida Precio coincida con el del pedido
                  Sentencia = "Select ImporteNac From xVTPedImporte Where Pedido = " & Sparm(Pedido) & " And NoImporte = " & Sparm(bxVTEmpresa.ConcTotUnidID)
                  Result4 = SqlFetch1(c5, Sentencia, bxPrecio, LenB(bxPrecio))

                  If Result4 = 9 Then
                     Call MessBox("No encontró registro a comparar de precio en el pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If

                  If Round(sivMyApp.Controls("cPrecio"), 2) <> Round(bxPrecio.precio, 2) Then
                     Call MessBox("Precio no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If

                  'Valida ISAN Coincida con el del Pedido
                  Sentencia = "Select ImporteNac From xVTPedImporte Where Pedido = " & Sparm(Pedido) & " And NoImporte = " & Sparm(bxVTEmpresa.ConcISANID)
                  Result4 = SqlFetch1(c5, Sentencia, bxPrecio, LenB(bxPrecio))

                  BanderaISAN = True
                  If Result4 = 9 Then
                     BanderaISAN = False
              '      Call MessBox("No encontró registro a comparar de ISAN en el pedido", vbOKOnly, "ADVERTENCIA")
              '      retval = ErrNoMess
              '      Exit Sub
                  End If
                  'If RTrim(usuario) = "SYSADMIN" Then Stop

                  If BanderaISAN = True Then
                     If Abs(sivMyApp.Controls("cIsan") - bxPrecio.precio) > 0.02 Then
                        'HEAF. Se comento porque no deja guardar
                        'Call MessBox("ISAN no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                        'retval = ErrNoMess
                        'Exit Sub
                     End If
                  Else
                     If sivMyApp.Controls("cIsan") <> 0 Then
                        Call MessBox("Pedido no tiene ISAN", vbOKOnly, "ADVERTENCIA")
                        retval = ErrNoMess
                        Exit Sub
                     End If
                  End If
                  Call GetBufferValue("bsoshipline.user5", ISANRes)

                  'Valida Cantidad sea igual a 1
                  If sivMyApp.Controls("cQtyShip_1") <> 1 Then
                     Call MessBox("Cantidad debe ser igual a 1", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If

                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)



               GridHandle = GetGridHandle("Spread3")
               Reg = mrowcnt(GridHandle)
               'Valida Isan coincida con el cargo miscelaneo de ISAN
               GridHandle = GetGridHandle("Spread3")
               Reg = mrowcnt(GridHandle)
               If Reg = 0 And ISANRes <> 0 And RTrim(usuario) <> "SYSADMIN" Then
                  Call MessBox("Capturar ISAN en pestaña de Cargos Miscelaneos", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
        '       If Reg > 1 And ISANRes <> 0 Then
        '          Call MessBox("Crear solamente un renglón de ISAN", vbOKOnly, "ADVERTENCIA")
        '          retval = ErrNoMess
        '          Exit Sub
        '       End If
    '           If Reg <> 0 And ISANRes = 0 Then
        '          Call MessBox("No debe crearse registro de ISAN", vbOKOnly, "ADVERTENCIA")
    '              retval = ErrNoMess
    '              Exit Sub
    '           End If
         
               'Valida ISAN de cargos miscelaneos coincida con ISANRes
               GridHandle = GetGridHandle("Spread3")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  If sivMyApp.Controls("cCuryMiscChrg_3") <> ISANRes And RTrim(usuario) <> "SYSADMIN" Then
                     Call MessBox("ISAN en pestaña Cargos misceláneos diferente a ISAN calculado", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)
             
               'valida ISAN coincida con el total del ISAN
               'If sivMyApp.Controls("cCuryTotmisc_0") <> ISANRes Then
               '   Call MessBox("ISAN no Coincide con total de cargos misceláneos", vbOKOnly, "ADVERTENCIA")
               '   retval = ErrNoMess
               '   Exit Sub
               'End If
               
               
               'Valda exista serie
               GridHandle = GetGridHandle("Spread8")
               Reg = mrowcnt(GridHandle)
               If Reg = 0 Then
                  Call MessBox("Capturar No. de Serie", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
               If Reg > 1 Then
                  Call MessBox("Capturar solamente un No. de Serie", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
               
               'Valida Serie coincida con el del pedido
               GridHandle = GetGridHandle("Spread8")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  If sivMyApp.Controls("cLotSerNbr_8") <> bPedidoVal.LotSerNbr Then
                     Call MessBox("Serie de la unidad no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  
                  Call GetBufferValue("bpes.userid", usuario)
                  'If Trim(usuario) = "SYSADMIN" Then Stop
               
                  If sivMyApp.Controls("cSpecificCostID_8") <> bPedidoVal.NoControl Then
                     Call MessBox("Costo Específico de la unidad no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               
                  If Trim(sivMyApp.Controls("cSpecificCostID_8")) <> Trim(sivMyApp.Controls("cWhSeLoc_8")) Then
                     Call MessBox("La localización de la unidad no coincide con el del pedido y costo específico", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)
            End If ' Fin de INVC
      
            ' Si el tipo de orden es devolución de factura
            If Result = 0 And bPedidoCtrl.SoClase = "DF" Then
               If Trim(Pedido) <> "" And Status = "O" And Cancelado = 1 Then
                  Sentencia = "Select * from xVTPedido Where Pedido = " & Sparm(Pedido)
                  Result1 = SqlFetch1(c8, Sentencia, bPedidoVal, LenB(bPedidoVal))
                         
                  If Result1 = 9 Or _
                     bPedidoVal.PermitirFacturar <> "1" Then
                     Call MessBox("No se permite cancelar embarque, el pedido debe estar marcado para permitir facturar", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Call SqlFree(c8)
                     Exit Sub
                  End If
                  Call SqlFree(c8)
               End If
                
               'Valida sea un solo renglón en el grid
               GridHandle = GetGridHandle("Spread1")
               Reg = mrowcnt(GridHandle)
               If Reg = 0 Then
                  Call MessBox("Buscar el documento y traerse la unidad a reversasr por medio del botón MRA", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
               If Reg > 1 Then
                  Call MessBox("Solamente debe ser una unidad", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
            
               'Valida Unidad coincida con el del pedido
               GridHandle = GetGridHandle("Spread1")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  If Trim(sivMyApp.Controls("cInvtID_1")) <> Trim(bPedidoVal.invtid) Then
                     Call MessBox("Unidad seleccionada a devolver no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
              
                  'Valida precio sea igual al total de la factura por diferencia de 1 peso
                  'If Abs(Abs(sivMyApp.Controls("cPrecio")) - Abs(sivMyApp.Controls("cCuryTotInvc_0"))) > 1 Then
                  '   Call MessBox("Total factura diferente al precio de la unidad", vbOKOnly, "ADVERTENCIA")
                  '   retval = ErrNoMess
                  '   Exit Sub
                  'End If
              
                  'Valida Precio coincida con el del pedido
                  Sentencia = "Select ImporteNac From xVTPedImporte Where Pedido = " & Sparm(Pedido) & " And NoImporte = " & Sparm(bxVTEmpresa.ConcTotUnidID)
                  Result4 = SqlFetch1(c5, Sentencia, bxPrecio, LenB(bxPrecio))
       
                  If Result4 = 9 Then
                     Call MessBox("No encontró registro a comparar de precio en el pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
              
                  If Abs(sivMyApp.Controls("cPrecio")) <> bxPrecio.precio Then
                     Call MessBox("Precio no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
              
                  'Valida ISAN Coincida con el del Pedido
                  Sentencia = "Select ImporteNac From xVTPedImporte Where Pedido = " & Sparm(Pedido) & " And NoImporte = " & Sparm(bxVTEmpresa.ConcISANID)
                  Result4 = SqlFetch1(c5, Sentencia, bxPrecio, LenB(bxPrecio))
       
                  BanderaISAN = True
                  If Result4 = 9 Then
                     BanderaISAN = False
              '      Call MessBox("No encontró registro a comparar de ISAN en el pedido", vbOKOnly, "ADVERTENCIA")
              '      retval = ErrNoMess
              '      Exit Sub
                  End If
                            
                  If BanderaISAN = True Then
                     If sivMyApp.Controls("cIsan") <> bxPrecio.precio Then
                        Call MessBox("ISAN no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                        retval = ErrNoMess
                        Exit Sub
                     End If
                  'Else
                  '   If sivMyApp.Controls("cIsan") <> 0 Then
                  '      Call MessBox("Pedido no tiene ISAN", vbOKOnly, "ADVERTENCIA")
                  '      retval = ErrNoMess
                  '      Exit Sub
                  '   End If
                  End If
                  Call GetBufferValue("bsoshipline.user5", ISANRes)
                 
                  'Valida Cantidad sea igual a -1
                  If sivMyApp.Controls("cQtyShip_1") <> -1 Then
                     Call MessBox("Cantidad debe ser igual a -1", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)
             
               'Valida Isan coincida con el cargo miscelaneo de ISAN
               GridHandle = GetGridHandle("Spread3")
               Reg = mrowcnt(GridHandle)
               If Reg = 0 And ISANRes <> 0 Then
                  Call MessBox("Capturar ISAN en pestaña de Cargos Miscelaneos", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
        '       If Reg > 1 And ISANRes <> 0 Then
        '          Call MessBox("Crear solamente un renglón de ISAN", vbOKOnly, "ADVERTENCIA")
        '          retval = ErrNoMess
        '          Exit Sub
        '       End If
       '        If Reg <> 0 And ISANRes = 0 Then
        '          Call MessBox("No debe crearse registro de ISAN", vbOKOnly, "ADVERTENCIA")
       '           retval = ErrNoMess
       '           Exit Sub
       '        End If
              
               'Valida ISAN de cargos miscelaneos coincida con ISANRes
               GridHandle = GetGridHandle("Spread3")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  'If Abs(sivMyApp.Controls("cCuryMiscChrg_3")) <> Abs(ISANRes) Then
                  '   Call MessBox("ISAN en pestaña Cargos misceláneos diferente a ISAN calculado", vbOKOnly, "ADVERTENCIA")
                  '   retval = ErrNoMess
                  '   Exit Sub
                  'End If
               
                  'Valida que el importe del ISAN sea negativo
                  If sivMyApp.Controls("cCuryMiscChrg_3") > 0 Then
                     Call MessBox("El importe del ISAN debe ser Negativo en pestaña de misceláneos", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)
             
               'valida ISAN coincida con el total del ISAN
               'If Abs(sivMyApp.Controls("cCuryTotmisc_0")) <> Abs(ISANRes) Then
               '   Call MessBox("ISAN no Coincide con total de cargos misceláneos", vbOKOnly, "ADVERTENCIA")
               '   retval = ErrNoMess
               '   Exit Sub
               'End If
               
               'Valida Serie exista
               GridHandle = GetGridHandle("Spread8")
               Reg = mrowcnt(GridHandle)
               If Reg = 0 Then
                  Call MessBox("Capturar No. de Serie", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
               If Reg > 1 Then
                  Call MessBox("Capturar solamente un No. de Serie", vbOKOnly, "ADVERTENCIA")
                  retval = ErrNoMess
                  Exit Sub
               End If
         
               'Valida Serie coincida con el del pedido
               GridHandle = GetGridHandle("Spread8")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  If sivMyApp.Controls("cLotSerNbr_8") <> bPedidoVal.LotSerNbr Then
                     Call MessBox("Serie de la unidad no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               
                  If sivMyApp.Controls("cSpecificCostID_8") <> bPedidoVal.NoControl Then
                     Call MessBox("Costo Específico de la unidad no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               
                  If Trim(sivMyApp.Controls("cSpecificCostID_8")) <> Trim(sivMyApp.Controls("cWhSeLoc_8")) Then
                     Call MessBox("La localización de la unidad no coincide con el del pedido y costo específico", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)
            End If ' Fin de ADM (devolución unidad)
         
            ' Si el tipo de orden es Nota de Crédito por descuento.
            If Result = 0 And bPedidoCtrl.SoClase = "CR" Then
            End If
            ' Si el tipo de orden es una cancelación de descuento.
            If Result = 0 And bPedidoCtrl.SoClase = "DC" Then
            End If
            ' Seguros
            If Result = 0 And bPedidoCtrl.SoClase = "SA" Then
            End If
            ' Si el tipo de orden es una cancelación de Seguros.
            If Result = 0 And bPedidoCtrl.SoClase = "XA" Then
            End If
            ' Si el tipo de orden de trámites
            If Result = 0 And bPedidoCtrl.SoClase = "PT" Then
            End If
            ' Si el tipo de orden es una cancelación de trámites.
            If Result = 0 And bPedidoCtrl.SoClase = "XT" Then
            End If
            ' Si el tipo de orden de trámites descuento
            If Result = 0 And bPedidoCtrl.SoClase = "TD" Then
            End If
            ' Si el tipo de orden es una cancelación de trámites descuento
            If Result = 0 And bPedidoCtrl.SoClase = "XD" Then
            End If
            ' Si el tipo de orden es una nota de débito por accesorios.
            If Result = 0 And bPedidoCtrl.SoClase = "DB" Then
               GridHandle = GetGridHandle("Spread1")
               Rows = mrowcnt(GridHandle)
               Renglon = MGetRowNum(GridHandle)
               RecFound = MFirst(GridHandle, MemMaintFlag)
               While RecFound = 0
                  'Valida Unidad coincida con el del pedido
                  If Trim(bPedidoVal.NoControl) <> Trim(sivMyApp.Controls("cWhSeLoc_1")) Then
                     Call MessBox("La localización de la unidad no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
                     retval = ErrNoMess
                     Exit Sub
                  End If
                  RecFound = MNext(GridHandle, MemMaintFlag)
               Wend
               Call msetrownum(GridHandle, Renglon)
            End If
            ' Si el tipo de orden es una devolución de accesorios.
            If Result = 0 And bPedidoCtrl.SoClase = "DA" Then
            End If
         
         End If ' No Cancelados
      End If ' fin de level = 32001
   
      If Level = 0 Then
         Call GetBufferValue("bPes.UserID", usuario)
         Call GetBufferValue("bSoShipHeader.Status", Status)
         Call GetBufferValue("bSoShipHeader.Cancelled", Cancelado)
         Call GetBufferValue("bSoShipHeader.CustOrdNbr", Pedido)
         Call GetBufferValue("bSoShipHeader.SiteID", almacen)
         Call GetBufferValue("bSoShipHeader.SoTypeID", tipoOrden)
         Call GetBufferValue("bSoType.Behavior", Comporta)
         
         'Busca tipos de orden pertenezcan a NUEVOS
         Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where SiteID = " & Sparm(almacen) & " And SoTypeID = " & Sparm(tipoOrden)
         Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
   
         If Result = 9 Then
            Call MessBox("Registro no encontrado en tabla xVTPedido_Ctrl, favor de comunicarse a sistemas", vbOKOnly, "ADVERTENCIA")
            retval = ErrNoMess
            Call SetBufferValue("bSoShipHeader.ShipperID", NoEmbarque)
            Call DispFields("Form1", "cShipperID_0")
            Exit Sub
         End If
         ' Si es factura
         If Result = 0 And Trim(bPedidoCtrl.SoClase) = "FA" Then
        
            ' Si el embarque está abierto y no está cancelado
            If Trim(Pedido) <> "" And Status = "O" And Cancelado = 0 Then
               serr1 = SqlFetch1(c2, "Select StatusUnidad from xVTPedido Where Pedido = " & Sparm(Trim(Pedido)), bStatus, LenB(bStatus))
               If serr1 = 9 Then
                  StatusU = "S"
               Else
                  If bStatus.StatusUnidad = "E" Or bStatus.StatusUnidad = "S" Then
                     StatusU = bStatus.StatusUnidad
                  Else
                     StatusU = "S"
                  End If
               End If
          
               'Si tiene No. de factura capturado
               If Trim(sivMyApp.Controls("cInvcnbr_0")) = "" Then
                  Sentencia = "Update xVTPedido Set Lupd_DateTime = GetDate(), Lupd_User = " & Sparm(usuario) & ", Status = 'PF', StatusUnidad = " & Sparm(StatusU) & ", " & _
                           "NoFactura = " & Sparm(sivMyApp.Controls("cInvcnbr_0")) & ", ShipperID = " & Sparm(sivMyApp.Controls("cShipperID_0")) & _
                           " Where xVTPedido.Pedido = " & Sparm(Trim(Pedido))
               Else
                  'Si tiene no. de factura capturado
                  Sentencia = "Update xVTPedido Set Lupd_DateTime = GetDate(), Lupd_User = " & Sparm(usuario) & ", Status = 'FA', StatusUnidad = 'E'," & _
                           "RevFactura = '', RevShipperID = '', NoFactura = " & Sparm(sivMyApp.Controls("cInvcnbr_0")) & ", ShipperID = " & Sparm(sivMyApp.Controls("cShipperID_0")) & _
                           " Where xVTPedido.Pedido = " & Sparm(Trim(Pedido))
               End If
               
               Call SqlFree(c1)
               Call sql(c1, Sentencia)
               serr1 = SqlErr()
               Call SqlFree(c1)
               If serr1 <> 0 Then
                  Call SqlFree(c1)
                  Call MessBox("Pedido no se pudo grabar, No guardó datos en el pedido, volver a intentar gurdar ", vbInformation + vbOKOnly, "Pedido")
                  retval = ErrNoMess
                  Exit Sub
               End If
            
            'Si el embarque está abierto y se cancela
            ElseIf Trim(Pedido) <> "" And Status = "O" And Cancelado = 1 Then
               Sentencia = "Update xVTPedido Set Lupd_DateTime = GetDate(), Lupd_User = " & Sparm(usuario) & ", Status = 'IN', " & _
                           "NoFactura = '', ShipperID = '', StatusUnidad = 'S', RevFactura = '', RevShipperID = '' Where xVTPedido.Pedido = " & Sparm(Trim(Pedido))
               Call SqlFree(c1)
               Call sql(c1, Sentencia)
               serr1 = SqlErr()
               Call SqlFree(c1)
               If serr1 <> 0 Then
                  Call SqlFree(c1)
                  Call MessBox("Pedido no se pudo grabar, No guardó datos en el pedido, volver a intentar gurdar ", vbInformation + vbOKOnly, "Pedido")
                  retval = ErrNoMess
                  Exit Sub
               End If
            Else
               Call GetBufferValue("bpes.userid", usuario)
               'If Trim(usuario) = "SYSADMIN" Then Stop
               
               Call MessBox("status inválido", vbOKOnly, "ADVERTENCIA")
               Call SetBufferValue("bSoShipHeader.ShipperID", NoEmbarque)
               Call DispFields("Form1", "cShipperID_0")
               retval = ErrNoMess
               Exit Sub
            End If
         End If ' Si es factura
         
         'Si es devolución
         If Result = 0 And Trim(bPedidoCtrl.SoClase) = "DF" Then
            Sentencia = "Select * from xVTPedido Where Pedido = " & Sparm(Pedido)
            Result1 = SqlFetch1(c8, Sentencia, bPedidoVal, LenB(bPedidoVal))
            
            ' Si el embarque está abierto y no está cancelado
            Call SqlFree(c1)
            If Trim(Pedido) <> "" And Status = "O" And Cancelado = 0 Then
               If Trim(bPedidoVal.shipperid) <> "" And _
                  Trim(bPedidoVal.NoFactura) <> "" Then
                  Sentencia = "Update xVTPedido Set Lupd_DateTime = GetDate(), Lupd_User = " & Sparm(usuario) & ", Status = 'IN', " & _
                           "RevFactura = NoFactura, RevShipperID = ShipperID, NoFactura = '', ShipperID = '', StatusUnidad = 'S' " & _
                           " Where xVTPedido.Pedido = " & Sparm(Trim(Pedido))
                  Call SqlFree(c1)
                  Call sql(c1, Sentencia)
                  serr1 = SqlErr()
                  Call SqlFree(c1)
                  If serr1 <> 0 Then
                     Call SqlFree(c1)
                     Call MessBox("Pedido no se pudo grabar, No guardó datos en el pedido, volver a intentar gurdar ", vbInformation + vbOKOnly, "Pedido")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               End If
            'Si el embarque está abierto y se cancela
            ElseIf Trim(Pedido) <> "" And Status = "O" And Cancelado = 1 Then
               If Trim(bPedidoVal.RevShipperID) <> "" And _
                  Trim(bPedidoVal.RevFactura) <> "" Then
                  Sentencia = "Update xVTPedido Set Lupd_DateTime = GetDate(), Lupd_User = " & Sparm(usuario) & ", Status = 'FA', " & _
                              "NoFactura = RevFactura, ShipperID = RevShipperID, RevFactura = '', RevShipperID = '', StatusUnidad = 'E' " & _
                              " Where xVTPedido.Pedido = " & Sparm(Trim(Pedido))
                  Call SqlFree(c1)
                  Call sql(c1, Sentencia)
                  serr1 = SqlErr()
                  Call SqlFree(c1)
                  If serr1 <> 0 Then
                     Call SqlFree(c1)
                     Call MessBox("Pedido no se pudo grabar, No guardó datos en el pedido, volver a intentar gurdar ", vbInformation + vbOKOnly, "Pedido")
                     retval = ErrNoMess
                     Exit Sub
                  End If
               End If
            Else
               Call GetBufferValue("bpes.userid", usuario)
               'If Trim(usuario) = "SYSADMIN" Then Stop
               
               Call MessBox("Status Inválido", vbOKOnly, "ADVERTENCIA")
               Call SetBufferValue("bSoShipHeader.ShipperID", NoEmbarque)
               Call DispFields("Form1", "cShipperID_0")
               retval = ErrNoMess
               Call SqlFree(c1)
               Exit Sub
            End If
            Call SqlFree(c1)
         End If ' Si es devolución RMA
      End If
   End If
   

   ' Proyecto xVTPedido -------------------------------------- Final
   
' Facturacion Electronica
    Dim shipperid As String
    Dim Fecha As Sdate
'    Debug.Print "Level: ", Level, "   InsertFlg: ", InsertFlg
    If Level = LEVEL0 Then
        Call GetSysDate(Fecha)
        Call GetBufferValue("bSoShipHeader.OrdNbr", shipperid)
        If RTrim(shipperid) = "" Then
           Call GetBufferValue("bSoShipHeader.ShipperId", shipperid)
        End If
        
        With bxFEAddenda
            If VBA.Trim$(.ServiceCallId) = "" Or Asc(.ServiceCallId) < 32 Then
                .Crtd_DateTime = Fecha
                .Crtd_Prog = "4011000"
                .Crtd_User = usuario
                .ServiceCallId = shipperid
            End If
            .LUpd_DateTime = Fecha
            .LUpd_Prog = "4011000"
            .LUpd_User = usuario
        End With
       ' Stop
        Sentencia = "Select * From xFEAddenda where ServiceCallId =" & Sparm(shipperid)
        Result = SqlFetch1(csr_xFEAddenda, Sentencia, bxFEAddendaTemp, LenB(bxFEAddendaTemp))
        Status = TestLevelChg(LEVEL0)
        Select Case Status
            Case UPDATED, INSERTED
                If Result = NOTFOUND Then
                    Call SInsert1(csr_xFEAddenda, "xFEAddenda", bxFEAddenda, LenB(bxFEAddenda))
                Else
                    Call SUpdate1(csr_xFEAddenda, "xFEAddenda", bxFEAddenda, LenB(bxFEAddenda))
                End If
            Case DELETED
                serr1 = SDelete(c1, "xFEAddenda")
        End Select
        
        If VBA.Trim$(bAuOrdAdic.ServCallID) = "" Or Asc(bAuOrdAdic.ServCallID) < 32 Then
            bAuOrdAdic.ServCallID = shipperid
        End If
        Sentencia = "Select * From AuOrdAdic Where ServCallId = " & Sparm(shipperid)
        Result = SqlFetch1(CSR_AuOrdAdic, Sentencia, bAuOrdAdicTemp, LenB(bAuOrdAdicTemp))
        Status = TestLevelChg(LEVEL0)
        Select Case Status
            Case UPDATED, INSERTED
                If Result = NOTFOUND Then
                    Call SInsert1(CSR_AuOrdAdic, "AuOrdAdic", bAuOrdAdic, LenB(bAuOrdAdic))
                Else
                    Call SUpdate1(CSR_AuOrdAdic, "AuOrdAdic", bAuOrdAdic, LenB(bAuOrdAdic))
                End If
            Case DELETED
                serr1 = SDelete(c1, "AuOrdAdic")
        End Select
    End If
   ' Fin Facturacion Electronica
    
    If gRefacciones Then
       Dim FechaV     As String
       Dim Hora       As String
       Dim Llave      As String
       Dim MaintFlag  As Integer
   
       Call GetBufferValue("bpes.UserID", usuario)
       FechaV = Date
       Hora = Time
   
       Llave = Trim(usuario) & Trim(FechaV) & Trim(Hora)
   
      If Level = 32001 Then
         GridHandle = GetGridHandle("Spread1")
         Rows = mrowcnt(GridHandle)
         Renglon = MGetRowNum(GridHandle)
         RecFound = MFirst(GridHandle, MemMaintFlag)
         Row = 1
         While RecFound = 0
            Call GetBufferValue("bSoShipLine.InvtID", varInvtID)
            Sentencia = "Select * from xTMValida Where codigo = " & Sparm(Llave) & " And InvtID = " & Sparm(varInvtID)
            Call SqlFree(c1)
            serr1 = SqlFetch1(c1, Sentencia, bxTMValida, LenB(bxTMValida))
            If serr1 = 0 Then
               Call MessBox("El artículo " & Trim(varInvtID) & Chr(13) & _
                            "Que se encuentra en la linea " & Row & " " & Chr(13) & _
                            " Ya está en la línea " & bxTMValida.Linea & " " & Chr(13) & _
                            " Favor de ELIMINAR UNA DE LAS LINEAS", vbOKOnly, "ADVERTENCIA")
           
               Sentencia = "Delete xTMValida Where Codigo = " & Sparm(Llave)
               Call sql(c1, Sentencia)
               Call SqlFree(c1)
               Call msetrownum(GridHandle, Renglon)
               retval = ErrNoMess
               Exit Sub
            End If
            Call SqlFree(c1)
            Sentencia = "Insert xTMValida (codigo, InvtID, Linea) Values( " & Sparm(Llave) & "," & Sparm(varInvtID) & "," & Row & ")"
            Call sql(c1, Sentencia)
            Call SqlFree(c1)
            Row = Row + 1
            RecFound = MNext(GridHandle, MemMaintFlag)
         Wend
         Call msetrownum(GridHandle, Renglon)
         Call SqlFree(c1)
         Sentencia = "Delete xTMValida Where Codigo = " & Sparm(Llave)
         Call sql(c1, Sentencia)
         Call SqlFree(c1)
      End If
   End If
End Sub

Private Sub xbDatosAdic_Click()
    Dim sSQL As String
    Dim sUserId As String
    Dim sCustId As String
    
    sCustId = sivMyApp.Controls("ccustid_0")
    Call GetBufferValue("bpes.userid", sUserId)
    
    If Trim(sCustId) <> "000004" Then
        Call MsgBox("Solo puede modificar al cliente 000004", vbInformation)
        Exit Sub
    End If
   
    sSQL = "Select GroupID, User1, User2 From VS_UserGrp Where GroupID='VREFACC' and UserID = " + Sparm(sUserId)
    serr1 = SqlFetch1(c1, sSQL, bDatos, LenB(bDatos))
    Call ApplSetParmValue(PRMSECTION_VBRDT, "CustId", sCustId)
    Call ApplSetParmValue(PRMSECTION_VBRDT, "ShipToId", "DEFAULT")
    If serr1 <> NOTFOUND Then
        If Trim(sCustId) = "000004" Then
            Call ApplSetParmValue(PRMSECTION_VBRDT, "Existe", "1")
        Else
            Call ApplSetParmValue(PRMSECTION_VBRDT, "Existe", "2")
        End If
    Else
        Call ApplSetParmValue(PRMSECTION_VBRDT, "Existe", "1")
    End If
    serr1 = Launch("0826010", True, True, 1)
End Sub

Private Sub xbtnCargaOrdenServicio1_Click()
Dim SIVAppTrans As SIVApplication
Dim iSolErr  As Integer
Dim iOSErr   As Long
Dim OrdenServicio As String
Dim CpnyId As String
Dim servicioSiteid As String
Dim refaccionessiteId As String
Dim Sentencia As String
Dim Sentencia1 As String
Dim SentenciaUpdate As String
Dim SentenciaError As String
Dim qty As Double
Dim sDataEntityTrans As String
Dim GridHandleTrans As Integer
Dim sDataEntityEm As String
Dim GridHandleEm As Integer
Dim mensajeError As String
Dim tipoOrden As String
Dim cliente As String
Dim i As Integer
Dim LimiteOK As Boolean
Dim Verif As Boolean
Dim Continua As Boolean
Dim precioExt As Double
Dim LoteTransServToRef As String
Dim SentenciaUpdateOrden As String
Dim SentenciaMail As String
Dim sendMail As String
Dim mail As String
Dim body As String
Dim profile As String
Dim subject As String
Dim attachment As String
Dim SentenciaInsert As String
Dim SentenciaDelete  As String
Dim usuarioT As String

EmbActual__ = 0
Call GetBufferValue("bpes.cpnyid", CpnyId)
Call GetBufferValue("bpes.userid", usuarioT)
OrdenServicio = Trim(sivMyApp.Controls("xtxtOrdenServicio"))
tipoOrden = Trim(sivMyApp.Controls("csotypeid_0"))
cliente = Trim(sivMyApp.Controls("ccustid_0"))
If OrdenServicio <> "" And tipoOrden <> "" And cliente <> "" Then
    Sentencia = "SELECT shipperid FROM SOShipHeader WHERE s4future11 = " & Sparm(OrdenServicio) & _
                " AND cpnyid= " & Sparm(CpnyId)
    serr1 = SqlFetch1(c1, Sentencia, bshipper, LenB(bshipper))
    If serr1 = NOTFOUND Then
            Sentencia = "Select user6,user5 From smbranch Where cpnyId like " & Sparm(CpnyId)
            serr1 = SqlFetch1(c1, Sentencia, blocalizacion, LenB(blocalizacion))
            servicioSiteid = Trim(blocalizacion.servicioSiteid)
            refaccionessiteId = Trim(blocalizacion.refaccionesiteId)
            
            Sentencia = "SELECT invtid,precio,codigointerv,whseloc,'FRENTE',qtyinvt,unitdesc" & _
            " FROM AuVW_InTran_TransfersDescto_V2" & _
            " WHERE ServiceCallID= " & Sparm(OrdenServicio)
            serr12 = SqlFetch1(c12, Sentencia, brefacciones, LenB(brefacciones))

            If serr12 <> NOTFOUND Then
                Sentencia1 = "SELECT sum(precio*qtyinvt) FROM AuVW_InTran_TransfersDescto_V2 WHERE servicecallid=" & _
                Sparm(OrdenServicio)
                serr2 = SqlFetch1(c2, Sentencia1, bsumaEmbarque, LenB(bsumaEmbarque))
                
                Sentencia = "SELECT invtid,qtyinvt,precio as unitprice,'FRENTE' " & _
                        " FROM AuVW_InTran_TransfersDescto_V2 where ServiceCallID=" & _
                        Sparm(OrdenServicio)
                serr10 = SqlFetch1(c10, Sentencia, bTransfersDescto, LenB(bTransfersDescto))
                
                If serr2 = 0 Then
                    'sivMyApp.Controls("cCuryBalDue_0").Properties("Enabled") = True
                    'Call setprop("ccurybaldue_0", PROP_ENABLED, True)
                    'Call Set ("ccurybaldue_0", bsumaEmbarque.suma)
                    'Call setprop("ccurybaldue_0", PROP_ENABLED, False)
                    'Call SetObjectValue(
                    EmbActual__ = bsumaEmbarque.suma
                    
                    Let LimiteOK = True
                    Call Rev_Limite(LimiteOK, sivMyApp.Controls("ctermsid_0")) 'Ram
            
                    If LimiteOK Then
                        Continua = True
                     Else
                        'Let Verif = True
                        Call Verifica_Clave(Verif)
                        If Verif Then
                            Continua = True
                        Else
                            Continua = False
                        End If
                    End If
                    If Continua Then
                    'empieza la carga en transferencias
                        SentenciaInsert = "Insert INTO xAlmPermitido Values(" & Sparm(CpnyId) & _
                        "," & Sparm(usuarioT) & "," & Sparm(servicioSiteid) & "," & Sparm(refaccionessiteId) & _
                        ",'Un Paso')"
                        Call sql(c9, SentenciaInsert)
                        Call SetStatusBarText("Abriendo el Programa", "")
                        Set SIVAppTrans = StartAppAndAutomate("IN\1004000.EXE", iSolErr, iOSErr)
                        SIVAppTrans.Visible = True
                        SIVAppTrans.Controls("cSiteId") = servicioSiteid
                        SIVAppTrans.Controls("cToSiteId") = refaccionessiteId
                        SIVAppTrans.Controls("cOrdServ") = OrdenServicio
                        SIVAppTrans.Controls("cRefNbr") = OrdenServicio
                        SIVAppTrans.Controls("cBatchHandling") = "Liberar Ahora"
                        SIVAppTrans.Controls("cTransferType") = "Un Paso"
                        
                        sDataEntityTrans = SIVAppTrans.Controls("cInvtId").Properties("Level")
                        'sDataEntityTrans = "02"
                        GridHandleTrans = GetGridHandle("Spread1")
                        SIVAppTrans.New sDataEntityTrans
                        Do While serr12 = 0
                            Sentencia1 = "SELECT 1 FROM tempTransError WHERE siteid=" & Sparm(servicioSiteid) & _
                                    " AND invtid = " & Sparm(brefacciones.invtid) & _
                                    " AND whseloc = " & Sparm(brefacciones.towhseloc) & _
                                    " AND servicecallid= " & Sparm(OrdenServicio)
                            serr2 = SqlFetch1(c2, Sentencia1, binvtidError, LenB(binvtidError))
                            If serr2 = NOTFOUND Then
                                'valida que tenga existencia la orden para devolver en la tabla location
                                Sentencia1 = "SELECT QtyInvt from AuVW_InTran_TransfersDescto_V2 WHERE ServiceCallID like " & _
                                        Sparm(OrdenServicio) & " AND invtid=" & Sparm(brefacciones.invtid)
                                serr2 = SqlFetch1(c2, Sentencia1, bcantidadNecesaria, LenB(bcantidadNecesaria))
                                
                                Sentencia1 = "SELECT qtyonhand,qtyAvail FROM location WHERE " & _
                                            " invtid=" & Sparm(brefacciones.invtid) & "AND siteid=" & _
                                            Sparm(servicioSiteid) & " AND Whseloc=" & Sparm(brefacciones.whseloc)
                                serr2 = SqlFetch1(c2, Sentencia1, bcantidadLocation, LenB(bcantidadLocation))
                                
                                If bcantidadNecesaria.qty <= bcantidadLocation.qtyonhand Then
                                    If bcantidadLocation.qtyavail < bcantidadNecesaria.qty Then
                                        SentenciaUpdate = "UPDATE Location SET qtyAvail = " & bcantidadNecesaria.qty & _
                                                " WHERE invtid=" & Sparm(brefacciones.invtid) & "AND siteid=" & _
                                                Sparm(servicioSiteid) & " AND Whseloc=" & Sparm(brefacciones.whseloc)
                                        Call sql(c2, SentenciaUpdate)
                                    End If
                                    'valida que tenga existencia la orden para devolver en la tabla itemsite
                                    Sentencia1 = "SELECT qtyonhand,qtyAvail FROM itemsite WHERE " & _
                                                " invtid=" & Sparm(brefacciones.invtid) & "AND siteid=" & _
                                                Sparm(servicioSiteid) & " AND DfltPutAwayBin=" & Sparm(brefacciones.whseloc)
                                    serr2 = SqlFetch1(c2, Sentencia1, bcantidadLocation, LenB(bcantidadLocation))
    
                                    If bcantidadNecesaria.qty <= bcantidadLocation.qtyonhand Then
                                        If bcantidadLocation.qtyavail < bcantidadNecesaria.qty Then
                                            SentenciaUpdate = "UPDATE itemsite SET qtyAvail = " & bcantidadNecesaria.qty & _
                                                    " WHERE invtid=" & Sparm(brefacciones.invtid) & "AND siteid=" & _
                                                    Sparm(servicioSiteid) & " AND DfltPutAwayBin=" & Sparm(brefacciones.whseloc)
                                            Call sql(c2, SentenciaUpdate)
                                        End If
                                        'Call MsgBox(brefacciones.invtid)
                                        SIVAppTrans.Controls("cInvtId") = brefacciones.invtid
                                        SIVAppTrans.Controls("cWhseLoc") = brefacciones.whseloc
                                        SIVAppTrans.Controls("cToWhseLoc") = brefacciones.towhseloc
                                        SIVAppTrans.Controls("cCant") = brefacciones.qty
                                        SIVAppTrans.Controls("cQty") = brefacciones.qty
                                        SIVAppTrans.Controls("cUnitDesc") = brefacciones.unitDesc
                                        'SIVApp.Controls("cSpecificCostId") = brefacciones.specificcostid
                                        SIVAppTrans.Controls("cPrecio") = brefacciones.precio
                                        'Call MsgBox(brefacciones.descuento)
                                        SIVAppTrans.Controls("cInterv") = brefacciones.codigointerv
                                    Else
                                        Call insertError(brefacciones.invtid, servicioSiteid, OrdenServicio, brefacciones.towhseloc, bcantidadLocation.qtyonhand, bcantidadNecesaria.qty)
                                    End If
                                Else
                                'si es que no tiene existencia suficiente
                                    Call insertError(brefacciones.invtid, servicioSiteid, OrdenServicio, brefacciones.towhseloc, bcantidadLocation.qtyonhand, bcantidadNecesaria.qty)
                                End If
                                'siguiente registro
                                SIVAppTrans.Next sDataEntityTrans
                                Call MUpdate(GridHandleTrans)
                            End If
                            serr12 = SFetch1(c12, brefacciones, LenB(brefacciones))
                        Loop
                        Call SetStatusBarText("Cerrando el Programa", "")
                        Sentencia = "SELECT invtid,WHSELOC,qtyonhand,qtyavail FROM tempTransError WHERE servicecallId=  " & Sparm(OrdenServicio)
                        serr1 = SqlFetch1(c1, Sentencia, bmensajeError, LenB(bmensajeError))
                        'SIVApp.Visible = True
                        If serr1 <> NOTFOUND Then
                            SIVAppTrans.Cancel
                            SIVAppTrans.Quit
                            i = 1
                            Do While serr1 = 0
                                mensajeError = mensajeError & i & ".-El articulo: " & Sparm(bmensajeError.invtid) & _
                                                ", requiere: " & bmensajeError.qtyavail & " unidades y solo hay disponibles: " & _
                                                bmensajeError.qtyonhand & " en la siguiente localizacion: " & _
                                                Sparm(bmensajeError.whseloc)
                                serr1 = SFetch1(c1, bmensajeError, LenB(bmensajeError))
                                i = i + 1
                            Loop
                            Call MsgBox(mensajeError, vbCritical)
                            
                            SentenciaError = "DELETE FROM tempTransError WHERE servicecallid=" & Sparm(OrdenServicio)
                            Call sql(c1, SentenciaError)
                        Else
                            SIVAppTrans.Last sDataEntityTrans
                            SIVAppTrans.Delete sDataEntityTrans
                            SIVAppTrans.first sDataEntityTrans
                            SIVAppTrans.Save
                            SIVAppTrans.Quit
                            Call SetStatusBarText("Cargando embarque", "")
                            Sentencia = "select max(batnbr) from trnsfrdoc where user1=" & _
                                Sparm(OrdenServicio) & " and siteid=" & Sparm(servicioSiteid)
                            serr8 = SqlFetch1(c8, Sentencia, bLoteTransf, LenB(bLoteTransf))
                            LoteTransServToRef = bLoteTransf.lote
                            'Call MsgBox(LoteTransServToRef)
                            'actualiza la orden de servicio a cancelada
                            SentenciaUpdateOrden = "UPDATE AuInterv SET status='CANCELADA' WHERE servicecallid like " & _
                            Sparm(OrdenServicio)
                            Call sql(c3, SentenciaUpdateOrden)
                            SentenciaUpdateOrden = "UPDATE AuOrdServ SET status='CANCELADA' WHERE servicecallid like " & _
                            Sparm(OrdenServicio)
                            Call sql(c3, SentenciaUpdateOrden)
                            
                            
                            SentenciaMail = "SELECT user1 FROM xvtEmpresa WHERE siteid like " & Sparm(CpnyId)
                            serr1 = SqlFetch1(c1, SentenciaMail, bcorreoRefacciones, LenB(bcorreoRefacciones))
                            If serr1 = 0 And Trim(bcorreoRefacciones.correo) <> "" Then
                                mail = bcorreoRefacciones.correo
                            Else
                                mail = "desarrollo@nissanacueducto.mx"
                            End If
                            body = "Se realizo una tranferencia con el siguiente numero de Lote:" & LoteTransServToRef & _
                            ", haciendo referencia a la Orden:" & OrdenServicio
                            profile = "DYNAMICS SL"
                            subject = "Tranferencia Orden-Refacciones"
                            attachment = ""
                            sendMail = "xsp_xFEEnviaMail " & Sparm(profile) & _
                                            Sparm(mail) & Sparm(subject) & Sparm(body) & Sparm(attachment)
                            'Call MsgBox(sendMail)
                            serr3 = SqlFetch1(c3, sendMail, bresponseMail, LenB(bresponseMail))
                            'Call MsgBox(bresponseMail.message)
                            
                            ' inicia la carga al embarque
                            Call SqlFree(c1)
                            Call SqlFree(c2)
                            
                            If serr10 = 0 Then
                                'sivMyApp.Controls("csiteid_0") = refaccionessiteId
                                sDataEntityEm = sivMyApp.Controls("cinvtid_1").Properties("Level")
                                GridHandleEm = GetGridHandle("Spread1")
                                'sivMyApp.Delete sDataEntityEm
                                'Call MUpdate(GridHandleEm)
                                sivMyApp.New sDataEntityEm
                                Do While serr10 = 0
                                    'valida que tenga qtyavail en location y si qtyonhand es mayor para poder asignar
                                    Sentencia1 = "SELECT qtyonhand,qtyAvail FROM location WHERE " & _
                                                " invtid=" & Sparm(bTransfersDescto.invtid) & "AND siteid=" & _
                                                Sparm(refaccionessiteId) & " AND Whseloc=" & Sparm(Trim(bTransfersDescto.whseloc))
                                    serr2 = SqlFetch1(c2, Sentencia1, bcantidadLocation, LenB(bcantidadLocation))
                                    If (bcantidadLocation.qtyonhand >= bTransfersDescto.qtyinvt And bcantidadLocation.qtyavail < bTransfersDescto.qtyinvt) Then
                                        SentenciaUpdate = "UPDATE Location SET qtyAvail = " & bTransfersDescto.qtyinvt & _
                                                    " WHERE invtid=" & Sparm(bTransfersDescto.invtid) & "AND siteid=" & _
                                                    Sparm(refaccionessiteId) & " AND Whseloc=" & Sparm(Trim(bTransfersDescto.whseloc))
                                        Call sql(c2, SentenciaUpdate)
                                    End If
                                    'valida que tenga qtyavail en itemsite y si qtyonhand es mayor para poder asignar
                                    Sentencia1 = "SELECT qtyonhand,qtyAvail FROM itemsite WHERE " & _
                                                " invtid=" & Sparm(bTransfersDescto.invtid) & "AND siteid=" & _
                                                Sparm(refaccionessiteId) & " AND DfltPutAwayBin=" & Sparm(Trim(bTransfersDescto.whseloc))
                                    serr2 = SqlFetch1(c2, Sentencia1, bcantidadLocation, LenB(bcantidadLocation))
                                    If (bcantidadLocation.qtyonhand >= bTransfersDescto.qtyinvt And bcantidadLocation.qtyavail < bTransfersDescto.qtyinvt) Then
                                        SentenciaUpdate = "UPDATE itemsite SET qtyAvail = " & bTransfersDescto.qtyinvt & _
                                                " WHERE invtid=" & Sparm(bTransfersDescto.invtid) & "AND siteid=" & _
                                                Sparm(refaccionessiteId) & " AND DfltPutAwayBin=" & Sparm(Trim(bTransfersDescto.whseloc))
                                        Call sql(c2, SentenciaUpdate)
                                    End If
                                    'llena el embarque
                                    sivMyApp.Controls("cinvtid_1") = bTransfersDescto.invtid
                                    sivMyApp.Controls("cPedida") = bTransfersDescto.qtyinvt
                                    sivMyApp.Controls("cWhseLoc_1") = bTransfersDescto.whseloc
                                    sivMyApp.Controls("xcPrice1") = bTransfersDescto.unitprice
                                    'Call SetBufferValue("ccurytotinvc_1", bTransfersDescto.unitprice * bTransfersDescto.qtyinvt)
                                    sivMyApp.Controls("ccuryslsprice_1") = bTransfersDescto.unitprice
                                    sivMyApp.Next sDataEntityEm
                                    Call MUpdate(GridHandleEm)
                                    sivMyApp.New sDataEntityEm
                                    serr10 = SFetch1(c10, bTransfersDescto, LenB(bTransfersDescto))
                                Loop
                                sivMyApp.Last sDataEntityEm
                                sivMyApp.Delete sDataEntityEm
                                sivMyApp.first sDataEntityEm
                            End If
                        End If
                        SentenciaDelete = "DELETE FROM xAlmPermitido WHERE cpnyid=" & Sparm(CpnyId) & _
                                    " AND userid=" & Sparm(usuarioT) & " AND siteid=" & Sparm(servicioSiteid) & _
                                    " AND tositeid=" & Sparm(refaccionessiteId)
                        Call sql(c9, SentenciaDelete)
                    Else
                        Call MsgBox("No Cuenta con Autorizacion para Facturar", vbCritical)
                    End If ' termina validacion de credito
                Else
                    Call MsgBox("No tiene costo las piezas", vbExclamation)
                End If 'termina la validacion de que se haya cargado a la orden
                'SIVApp.Quit
            Else
                Call MsgBox("No se cargaron los articulos a la Orden", vbExclamation)
            End If
    Else
        Call MsgBox("La Orden de Servicio esta asignada al embarque: " & Sparm(bshipper.shipperid), vbInformation)
    End If
Else
    Call MsgBox("Debe ingresar Orden de Servicio,Tipo de Orden y Cliente para continuar", vbInformation)
End If
EmbActual__ = 0
End Sub

Private Sub xCorrigeIsan_Click()
'**** Corrige Isan mal calculado en devolucion   ****
    Dim IsanImp As Double, SubImp As Double, Sentencia As String, Pedido As String
    Pedido = RTrim(sivMyApp.Controls("xPedido"))
    If Pedido <> "" Then
        Sentencia = "select importenac from xvtpedimporte where descr='ISAN' and pedido =" & Sparm(Pedido)
        serr1 = SqlFetch1(c12, Sentencia, bIsanImp, LenB(bIsanImp))
        Sentencia = "select importenac from xvtpedimporte where descr='PRECIO BASE UNIDAD' and pedido =" & Sparm(Pedido)
        serr2 = SqlFetch1(c12, Sentencia, bSubImp, LenB(bSubImp))
        If serr1 = 0 And serr2 = 0 And bIsanImp.Importe <> 0 And bSubImp.Importe <> 0 Then
            sivMyApp.Controls("cdisp_1") = "Return to Stock"
            sivMyApp.Controls("ccuryslsprice_1") = bSubImp.Importe
            sivMyApp.Controls("cIsan") = bIsanImp.Importe
            If RTrim(sivMyApp.Controls("cmiscchrgid_3")) = "" Then
                sivMyApp.Controls("cmiscchrgid_3") = "ISAN"
            End If
            sivMyApp.Controls("ccurymiscchrg_3") = (bIsanImp.Importe * -1)
        End If
    End If
End Sub

Private Sub xCotizacion_Click()
    Dim Prmsep$, Parmstr$, embarque$
    
    Prmsep = Chr(9)
    embarque = Trim(sivMyApp.Controls("cshipperid_0"))
    Parmstr = "ROI.EXE " + Prmsep + "40FE2/RUN" + Prmsep + "{soshipheader.shipperid} =" + Sparm(embarque) + "/WHERE" + Prmsep + "/PSCRN"
    serr1 = Launch(Parmstr, True, True, 0)
End Sub

Private Sub xcPoliza_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub xcPrice1_Chk(ChkStrg As String, retval As Integer)

End Sub

Private Sub xfrAddenda_CLOSE_Click()

Call HideForm("xfrAddenda")

End Sub

Private Sub xfrAddenda_Display()
    Call ApplSetfocus("xcPoliza")
End Sub

Private Sub xfrAddenda_Load()
    
End Sub

Private Sub xfrAddenda_OPEN_Click()

Call dispform("xfrAddenda", True)

End Sub


Private Sub xImp_Click()
   ' Facturacion Electronica
   Dim FolioFE$, TODAYSDATE As Sdate, xPeriodo$, sqlst$
   Dim SigFunc$, SigFuncClas$, tipoOrden$, xsiteid$, xSotypeId$
   Dim xFe As Boolean
   Dim Status$, usuario$
   Dim Verif As Boolean
   Dim vin As String
   vin = sivMyApp.Controls("cLotSerNbr_8")
   Dim SentenciaClass As String
   Dim invtidC As String
   Dim Pedido As String
   Dim RecFound      As Integer
   Dim MemMaintFlag  As Integer
   Dim GridHandle    As Integer
   Dim CorrectoI As Boolean
   Dim MensajeErrorClass As String
   
'   If RTrim(sivMyApp.Controls("dFPagos")) = "" And Left(sivMyApp.Controls("csotypeid_0"), 2) = "NF" Then
'      Call MessBox("Debe Capturar el metodo de pago desde el boton de Bancos", vbInformation + vbOKOnly, "Facturacion")
'      Exit Sub
'   End If
   
   GridHandle = GetGridHandle("Spread1")
   RecFound = MFirst(GridHandle, MemMaintFlag)
   If (RecFound = 0) Then
        invtidC = sivMyApp.Controls("cinvtid_1")
   Else
        invtidC = ""
   End If
   Pedido = sivMyApp.Controls("xPedido")
    
   SentenciaClass = "SELECT classid FROM Inventory WHERE invtid LIKE " & Sparm(invtidC) & _
                    " AND classid IN ('S001','S002')"
   serr12 = SqlFetch1(c12, SentenciaClass, bclassInventory, LenB(bclassInventory))
   
   SentenciaClass = "SELECT classid FROM Inventory WHERE invtid LIKE " & Sparm(invtidC) & _
                    " AND classid IN ('NCOM','NIMP','NPAS')"
   serr11 = SqlFetch1(c11, SentenciaClass, bclassInventory, LenB(bclassInventory))
   CorrectoI = False
   If serr12 = NOTFOUND And serr11 = NOTFOUND Then
        CorrectoI = True
   Else
        If (serr12 = 0) Then
            If (Trim(vin) <> "") Then
                CorrectoI = True
            Else
                MensajeErrorClass = "Unidades seminuevas necesitan Numero de Serie para Imprimir"
                CorrectoI = False
            End If
        Else
            If (serr11 = 0) Then
                If (Trim(vin) <> "" And Trim(Pedido) <> "") Then
                    CorrectoI = True
                Else
                    MensajeErrorClass = "Las unidades nuevas necesitan Numero de Serie y Numero de Pedido para Imprimir"
                    CorrectoI = False
                End If
            End If
        End If
   End If
   If (CorrectoI) Then
       Edit_Save
       
       If sivMyApp.Controls("chold_0") = True Or sivMyApp.Controls("ccredithold_0") = True Then
            Call MessBox("El embarque tienen retencion administrativa, revisar con vendedor.", vbInformation + vbOKOnly, "Retencion")
            Exit Sub
       End If
       If sivMyApp.Controls("ccurytotinvc_0") = 0 Then
            Call MessBox("No puede facturar en cero", vbInformation + vbOKOnly, "Facturacion")
            Exit Sub
       End If
    '   If RTrim(sivMyApp.Controls("xPedido")) <> "" And RTrim(sivMyApp.Controls("cLotSerNbr_8")) = "" Then
    '        Call MessBox("Debe Seleccionar la serie de la Unidad", vbInformation + vbOKOnly, "Unidades")
    '        Exit Sub
    '   End If
       
       If TestLevelChg(LEVEL0) <> NOTCHANGED Or _
          TestLevelChg(LEVEL1) <> NOTCHANGED Or _
          TestLevelChg(LEVEL2) <> NOTCHANGED Or _
          TestLevelChg(LEVEL3) <> NOTCHANGED Or _
          TestLevelChg(LEVEL4) <> NOTCHANGED Or _
          TestLevelChg(LEVEL5) <> NOTCHANGED Or _
          TestLevelChg(LEVEL6) <> NOTCHANGED Or _
          TestLevelChg(LEVEL7) <> NOTCHANGED Or _
          TestLevelChg(LEVEL8) <> NOTCHANGED Then
          Call MessBox("Guardar el embarque primero", vbInformation + vbOKOnly, "Refacciones")
          Exit Sub
       End If
          
       ' Revisa Clave de Vendedor para Imprimir
       Call GetBufferValue("bpes.Userid", usuario)
       'If Trim(usuario) = "SYSADMIN" Then Stop
      
       If Valida_Usuario("REFCANCELV") = True Then
          Status = Trim(sivMyApp.Controls("cPaso"))
          If Status <> "FACTURA" Then
             Call MessBox("Pedido no Esta en Status de Factura, No tiene Acceso a Imprimir", vbInformation + vbOKOnly, "Refacciones")
             Exit Sub
          Else
             If Status = "FACTURA" Then
                Verif = False
                Call Verif_Impresion(Verif)
                If Verif = False Then
                   Call MessBox("No tiene Acceso a Imprimir", vbInformation + vbOKOnly, "Refacciones")
                   Exit Sub
                End If
             End If
          End If
       End If
     
       Sentencia = "Select GroupID, User1, User2 From VS_UserGrp Where GroupID='FE' and UserID =" & Sparm(Trim(usuario))
       serr1 = SqlFetch1(c1, Sentencia, bDatos, LenB(bDatos))
       If serr1 = 0 Then
          xFe = True
       Else
          xFe = False
       End If
        
       If xFe = True Then
          xsiteid = VBA.Trim$(sivMyApp.Controls("cSiteid_0"))
          xSotypeId = VBA.Trim$(sivMyApp.Controls("cSoTypeId_0"))
      
          sqlst = "Select siteid, sotypeid, prefijo, tipodoc, suc, documento, subdocumento from xFEPrefijos where Siteid=" & Sparm(xsiteid) & " and Sotypeid=" & Sparm(xSotypeId)
          serr1 = SqlFetch1(c1, sqlst, bxFePref, LenB(bxFePref))
          Call SqlFree(c1)
    '      If serr6 = 0 And xFe = True Then
          If serr1 = 0 And xFe = True Then
             Call GetBufferValue("bsoshipheader.invcnbr", FolioFE)
             If VBA.Trim$(FolioFE) = "" Then
                If Trim(funTipoEvento) <> "PINV" Then
                   Call MessBox("Documento no se encuentra en el paso de impresión Factura/Nota de Cargo o Crédito", vbOKOnly, "ADVERTENCIA")
                   Exit Sub
                End If
                Call GetSysDate(TODAYSDATE)
                xPeriodo = VBA.RTrim$(VBA.LTrim$(Str(Year(DateToStrSep(TODAYSDATE))))) & VBA.LTrim$(VBA.Right$(VBA.LTrim$(VBA.RTrim$(Str(100 + Month(DateToStrSep(TODAYSDATE))))), 2))
                Call Imprime_FE_REF("1", DateToStrSep(TODAYSDATE), "", xPeriodo)
             Else
                Call MessBox("Este Folio ya fue impreso, no puede volver a generarlo.", vbOKOnly, "ADVERTENCIA")
             End If
          End If
       Else
          Call MessBox("No esta habilitado para Facturacion Electronica ", vbInformation + vbOKOnly, "Factura Electronica")
       End If
    '  Fin Facturacion Electronica
    '-----------------------------------------------------------------------
        Dim embarqueNo As String
        Dim OrdenServicio As String
        Dim CpnyId As String
        Dim SentenciaMail As String
        Dim mail As String
        Dim body, profile, subject, attachment, sendMail As String
        Call GetBufferValue("bpes.cpnyid", CpnyId)
        embarqueNo = Trim(sivMyApp.Controls("cshipperid_0"))
        OrdenServicio = Trim(sivMyApp.Controls("xtxtOrdenServicio"))
        If (embarqueNo <> "" And OrdenServicio <> "") Then
            SentenciaMail = "SELECT user1 FROM xvtEmpresa WHERE siteid like " & Sparm(CpnyId)
            serr1 = SqlFetch1(c1, SentenciaMail, bcorreoRefacciones, LenB(bcorreoRefacciones))
            If serr1 = 0 And Trim(bcorreoRefacciones.correo) <> "" Then
                mail = bcorreoRefacciones.correo
            Else
                mail = "desarrollo@nissanacueducto.mx"
            End If
            body = "Se imprimio el Embarque No:" & embarqueNo & _
            ", haciendo referencia a la Orden:" & OrdenServicio
            profile = "DYNAMICS SL"
            subject = "Embarque Orden-Refacciones"
            attachment = ""
            sendMail = "xsp_xFEEnviaMail " & Sparm(profile) & _
                            Sparm(mail) & Sparm(subject) & Sparm(body) & Sparm(attachment)
            'Call MsgBox(sendMail)
            serr3 = SqlFetch1(c3, sendMail, bresponseMail, LenB(bresponseMail))
        End If
   Else
       Call MsgBox(MensajeErrorClass, vbCritical)
   End If
End Sub

Private Sub xImpPba_Click()
 ' Facturacion Electronica
   Dim FolioFE$, TODAYSDATE As Sdate, xPeriodo$, sqlst$
   Dim SigFunc$, SigFuncClas$, tipoOrden$, xsiteid$, xSotypeId$
   Dim xFe As Boolean

 '  Dim usuario As String * 47
 '  Call GetBufferValue("bpes.Userid", usuario)
 '  If Trim(usuario) = "SYSADMIN" Then
 '     Stop
 '  End If

   If TestLevelChg(LEVEL0) <> NOTCHANGED Or _
      TestLevelChg(LEVEL1) <> NOTCHANGED Or _
      TestLevelChg(LEVEL2) <> NOTCHANGED Or _
      TestLevelChg(LEVEL3) <> NOTCHANGED Or _
      TestLevelChg(LEVEL4) <> NOTCHANGED Or _
      TestLevelChg(LEVEL5) <> NOTCHANGED Or _
      TestLevelChg(LEVEL6) <> NOTCHANGED Or _
      TestLevelChg(LEVEL7) <> NOTCHANGED Or _
      TestLevelChg(LEVEL8) <> NOTCHANGED Then
      Call MessBox("Guardar el embarque primero", vbInformation + vbOKOnly, "Refacciones")
      Exit Sub
   End If
    
   xsiteid = VBA.Trim$(sivMyApp.Controls("cSiteid_0"))
   xSotypeId = VBA.Trim$(sivMyApp.Controls("cSoTypeId_0"))
  
   sqlst = "Select siteid, sotypeid, prefijo, tipodoc, suc, documento, subdocumento from xFEPrefijos where Siteid=" & Sparm(xsiteid) & " and Sotypeid=" & Sparm(xSotypeId)
   serr1 = SqlFetch1(c1, sqlst, bxFePref, LenB(bxFePref))
   Call SqlFree(c1)
   Call GetBufferValue("bsoshipheader.invcnbr", FolioFE)
    
'   If serr6 = 0 And Trim(FolioFE) <> "" Then
   If serr1 = 0 And Trim(FolioFE) <> "" Then
      Call Imprime_FE_PBAREF("1", sivMyApp.Controls("cinvcdate"), FolioFE)
   End If
 ' Fin Facturacion Electronica
End Sub

Private Sub xPedido_Chk(ChkStrg As String, retval As Integer)
  ' Proyecto xVTPedido -------------------------------------- Inicio
  Dim SqlStr$
  Dim Result1       As Integer
  Dim Reg           As Integer
  Dim Sentencia     As String
  Dim sDataEntity   As String
  Dim GridHandle    As Integer
  Dim sDataEntity8  As String
  Dim GridHandle8   As Integer
  Dim Result        As Integer
  Dim Comporta      As String
  Dim almacen       As String
  Dim tipoOrden     As String
  Dim Resp          As Integer
  Dim xPrecioBase As Double, xIsan As Double
'  Dim vCustOrd      As String

'  Call GetBufferValue("bSoShipHeader.CustOrdNbr", vCustOrd)
  If glbSerie = True Then
     'retval = ErrNoMess
     Exit Sub
  End If
  
  Dim usuario As String
  Call GetBufferValue("bpes.userid", usuario)
  'If Trim(usuario) = "SYSADMIN" Then Stop

  Call GetBufferValue("bSoShipHeader.SiteID", almacen)
  Call GetBufferValue("bSoShipHeader.SoTypeID", tipoOrden)
  Call GetBufferValue("bSoType.Behavior", Comporta)
  
  Sentencia = "Select SiteID, SoTypeID, SoClase From xVTPedido_Ctrl Where SiteID = " & Sparm(almacen) & " And SoTypeID = " & Sparm(tipoOrden)
  Result = SqlFetch1(c9, Sentencia, bPedidoCtrl, LenB(bPedidoCtrl))
  
  If Result = 0 And bPedidoCtrl.SoClase = "FA" Then
     GridHandle = GetGridHandle("Spread1")
     Reg = mrowcnt(GridHandle)
     
     If Reg = 0 Then
        SqlStr = "Select * From xVTPedido Where Pedido = " & Sparm(Trim(ChkStrg))
        Result1 = SqlFetch1(c2, SqlStr, bxVTPedido, LenB(bxVTPedido))
  
        If Result1 = 9 Then
           Call MessBox("No existe Pedido", vbOKOnly, "ADVERTENCIA")
           retval = ErrNoMess
           Exit Sub
        Else
        
           SqlStr = "Select * From xVTEmpresa Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And EmpresaID = " & Sparm(bxVTPedido.EmpresaID)
           Result1 = SqlFetch1(c4, SqlStr, bxVTEmpresa, LenB(bxVTEmpresa))
         
           If Result1 = 9 Then
              Call MessBox("No existe la empresa / área", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
        
           If Trim(bxVTPedido.shipperid) <> "" Then
              Call MessBox("Pedido ya asignado al Embarque ", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
   
        
           If Trim(sivMyApp.Controls("cCustID_0")) <> Trim(bxVTPedido.CustId) Then
              Call MessBox("Cliente no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
   
           If Trim(bxVTPedido.LotSerNbr) = "" Then
              Call MessBox("Serie del auto aún no capturado en el pedido", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
    
           If Trim(bxVTPedido.invtid) = "" Then
              Call MessBox("No de Inventario no capturado en el pedido", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
        
           SqlStr = "Select ImporteNac From xVTPedImporte Where Pedido = " & Sparm(Trim(ChkStrg)) & " And NoImporte = " & Sparm(bxVTEmpresa.ConcTotUnidID)
           Result1 = SqlFetch1(c3, SqlStr, bxPrecio, LenB(bxPrecio))
        
           If Result1 = 9 Then
              bxPrecio.precio = 0
           End If
           
'           Call GetBufferValue("bSoShipHeader.CustOrdNbr", ChkStrg)
'           Call DispFields("Form1", "cCustOrdNbr_0")
           serr1 = SetObjectValue("cCustOrdNbr_0", Trim(ChkStrg))
           GridHandle = GetGridHandle("Spread1")

           Call Edit_New(LEVEL1)
           Resp = SetObjectValue("cinvtid_1", bxVTPedido.invtid)
           If Resp <> 0 Then
              Call MessBox("No encontró unidad, o no hay existencia", vbOKOnly, "Pedido")
              Call MSetLineStatus(GridHandle, NEWROW)
              Call MUpdate(GridHandle)
              Call Edit_Delete(LEVEL1)
              Resp = SetObjectValue("cCustOrdNbr_0", "")
              retval = ErrNoMess
              Exit Sub
           End If
           
           If bxPrecio.precio > 0 Then
              Resp = SetObjectValue("cPrecio", bxPrecio.precio)
              sivMyApp.Controls("cPrecio") = bxPrecio.precio
              If Resp <> 0 Then
                 Call MessBox("No colocó precio de la unidad", vbOKOnly, "Pedido")
                 Call MSetLineStatus(GridHandle, NEWROW)
                 Call MUpdate(GridHandle)
                 Call Edit_Delete(LEVEL1)
                 Resp = SetObjectValue("cCustOrdNbr_0", "")
                 retval = ErrNoMess
                 Exit Sub
              End If
           End If
        
           Resp = SetObjectValue("cqtyship_1", 1)
           If Resp <> 0 Then
              Call MessBox("No colocó cantidad a facturar, no hay disponible", vbOKOnly, "Pedido")
              Call MSetLineStatus(GridHandle, NEWROW)
              Call MUpdate(GridHandle)
              Call Edit_Delete(LEVEL1)
              Resp = SetObjectValue("cCustOrdNbr_0", "")
              retval = ErrNoMess
              Exit Sub
           End If
           
           Resp = SetObjectValue("cWhSeLoc_1", bxVTPedido.NoControl)
           If Resp <> 0 Then
              Call MessBox("No encontró ubicación de la unidad", vbOKOnly, "Pedido")
              Call MSetLineStatus(GridHandle, NEWROW)
              Call MUpdate(GridHandle)
              Call Edit_Delete(LEVEL1)
              Resp = SetObjectValue("cCustOrdNbr_0", "")
              retval = ErrNoMess
              Exit Sub
           End If
           
           Let xIsan = sivMyApp.Controls("cISAN")
           Let xPrecioBase = sivMyApp.Controls("cCurySlsPrice_1")
      
           Call ApplSetfocus("cWhSeLoc_1")
           Call Edit_Next(LEVEL1)
           Call Edit_Prev(LEVEL1)
           
           Let sivMyApp.Controls("cISAN") = xIsan
           Let sivMyApp.Controls("cCurySlsPrice_1") = xPrecioBase

           glbSerie = True
           
           sivMyApp.Controls("cmdLotSerial") = True
            'Stop
           glbSerie = False
           sivMyApp.Controls("cmdIsan") = True
           Call ApplSetfocus("cinvtid_1")
        End If
     Else
        Call MessBox("No se permite cambiar de pedido cuando ya existen artículos capturados", vbOKOnly, "ADVERTENCIA")
        retval = ErrNoMess
     End If
  End If 'INVC
  
  If Result = 0 And bPedidoCtrl.SoClase = "DB" Then
     GridHandle = GetGridHandle("Spread1")
     Reg = mrowcnt(GridHandle)
     
     If Reg = 0 Then
        SqlStr = "Select * From xVTPedido Where Pedido = " & Sparm(Trim(ChkStrg))
        Result1 = SqlFetch1(c2, SqlStr, bxVTPedido, LenB(bxVTPedido))
  
        If Result1 = 9 Then
           Call MessBox("No existe Pedido", vbOKOnly, "ADVERTENCIA")
           retval = ErrNoMess
           Exit Sub
        Else
        
           SqlStr = "Select * From xVTEmpresa Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And EmpresaID = " & Sparm(bxVTPedido.EmpresaID)
           Result1 = SqlFetch1(c4, SqlStr, bxVTEmpresa, LenB(bxVTEmpresa))
         
           If Result1 = 9 Then
              Call MessBox("No existe la empresa / área", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
           
           If Trim(sivMyApp.Controls("cCustID_0")) <> Trim(bxVTPedido.CustId) Then
              Call MessBox("Cliente no coincide con el del pedido", vbOKOnly, "ADVERTENCIA")
              retval = ErrNoMess
              Exit Sub
           End If
           
           SqlStr = "Select * From xVTPedAcces Where Pedido = " & Sparm(Trim(ChkStrg)) & " And Obsequio = '0' And DespFactura = '0' And BatNbr_NAJ = '' And BatNbr_RAJ = ''"
           Result1 = SqlFetch1(c4, SqlStr, bxVTPedAcces, LenB(bxVTPedAcces))
           
           GridHandle = GetGridHandle("Spread1")
           Call Edit_Last(LEVEL1)
           Call Edit_Next(LEVEL1)
           
           Do While Result1 = 0
              SqlStr = "Select QtyOnHand - QtyAlloc - QtyShipNotInv From Location Where InvtID = " & Sparm(bxVTPedAcces.Accesorio) & " And SiteID = " & Sparm(bxVTEmpresa.SiteID) & " And WhSeLoc = " & Sparm(bxVTPedido.NoControl)
              serr1 = SqlFetch1(c5, SqlStr, bExiste, LenB(bExiste))
              
              If serr1 = 0 Then
                 If bExiste.Cantidad > 0 Then
                    Call Edit_Next(LEVEL1)
                    
                    Resp = SetObjectValue("cinvtid_1", bxVTPedAcces.Accesorio)
                    If Resp <> 0 Then
                       Call MessBox("No encontró accesorio, o no hay existencia", vbOKOnly, "Pedido")
                       Edit_Cancel
                       retval = ErrNoMess
                       Exit Sub
                    End If
                    
                    If bxVTPedAcces.PrecioUnitNac > 0 Then
                       Resp = SetObjectValue("ccuryslsprice_1", bxVTPedAcces.PrecioUnitNac)
                       If Resp <> 0 Then
                          Call MessBox("No colocó precio a accesorio", vbOKOnly, "Pedido")
                          Edit_Cancel
                          retval = ErrNoMess
                          Exit Sub
                       End If
                    End If
        
                    If bExiste.Cantidad < bxVTPedAcces.Cantidad Then
                       Resp = SetObjectValue("cqtyship_1", bExiste.Cantidad)
                       If Resp <> 0 Then
                          Call MessBox("No colocó cantidad en accesorio", vbOKOnly, "Pedido")
                          Edit_Cancel
                          retval = ErrNoMess
                          Exit Sub
                       End If
                    Else
                       Resp = SetObjectValue("cqtyship_1", bxVTPedAcces.Cantidad)
                       If Resp <> 0 Then
                          Call MessBox("No colocó cantidad en accesorio", vbOKOnly, "Pedido")
                          Edit_Cancel
                          retval = ErrNoMess
                          Exit Sub
                       End If
                    End If
        
                    Resp = SetObjectValue("cWhSeLoc_1", bxVTPedido.NoControl)
                    If Resp <> 0 Then
                       Call MessBox("No colocó ubicación en accesorio", vbOKOnly, "Pedido")
                       Edit_Cancel
                       retval = ErrNoMess
                       Exit Sub
                    End If
                 End If
              End If
              Call Edit_Last(LEVEL1)
              Result1 = SFetch1(c4, bxVTPedAcces, LenB(bxVTPedAcces))
           Loop
           
           Call Edit_First(LEVEL1)
           Call ApplSetfocus("cinvtid_1")
        End If
     End If
  End If ' invc Accesorios
  
  Call SqlFree(c1)
  Call SqlFree(c2)
  Call SqlFree(c3)
  Call SqlFree(c4)
  ' Proyecto xVTPedido -------------------------------------- Final
End Sub

Private Sub xPedido_Default(OldValue As String, retval As Integer)
  ' Proyecto xVTPedido -------------------------------------- Inicio
'   If UsaPedido = True Then
'     Call SetBufferValue("bSoShipHeader.CustOrdNbr", "")
'     Call DispFields("Form1", "xPedido")
'   End If
  ' Proyecto xVTPedido -------------------------------------- Final
End Sub

Private Sub fSEVASA_CLOSE_Click()

Call HideForm("fSEVASA")

End Sub

Private Sub xvtSerie_Click()
' Proyecto xVTPedido -------------------------------------- Inicio
  Dim sDataEntity8 As String
  Dim GridHandle8 As Integer
  Dim MaintFlag As Integer
  Dim Reg As Integer
  Dim usuario As String
  Call GetBufferValue("bpes.userid", usuario)
  'If Trim(usuario) = "SYSADMIN" Then Stop

'  sDataEntity8 = SivMyApp.Controls("cLotSerNbr_8").Properties("Level")
  GridHandle8 = GetGridHandle("Spread8")
  
  Reg = mrowcnt(GridHandle8)
    
  If Reg = 0 Then
     Call Edit_New(LEVEL8)
'     SivMyApp.New sDataEntity8
  ElseIf Reg = 1 Then
     Call Edit_First(LEVEL8)
'     Let serr1 = MFirst(GridHandle8, MaintFlag)
  Else
     Call MessBox("nada mas debe existir un registro", vbOKOnly, "ADVERTENCIA")
  End If
  
  serr1 = SetObjectValue("cLotSerNbr_8", Trim(bxVTPedido.LotSerNbr))
  If serr1 <> 0 Then
     Call MessBox("No encontró serie de la unidad", vbOKOnly, "Pedido")
  End If
  
  serr1 = SetObjectValue("cSpecificCostID_8", Trim(bxVTPedido.NoControl))
  If serr1 <> 0 Then
     Call MessBox("No encontró costo específico de la unidad", vbOKOnly, "Pedido")
  End If
  ' Proyecto xVTPedido -------------------------------------- Final
End Sub


Private Sub cPedida_Chk(ChkStrg As String, retval As Integer)
   If gRefacciones Then
      Dim Sqlst2$, Sqlst1$
      Dim Almac$, InveId$
      Dim Existe As Double, Dispo As Double
      
      '----    Si la cantidad pedida es mayor a la disponible, poner ésta
      InveId = Trim(GetObjectValue("cinvtid_1"))
      Almac = Obtiene_Almacen("REFACCIONES")

      Sqlst2 = "Select itemsite.QtyOnHand,itemsite.QtyAvail from itemsite where InvtId = " & Sparm(InveId) & " and siteid = " & Sparm(Almac)
      serr2 = SqlFetch1(c1, Sqlst2, bInvent, LenB(bInvent))
      Existe = Round(bInvent.QtyExi, 0)
      Dispo = Round(bInvent.QtyDis, 0)
      Call SetStatusBarText("Disponible en Almacen :" & Almac & " :" & Str(Dispo), "ToolTipText")
      If serr2 <> NOTFOUND Then
         If val(ChkStrg) > Dispo Then
            Call SetObjectValue("cqtyship_1", Dispo)
         Else
            Call SetObjectValue("cqtyship_1", val(ChkStrg))
         End If
      Else
         Existe = 0
         Dispo = 0
         Call SetObjectValue("cqtyship_1", Dispo)
         sivMyApp.Controls("cqtyship_1") = Dispo
         Call MessBox("No hay Información de este producto", vbOKOnly, "Error")
         retval = ErrNoMess
      End If
        
      If ChkStrg < 1 Then
         Call MessBox("Debe de pedir al menos uno", vbOKOnly, "Error")
         retval = ErrNoMess
      End If

  ' Revisa precio para Cte Tipo DAOSA o ODIS
  'xCliente = Trim(sivMyApp.Controls(ccustid_0))
 
'   Dim xClaseCte$
'   Dim xCliente$
'   Dim xPrecio As Double
'
'
'   Call GetBufferValue("bsoshipheader.custid", xCliente)
'
'   Sqlst1 = "Select classid from customer where Custid = " & Sparm(xCliente)
'   serr1 = SqlFetch1(c1, Sqlst1, bxCte, LenB(bxCte))
'   If serr1 <> NOTFOUND Then
'     xClaseCte = Trim(bxCte.classid)
'   Else
'     xClaseCte = ""
'   End If
'
'   Sqlst1 = "Select dirstdcost, user3 from inventory where Invtid = " & Sparm(InveId)
'   serr1 = SqlFetch1(c1, Sqlst1, bxInPrecio, LenB(bxInPrecio))
'   If serr1 <> NOTFOUND Then
'     xPrecio = bxInPrecio.precio
'   Else
'     xPrecio = 0
'   End If
'
'   If xPrecio <> 0 Then
'     If xClaseCte = "DAOSA" Then
'       Call SetBufferValue("bsoshipline.curyslsprice", (xPrecio / 0.999))
'     ElseIf xClaseCte = "ODIS" Then
'       Call SetBufferValue("bsoshipline.curyslsprice", (xPrecio / 0.95))
'     ElseIf xClaseCte = "ODIS10" Then
'       Call SetBufferValue("bsoshipline.curyslsprice", (xPrecio / 0.9))
'     ElseIf xClaseCte = "AA" Then
'       Call SetBufferValue("bsoshipline.curyslsprice", bxInPrecio.precioAA)
'     End If
'   End If
'   Call DispFields("Form1", "")
'
'  ' Fin Revisa precio
'  End If
   End If
End Sub

Private Sub cqtyship_1_Chk(ChkStrg As String, retval As Integer)
   If gRefacciones Then
      Dim Sqlst2$
      Dim Almac$, InveId$
      Dim Existe As Double, Dispo As Double
      Dim sUserId As String
'      Stop
'    Call GetBufferValue("bpes.userid", sUserId)
'    If Trim(sUserId) = "SYSADMIN" Then
'    Stop
'    End If
      '----    Si la cantidad pedida es mayor a la disponible, poner ésta
      InveId = Trim(GetObjectValue("cinvtid_1"))
      Almac = Obtiene_Almacen("REFACCIONES")

      Sqlst2 = "Select itemsite.QtyOnHand,itemsite.QtyAvail from itemsite where InvtId = " & Sparm(InveId) & " and siteid = " & Sparm(Almac)
      serr2 = SqlFetch1(c1, Sqlst2, bInvent, LenB(bInvent))
      Existe = bInvent.QtyExi
      Dispo = bInvent.QtyDis
      Call SetStatusBarText("Disponible en Almacen :" & Almac & " :" & Str(Dispo), "ToolTipText")
      If serr2 <> NOTFOUND Then
         If val(ChkStrg) > Dispo Then
            Call MessBox("NO HAY MAS QUE <" & Str(Dispo) & "> Disponibles", vbOKOnly, "Error al Intentar vender más de lo Disponible")
             retval = ErrNoMess
         End If
      Else
         Existe = 0
         Dispo = 0
      End If
        
      Call NuevoPrecio(InveId)
      'Call DispFields("Form1", "")
   End If
End Sub


Private Sub csiteid_0_Chk(ChkStrg As String, retval As Integer)
 If gRefacciones Then
   Dim Almac$
   ' Valida almacén
        Almac = sivMyApp.Controls("csiteid_0")
        If Trim(Almac) <> Trim(Obtiene_Almacen("REFACCIONES")) Then
            sivMyApp.Controls("csiteid_0") = Obtiene_Almacen("REFACCIONES")
        End If
 End If
End Sub

Private Sub cslsperid_0_Chk(ChkStrg As String, retval As Integer)
   Dim tipovend$
   Dim varVendedor As String
   Dim usuario As String * 47

   Call GetBufferValue("bpes.userid", usuario)
   
   If gRefacciones Or Valida_Usuario("REFSUPER") = True Or Valida_Usuario("MOSTRADOR") Then
      If vCambiaVend = False Then
         If Valida_Usuario("CAMBIAVEND") = False Then
            Call GetBufferValue("bSoShipHeader.slsperid", varVendedor)
            If Trim(varVendedor) <> Trim(ChkStrg) And Trim(varVendedor) <> "" Then
               Call MessBox("NO PERMITIDO CAMBIAR DE VENDEDOR", vbOKOnly, "Advertencia")
               retval = ErrNoMess
               Exit Sub
            End If
         End If
      End If
      
      tipovend = Trim(ChkStrg)
      If Left$(tipovend, 1) <> "R" And _
         Left$(tipovend, 2) <> "CR" And _
         Left$(tipovend, 2) <> "AR" Then
         Call MessBox("SOLO VENDEDORES DE REFACCIONES", vbOKOnly, "Error")
         retval = ErrNoMess
      End If
        
      If Left(Trim(sivMyApp.Controls("cinvcnbr_0")), 1) <> "" Then
         Call MessBox("NO SE PUEDE CAMBIAR EL VENDEDOR YA ESTA FACTURADA", vbOKOnly, "Error")
         retval = ErrNoMess
      End If
   End If
End Sub

Private Sub Habilita()
    Dim varStatus As String
    Call GetBufferValue("bSoShipHeader.Status", varStatus)
    
    If Trim(varStatus) <> "C" Then
        Call MSetProp("cinvtid_1", PROP_ENABLED, True)
        Call MSetProp("cqtyship_1", PROP_ENABLED, True)
        Call MSetProp("cdiscpct_1", PROP_ENABLED, True)
        Call setprop("cPASO", PROP_ENABLED, True)
        Call MSetProp("cPedida", PROP_ENABLED, True)
        Call MSetProp("cdescr_1", PROP_ENABLED, True)
        Call MSetProp("cWhseLoc_1", PROP_ENABLED, True)
        Call setprop("fraItem", PROP_ENABLED, True)
        
        Call setprop("cslsperid_0", PROP_ENABLED, True)
        Call setprop("cinvcnbr_0", PROP_ENABLED, True)
        
    Else
        Call Deshabilita
    End If
    Call setprop("cmdSalesPeople", PROP_VISIBLE, False)
    Call setprop("lProjectID_0", PROP_VISIBLE, False)
End Sub

Private Sub Deshabilita()
   Call MSetProp("cinvtid_1", PROP_ENABLED, False)
   Call MSetProp("cqtyship_1", PROP_ENABLED, False)
   Call MSetProp("cdiscpct_1", PROP_ENABLED, False)
   Call setprop("cPASO", PROP_ENABLED, False)
   Call MSetProp("cPedida", PROP_ENABLED, False)
   Call MSetProp("cdescr_1", PROP_ENABLED, False)
   Call MSetProp("cWhseLoc_1", PROP_ENABLED, False)
   Call setprop("fraItem", PROP_ENABLED, False)
   Call setprop("cslsperid_0", PROP_ENABLED, False)
   Call setprop("cinvcnbr_0", PROP_ENABLED, False)

   
   Call setprop("cmdSalesPeople", PROP_VISIBLE, False)
   Call setprop("lProjectID_0", PROP_VISIBLE, False)
End Sub


Public Sub NuevoPrecio(xInvtID As String)
' Revisa Nvo Precio
 Dim xPriceClass$, xCliente$, Sentencia$
 Dim Result     As Integer
 Dim Result2    As Integer

 xCliente = Trim(sivMyApp.Controls("ccustid_0"))

 Call SqlFree(c1)
 Call SqlFree(c2)
 
 Sentencia = "Select * from xPreciosN where Codigo = " & Sparm(xInvtID)
 Result = SqlFetch1(c1, Sentencia, bxPreciosN, LenB(bxPreciosN))
 If Result <> NOTFOUND Then

   Sentencia = "Select Priceclassid from customer where Custid = " & Sparm(xCliente)
   Result2 = SqlFetch1(c2, Sentencia, bxCte, LenB(bxCte))
   If Result2 <> NOTFOUND Then
     xPriceClass = Trim(bxCte.ClassId)
     
     Select Case xPriceClass
       Case "CTO90"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.Cto90, 2))
       Case "CTO92"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.Cto92, 2))
       Case "MAY"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.May, 2))
       Case "MAYOR"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.May, 2))
       Case "SEG"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.Seg, 2))
       Case "PUB"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.Pub, 2))
       Case "AAA"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.AAA, 2))
       Case "AA"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.AA, 2))
       Case "FEMSA"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.FEMSA, 2))
       Case "SEGCON"
        Call SetObjectValue("ccuryslsprice_1", Round(bxPreciosN.SEGCON, 2))

     End Select
   End If
 End If
 Call SqlFree(c1)
 Call SqlFree(c2)
 ' Fin Revisa Nvo Precio
End Sub

Public Sub SSTAb1_HabDes()
   Dim usuario As String * 47

   Call GetBufferValue("bpes.userid", usuario)
   If gRefacciones Then
      Call setprop("SSTab1", "TabVisible(0)", False)
      Call setprop("SSTab1", "TabVisible(2)", False)
      'Call setprop("SSTab1", "TabVisible(2)", True)
      Call setprop("SSTab1", "TabVisible(5)", False)
      Call setprop("SSTab1", "TabVisible(6)", False)
      Call setprop("SSTab1", "TabVisible(7)", False)
  
      If Valida_Usuario("DESHAB3") = True Then
         Call setprop("SSTab1", "TabVisible(3)", True)
      Else
          Call setprop("SSTab1", "TabVisible(3)", False)
      End If
   End If
End Sub

Public Function funTipoEvento() As String
   Dim Sentencia      As String
   Dim vCpnyID        As String
   Dim vSoTypeID      As String
   Dim vFunctionID    As String
   Dim vFunctionClass As String
   
   funTipoEvento = ""
 
   Call GetBufferValue("bpes.cpnyid", vCpnyID)
   Call GetBufferValue("bSoShipHeader.SoTypeID", vSoTypeID)
   Call GetBufferValue("bSoShipHeader.NextFunctionID", vFunctionID)
   Call GetBufferValue("bSoShipHeader.NextFunctionClass", vFunctionClass)
   
   Sentencia = "Select EventType from SoStep Where CpnyID = " & Sparm(vCpnyID) & " And SoTypeID = " & Sparm(vSoTypeID) & " And FunctionID = " & Sparm(vFunctionID) & " And FunctionClass = " & Sparm(vFunctionClass)
   Call SqlFree(c1)
   serr1 = SqlFetch1(c1, Sentencia, bTipoEvento, LenB(bTipoEvento))
   
   If serr1 = 0 Then
      funTipoEvento = bTipoEvento.EventType
   End If
   Call SqlFree(c1)
End Function



































' End VBComponent **********************************************************



' VBComponent: VBTools_VBA, ComponentType: 1 **********************************************************
Attribute VB_Name = "VBTools_VBA"
'/************************************************************************
'* Solomon IV VBA Module
'* Copyright Solomon Software  1993-1999. All Rights Reserved.
'*
'* File Name     : VBTVBA.BAS
'*
'* Narrative     : Contains definitions needed for VBA customizations.
'*
'*************************************************************************
Option Explicit

'$CSTRINGS
Type SumInteger     ' Declare of field to be passed to sum(integer_field) fetch statement
    l As Long
End Type

Type Sdate
    val As Long
End Type

Type Stime
    val As Long
End Type

Type Sinteger
    val As Integer
End Type

Type Ssingle
    val As Single
End Type

Type Sdouble
    val As Double
End Type

Type Sstring
    val As String
End Type

Type Slong
    val As Long
End Type

'   Important dcls follow
Global Const MinLVARLen = 257  ' Min nbr of bytes for LVAR field
Global Const NL = vbCrLf       ' Newline (carraige return, line feed)
Global Const Prmsep = vbTab     ' Application parameter seperator.
Global Const NoAutoChk = 0     ' Suppress any auto error checking SWIM would normally perform (e.g. pvchk()) after a CHK event is finished
Global Const NoAction = 0      ' Suppress any default action SWIM would normally perform when the event code has returned
Global Const Accept = 1        ' PV Accept.
Global Const Cancel = -1       ' PV Cancel.
Global Const ErrNoMess = 32000 ' Suppress error display SWIM would normally perform (e.g. pvchk()) if CHK returns error value
Global Const Finished = 32000  ' value of "level" in Update event, after other levels process sucessfully
Global Const IntMax = 32767
Global Const IntMin = -32768
Global Const FltMax = 3.402823E+38
Global Const OVERFLOW = FltMax
Global Const EXCEPTION_ON = -1  ' used in sqlerrexception
Global Const EXCEPTION_OFF = 0  ' used in sqlerrexception
Global Const PVAccept = 1         ' PV Event, Accept PV value returned. (moves to next field if valid).
Global Const PVCancel = -1        ' PV Event, Cancel PV value returned. (stays on current field without validation).

' Launch flag parameter values:
Global Const LaunchMinimize = 2
Global Const LaunchMaximize = 3

' Application Parameter Passing Sections:
Global Const PRMSECTION_VBRDT = "[VBRDT]"
Global Const PRMSECTION_BSL = "[BSL]"

' Used in ProcAlterDefaults() call
Global Const PROC_RETURN_DB_ERRORS = 1

' property id to be passed to setprop/getprop/msetprop
Global Const PROP_VISIBLE = "visible"
Global Const PROP_DEFAULT = "default"
Global Const PROP_BLANKERR = "blankerr"
Global Const PROP_ENABLED = "enabled"
Global Const PROP_MASK = "mask"
Global Const PROP_CUSTLIST = "list"
Global Const PROP_LEVEL = "level"
Global Const PROP_TABstop = "tabstop"
Global Const PROP_MIN = "min"
Global Const PROP_MAX = "max"
Global Const PROP_HEADING = "heading"
Global Const PROP_CAPTION = "caption"

Global Const LTRUE = 1     ' XQL logical TRUE
Global Const LFALSE = 0    ' XQL logical FALSE
Global Const NOTRANSACTION = 2      ' Return value from transtatus()
Global Const SQLWILDSTRING = "%"    ' SQL wildcard for "like" restriction
Global Const SQLWILDCHAR = "_"      ' SQL wildcard for "like" restriction, 1 char

'  sqlcursor() and sqlcursorex() parameter defines
Global Const SqlList = 32           ' Buffer rows (read ahead) defined by this cursor
Global Const SqlUpdate = 0          ' For upward compatability only
Global Const SqlLock = &H1000       ' Every row fetched with this type of cursor will be immediately locked.
                                                    ' Rows fetched with this type of cursor should only be fetched
                                                    ' within a transaction (to avoid db server dependant behavior).
Global Const SqlFastReadOnly = &H100 ' No updates,inserts, or deletes will be performed on the cursor.
                                                    ' NOTE: Cursors with this flag cannot access tables which
                                            '       other cursors have updated in the same transaction.
Global Const SqlNoSelect = &H200    ' Indicates that the cursor will be used with any sql statement
                                                    ' except Select.  Update and Delete statements will be the most
                                                    ' common usage of this type of cursor.
Global Const SqlNoList = &H400      ' This flag instructs SWIM not to perform any buffering on this
                                                    ' cursor during sfetch calls.
Global Const SqlSingleRow = &H2000  ' Indicates cursor will never read more then 1 row after each select
                                                    ' statement (or stored procedure containing a select statement) has
                                                    ' been compiled. sfetch calls with this type of cursor should not be
                                                    ' separated from the associated sql call by any other db I/O.  The
                                                    ' easiest way to accomplish this is via the sqlfetch functon.  Update,
                                                    ' inserts, and deletes are allowed with this type of cursor.
Global Const SqlSystemDb = &H4000   ' Cursor is only to be used for system db tables
Global Const SqlReadOnly = &H8000   ' No updates,inserts, or deletes will be performed on the cursor.
                                                ' NOTE: This flag also implies a simple Fetch First,
                                                    ' Fetch Next call sequence.  Once NOTFOUND is returned,
                                                    ' no more Fetch calls can be sent.
Global Const NOLEVEL = 15
Global Const LEVEL0 = 0
Global Const LEVEL1 = 1
Global Const LEVEL2 = 2
Global Const LEVEL3 = 3
Global Const LEVEL4 = 4
Global Const LEVEL5 = 5
Global Const LEVEL6 = 6
Global Const LEVEL7 = 7
Global Const LEVEL8 = 8
Global Const LEVEL9 = 9

' Memory array line status
Global Const NEWROW = 0
Global Const INSERTED = 1
Global Const UPDATED = 2
Global Const DELETED = 3
Global Const NOTCHANGED = 4
Global Const ABANDONED = 5

' The following error codes are guarenteed to be sql portable
Global Const DUPLICATE = 5
Global Const NOTFOUND = 9
Global Const RecordLocked = 84
Global Const TableNameUnknown = 10215
Global Const ProcNameUnknown = 501
Global Const SqlErrInvalidPassword = 205
Global Const SqlErrDatabaseNotFound = 348
Global Const RecordAlreadyUpdated = 6900
Global Const RecordAlreadyDeleted = 6906

' Message box parameters
Global Const MB_OK = 0                 ' OK button only
Global Const MB_OKCANCEL = 1           ' OK and Cancel buttons
Global Const MB_ABORTRETRYIGNORE = 2   ' Abort, Retry, and Ignore buttons
Global Const MB_YESNOCANCEL = 3        ' Yes, No, and Cancel buttons
Global Const MB_YESNO = 4              ' Yes and No buttons
Global Const MB_RETRYCANCEL = 5        ' Retry and Cancel buttons

Global Const MB_ICONstop = 16          ' Critical message
Global Const MB_ICONQUESTION = 32      ' Warning query
Global Const MB_ICONEXCLAMATION = 48   ' Warning message
Global Const MB_ICONINFORMATION = 64   ' Information message

Global Const MB_DEFBUTTON1 = 0         ' First button is default
Global Const MB_DEFBUTTON2 = 256       ' Second button is default
Global Const MB_DEFBUTTON3 = 512       ' Third button is default

' Message box return values
Global Const IDOK = 1                  ' OK button pressed
Global Const IDCANCEL = 2              ' Cancel button pressed
Global Const IDABORT = 3               ' Abort button pressed
Global Const IDRETRY = 4               ' Retry button pressed
Global Const IDIGNORE = 5              ' Ignore button pressed
Global Const IDYES = 6                 ' Yes button pressed
Global Const IDNO = 7                  ' No button pressed

' Show (form)
Global Const MODAL = 1

' Used by application for floating point calculations;
' These values will tell the Kernel to use default rounding corresponding
' to each of these types
Global Const MONEY = &H8000
Global Const INV_UNIT_QTY = &H4000
Global Const UNITS = &H3000             ' Used for Payroll and Project Costing
Global Const INV_UNIT_PRICE = &H2000
Global Const PERCENT = &H1000

' SQL cursor integer variables
Public c1 As Integer, c2 As Integer, c3 As Integer, c4 As Integer, c5 As Integer, c6 As Integer
Public c7 As Integer, c8 As Integer, c9 As Integer, c10 As Integer, c11 As Integer, c12 As Integer

' Function return value integer variables
Public serr As Integer, serr1 As Integer, serr2  As Integer, serr3 As Integer, serr4 As Integer
Public serr5 As Integer, serr6 As Integer, serr7 As Integer, serr8 As Integer, serr9 As Integer
Public serr10 As Integer, serr11 As Integer, serr12 As Integer

Global NULLDATE As Sdate

' Transaction Import Constants
Global Const TI_Start = 99
Global Const TI_Finish = 100

' SaveTemplate StartingLevelNbr parameter values
Global Const CCPAllLevels = -1
Global Const CCPSelectedFields = -2

' GetSqlType return values
Global Const BTISqlType = 0
Global Const MSSqlType = 1

'Embarque para el boton
Public EmbActual__ As Double

' Message
Declare Sub Mess Lib "swimapi.dll" Alias "#321" (ByVal messno%)
Declare Sub Messf Lib "swimapi.dll" Alias "#427" (ByVal messno%, ByVal arg0$, ByVal arg1$, ByVal arg2$, ByVal arg3$, ByVal arg4$, ByVal arg5$)
Declare Sub MessBox Lib "swimapi.dll" Alias "#428" (ByVal msg$, ByVal msgtype%, ByVal Title$)
Declare Function MessResponse Lib "swimapi.dll" Alias "#324" () As Integer

' Parameter passing
Declare Function ApplGetParms Lib "swimapi.dll" () As String
Declare Function Launch Lib "swimapi.dll" Alias "#425" (ByVal cmdline$, ByVal Applic%, ByVal WaitFlag%, ByVal WindowFlags%) As Integer

Declare Function ApplGetReturnParms Lib "swimapi.dll" Alias "#111" () As String
Declare Function ApplGetParmValue Lib "swimapi.dll" (ByVal pSection$, ByVal pEntry$) As String
Declare Sub ApplSetParmValue Lib "swimapi.dll" Alias "#112" (ByVal pSection$, ByVal pEntry$, ByVal pValue$)

' Date/Time/Period
Declare Function DateCheck Lib "swimapi.dll" Alias "#117" (ByVal DateStr$) As Integer
Declare Function PeriodCheck Lib "swimapi.dll" Alias "#118" (ByVal Period$) As Integer
Declare Sub StrToDate Lib "swimapi.dll" Alias "#310" (ByVal DateStr$, dateval As Sdate)
Declare Function DateToStr Lib "swimapi.dll" Alias "#119" (dateval As Sdate) As String
Declare Function DateToStrSep Lib "swimapi.dll" Alias "#120" (dateval As Sdate) As String
Declare Sub StrToTime Lib "swimapi.dll" Alias "#121" (ByVal timestr$, timeval As Stime)
Declare Function TimeToStr Lib "swimapi.dll" Alias "#122" (timeval As Stime) As String
Declare Function DateMinusDate Lib "swimapi.dll" Alias "#123" (date1 As Sdate, date2 As Sdate) As Integer
Declare Sub DatePlusDays Lib "swimapi.dll" Alias "#124" (date1 As Sdate, ByVal addindays%, enddate As Sdate)
Declare Function DateCmp Lib "swimapi.dll" Alias "#125" (date1 As Sdate, date2 As Sdate) As Integer
Declare Function PeriodPlusPerNum Lib "swimapi.dll" Alias "#126" (ByVal ppyyyy$, ByVal Number%) As String
Declare Function PeriodMinusPeriod Lib "swimapi.dll" Alias "#127" (ByVal period1$, ByVal period2$) As Integer
Declare Sub DatePlusMonthSetDay Lib "swimapi.dll" Alias "#128" (date1 As Sdate, ByVal monthval%, ByVal dayval%, date2 As Sdate)
Declare Sub GetSysDate Lib "swimapi.dll" Alias "#129" (currdate As Sdate)
Declare Sub GetSysTime Lib "swimapi.dll" Alias "#130" (currtime As Stime)

' Math floating point
Declare Function FPRnd Lib "swimapi.dll" Alias "#99" (ByVal dbl As Double, ByVal precision As Integer) As Double
Declare Function FPAdd Lib "swimapi.dll" Alias "#333" (ByVal dbl1 As Double, ByVal dbl2 As Double, ByVal precision As Integer) As Double
Declare Function FPSub Lib "swimapi.dll" Alias "#334" (ByVal dbl1 As Double, ByVal dbl2 As Double, ByVal precision As Integer) As Double
Declare Function FPMult Lib "swimapi.dll" Alias "#335" (ByVal dbl1 As Double, ByVal dbl2 As Double, ByVal precision As Integer) As Double
Declare Function FPDiv Lib "swimapi.dll" Alias "#336" (ByVal dbl1 As Double, ByVal dbl2 As Double, ByVal precision As Integer) As Double

' SQL
Declare Function GetSqlType Lib "swimapi.dll" () As Integer
Declare Function Sparm Lib "swimapi.dll" Alias "SParm" (ByVal sval$) As String
Declare Function DParm Lib "swimapi.dll" Alias "#338" (dval As Sdate) As String
Declare Function FParm Lib "swimapi.dll" (ByVal fval#) As String
Declare Function IParm Lib "swimapi.dll" (ByVal ival&) As String
Declare Function SDelete Lib "swimapi.dll" Alias "#341" (ByVal cursor%, ByVal recordname$) As Integer
Declare Function SDeleteAll Lib "swimapi.dll" Alias "#342" (ByVal cursor%, ByVal recordname$) As Integer
Declare Sub sql Lib "swimapi.dll" Alias "#344" (cursor%, ByVal psql$)
Declare Sub SqlExec Lib "swimapi.dll" Alias "#345" (ByVal cursor%)
Declare Sub TranBeg Lib "swimapi.dll" Alias "#346" (ByVal abortable%)
Declare Function TranStatus Lib "swimapi.dll" Alias "#349" () As Integer
Declare Sub SqlCursor Lib "swimapi.dll" Alias "#359" (cursor%, ByVal flags%)
Declare Sub SqlCursorEx Lib "swimapi.dll" (cursor%, ByVal flags%, ByVal CursorName$, ByVal TabNames$, ByVal UpdateTabNames$)
Declare Sub SqlFree Lib "swimapi.dll" Alias "#360" (cursor%)
Declare Sub SqlSubst Lib "swimapi.dll" Alias "#361" (ByVal cursor%, ByVal parmname$, ByVal parmval$)
Declare Function SqlErr Lib "swimapi.dll" Alias "#362" () As Integer
Declare Sub SqlErrException Lib "swimapi.dll" Alias "#363" (ByVal flag%, ByVal errval%)

' Miscellaneous
Declare Sub SetLevelChg Lib "swimapi.dll" Alias "#138" (ByVal Level%, ByVal chgflg%)
Declare Function TestLevelChg Lib "swimapi.dll" Alias "#139" (ByVal Level%) As Integer
Declare Function NameAltDisplay Lib "swimapi.dll" Alias "VBA_NameAltDisplay" (ByVal db_string$) As String
Declare Sub DispFields Lib "swimapi.dll" Alias "VBA_dispfields" (ByVal formctl$, ByVal ctl$)
Declare Function CallChks Lib "swimapi.dll" Alias "VBA_callchks" (ByVal formctl$, ByVal ctl$) As Integer
Declare Function SetDefaults Lib "swimapi.dll" Alias "VBA_setdefaults" (ByVal formctl$, ByVal ctl$) As Integer
Declare Function Vgetprop Lib "swimapi.dll" Alias "VBA_getprop" (ByVal ctlname$, ByVal propname$, pvarval As Variant) As Integer
Declare Sub setprop Lib "swimapi.dll" Alias "VBA_setprop" (ByVal ctl$, ByVal property_id$, newval As Variant)
Declare Sub ApplSetfocus Lib "swimapi.dll" Alias "VBA_ApplSetFocus" (ByVal ctl$)
Declare Sub HideForm Lib "swimapi.dll" Alias "VBA_hideform" (ByVal formctl$)
Declare Sub dispform Lib "swimapi.dll" Alias "VBA_dispform" (ByVal formctl$, ByVal centered%)
Declare Function swimversion Lib "swimapi.dll" Alias "#227" () As String
Declare Sub IncrStrg Lib "swimapi.dll" Alias "#140" (ByVal Buffer$, ByVal length%, ByVal delta%)
Declare Function VGetObjectValue Lib "swimapi.dll" Alias "VBA_GetObjectValue" (ByVal ctlname$, newval As Variant) As Integer
Declare Function SetObjectValue Lib "swimapi.dll" Alias "VBA_SetObjectValue" (ByVal ctlname$, newval As Variant) As Integer
Global Const FIRSTCONTROL = 1
Global Const NEXTCONTROL = 0
Declare Function mFindControlName Lib "swimapi.dll" Alias "VBA_FindControlName" (ByVal first%) As String
' Memory Array / Grid
Declare Function GetGridHandle Lib "swimapi.dll" Alias "VBA_GetGridHandle" (ByVal SpreadControlName$) As Integer
Declare Function GetDelGridHandle Lib "swimapi.dll" Alias "VBA_GetDelGridHandle" (ByVal SpreadControlName$) As Integer
Declare Sub MClose Lib "swimapi.dll" Alias "#263" (ByVal handle%)
Declare Sub MClear Lib "swimapi.dll" Alias "#266" (ByVal handle%)
Declare Function MFirst Lib "swimapi.dll" Alias "#267" (ByVal handle%, maintflg%) As Integer
Declare Function MNext Lib "swimapi.dll" Alias "#268" (ByVal handle%, maintflg%) As Integer
Declare Function MLast Lib "swimapi.dll" Alias "#269" (ByVal handle%, maintflg%) As Integer
Declare Function MPrev Lib "swimapi.dll" Alias "#270" (ByVal handle%, maintflg%) As Integer
Declare Function MDelete Lib "swimapi.dll" Alias "#271" (ByVal handle%, maintflg%) As Integer
Declare Sub MInsert Lib "swimapi.dll" Alias "#272" (ByVal handle%)
Declare Sub MDisplay Lib "swimapi.dll" Alias "#273" (ByVal handle%)
Declare Sub MUpdate Lib "swimapi.dll" Alias "#274" (ByVal handle%)

Declare Function MSetLineStatus Lib "swimapi.dll" Alias "#276" (ByVal handle%, ByVal Status%) As Integer
Declare Function MGetLineStatus Lib "swimapi.dll" Alias "#277" (ByVal handle%) As Integer
Declare Sub MKey Lib "swimapi.dll" Alias "#279" (ByVal handle%, ByVal segnum%, ByVal fieldname$, ByVal ascending%)
Declare Sub MSort Lib "swimapi.dll" Alias "#286" (ByVal handle%)
Declare Function mrowcnt Lib "swimapi.dll" Alias "#410" (ByVal handle%) As Integer
Declare Sub MLoad Lib "swimapi.dll" Alias "#265" (ByVal handle%, ByVal cursor%)
Declare Sub MKeyHctl Lib "swimapi.dll" Alias "VBA_mkeyhctl" (ByVal handle%, ByVal segnum%, ByVal ctlname$, ByVal ascending%)
Declare Function MGetRowNum Lib "swimapi.dll" Alias "#284" (ByVal handle%) As Integer
Declare Sub msetrownum Lib "swimapi.dll" Alias "#283" (ByVal handle%, ByVal Row%)
Declare Function MCallChks Lib "swimapi.dll" Alias "VBA_mcallchks" (ByVal handle%, ByVal ctlbeg$, ByVal ctrlend$) As Integer
Declare Sub MSetProp Lib "swimapi.dll" Alias "VBA_msetprop" (ByVal ctl$, ByVal property_id$, newval As Variant)
Declare Sub MSet Lib "swimapi.dll" Alias "VBA_mset" (ByVal ctl$, ByVal valstr$)

' Application buffer manipulation
Declare Sub VGetBufferValue Lib "swimapi.dll" Alias "VBA_GetBufferValue" (ByVal ctlname$, pvarval As Variant)
Declare Sub SetBufferValue Lib "swimapi.dll" Alias "VBA_SetBufferValue" (ByVal ctlname$, pvarval As Variant)

' Transaction Import
Declare Function ImportField Lib "swimapi.dll" Alias "VBA_ImportField" (ByVal field_index%) As String
Declare Sub AliasConstant Lib "swimapi.dll" Alias "#422" (ByVal TI_COnst As String, ByVal TI_Alias As String)
Declare Function IS_TI Lib "swimapi.dll" Alias "#301" () As Integer

' Templates
Declare Sub SaveTemplate Lib "swimapi.dll" Alias "#423" (ByVal TemplateId$, ByVal templatedesc$, ByVal UserId$, ByVal LowerLevelData%, ByVal levelnbr%)
Declare Function PasteTemplate Lib "swimapi.dll" Alias "#424" (ByVal TemplateId$) As Integer

Declare Sub SetStatusBarText Lib "swimapi.dll" Alias "#597" (ByVal StatusBarText As String, ByVal ToolTip As String)

'Object Model
Declare Function StartAppAndAutomate Lib "swimapi.dll" (ByVal ExeName As String, SolomonErr As Integer, OSErr As Long) As SIVApplication




'$NOCSTRINGS

Function GetObjectValue(ByVal ctlname As String) As Variant

        Dim ResultValue As Variant
        
    If VGetObjectValue(ctlname, ResultValue) <> 0 Then
        ResultValue = ""
    End If
    
    GetObjectValue = ResultValue
    
End Function

Function getprop(ByVal ctlname$, ByVal propname$, pvarval As Variant) As Integer

        Dim ResultValue As Variant
        
    getprop = Vgetprop(ctlname, propname, ResultValue)
    pvarval = ResultValue
    
End Function

Sub GetBufferValue(ByVal ctlname$, pvarval As Variant)

        Dim ResultValue As Variant
    
    Call VGetBufferValue(ctlname, ResultValue)
    pvarval = ResultValue

End Sub
' End VBComponent **********************************************************



' VBComponent: Definiciones, ComponentType: 1 **********************************************************
Attribute VB_Name = "Definiciones"
'Variables para definir si el usuario es miembro de el grupo de usuarios de nuevos

Public Nuevos As Boolean
Public Nuevos_Ant As Boolean
Public gRefacciones As Boolean
Global glbSerie As Boolean
Global glbNivel As Integer
Global glbCustOrd As Boolean

'Datos Necesarios de AuSetup

Type AuSetup
    Usuarios As String * 47
    CategNu As String * 30
    CategCa As String * 30
    CategPF As String * 30
    PorIva As Double
    PorIsan As Double
End Type
Public bAusetup As AuSetup, nAuSetup As AuSetup

Type IsanImp
    Importe As Double
End Type
Public bIsanImp As IsanImp

Type SubImp
    Importe As Double
End Type
Public bSubImp As SubImp

'Variables para el calculo del isan

Public ISAN#, TASA#, LI#, LE#, TE#, EXC#, Isan2#
Public PonerISAN As Integer

Type FolioType
     FolioMax    As String * 10
End Type

Public bFolioMax As FolioType

Type RFC_Type
    RFC As String * 15
End Type
Public bRFC As RFC_Type

Type RevCto
    CtoProm As Double
End Type
Public bRevCto As RevCto

Type Tipoevento_Type
   EventType As String * 4
End Type

Public bTipoEvento As Tipoevento_Type, nTipoEvento As Tipoevento_Type

Type Cancelado_Type
   Cancelled As String * 1
End Type

Public bCancelado As Cancelado_Type, nCancelado As Cancelado_Type

Type WhSeLoc_Type
   whseloc As String * 10
   QtyShip As Double
End Type

Public bWhSeLoc As WhSeLoc_Type, nWhSeLoc As WhSeLoc_Type

Type Isan50
   Minimo As Double
   Maximo As Double
End Type
Public bIsan50 As Isan50, nIsan50 As Isan50
' End VBComponent **********************************************************



' VBComponent: SalesTaxDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "SalesTaxDH"
Option Explicit
 
Type SalesTax
    AccruTaxAcct                    As String * 10
    AccruTaxSubAcct                 As String * 24
    AdjByTermsDisc                  As String * 1
    ApplTermDisc                    As String * 1
    ApplTermsDiscTax                As Integer
    APTaxPtDate                     As String * 1
    ARTaxPtDate                     As String * 1
    CatExcept(0 To 5)               As String * 10
    CatFlg                          As String * 1
    Crtd_DateTime                   As Sdate
    Crtd_Prog                       As String * 8
    Crtd_User                       As String * 10
    descr                           As String * 30
    Exemption                       As String * 1
    ExemTaxId                       As String * 10
    Exp_to_Proj_Sw                  As Integer
    ExpTaxAcct                      As String * 10
    ExpTaxSub                       As String * 24
    FilingLoc                       As String * 10
    GroupDetCnt                     As Integer
    GroupID                         As String * 10
    GroupRule                       As String * 1
    InclFrt                         As String * 1
    InclInDocTot                    As String * 1
    Inclmisc                        As String * 1
    LiabTaxAcct                     As String * 10
    LiabTaxSub                      As String * 24
    LocalCode                       As String * 15
    LongId                          As String * 15
    LUpd_DateTime                   As Sdate
    LUpd_Prog                       As String * 8
    LUpd_User                       As String * 10
    Lvl2Exmpt                       As Integer
    NewRateDate                     As Sdate
    NewTaxRate                      As Double
    NoteId                          As Long
    OldTaxRate                      As Double
    OPTaxPtDate                     As String * 1
    POTaxPtDate                     As String * 1
    PrcTaxIncl                      As String * 1
    PurTaxAcct                      As String * 10
    PurTaxDiscAcct                  As String * 10
    PurTaxDiscSub                   As String * 24
    PurTaxSub                       As String * 24
    RateAboveMax                    As Double
    S4Future01                      As String * 30
    S4Future02                      As String * 30
    S4Future03                      As Double
    S4Future04                      As Double
    S4Future05                      As Double
    S4Future06                      As Double
    S4Future07                      As Sdate
    S4Future08                      As Sdate
    S4Future09                      As Long
    S4Future10                      As Long
    S4Future11                      As String * 10
    S4Future12                      As String * 10
    SlsTaxAcct                      As String * 10
    SlsTaxDiscAcct                  As String * 10
    SlsTaxDiscSub                   As String * 24
    SlsTaxSub                       As String * 24
    TaxAuthLvl                      As String * 1
    TaxBasis                        As String * 1
    TaxCalcLvl                      As String * 1
    TaxCalcMeth                     As String * 1
    TaxCalcType                     As String * 1
    TaxID                           As String * 10
    taxrate                         As Double
    TaxRvsdDate                     As Sdate
    TaxType                         As String * 1
    TxblAdjPct                      As Double
    TxblMax                         As Double
    TxblMin                         As Double
    TxblMinMaxCuryID                As String * 4
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    User5                           As String * 10
    User6                           As String * 10
    User7                           As Sdate
    User8                           As Sdate
    VendID                          As String * 15
    VoucherTax                      As Integer
End Type
 
Public bSalesTax As SalesTax, nSalesTax As SalesTax
Public bIva As SalesTax, nIva As SalesTax

' End VBComponent **********************************************************



' VBComponent: Calcula_Isan, ComponentType: 1 **********************************************************
Attribute VB_Name = "Calcula_Isan"
Option Explicit

Public usuario As String
Public Sentencia As String

Public CatImp As String
Public Lista As String
Public Excedente As Double
Public Porcentaje As Double
Public PorcCamion As Double
Public PorcIVA As Double


Type Doble
  Dato  As Double
End Type
Public bDoble As Doble, nDoble As Doble

Public Sub CargaLista()

Dim Pos As Integer
Dim Letra As String
Dim Acumulado As Double

  Let Acumulado = 0
  Let PorcCamion = 5
  Let Letra = "" ' Mid(sivMyApp.Controls("cInvtID_1"), 2, 1)
  Let Sentencia = "Select * From SalesTax Where TaxID Like '" & Letra & "%ISAN%' And TaxRate <> 0 Order By TaxRate"
  Let serr1 = SqlFetch1(c1, Sentencia, bSalesTax, LenB(bSalesTax))
  Do While serr1 = 0
    Let Pos = InStr(1, UCase(Trim(bSalesTax.TaxID)), "ISAN")
    Let Letra = Mid(UCase(Trim(bSalesTax.TaxID)), Pos + 4, 5)
    Select Case Letra
    Case "00", "EX", "EXC"
      Let Excedente = bSalesTax.TxblMin
      Let Porcentaje = bSalesTax.taxrate
    Case "CA", "CAM"
      Let PorcCamion = bSalesTax.taxrate
    Case Else
      Let Lista = Lista & bSalesTax.TxblMin & vbTab & bSalesTax.TxblMax & vbTab & Acumulado & vbTab & bSalesTax.taxrate & vbTab & vbCr
      Let Acumulado = Acumulado + ((bSalesTax.TxblMax - bSalesTax.TxblMin) * (bSalesTax.taxrate / 100))
      Let Acumulado = Int((Acumulado + 0.005) * 100) / 100
    End Select
    Let serr1 = SFetch1(c1, bSalesTax, LenB(bSalesTax))
  Loop
  Call SqlFree(c1)

End Sub

Public Function IsanAnterior(TotalFactura As Double, IVA As Double) As Double

Dim Monto As Double
Dim Isan1 As Double
Dim Isan2 As Double
Dim Calculos As Integer

  If Lista = "" Then Call CargaLista
  Let Isan1 = -1
  While Isan1 <> Isan2
    Let Monto = TotalFactura - IVA - Isan2
    Let Isan1 = Isan2
    Let Isan2 = Calcula(Monto)
    Let Calculos = Calculos + 1
    If Calculos > 30 Then Let Isan1 = Isan2
  Wend
  Let IsanAnterior = FPMult(Isan1, 1, 2)

End Function

Public Function IsanBase(Importe As Double) As Double

Dim Isan1 As Double
Dim Isan50Min As Double
Dim Isan50Max As Double
  Let Sentencia = "select txblmin,txblmax from salestax where taxid='LIMIS50'"
  Let serr1 = SqlFetch1(c1, Sentencia, bIsan50, LenB(bIsan50))
  If serr1 = 0 Then
    Isan50Min = bIsan50.Minimo
    Isan50Max = bIsan50.Maximo
  End If
  
  If Importe < Isan50Min Then
    Let IsanBase = 0
    Exit Function
  End If
  If Lista = "" Then Call CargaLista
  Let Isan1 = Calcula(Importe)
  
  If Importe >= Isan50Min And Importe <= Isan50Max Then ' ISAN 50%
    Let Isan1 = Isan1 * 0.5
  End If
  Let IsanBase = FPMult(Isan1, 1, 2)

End Function

Public Function IsanFactura(TotalFactura As Double, IVA As Double) As Double

Dim Base As Double
Dim Total As Double
Dim Isan1 As Double
Dim Limite As Double
Dim Calculos As Double
Dim Ajuste As Double
Dim Isan50Min As Double
Dim Isan50Max As Double

  Let Sentencia = "select txblmin,txblmax from salestax where taxid='LIMIS50'"
  Let serr1 = SqlFetch1(c1, Sentencia, bIsan50, LenB(bIsan50))
  If serr1 = 0 Then
    Isan50Min = bIsan50.Minimo
    Isan50Max = bIsan50.Maximo
  End If

  If Lista = "" Then Call CargaLista
  Let TotalFactura = Int((TotalFactura + 0.005) * 100) / 100
  'If TotalFactura - IVA < 156135.01 Then    isan 2007
  'If TotalFactura - IVA < 162255.49 Then    isan2008
 ' If TotalFactura - IVA < 172364.01 Then --isan 2009
 ' If TotalFactura - IVA < 179017.26 Then --isan 2010
 ' If TotalFactura - IVA < 186732.9 Then  --isan 2011
 ' If TotalFactura - IVA < 201288.95 Then  -- ISAN 2013
'  If TotalFactura - IVA < 208555.48 Then  ' ISAN 2014
  If TotalFactura - IVA < bIsan50.Minimo Then  ' ISAN 2015
    Let IsanFactura = 0
    Exit Function
  End If

  'Let Limite = IsanBase(197771)  isan 2007
  'Let Limite = (197771 + Limite) * PorcIVA  isan 2007


  'Let Limite = IsanBase(205523.62)  isan 2008
  'Let Limite = (205523.62 + Limite) * PorcIVA    isan 2008
  
  'Let Limite = IsanBase(218327.74)
  'Let Limite = (218327.74 + Limite) * PorcIVA --isan 2009
  'Let Limite = IsanBase(226755.19) --isan 2010
  'Let Limite = (226755.19 + Limite) * PorcIVA --isan 2010
  
  ' Let Limite = IsanBase(236528.34)  -----isan 2011
  ' Let Limite = (236528.34 + Limite) * PorcIVA isan 2011
  
'   Let Limite = IsanBase(254966)               ' ISAN 2013
'  Let Limite = (254966 + Limite) * PorcIVA     ' ISAN 2013
  
'   Let Limite = IsanBase(264170.27)                ' ISAN 2014
'  Let Limite = (264170.27 + Limite) * PorcIVA      ' ISAN 2014
  
  Let Limite = IsanBase(Isan50Max)                ' ISAN
  Let Limite = (Isan50Max + Limite) * PorcIVA      ' ISAN
  
  Let Limite = Int((Limite + 0.005) * 100) / 100
  If TotalFactura > Limite Then
    Let IsanFactura = IsanAnterior(TotalFactura, IVA)
    Exit Function
  End If

  Let Base = TotalFactura - IVA
  Let Calculos = 0
  While TotalFactura <> Total
    Let Isan1 = Calcula(Base) * 0.5
    Let Isan1 = Int((Isan1 + 0.005) * 100) / 100
    Let Total = Base + IVA + Isan1
    Let Ajuste = (Total - TotalFactura) / PorcIVA
    Let Base = Base - Ajuste
    Let Base = Int((Base + 0.005) * 100) / 100
    Let Calculos = Calculos + 1
    If Calculos > 30 Then
      Let Total = TotalFactura
    End If
  Wend
  Let IsanFactura = FPMult(Isan1, 1, 2)

End Function

Public Function Calcula(Importe As Double) As Double

Dim Ini As Double
Dim Pos As Double
Dim Linea As String
Dim Inf As Double
Dim Sup As Double
Dim C_F As Double
Dim Por As Double
Dim Extra As Double

  If Trim(CatImp) = Trim(bAusetup.CategCa) Then
    Let Calcula = Importe * (PorcCamion / 100)
  Else
    Let Ini = 1
    While Sup < Importe
      Let Pos = InStr(Ini, Lista, vbCr)
      Let Linea = Mid(Lista, Ini, Pos - Ini + 1)
      Let Ini = Ini + Len(Linea)
      Let Inf = Recorte(Linea)
      Let Sup = Recorte(Linea)
      Let C_F = Recorte(Linea)
      Let Por = Recorte(Linea)
    Wend
    Let Extra = (Importe - Excedente) * (-Porcentaje / 100)
    If Extra < 0 Then Extra = 0
    Let Calcula = (C_F + ((Importe - Inf) * (Por / 100))) - Extra
  End If

End Function

Public Function Recorte(Linea) As Double

Dim Pos As Integer

  Let Pos = InStr(1, Linea, vbTab)
  Let Recorte = Mid(Linea, 1, Pos - 1)
  Let Linea = Mid(Linea, Pos + 1)

End Function
' End VBComponent **********************************************************



' VBComponent: Pedido_Declaraciones, ComponentType: 1 **********************************************************
Attribute VB_Name = "Pedido_Declaraciones"
Option Explicit

' Proyecto xPedido -------------------------------------- Inicio

Public Autos As Boolean
Public AutosAnt As Boolean
Public Computadora As String
Public NoEmbarque   As String * 15

Type Existe_Type
     Cantidad As Double
End Type

Public bExiste As Existe_Type, nExiste As Existe_Type

Type Datos
  Grupo      As String * 47
  TipoVenta  As String * 30
  Vendedor   As String * 30
End Type
Public bDatos As Datos

Public Vendedor As String
Public VendedorCliente As String
Public Tipo As String


Type Pedido_Type
     Pedido     As String * 10
     LotSerNbr  As String * 25
End Type

Public bPedido As Pedido_Type

Type Serie_Type
    invtid          As String * 30
    MfgrLotSerNbr   As String * 25
End Type

Public bSerie As Serie_Type

Type PedidoCtrl_Type
    SiteID          As String * 10
    sotypeid        As String * 4
    SoClase         As String * 2
End Type

Public bPedidoCtrl As PedidoCtrl_Type

Type Status_Type
     StatusUnidad     As String * 1
End Type

Public bStatus As Status_Type, nStatus As Status_Type

Public BanderaLotSer  As Boolean
Global UsaPedido As Boolean

Type xPrecio_Type
    precio      As Double
End Type

Public bxPrecio As xPrecio_Type, nxPrecio As xPrecio_Type

Public bPedidoVal As xVTPedido

Type PedidoSite_Type
    SiteID      As String * 10
End Type

Public bPedidoSite  As PedidoSite_Type

Type Behavior_Type
    Behavior As String * 4
End Type

Public bBehavior As Behavior_Type, nBehavior As Behavior_Type

' Proyecto xPedido -------------------------------------- Final




' End VBComponent **********************************************************



' VBComponent: xVTPedAccesDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "xVTPedAccesDH"
Option Explicit

'------------------------------------------------
' Tabla Detalle de Accesorio por Pedido
'
' SyCMotors. S.A. de C.V.               Nuevos.
'
' Javier Gloria Moreno.         28/Febrero/2005.
'------------------------------------------------

 
Type xVTPedAcces
    Accesorio                       As String * 30
    BatNbr_NAJ                      As String * 10
    BatNbr_RAJ                      As String * 10
    Cantidad                        As Double
    Costo                           As Double
    Crtd_DateTime                   As Sdate
    Crtd_User                       As String * 10
    descuento                       As Double
    Futuro1                         As String * 30
    Futuro2                         As String * 30
    Futuro3                         As Double
    Futuro4                         As Double
    Futuro5                         As String * 10
    Futuro6                         As String * 10
    Futuro7                         As Sdate
    Futuro8                         As Sdate
    Linea                           As Long
    LUpd_DateTime                   As Sdate
    LUpd_User                       As String * 10
    Moneda                          As String * 10
    Obsequio                        As String * 1
    Pedido                          As String * 10
    PrecioTotExt                    As Double
    PrecioTotNac                    As Double
    PrecioUnitExt                   As Double
    PrecioUnitNac                   As Double
    ReasonCD                        As String * 6
    specificcostid                  As String * 25
    TotalExt                        As Double
    TotalNac                        As Double
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    User5                           As String * 10
    User6                           As String * 10
    User7                           As Sdate
    User8                           As Sdate
    Utilidad                        As Double
    DespFactura                     As String * 1
End Type
 
Public bxVTPedAcces As xVTPedAcces, nxVTPedAcces As xVTPedAcces
' End VBComponent **********************************************************



' VBComponent: xVTRelTVTODH, ComponentType: 1 **********************************************************
Attribute VB_Name = "xVTRelTVTODH"
Option Explicit

'------------------------------------------------
' Tabla Empresa
'
' Javier Gloria Moreno.         28/Febrero/2005.
'------------------------------------------------

Type xVTRelTVTO
    TipoVentaID                     As String * 2
    CpnyId                          As String * 10
    Crtd_DateTime                   As Sdate
    Crtd_User                       As String * 10
    EmpresaID                       As String * 10
    Futuro1                         As String * 30
    Futuro2                         As String * 30
    Futuro3                         As Double
    Futuro4                         As Double
    Futuro5                         As String * 10
    Futuro6                         As String * 10
    Futuro7                         As Sdate
    Futuro8                         As Sdate
    LUpd_DateTime                   As Sdate
    LUpd_User                       As String * 10
    sotypeid                        As String * 4
    SoClase                         As String * 2
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    User5                           As String * 10
    User6                           As String * 10
    User7                           As Sdate
    User8                           As Sdate
End Type
 
Public bxVTRelTVTO As xVTRelTVTO, nxVTRelTVTO As xVTRelTVTO



' End VBComponent **********************************************************



' VBComponent: soshipmisc_VBA, ComponentType: 1 **********************************************************
Attribute VB_Name = "soshipmisc_VBA"
Type soshipmisc

CpnyId                    As String * 10
Crtd_DateTime             As Sdate
Crtd_Prog                 As String * 8
Crtd_User                 As String * 10
curymiscchrg              As Double
descr                     As String * 30
LUpd_DateTime             As Sdate
LUpd_Prog                 As String * 8
LUpd_User                 As String * 10
miscacct                  As String * 10
miscchrg                  As Double
miscchrgid                As String * 10
miscchrgref               As String * 5
miscsub                   As String * 24
NoteId                    As Long
S4Future01                As String * 30
S4Future02                As String * 30
S4Future03                As Double
S4Future04                As Double
S4Future05                As Double
S4Future06                As Double
S4Future07                As Sdate
S4Future08                As Sdate
S4Future09                As Long
S4Future10                As Long
S4Future11                As String * 10
S4Future12                As String * 10
service                   As Integer
shipperid                 As String * 15
taxable                   As Integer
taxcat                    As String * 10
User1                     As String * 30
user10                    As Sdate
User2                     As String * 30
User3                     As String * 30
User4                     As String * 30
User5                     As Double
User6                     As Double
User7                     As String * 10
User8                     As String * 10
user9                     As Sdate

End Type

'The following error occurred during BSL -> VBA translation
'Basic Script Language Translator Warning -9500.  GLOBAL translated to PUBLIC
Public bsoshipmisc As soshipmisc, nsoshipmisc As soshipmisc
' End VBComponent **********************************************************



' VBComponent: xVTEmpresaDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "xVTEmpresaDH"
Option Explicit

'------------------------------------------------
' Tabla Empresa
'
' Javier Gloria Moreno.         28/Febrero/2005.
'------------------------------------------------

Type xVTEmpresa
    Apartado                        As Integer
    AjConcRebate                    As String * 10
    ClaseACC                        As String * 6
    ClaseTC                         As String * 10
    CodigoAlterno                   As String * 1
    ConcAccNacID                    As String * 10
    ConcAccExtID                    As String * 10
    ConcGestorID                    As String * 10
    ConcPrBaseID                    As String * 10
    ConcPrUtilID                    As String * 10
    ConcTotUnidID                   As String * 10
    ConcISANID                      As String * 10
    Consecutivo                     As String * 10
    CpnyId                          As String * 10
    Crtd_DateTime                   As Sdate
    Crtd_User                       As String * 10
    CtaCost                         As String * 10
    CustID_SerNvo                   As String * 15
    descr                           As String * 60
    DesctoMax                       As Double
    EmpresaID                       As String * 10
    Futuro1                         As String * 30
    Futuro2                         As String * 30
    Futuro3                         As Double
    Futuro4                         As Double
    Futuro5                         As String * 10
    Futuro6                         As String * 10
    Futuro7                         As Sdate
    Futuro8                         As Sdate
    Futuro9                         As String * 1
    Futuro10                        As String * 1
    GteComercID                     As String * 10
    ImpGestoria                     As Double
    ISanEX                          As String * 10
    IsanCAM                         As String * 10
    LUpd_DateTime                   As Sdate
    LUpd_User                       As String * 10
    MonedaBase                      As String * 10
    MonedaExt                       As String * 10
    Multimoneda                     As String * 1
    ModPrecioAcc                    As String * 1
    ModPBase                        As String * 1
    NoIsan                          As String * 10
    NombreRep                       As String * 30
    NoteId                          As Long
    Notas1                          As String * 10
    Notas2                          As String * 10
    Notas3                          As String * 10
    Notas4                          As String * 10
    OcultaObsequio                  As String * 1
    TaxID00                         As String * 10
    Terms                           As String * 2
    TipoImpresion                   As String * 2
    RefAcct                         As String * 10
    RefSub                          As String * 24
    RefMesesPerm                    As Integer
    RCDObsequio                     As String * 6
    RCDUnidad                       As String * 6
    RCDServicio                     As String * 6
    RCDGastos                       As String * 6
    PrefijoCons                     As String * 3
    PrefijoCtes                     As String * 10
    PrefijoIsan                     As String * 10
    SiteID                          As String * 10
    SiteID1                         As String * 10
    SiteID2                         As String * 10
    TipoCtes                        As String * 10
    TipoServ                        As String * 10
    TiempoCancPed                   As Integer
    TiempoElimPed                   As Integer
    TipoEmpresa                     As String * 10
    UbicRec                         As String * 10
    UbicSDef                        As String * 10
    UbicSPro                        As String * 10
    UbicTra                         As String * 10
    UsarGestoria                    As String * 1
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    User5                           As String * 10
    User6                           As String * 10
    User7                           As Sdate
    User8                           As Sdate
    VendID_Acc                      As String * 10
    VendID_Nvos                     As String * 10
    VendID_MRS                      As String * 10
    VendPorcCom                     As Double
End Type
 
Public bxVTEmpresa As xVTEmpresa, nxVTEmpresa As xVTEmpresa
' End VBComponent **********************************************************



' VBComponent: xVTPedidoDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "xVTPedidoDH"
Option Explicit

'------------------------------------------------
' Tabla Pedido
'
' SyCMotors. S.A. de C.V.               Nuevos.
'
' Javier Gloria Moreno.         28/Febrero/2005.
'------------------------------------------------

 
Type xVTPedido
    AvaApellidoMat                 As String * 30
    AvaApellidoPat                 As String * 30
    AvaAttn                        As String * 60
    AvaCD                          As String * 10
    AvaCiudad                      As String * 50
    AvaCol                         As String * 50
    AvaCP                          As String * 10
    AvaCurp                        As String * 30
    AvaDom                         As String * 70
    AvaEdo                         As String * 3
    AvaEMail                       As String * 100
    AvaLadCas                      As String * 10
    AvaLadOfi                      As String * 10
    AvaNombre                      As String * 30
    AvaNum                         As String * 30
    AvaPais                        As String * 3
    AvaRazonSocial                 As String * 100
    AvaRFC                         As String * 15
    AvaSiglo                       As String * 10
    AvaTelCas                      As String * 20
    AvaTelCel                      As String * 20
    AvaTelOfi                      As String * 20
    AvaTitulo                      As String * 1
    CalcPlacas                     As String * 1
    CalcGestoria                   As String * 1
    CalcPlacas2                    As String * 1
    ClaseTC                        As String * 10
    CpnyId                         As String * 10
    CteApellidoMat                 As String * 30
    CteApellidoPat                 As String * 30
    CteCD                          As String * 10
    CteCiudad                      As String * 50
    CteCol                         As String * 50
    CteCP                          As String * 10
    CteDom                         As String * 70
    CteEdo                         As String * 3
    CteEMail                       As String * 100
    CteLadCas                      As String * 10
    CteLadOfi                      As String * 10
    CteNombre                      As String * 30
    CteNum                         As String * 30
    CtePais                        As String * 3
    CteTelCas                      As String * 20
    CteTelCel                      As String * 20
    CteTelOfi                      As String * 20
    Crtd_DateTime                  As Sdate
    Crtd_User                      As String * 10
    CustId                         As String * 15
    DiaVenc                        As Integer
    EmpresaID                      As String * 10
    FacApellidoMat                 As String * 30
    FacApellidoPat                 As String * 30
    FacAttn                        As String * 60
    FacCD                          As String * 10
    FacCiudad                      As String * 50
    FacCol                         As String * 50
    FacCP                          As String * 10
    FacCurp                        As String * 30
    FacDom                         As String * 70
    FacEdo                         As String * 3
    FacEMail                       As String * 100
    FacLadCas                      As String * 10
    FacLadOfi                      As String * 10
    FacNombre                      As String * 30
    FacNum                         As String * 30
    FacPais                        As String * 3
    FacRazonSocial                 As String * 100
    FacRFC                         As String * 15
    FacSiglo                       As String * 10
    FacTelCas                      As String * 20
    FacTelCel                      As String * 20
    FacTelOfi                      As String * 20
    FacTitulo                      As String * 1
    FechaPed                       As Sdate
    FechaTC                        As Sdate
    FechaLimAP                     As Sdate
    Futuro1                        As String * 30
    Futuro2                        As String * 30
    Futuro3                        As Double
    Futuro4                        As Double
    Futuro5                        As String * 10
    Futuro6                        As String * 10
    Futuro7                        As Sdate
    Futuro8                        As Sdate
    ImMoneda                       As String * 10
    ImPrecioBase                   As Double
    ImPrecioConAcc                 As Double
    ImprimeOrden                   As String * 1
    invtid                         As String * 30
    InvtID_CA                      As String * 30
    LineCtrl                       As Integer
    LotSerNbr                      As String * 25
    LUpd_DateTime                  As Sdate
    LUpd_User                      As String * 10
    MonedaNac                      As String * 10
    MonedaExt                      As String * 10
    NoControl                      As String * 25
    NoFactura                      As String * 15
    NoteId                         As Long
    NoVencim                       As Integer
    Pedido                         As String * 10
    PermitirFacturar               As String * 1
    ProdMgrID                      As String * 10
    RevFactura                     As String * 15
    RevShipperID                   As String * 15
    shipperid                      As String * 15
    shiptoid                       As String * 10
    SlsperId                       As String * 10
    Status                         As String * 2
    StatusCredito                  As String * 1
    StatusUnidad                   As String * 1
    TipoCambio                     As Double
    TipoUnidad                     As String * 2
    TipoVenta                      As String * 2
    User1                          As String * 30
    User2                          As String * 30
    User3                          As Double
    User4                          As Double
    User5                          As String * 10
    User6                          As String * 10
    User7                          As Sdate
    User8                          As Sdate
End Type
 
Public bxVTPedido    As xVTPedido, nxVTPedido    As xVTPedido
' End VBComponent **********************************************************



' VBComponent: xLimite, ComponentType: 1 **********************************************************
Attribute VB_Name = "xLimite"
Option Explicit
Public Clave As String * 8

Type xCondic
  Condic  As String * 2
  Dias As Integer
End Type
Public bxCondic As xCondic, nxCondic As xCondic

Type xLimite
  Implimite  As Double
End Type
Public bxLimite As xLimite, nxLimite As xLimite

Type xCargos
  ImpCargo  As Double
End Type
Public bxCargos As xCargos, nxCargos As xCargos

Type xAbonos
  ImpAbono  As Double
End Type
Public bxAbonos As xAbonos, nxAbonos As xAbonos

Type xCteRule
  cliente  As String * 15
  Regla As String * 2
End Type
Public bxCteRule As xCteRule, nxCteRule As xCteRule

'Type xTipoOrden
'  Tipo  As String * 4
'  Revisa As String * 30
'End Type
'Public bxTipoOrden As xTipoOrden, nxTipoOrden As xTipoOrden

Type xembAb
  ImpEmb  As Double
End Type
Public bxembAb As xembAb, nxembAb As xembAb

Type xordAb
  ImpOrd  As Double
End Type
Public bxordAb As xordAb, nxordAb As xordAb

Type xVencido
  Venc As Double
End Type
Public bxVencido As xVencido, nxVencido As xVencido

Type xDiasGr
  Diagrac As Integer
End Type
Public bxDiasGr As xDiasGr, nxDiasGr As xDiasGr

Type xCondCte
  CondCliente  As String * 2
End Type
Public bxCondCte As xCondCte, nxCondCte As xCondCte

Type xCveAut
  Credito  As String * 8
End Type
Public bxCveAut As xCveAut, nxCveAut As xCveAut

Public Function Rev_Limite(LimiteOK As Boolean, ByVal ChkStrg As String)
  Dim RCondic As Boolean
  Dim RCliente As Boolean
  Dim RTipoOrden As Boolean
  Dim RSaldo As Boolean
  Dim RVende As Boolean
  Dim Verif As Boolean
  
  Let RCliente = False
  Let RTipoOrden = False
  Let RSaldo = False
  Let RVende = True
  Let Verif = False
      
    Call Rev_Condic(RCondic, ChkStrg)
    If RCondic Then
      Call Rev_Cliente(RCliente, RVende)
    
      If RCliente Then
'        Call Rev_TipoOrden(RTipoOrden)
'
'        If RTipoOrden Then
          Call Rev_Saldo(RSaldo)
         
          If RSaldo And RVende Then
            LimiteOK = True
          Else
            LimiteOK = False
          End If
'        End If
      Else
        If RVende Then
          LimiteOK = True
        Else
          LimiteOK = False
        End If
      End If
    End If

End Function

Public Sub Rev_Cliente(RCliente As Boolean, RVende As Boolean)
  Dim cliente As String * 6
  Dim Regla As String * 2
  Dim RVencido As Boolean
  Dim Sentencia As String
    
  Let RCliente = False
  Let RVende = True
  Let RVencido = False
  Let cliente = Trim(GetObjectValue("ccustid_0"))
  
  Let Sentencia = "Select custid, creditrule From CustomerEdi Where Custid ='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxCteRule, LenB(bxCteRule))
  If serr1 = 0 Then
    Let Regla = bxCteRule.Regla
    If Regla = "A " Or Regla = "B " Then
      Let RCliente = True
      If Regla = "B " Then
        Call Rev_Vencido(RVencido)
        If RVencido Then
          Let RVende = False
        End If
      End If
      
    Else
      If Regla = "H " Or Regla = "X " Then
        Call MessBox("CLIENTE RETENIDO ", vbInformation + vbOKOnly, "Cuentas por Cobrar")
        Let RVende = False
      End If
    End If
  End If
  Call SqlFree(c1)
      
End Sub

Public Sub Rev_Condic(RCondic As Boolean, ByVal ChkStrg As String)
  Dim Condicion As String * 2
  Dim DiasVenc As Integer
  Dim Sentencia As String
    
  Let RCondic = False
'  Let Condicion = GetObjectValue("cTermsId_0")
  
  Let Sentencia = "Select TermsId, DueIntrv From Terms Where TermsId ='" & ChkStrg & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxCondic, LenB(bxCondic))
  If serr1 = 0 Then
    Let DiasVenc = bxCondic.Dias
    If DiasVenc <> 0 Then
      Let RCondic = True
    End If
  End If
  Call SqlFree(c1)
      
End Sub

'Public Sub Rev_TipoOrden(RTipoOrden As Boolean)
'  Dim TipoOrden As String * 4
'  Dim RevTO As String * 1
'  Dim Sentencia As String
'
'  Let RTipoOrden = False
'  Let TipoOrden = RTrim(GetObjectValue("csotypeid_0"))
'
'  Let Sentencia = "Select sotypeid, user2 From Sotype Where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And Sotypeid ='" & TipoOrden & "'"
'  Let serr1 = SqlFetch1(c1, Sentencia, bxTipoOrden, LenB(bxTipoOrden))
'  If serr1 = 0 Then
'    Let RevTO = RTrim(bxTipoOrden.Revisa)
'    If RevTO = "1" Then
'      Let RTipoOrden = True
'    End If
'  End If
'  Call SqlFree(c1)
'
'End Sub

Public Sub Rev_Saldo(RSaldo As Boolean)
  Dim cliente As String * 6
  Dim Limite As Double
  Dim Cargos As Double
  Dim Abonos As Double
  Dim SaldoTot As Double
  Dim SaldoEmb As Double
  Dim SaldoOrd As Double
  Dim EmbActual As Double
  Dim NoEmbAct As String * 6
  Dim Sentencia As String
  
  Let EmbActual = 0
  Let Cargos = 0
  Let Abonos = 0
  Let SaldoTot = 0
  Let SaldoEmb = 0
  Let SaldoOrd = 0
  Let Limite = 0
    
  Let RSaldo = False
  Let cliente = Trim(GetObjectValue("ccustid_0"))
  If EmbActual__ > 0 Then
        Let EmbActual = EmbActual__
  Else
        Let EmbActual = GetObjectValue("ccurybaldue_0")
  End If
  Let NoEmbAct = GetObjectValue("cshipperid_0")
  
' Suma Cargos Liberados
  Let Sentencia = "Select isnull(sum(curydocbal),0) From Ardoc Where doctype in ('IN','DM','NS','RP','SC') and docbal > 0 and rlsed=1 and Custid ='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxCargos, LenB(bxCargos))
  If serr1 = 0 Then
    Let Cargos = bxCargos.ImpCargo
  End If
  Call SqlFree(c1)
  
' Suma Abonos Liberados
  Let Sentencia = "Select isnull(sum(curydocbal),0) From Ardoc Where doctype not in ('IN','DM','NS','RP','SC') and docbal > 0 and rlsed=1 and Custid ='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxAbonos, LenB(bxAbonos))
  If serr1 = 0 Then
    Let Abonos = bxAbonos.ImpAbono
  End If
  Call SqlFree(c1)
  
' Suma Embarques Abiertos
'  If NoEmbAct <> "<NEW> " Then
    Let Sentencia = "Select isnull(sum(curybaldue),0) From soshipheader Where status='O' and Custid ='" & cliente & "' and cancelled<>1 and sotypeid in (select sotypeid from sotype where user2='1') and shipperid <> '" & NoEmbAct & "'"
'  Else
'    Let Sentencia = "Select isnull(sum(curybaldue),0) From soshipheader Where status='O' and Custid ='" & Cliente & "' and cancelled<>1 and sotypeid in (select sotypeid from sotype where user2='1')"
'  End If
  Let serr1 = SqlFetch1(c1, Sentencia, bxembAb, LenB(bxembAb))
  If serr1 = 0 Then
    Let SaldoEmb = bxembAb.ImpEmb
  End If
  Call SqlFree(c1)
  
' Suma Ordenes Abiertas
  Let Sentencia = "Select isnull(sum(invoiceamount),0) From smservcall Where servicecallcompleted=0 and AltCustid ='" & cliente & "' and calltype in (select sotypeid from sotype where user2='1')"
  Let serr1 = SqlFetch1(c1, Sentencia, bxordAb, LenB(bxordAb))
  If serr1 = 0 Then
    Let SaldoOrd = bxordAb.ImpOrd
  End If
  Call SqlFree(c1)
  
' Revisa Limite de Credito
  Let Sentencia = "Select crlmt From Customer Where Custid ='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxLimite, LenB(bxLimite))
  If serr1 = 0 Then
    Let Limite = bxLimite.Implimite
  End If
  Call SqlFree(c1)
  
'  Let SaldoTot = ((EmbActual + Cargos + SaldoEmb + SaldoOrd) - Abonos)
  Let SaldoTot = ((Cargos + SaldoEmb + SaldoOrd + EmbActual) - Abonos)
  If SaldoTot > Limite Then
    Call MessBox("NO TIENE CREDITO DISPONIBLE " & vbCr & vbCr & "Embarque Actual: " & EmbActual & vbCr & "           Saldo CXC: " & Cargos - Abonos & vbCr & "      Emb Abiertos: " & (SaldoEmb - EmbActual) & vbCr & "       Ord Abiertas: " & SaldoOrd & vbCr & "         Saldo Total: " & SaldoTot & vbCr & "                  Limite: " & Limite, vbInformation + vbOKOnly, "Credito Disponible")
    RSaldo = False
  Else
    RSaldo = True
  End If
        
End Sub

Public Sub Rev_Vencido(RVencido As Boolean)
  Dim cliente As String * 6
  Dim Vencido As Double
  Dim Dias As Integer
  Dim Sentencia As String
     
  Let RVencido = False
  Let cliente = Trim(GetObjectValue("ccustid_0"))
  
  Let Sentencia = "select gracePer from CustomerEdi where custid='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxDiasGr, LenB(bxDiasGr))
  If serr1 = 0 Then
    Let Dias = bxDiasGr.Diagrac
  Else
    Let Dias = 0
  End If
  Call SqlFree(c1)
  
  Let Sentencia = "select isnull(sum(docbal),0) from ardoc where doctype in ('IN','DM','NS','RP','SC') and rlsed=1 and docbal >0 and duedate <= getdate() +" & Dias & " and custid='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxVencido, LenB(bxVencido))
  If serr1 = 0 Then
    Let Vencido = bxVencido.Venc
    If Vencido > 0 Then
      Call MessBox("TIENE DOCUMENTOS VENCIDOS " & vbCr & vbCr & "Importe Vencido: " & Vencido, vbInformation + vbOKOnly, "Vencimiento")
      Let RVencido = True
    End If
  End If
  Call SqlFree(c1)
      
End Sub

Public Sub Verifica_Clave(Verif As Boolean)
  Dim xClavecredito As String
  Let Verif = False
  Dim Sentencia As String
  
  Let Sentencia = "Select credito From xClaveAut"
  Let serr1 = SqlFetch1(c1, Sentencia, bxCveAut, LenB(bxCveAut))
  If serr1 = 0 Then
    Let xClavecredito = bxCveAut.Credito
  End If
  Call SqlFree(c1)

  UserForm1.Show
' If Clave <> xClavecredito Then
   If Clave <> xClavecredito Or Clave = "" Then
'    Call messbox("No Cuenta con Autorizacion para Facturar", vbExclamation + vbOKOnly, "Aviso...")
'    Let xGrabarOK = "No Cuenta con Autorizacion para Facturar"
  Else
    Let Verif = True
  End If

End Sub

Public Sub Cambia_Condic(RCambCond, ByVal ChkStrg As String)
  Dim cliente As String * 6
  Dim CondCte As String * 2
  Dim CondAct As String * 2
  Dim DiasVenc As Integer
  Dim Sentencia As String

  Let RCambCond = True
  Let cliente = GetObjectValue("cCustId_0")
  Let CondAct = GetObjectValue("cTermsId_0")
  
  Let Sentencia = "Select Terms From Customer Where CustId ='" & cliente & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxCondCte, LenB(bxCondCte))
  If serr1 = 0 Then
    Let CondCte = bxCondCte.CondCliente
  End If
  Call SqlFree(c1)
  
  Let Sentencia = "Select TermsId, DueIntrv From Terms Where TermsId ='" & ChkStrg & "'"
  Let serr1 = SqlFetch1(c1, Sentencia, bxCondic, LenB(bxCondic))
  If serr1 = 0 Then
    Let DiasVenc = bxCondic.Dias
'    If CondCte <> CondAct And DiasVenc <> 0 Then
    If CondCte <> ChkStrg And DiasVenc <> 0 Then
'      Call MessBox("La Condicion de Pago NO coincide con la del Cliente", vbExclamation + vbOKOnly, "Condiciones")
      Let RCambCond = False
    Else
    End If
  Else
    'Call MessBox("La Condicion de Pago NO coincide con la del Cliente", vbExclamation + vbOKOnly, "Condiciones")
    Let RCambCond = False
  End If
  Call SqlFree(c1)
      
End Sub
' End VBComponent **********************************************************



' VBComponent: UserForm1.FRX, ComponentType: 3 **********************************************************
EncodedDataLength = 4335
DecodedDataLength = 3096
M3$((```,`````````````,`2``#H"```T,\1X*&Q&N$`````````````````
M````/@`#`/[_"0`&```````````````!`````0``````````$````@````$`
M``#^____``````````#_________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M_______________________________________________________]____
M_O____[___\$````_O__________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M_________________U(`;P!O`'0`(`!%`&X`=`!R`'D`````````````````
M```````````````````````````````````````````6``4`__________\"
M````\&DJQMP6SA&>F`"J`%=*3P```````````````,!@9.:F]=(!`P```$`"
M````````9@``````````````````````````````````````````````````
M``````````````````````````````````0``@#_______________\`````
M````````````````````````````````````````````````ZP````````!O
M````````````````````````````````````````````````````````````
M````````````````````````!``"`0$````#````_____P``````````````
M``````````````````````````````````(```"X``````````$`0P!O`&T`
M<`!/`&(`:@``````````````````````````````````````````````````
M```````````````2``(`________________````````````````````````
M````````````````````````!P```&X``````````0````4````#````!```
M`/[___\&````_O___P@```#^____________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M__\`!"@`2`P0#`,````$0```__\```4`````?0``="```"`-````````````
M``-2XPN1C\X1G>,`J@!+N%$!````D`%$0@$`!E1A:&]M80```P```(0`````
M@P%O```D`.4!```(``"``0```#@``````!<`='AT0VQA=F6)$```(@`"&``!
M`P"``````!M(@"PJ````E`L``'L"`````A@`-0````8``("E``````(``%1A
M:&]M85H*``(H`"@````6``"`0VQA=F4@9&4@075T;W)I>F%C:6]N.B`]DPL`
M`*<!`````A@`-0````8``("E``````(``%1A:&]M85H*``(8`"@````'``"`
M06-E<'1A<@H.#@``3@,````"&`!U````!@``@*4``````@,`5&%H;VUA<@H`
M``````````0`````*`#U`0``!@``@`(````R````2`````$`%0!,86)E;#%V
M92($```B!``````H`.4!```*``"``P```#@````"`!$`8VUD06-E<'1A<@``
M[`D``$4(`````@P`&0```/-_`0#_`0``````````````````````````````
M`0#^_P,*``#_____\&DJQMP6SA&>F`"J`%=*3QD```!-:6-R;W-O9G0@1F]R
M;7,@,BXP($9O<FT`$````$5M8F5D9&5D($]B:F5C=``-````1F]R;7,N1F]R
M;2XQ`/0YLG$`````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
D````````````````````````````````````````````````
' End VBComponent **********************************************************



' VBComponent: UserForm1, ComponentType: 3 **********************************************************
VERSION 5.00
Begin {C62A69F0-16DC-11CE-9E98-00AA00574A4F} UserForm1 
   Caption         =   "UserForm1"
   ClientHeight    =   1905
   ClientLeft      =   45
   ClientTop       =   330
   ClientWidth     =   4710
   OleObjectBlob   =   "UserForm1.frx":0000
   StartUpPosition =   1  'CenterOwner
End
Attribute VB_Name = "UserForm1"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False





















Private Sub cmdAceptar_Click()
  Let Clave = RTrim(txtClave.Text)
  Unload Me
End Sub

Private Sub txtClave_Change()
  Let Clave = ""
End Sub

' End VBComponent **********************************************************



' VBComponent: Periodos, ComponentType: 1 **********************************************************
Attribute VB_Name = "Periodos"
Option Explicit

Function PermisoMoverPerCap(NumPeriodos As Integer) As String

Dim Mi_Cursor As Integer
Dim usuario As String * 47
Dim SQLString As String
Dim Encontrado As Integer
Dim PerAtras As Integer
Dim PerAdelante As Integer

  Call GetBufferValue("bpes.userid", usuario)
  Let SQLString = "Select * From VUserRec Where UserId =" & Sparm(usuario)
  Let Encontrado = SqlFetch1(Mi_Cursor, SQLString, bUserRec, LenB(bUserRec))

  If Encontrado = 0 Then
    Let PerAtras = CInt(val(bUserRec.User1)) * (-1)
    Let PerAdelante = CInt(val(bUserRec.User2))
    If NumPeriodos = 0 Then
      Let PermisoMoverPerCap = "SI"
    ElseIf NumPeriodos > 0 Then
      If NumPeriodos <= PerAdelante Then
        Let PermisoMoverPerCap = "SI"
      Else
        Let PermisoMoverPerCap = "NO"
      End If
    ElseIf NumPeriodos < 0 Then
      If NumPeriodos >= PerAtras Then
        Let PermisoMoverPerCap = "SI"
      Else
        Let PermisoMoverPerCap = "NO"
      End If
    End If
  Else
    Let PermisoMoverPerCap = "NO"
  End If
  Call SqlFree(Mi_Cursor)

End Function
' End VBComponent **********************************************************



' VBComponent: AuOrdAdicDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "AuOrdAdicDH"
Option Explicit

Type AuOrdAdic
    ServCallID As String * 10
    Color As String * 30
    Kms As Double
    Marca As String * 30
    Modelo As String * 30
    Placas As String * 30
    Serie  As String * 30
    Year  As String * 4
    Tipo As String * 10
    Torre As String * 20
    Motor As String * 30
    Transeje As String * 30
    Vendedor As String * 30
    Otu As String * 30
    CampoA10a As String * 10
    CampoA10b  As String * 10
    CampoIa As Integer
    CampoIb  As Integer
    CampoFa  As Double
    CampoFb  As Double
    CampoLa As Integer
    CampoLb As Integer
    CampoDa As Sdate
    CampoDb As Sdate
End Type

Public bAuOrdAdic As AuOrdAdic, nAuOrdAdic As AuOrdAdic
Public CSR_AuOrdAdic As Integer

Public bAuOrdAdicTemp As AuOrdAdic, nAuOrdAdicTemp As AuOrdAdic
Public CSR_AuOrdAdicTemp As Integer
' End VBComponent **********************************************************



' VBComponent: Parametros.FRX, ComponentType: 3 **********************************************************
EncodedDataLength = 8638
DecodedDataLength = 6168
M3$((```8`````````````!,:```6"```T,\1X*&Q&N$`````````````````
M````/@`#`/[_"0`&```````````````!````!```````````$```!P````$`
M``#^____``````4```#_________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M_______________________________________________________]____
M_O____[____^________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M_________________U(`;P!O`'0`(`!%`&X`=`!R`'D`````````````````
M```````````````````````````````````````````6``4`__________\"
M````\&DJQMP6SA&>F`"J`%=*3P```````````````````````````P```(``
M````````9@``````````````````````````````````````````````````
M``````````````````````````````````0``@#_______________\`````
M````````````````````````````````````````````````3P````````!O
M````````````````````````````````````````````````````````````
M````````````````````````!``"`0$````#````_____P``````````````
M`````````````````````````````````/[___\``````````&D`,``Q````
M````````````````````````````````````````````````````````````
M```````````````(``$`________________````````````````````````
M``"PJF;FIO72`;"J9N:F]=(!`````````````````0```/[_____________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M__\`!"@`2`P0#`H````$0```__\``!4`````?0``7RT``*X+````````````
M``-2XPN1C\X1G>,`J@!+N%$!````D`%$0@$`!E1A:&]M80``````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M`````````````````````````%(`;P!O`'0`(`!%`&X`=`!R`'D`````````
M```````````````````````````````````````````````````6``4`____
M______\"````\&DJQMP6SA&>F`"J`%=*3P```````````````+`;:>:F]=(!
M"````$`%````````9@``````````````````````````````````````````
M``````````````````````````````````````````0``@'_____________
M__\`````````````````````````````````````````````````````DP``
M``````!O````````````````````````````````````````````````````
M````````````````````````````````!``"`0$````#````_____P``````
M`````````````````````````````````````````/[___\``````````&D`
M,``Q````````````````````````````````````````````````````````
M```````````````````````(``$!_____P<````%````("`8;F#TSA&;S0"J
M`&".`0````"PJF;FIO72`;"J9N:F]=(!````````````````____________
M_________P8```#]_____O____[___\)````"@```/[_________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M__________]F````````````````````````````````````````````````
M````````````````````````````````````!``"`/_______________P``
M``````````````````````````````````````````````P```!X`0``````
M`&\`````````````````````````````````````````````````````````
M```````````````````````````$``(!!`````8```#_____````````````
M````````````````````````````````````!````-`!`````````0!#`&\`
M;0!P`$\`8@!J````````````````````````````````````````````````
M`````````````````!(``@#_______________\`````````````````````
M```````````````````````````"````<``````````!`$,`;P!M`'``3P!B
M`&H`````````````````````````````````````````````````````````
M````````$@`"`/_______________P``````````````````````````````
M`````````````````!,```!N``````````$````2`````P```/[___\%````
M!@````<````(````"0````H````+````_O___PT````.````#P```!`````1
M````_O____[___\4````_O______________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M________________________________________________________``0H
M`$@,$`P*````!$```/__```5`````'T``%\M``"N"P`````````````#4N,+
MD8_.$9WC`*H`2[A1`0```)`!1$(!``9486AO;6$```$````L``````%O<```
M)`#5`0``!@``@`$````C``0````.`$9R86UE,6ERU````-0!`/[_`PH``/__
M__\@(!AN8/3.$9O-`*H`8(X!&@```$UI8W)O<V]F="!&;W)M<R`R+C`@1G)A
M;64`$````$5M8F5D9&5D($]B:F5C=``.````1F]R;7,N1G)A;64N,0#T.;)Q
M```````````````````````````````````````")``H````$P``@$-O<G)E
M;R!D96P@0VQI96YT93H*DPL``*@!`````A@`-0````8``("E``````(``%1A
M:&]M80````(T`$8!P(``````#P``@!(``(`$`````0``@`L``(#U!P``+`(`
M`#$```!%;G9I87(@36%I;````A@`-0````8``("E``````(``%1A:&]M80``
M``(8``D!`(``````&TB`+#P```#8$P``+`(````"&``U````!@``@*4`````
M`@``5&%H;VUA`````C``1@'`@``````/``"`$@``@`0````!``"`"```@/4'
M```L`@``,0```$EM<')I;6ER``(8`#4````&``"`I0`````"``!486AO;6$`
M```"&``H````!P``@$-O<&EA<SH`1`@``*@!`````A@`-0````8``("E````
M``(``%1A:&]M83H```(@``D!0(``````&TB`+`(````!``"`]@0``"P"```S
M`'!R``(8`#4````&``"`I0`````"``!486AO;6$````"&``H````!P``@$%C
M97!T87(`G@8``'L"`````A@`=0````8``("E``````(#`%1A:&]M87(`````
M````````````````````````````````````````````````````````````
M``0H`$@,`@P*````!,````,````2`````'T``-(K``#L"0`````````````'
M````-`$```"'`6D``"@`]0$```<``(`"````,@```$0``````!4`;$-O<G)E
M;P#`"@``*P(`````)`#E`0``"```@`,```!4`````0`:`&-K16YV:6%RIP$`
M`*<!`````"@`Y0$```D``(`$````.`````(`%P!4>'1#;W)R96\```!_%0``
MIP$`````*`#E`0``"0``@`4```!0`````P`:`&-K26UP<FEM90```*<!``#V
M!``````H`/4!```'``"`!@```#(````X````!``5`&Q#;W!I87-RP`H``'H%
M`````"@`Y0$```D``(`)````0`````4`%P!T>'1#;W!I87,```!_%0``]@0`
M````*`#E`0``"@``@`H````X````!@`1`'1B;D%C97!T87(``+HB``#V!```
M``(,`!D```#S?P$`_P$```````````````````(,`!D```#S?P$`_P$`````
M``````````````````````````````````````````````````````````$`
M_O\#"@``______!I*L;<%LX1GI@`J@!72D\9````36EC<F]S;V9T($9O<FUS
M(#(N,"!&;W)M`!````!%;6)E9&1E9"!/8FIE8W0`#0```$9O<FUS+D9O<FTN
M,0#T.;)Q````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
#````
' End VBComponent **********************************************************



' VBComponent: Parametros, ComponentType: 3 **********************************************************
VERSION 5.00
Begin {C62A69F0-16DC-11CE-9E98-00AA00574A4F} Parametros 
   Caption         =   "Parametros"
   ClientHeight    =   1695
   ClientLeft      =   45
   ClientTop       =   330
   ClientWidth     =   6585
   OleObjectBlob   =   "Parametros.frx":0000
   StartUpPosition =   1  'CenterOwner
End
Attribute VB_Name = "Parametros"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False



















Option Explicit

Private Sub ckEnviar_Click()
    If ckEnviar.value Then
        TxtCorreo.Enabled = True
    Else
        TxtCorreo.Enabled = False
    End If
End Sub

Private Sub ckImprime_Click()
    If ckImprime.value Then
        txtCopias.Enabled = True
    Else
        txtCopias.Enabled = False
    End If
End Sub

Private Sub tbnAceptar_Click()
    If ckImprime.value Then
        Copias = IIf((VBA.Trim$(txtCopias.Text) = ""), 0, txtCopias.Text)
    Else
        Copias = 0
    End If
    If ckEnviar.value Then
        EmailCte = TxtCorreo.Text
    Else
       EmailCte = ""
    End If
    Unload Me
End Sub

Private Sub txtCopias_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
   If KeyAscii = 8 Then Exit Sub
   If KeyAscii < 48 Or KeyAscii > 57 Then
       KeyAscii = 0
   End If
End Sub
' End VBComponent **********************************************************



' VBComponent: xFE_Definiciones, ComponentType: 1 **********************************************************
Attribute VB_Name = "xFE_Definiciones"
Option Explicit

Public Declare Function GetProfileString Lib "kernel32" Alias "GetProfileStringA" ( _
        ByVal lpAppName As String, _
        ByVal lpKeyName As String, _
        ByVal lpDefault As String, _
        ByVal lpReturnedString As String, _
        ByVal nSize As Long) As Long

Public Nuevo As Boolean
Public Copias As String
Public EmailCte As String
Public xShipperId As String
Public csr_xFEAddendaTemp As Integer
Public bxFEAddendaTemp As xFEAddenda, xFEAddendaTemp As xFEAddenda

Type xFEFuncionSig
    NextFunctionId As String * 8
    NextFunctionClass As String * 4
End Type
Public bxFEFuncionSig As xFEFuncionSig

Type xFol
  FolioAct As String * 10
End Type
Public bxFol As xFol

Type xfCondic
  descr As String * 30
End Type
Public bxfCondic As xfCondic

Type xCompany
  Addr1 As String * 30
  Addr2 As String * 30
  City As String * 30
  Country As String * 3
  CpnyId As String * 10
  CpnyName As String * 30
  Fax As String * 30
  Master_Fed_ID As String * 12
  Phone As String * 30
  State As String * 3
  Zip As String * 10
End Type
Public bxCompany As xCompany

Type xDatoCte
  CustId As String * 15
  shiptoid As String * 10
  TaxLocId As String * 15
  Razonsocial As String * 100
  Domicilio As String * 70
  Numero As String * 30
  Colonia As String * 60
  City As String * 30
  State As String * 30
  Country As String * 30
  Zip As String * 10
  LadaCasa As String * 10
  TelefonoCasa As String * 20
  Email As String * 100
End Type
Public bxDatoCte As xDatoCte, nxDatoCte As xDatoCte

Type xItems
  Total As Double
End Type
Public bxItems As xItems, nxItems As xItems

Type xAseg
  Deducible As Double
  Poliza As String * 20
  Riesgo As String * 10
  ServiceCallId As String * 10
  Siniestro As String * 20
  Tramite As String * 15
  User1 As String * 30
  User2 As String * 30
  User3 As Double
  User4 As Double
  User5 As String * 10
  User6 As String * 10
  User7 As Sdate
  User8 As Sdate
End Type
Public bxAseg As xAseg, nxAseg As xAseg

Type xEmb
  CustId As String * 15
  shiptoid As String * 10
'  invcdate As Sdate
  curytottax As Double
  curytotinvc As Double
  curywholeorddisc As Double
  shipperid As String * 15
  SlsperId As String * 10
  Name As String * 60
  slsemailaddr As String * 80
  note As String * 250
  note2 As String * 250
  CuryId As String * 4
  termsid As String * 2
  dueintrv As Integer
  descr As String * 30
  Marca As String * 30
  Modelo As String * 30
  Year As String * 4
  Color As String * 30
  Serie As String * 30
  Placas As String * 30
  Kms As Double
  User1 As String * 30
  OrdNbr As String * 15
  Chasis As String * 30
'  Impresora As String * 200
End Type
Public bxEmb As xEmb, nxEmb As xEmb

Type xImprimir
  Impresora As String * 200
End Type
Public bxImprimir As xImprimir

Type xCodImp
  TaxID As String * 10
  taxrate As Double
End Type
Public bxCodImp As xCodImp

Type xSnote
  snotetext As String
End Type
Public bxSnote As xSnote, nxSnote As xSnote

Type xTotItems
  Cant As Double
End Type
Public bxTotItems As xTotItems

Type xFePref
  SiteID As String * 10
  sotypeid As String * 10
  Prefijo As String * 6
  TipoDoc As String * 12
  Sucursal As String * 10
  Documento As String * 20
  SubDocumento As String * 20
End Type
Public bxFePref As xFePref

Type xFeFolio
  Status As Long
  Serie As String * 6
  NoAprobacion As String * 20
  AnioAprob As String * 6
  Certificado As String * 30
  Ruta As String * 60
  FolioAct As String * 10
  Email As String * 200
  Copias As Double
End Type
Public bxFeFolio As xFeFolio

Type xFERefFolio
  FolioAct As String * 10
End Type
Public bxFERefFolio As xFERefFolio

Type xImpAddenda
  Imprime As Double
End Type
Public bxImpAddenda As xImpAddenda

Type xFEDatAddenda
        ServiceCallId       As String * 10
        MontoDeducible      As Double
        Motor               As String * 30
        NombreAsegurado     As String * 60
        NumeroPoliza        As String * 20
        NumeroReporte       As String * 20
        NumeroSiniestro     As String * 20
        NumeroTramitador    As String * 20
        PorcDeducible       As Double
        TDocRef             As String * 2
        TipoCliente         As String * 10
        Traccion            As String * 10
        Transmision         As String * 10
        CustId              As String * 15
        CdgIntEmisor        As String * 10
        EmailContactoEm     As String * 65
        EmailContactoRe     As String * 65
        Inc                 As String * 5
        NombreContactoEm    As String * 60
        NombreContactoRe    As String * 60
        TelContactoEm       As String * 20
        TelContactoRe       As String * 20
        TipoContactoEm      As String * 15
        TipoContactoRe      As String * 15
        TipoVehiculo        As String * 10
        TpoCdgIntEmisor     As String * 10
        CustGNP             As String * 15
        OficinaEntregaFactura  As String * 3
        FolioElectronicoR As String * 12
        FolioElectronicoV As String * 12
        BancoDepositoDeducible As String * 10
        FechaDepositoDeducible As String * 10
        FolioFichaReferenciaDeducible As String * 30
        MontoDemeritoRecupero As Double
        BancoDepositoDemeritoRecupero As String * 10
        FechaDepositoDemeritoRecupero As String * 10
        FolioFichaReferenciaDemerito As String * 30
        ExtTelContactoEm    As String * 10
        AreaContactoEm      As String * 30
End Type
Public bxFEDatAddenda As xFEDatAddenda, nxFEDatAddenda As xFEDatAddenda

Type xMatriz
  Suc As String * 10
  Nombre As String * 60
  Domicilio As String * 60
  Noext As String * 15
  Noint As String * 15
  Colonia As String * 50
  Ciudad As String * 50
  Estado As String * 40
  Cp As String * 6
  Pais As String * 20
  TelOfi As String * 20
  TelFax As String * 20
  RFC As String * 13
  Sitio2 As String * 10
  Sitio3 As String * 10
  Titulo As String * 20
  Internet As String * 60
  Distribuidor As String * 10
  LineaGratuita As String * 20
End Type
Public bxMatriz As xMatriz, nxMatriz As xMatriz

Type xSucursal
  Suc As String * 10
  Nombre As String * 60
  Domicilio As String * 60
  Noext As String * 15
  Noint As String * 15
  Colonia As String * 50
  Ciudad As String * 50
  Estado As String * 40
  Cp As String * 6
  Pais As String * 20
  TelOfi As String * 20
  TelFax As String * 20
  RFC As String * 13
  Sitio2 As String * 10
  Sitio3 As String * 10
  Titulo As String * 20
  Internet As String * 60
  Distribuidor As String * 10
  LineaGratuita As String * 20
End Type
Public bxSucursal As xSucursal, nxSucursal As xSucursal

Type xSitio2
  Suc As String * 10
  Nombre As String * 60
  Domicilio As String * 60
  Noext As String * 15
  Noint As String * 15
  Colonia As String * 50
  Ciudad As String * 50
  Estado As String * 40
  Cp As String * 6
  Pais As String * 20
  TelOfi As String * 20
  TelFax As String * 20
  RFC As String * 13
  Sitio2 As String * 10
  Sitio3 As String * 10
  Titulo As String * 20
  Internet As String * 60
  Distribuidor As String * 10
  LineaGratuita As String * 20
End Type
Public bxSitio2 As xSitio2, nxSitio2 As xSitio2

Type xSitio3
  Suc As String * 10
  Nombre As String * 60
  Domicilio As String * 60
  Noext As String * 15
  Noint As String * 15
  Colonia As String * 50
  Ciudad As String * 50
  Estado As String * 40
  Cp As String * 6
  Pais As String * 20
  TelOfi As String * 20
  TelFax As String * 20
  RFC As String * 13
  Sitio2 As String * 10
  Sitio3 As String * 10
  Titulo As String * 20
  Internet As String * 60
  Distribuidor As String * 10
  LineaGratuita As String * 20
End Type
Public bxSitio3 As xSitio3, nxSitio3 As xSitio3

Type xAtribNvos
    ClaveVehicular      As String * 30
'    Version             As String * 255
    Color               As String * 30
    NoMotor             As String * 30
    Transmision         As String * 30
    Capacidad           As String * 30
    Anio                As String * 30
    Combustible         As String * 30
    Puertas             As String * 30
    Cilindros           As String * 30
    ImportadoDe         As String * 30
    NumeroPedimento     As String * 30
    FechaPedimento      As String * 30
    Aduana              As String * 30
    Marca               As String * 10
    Modelo              As String * 60
'    DesMotor1           As String * 30
'    DesMotor2           As String * 30
'    Velocidades         As String * 30
    Comentario          As String * 500
End Type
Public bxAtribNvos As xAtribNvos, nxAtribNvos As xAtribNvos

Type Dist
    User8 As String * 10
End Type
Public bDist As Dist

Type MetodoCte
    banco           As String * 10
    metodoPago      As String * 10
    DigitosCuenta   As String * 4
End Type
Public bMetodoCte As MetodoCte

Public Function ImpresoraDflt() As String
    Dim Buffer As String
    Dim Ret As Long
    Buffer = Space(255)
    Ret = GetProfileString("Windows", ByVal "device", "", Buffer, Len(Buffer))
    If Ret <> 0 Then
        ImpresoraDflt = VBA.UCase$(VBA.Left$(Buffer, InStr(1, Buffer, ",") - 1))
    End If
End Function
' End VBComponent **********************************************************



' VBComponent: xFE_ImpConLetra, ComponentType: 1 **********************************************************
Attribute VB_Name = "xFE_ImpConLetra"
Public Function ImporteConLetra(Importe As Double, Ultimo As String, Tamaño As Integer, Linea As Integer) As String
' Copy Right
' Jaime Godina

Dim Datos As String       'Cadena con la información de los numeros
Dim Entero As String      'Cantidad sin Centavos
Dim Fracción As String    'Centavos del Importe
Dim Posición1 As Integer  'Variable para las posiciones de busqueda
Dim Posición2 As Integer  'Variable para las posiciones de busqueda
Dim Resultado As String   'Cadena para el resultado del importe
Dim Paso As Integer       'Cuenta el Paso en el que se encuentra
Dim Pasos As Integer      'Contiene el numero de pasos a ejecutar
Dim Cifras As String      'Contiene la Centena, Decena y Unidad
Dim Busca As String       'Aqui se escribe la cadena a buscar
Dim Valor As String       'Es el resultado de la busqueda
Dim Mientras As String

Let Datos = " 0 Cero 1 Un 2 Dos 3 Tres 4 Cuatro 5 Cinco 6 Seis 7 Siete 8 Ocho 9 Nueve 10 Diez 1# Dieci 11 Once 12 Doce 13 Trece 14 Catorce 15 Quince 20 Veinte 2# Veinti 3# Treinta 4# Cuarenta 5# Cincuenta 6# Sesenta 7# Setenta 8# Ochenta 9# Noventa 100 Cien 1## Ciento ### Cientos 5## Quinientos 7## Setecientos 9## Novecientos "

Let Entero = Importe
Let Posición1 = InStr(1, Entero, ".")
If Posición1 Then
   Let Fracción = Mid$(Entero, Posición1 + 1)
   Let Entero = Mid$(Entero, 1, Posición1 - 1)
End If
Let Pasos = Int((Len(Entero) + 2) / 3)
Let Entero = String((Pasos * 3) - Len(Entero), " ") & Entero

For Paso = 1 To Pasos
   Let Cifras = Mid$(Entero, (Paso * 3) - 2, 3)

Centena:
   If Mid$(Cifras, 1, 1) < "1" Then GoTo Decena
   Let Busca = " " & Mid$(Cifras, 1, 3) & " ": GoSub Buscar 'Busca 100
   If Valor <> "" Then
       Let Resultado = Resultado & Valor & " "
       GoTo Adicional
   End If
   Let Busca = " " & Mid$(Cifras, 1, 1) & "## ": GoSub Buscar 'Busca 500, 700, 900
   If Valor <> "" Then
       Let Resultado = Resultado & Valor & " "
       GoTo Decena
   End If
   Let Busca = " " & Mid$(Cifras, 1, 1) & " ": GoSub Buscar 'Busca 200, 300, 400, 600, 800
   Let Resultado = Resultado & Valor
   Let Busca = " ### ": GoSub Buscar
   Let Resultado = Resultado & LCase(Valor) & " "

Decena:
   If Mid$(Cifras, 2, 1) < "1" Then GoTo Unidad
   Let Busca = " " & Mid$(Cifras, 2, 2) & " ": GoSub Buscar 'Busca 10, 11, 12, 13, 14, 15, 20
   If Valor <> "" Then
       Let Resultado = Resultado & Valor & " "
       GoTo Adicional
   End If
   Let Busca = " " & Mid$(Cifras, 2, 1) & "# ": GoSub Buscar ' Busca 30, 40, 50, 60, 70, 80, 90
   Let Resultado = Resultado & Valor
   If Mid$(Cifras, 3, 1) = "0" Then
       Let Resultado = Resultado & " "
       GoTo Adicional
   End If
   If Mid$(Cifras, 2, 1) > "2" Then Resultado = Resultado & " y "

Unidad:
   If Mid$(Cifras, 3, 1) = "0" And Int(Importe) > 0 Then GoTo Adicional
   Let Busca = " " & Mid$(Cifras, 3, 1) & " ": GoSub Buscar 'Busca 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
   If Len(Resultado) Then
       If Mid$(Resultado, Len(Resultado)) <> " " Then
           Let Valor = LCase(Valor)
       End If
   End If
   Let Resultado = Resultado & Valor & " "

Adicional:
   If Paso = 1 And Pasos = 2 And val(Cifras) Then Let Resultado = Resultado & "Mil "
   If Paso = 2 And Pasos = 3 And val(Cifras) Then Let Resultado = Resultado & "Mil "
   If Paso = 1 And Pasos = 3 Then
       If val(Cifras) > 1 Then
           Let Resultado = Resultado & "Millones "
       Else
           Let Resultado = Resultado & "Millon "
       End If
       If val(Mid$(Entero, (Paso * 3) + 1)) = 0 Then Let Resultado = Resultado & "de "
   End If

Next Paso

If Int(Importe) = 1 Then
   Let Resultado = Resultado & "Peso "
Else
   Let Resultado = Resultado & "Pesos "
End If

If Len(Fracción) < 2 Then Fracción = Fracción & String(2 - Len(Fracción), "0")
If Len(Fracción) > 2 Then Fracción = Int(val(Mid$(Fracción, 1, 2) & "." & Mid$(Fracción, 3)) + 0.5)
'Resultado = Resultado & Fracción & "/1" & String(Len(Fracción), "0") & " M.N."
Resultado = Resultado & Fracción & "/1" & String(Len(Fracción), "0") & " MN"
If Ultimo <> "" Then Resultado = Resultado & " " & Ultimo

If Tamaño Then

   Mientras = Resultado

    Do
       Valor = ""
       Linea = Linea - 1
Otro:
       Posición1 = InStr(1, Mientras, " ")
       If Posición1 And (Posición1 - 1) + Len(Trim(Valor)) < Tamaño Then
           Valor = Valor & Mid$(Mientras, 1, Posición1)
           Mientras = Mid$(Mientras, Posición1 + 1)
           GoTo Otro
       End If
   Loop While Linea > 0
   Resultado = Trim(Valor)

End If

GoTo Salir

Buscar:
   Let Valor = ""
   Let Posición1 = InStr(1, Datos, Busca)
   If Posición1 Then
       Let Posición1 = Posición1 + Len(Busca)
       Let Posición2 = InStr(Posición1, Datos, " ")
       Let Valor = Mid$(Datos, Posición1, Posición2 - Posición1)
   End If
   Return

Salir:

ImporteConLetra = Resultado

End Function

' End VBComponent **********************************************************



' VBComponent: xFE_Impresion, ComponentType: 1 **********************************************************
Attribute VB_Name = "xFE_Impresion"
Option Explicit
Dim xtsubtot As Double
Dim xtiva As Double

Public Sub Imprime_FE_REF(xStatusFac As String, xFechaFac As Date, xFolioCanc As String, xPeriodo As String)
   Dim FileSystem As Object
   Dim Destino As Object
   Dim GridHandle As Integer
   Dim Linea As String
   Dim Renglon As Double
   Dim wkRuta As String
   Dim wkRuta2 As String
   Dim ImpLin As Double
   Dim xHora As Stime
   Dim xFechaFactxt$, xHoratxt$, xFechaVenctxt$
   Dim sqlst$, Condic$, dCondic$, xCustid$, xShiptoid$, xembarque$, xNota$, xrcn$
   Dim xIva As Double, xTotalFac As Double, xSubtot As Double
   Dim xImpDesc As Double, xPorDesc As Double
   Dim sDataEntity As String
   Dim Rows As Integer
   Dim i As Integer, NoDec As Integer
   Dim xInvtID$, xDescr$, xUDesc$, xtCant$, xtImp$, xtPU$, Fraccion$, xtPUDesc$, xtUDiscPct$
   Dim xCant As Double, xPU As Double, xImp As Double, xPUDesc As Double
   Dim xsiteid$, xSotypeId$, xprefijo$, xFolio As Double, xFoliotxt$
   Dim xCodImp As Double, xPorImp As Double, xUDiscPct As Double
   Dim xTipoComp$, xCodImpto$, xtCodImpto, xPorcImpto As Double, xtPorcImpto$, xComentario$, xImpAddenda$
   Dim xTipoDoc$, xSucursal$, xTotItem As Double, xTipoRef$, xTipoCobro$
   Dim xRfc$, xUser1$, xImpDto As Double
   Dim xtFechaVta$, xFechaVta2 As Sdate, xFechaVenc As Sdate, xtFechaVenc$
   Dim xUbicacion$, usuario As String * 47, xtClaseTec$, xtFechaletra$, xMeses$, xTipoEmbarque, xConc$
   Dim xIvaD As Double, xtIvaD$, xtTotD$
   Dim xBanco$, xFPagos$, xCuenta$
   Dim mIva As Double, mNeto As Double, mBruto As Double, mTotal As Double, xUIva As Double, xPUBruto As Double, xPUNeto As Double
   Dim SigFunc$, SigFuncClas$, tipoOrden$
   Dim RecFound         As Integer
   Dim MemMaintFlag     As Integer
   Dim RegFetch         As Integer
   Dim Prmsep$, Parmstr$, embarque$
   Dim xNumSerie As String, xNumInventario As String, xNumPedido As String
   Dim detDiscPct As String
   Dim LineRef    As String
   Dim xDescr2    As String
        
   Call GetBufferValue("bsoshipheader.user2", xrcn)
   Call GetBufferValue("bsoshipheader.shipperid", xembarque)
   Call GetBufferValue("bpes.UserId", usuario)
   usuario = Mid(RTrim(usuario), 1, 10)
   If RTrim(usuario) = "SYSADMIN" Then Stop
   xMeses = "  EneFebMarAbrMayJunJulAgoSepOctNovDic"
   
    
' Toma Metodo de Pago de la pestaña Pagos
   xBanco = IIf(Trim(sivMyApp.Controls("dBanco")) = "", "NO IDENTIFICADO", Trim(sivMyApp.Controls("dBanco")))
   xFPagos = IIf(Trim(sivMyApp.Controls("dFPagos")) = "", "99", Left(Trim(sivMyApp.Controls("dFPagos")), 2))
   xFPagos = IIf(xFPagos = "98", "NA", xFPagos)
   xCuenta = IIf(Trim(sivMyApp.Controls("dCuenta")) = "", "", Trim(sivMyApp.Controls("dCuenta")))
   
' Si es No Identificado busca directo en el cliente
   'If xBanco = "NO IDENTIFICADO" And xFPagos = "99" And xCuenta = "" Then
   '     sqlst = "Select Banco, MetodoPago, DigitosCuenta from xSoAddress where Custid=" & Sparm(sivmyapp.controls("cCustid_0") & " and " &
   '     sqlst = " Shiptoid=" & Sparm(sivmyapp.controls("cshiptoid_0")
   '
   '     xBanco = IIf(Trim(sivMyApp.Controls("dBanco")) = "", "NO IDENTIFICADO", Trim(sivMyApp.Controls("dBanco")))
   '     xFPagos = IIf(Trim(sivMyApp.Controls("dFPagos")) = "", "99", Left(Trim(sivMyApp.Controls("dFPagos")), 2))
   '     xCuenta = IIf(Trim(sivMyApp.Controls("dCuenta")) = "", "", Trim(sivMyApp.Controls("dCuenta")))
   'End If
   
    
' Datos Embarque
  sqlst = "select a.custid, a.shiptoid, a.curytottax, a.curytotinvc, a.curywholeorddisc, a.shipperid, a.slsperid, b.name, b.emailaddr, isnull(c.snotetext,''), isnull(c.snotetext2,''), a.curyid, a.termsid, e.dueintrv, e.Descr "
  sqlst = sqlst & ",marca=isnull(d.marca,''), modelo=isnull(d.modelo,''), year=isnull(d.year,''), color=isnull(d.color,''), serie=isnull(d.serie,''), placas=isnull(d.placas,''), kms=isnull(d.kms,0), cl.User1, a.ordnbr, Chasis=isnull(d.otu,'') "
  sqlst = sqlst & "from soshipheader a left outer join salesperson b on a.slsperid = b.slsperid "
  sqlst = sqlst & "left outer join auordadic d on a.shipperid = d.servcallid "
  sqlst = sqlst & "left outer join xFENotas1000 c on a.noteid = c.nid "
  sqlst = sqlst & "left outer join terms e on a.termsid = e.termsid "
  sqlst = sqlst & "left outer join Customer cl on a.Custid = cl.Custid "
  sqlst = sqlst & "where a.shipperid=" & Sparm(xembarque)
  Call SqlFree(c4)
  serr4 = SqlFetch1(c4, sqlst, bxEmb, LenB(bxEmb))
  Call SqlFree(c4)
  If serr4 = 0 Then
     xFechaFactxt = Year(xFechaFac) & "-" & VBA.Right$((100 + Month(xFechaFac)), 2) & "-" & VBA.Right$((100 + Day(xFechaFac)), 2)
     Call GetSysTime(xHora)
     xHoratxt = "T" & VBA.Left$(TimeToStr(xHora), 2) & ":" & VBA.Mid$(TimeToStr(xHora), 3, 2) & ":" & VBA.Mid$(TimeToStr(xHora), 5, 2)
     xtFechaVta = Right((100 + Day(xFechaFac)), 2) & "-" & Right((100 + Month(xFechaFac)), 2) & "-" & Year(xFechaFac) & " " & Mid(xHoratxt, 2, 5)
     xtFechaletra = Right((100 + Day(xFechaFac)), 2) & "-" & Mid(xMeses, (Month(xFechaFac) * 3), 3) & "-" & Year(xFechaFac) & " " & Mid(xHoratxt, 2, 5)
     Call StrToDate(Right((100 + Month(xFechaFac)), 2) & Right((100 + Day(xFechaFac)), 2) & Year(xFechaFac), xFechaVta2)
     Call DatePlusDays(xFechaVta2, bxEmb.dueintrv, xFechaVenc)
     xtFechaVenc = DateToStr(xFechaVenc)
     xtFechaVenc = Mid(xtFechaVenc, 3, 2) & "-" & Mid(xtFechaVenc, 1, 2) & "-" & Mid(xtFechaVenc, 5, 4)
     xFechaVenctxt = Mid(xtFechaVenc, 7, 4) & "-" & Mid(xtFechaVenc, 4, 2) & "-" & Mid(xtFechaVenc, 1, 2)
     xCustid = VBA.Trim$(bxEmb.CustId)
     xShiptoid = VBA.Trim$(bxEmb.shiptoid)
     xIva = Abs(bxEmb.curytottax)
     xSubtot = (Abs(bxEmb.curytotinvc) - xIva)
     xTotalFac = Abs(bxEmb.curytotinvc)
     xImpDesc = Abs(bxEmb.curywholeorddisc)
     If xImpDesc > 0 Then
        xPorDesc = (xImpDesc / xTotalFac)
     Else
        xPorDesc = 0
     End If
     If bxEmb.dueintrv = 0 Then
        xTipoCobro = "CONTADO"
     Else
        xTipoCobro = "CREDITO"
     End If
     xUser1 = VBA.RTrim$(bxEmb.User1)
  End If
  If bxEmb.curytotinvc < 0 Then
    xTipoComp = "EGRESO"
  Else
    xTipoComp = "INGRESO"
  End If
  
' Metodo de Pago
   dCondic = ""
   Condic = VBA.Trim$(GetObjectValue("cpmttypeid_5"))
   If Condic <> "" Then
      sqlst = "select descr from PmtType where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And pmttypeid =" & Sparm(Condic)
      Call SqlFree(c1)
      serr1 = SqlFetch1(c1, sqlst, bxfCondic, LenB(bxfCondic))
      Call SqlFree(c1)
      If serr1 = 0 Then
         dCondic = bxfCondic.descr
      End If
   End If
  
'  Total de Items
   sqlst = "select count(invtid) from soshipline where shipperid=" & Sparm(xembarque)
   Call SqlFree(c1)
   serr1 = SqlFetch1(c1, sqlst, bxTotItems, LenB(bxTotItems))
   xTotItem = Round(bxTotItems.Cant, 0)
   Call SqlFree(c1)
  
' Datos Facturacion
  sqlst = "xFEDatoCte " & Sparm(xCustid) & "," & Sparm(xShiptoid) & ", 'FRM'"
  Call SqlFree(c1)
  serr2 = SqlFetch1(c1, sqlst, bxDatoCte, LenB(bxDatoCte))
  Call SqlFree(c1)
  If Len(VBA.RTrim$(VBA.LTrim$(bxDatoCte.TaxLocId))) < 12 Or Mid(VBA.RTrim$(VBA.LTrim$(bxDatoCte.TaxLocId)), 5, 6) = "010101" Then
     xRfc = "XAXX010101000"
     xtsubtot = Str(xTotalFac)
     xtiva = "0.00"
  Else
     xRfc = VBA.RTrim$(VBA.LTrim$(bxDatoCte.TaxLocId))
     xtsubtot = Str(xSubtot)
     xtiva = Str(xIva)
  End If

'Revisa si imprime Addenda
  sqlst = "Select count(Custid) from xFEClientes where CdgIntEmisor <> '' and Custid=" & Sparm(xCustid)
  Call SqlFree(c1)
  serr1 = SqlFetch1(c1, sqlst, bxImpAddenda, LenB(bxImpAddenda))
  Call SqlFree(c1)
  If serr1 = 0 And bxImpAddenda.Imprime > 0 Then
     xImpAddenda = "SI"
  Else
     xImpAddenda = "NO"
  End If
  
' Datos Addenda
'  sqlst = "Select a.ServiceCallid, a.MontoDeducible,a.Motor,a.NombreAsegurado,a.NumeroPoliza,a.NumeroReporte,a.NumeroSiniestro,"
'  sqlst = sqlst & "a.NumeroTramitador,a.PorcDeducible,a.TDocRef,a.TipoCliente,a.Traccion,a.Transmision,"
'  sqlst = sqlst & "b.CustId,b.CdgIntEmisor,b.EmailContactoEm,b.EmailContactoRe,b.Inc,b.NombreContactoEm,b.NombreContactoRe,b.TelContactoEm,b.TelContactoRe,b.TipoContactoEm,"
'  sqlst = sqlst & "b.TipoContactoRe,a.TipoVehiculo,b.TpoCdgIntEmisor, "
'  sqlst = sqlst & " cast(isnull(gnp.Custgnp,'') as char(15)), cast(isnull(b.User05,'') as char(3)), cast(isnull(b.Futuro05,'') as char(10)), cast(isnull(b.Futuro01,'') as char(30)) "
'  sqlst = sqlst & "from xFEAddenda a inner join Soshipheader c  on a.servicecallid=c.shipperid "
'  sqlst = sqlst & "inner join xFEClientes b on c.Custid=b.CustId and a.servicecallid=" & Sparm(xembarque)
'  sqlst = sqlst & "Left join xFEGNP gnp on c.Custid=gnp.Custgnp"
  
  Call SqlFree(c1)
  sqlst = "xFEDatosAddendaRef_sp " & Sparm(xembarque)
  serr1 = SqlFetch1(c1, sqlst, bxFEDatAddenda, LenB(bxFEDatAddenda))
  Call SqlFree(c1)
  
' Datos Impresion
  sqlst = "Select Impresora from xFEImpresora where userid= " & Sparm(usuario)
  Call SqlFree(c3)
  serr3 = SqlFetch1(c3, sqlst, bxImprimir, LenB(bxImprimir))
  Call SqlFree(c3)
  
' Datos Cod Impuesto.
  sqlst = "select  a.taxid, b.taxrate from soshiptax a inner join salestax b on a.taxid = b.taxid where "
  sqlst = sqlst & "a.shipperid=" & Sparm(xembarque)
  sqlst = sqlst & " order by b.taxrate desc"
  Call SqlFree(c9)
  serr9 = SqlFetch1(c9, sqlst, bxCodImp, LenB(bxCodImp))
  Call SqlFree(c9)
  If serr9 = 0 Then
     xCodImpto = VBA.Trim$(bxCodImp.TaxID)
     xPorcImpto = bxCodImp.taxrate
     xtPorcImpto = VBA.Format$(xPorcImpto, "#######0.00")
  Else
     xCodImpto = ""
     xPorcImpto = 0
  End If
  xtCodImpto = "IVA" & VBA.Space$(11 - Len("IVA"))
  xtPorcImpto = xtPorcImpto & VBA.Space$(11 - Len(xtPorcImpto))

' Datos Folio
  xsiteid = VBA.Trim$(sivMyApp.Controls("cSiteid_0"))
  xSotypeId = VBA.Trim$(sivMyApp.Controls("cSoTypeId_0"))
  
  sqlst = "Select siteid, sotypeid, prefijo, tipodoc, suc, documento, subdocumento from xFEPrefijos where Siteid=" & Sparm(xsiteid) & " and Sotypeid=" & Sparm(xSotypeId)
  Call SqlFree(c6)
  serr6 = SqlFetch1(c6, sqlst, bxFePref, LenB(bxFePref))
  Call SqlFree(c6)
  If serr6 = 0 Then
     xprefijo = Replace(bxFePref.Prefijo, " ", "")
    
     Select Case VBA.Trim$(bxFePref.TipoDoc)
        Case "NOTA CARGO"
           xTipoDoc = "56"
           xTipoRef = "FE"
        Case "NOTA CREDITO"
           xTipoDoc = "61"
           xTipoRef = "NC"
        Case Else
          xTipoDoc = "33"
          xTipoRef = "FE"
     End Select

     xSucursal = VBA.Trim$(bxFePref.Sucursal)
 
 '   Busca y Asigna Folio
     sqlst = "xFEGeneraFolio " & Sparm(xprefijo) & "," & Sparm(sivMyApp.Controls("cCpnyID_0")) & "," & Sparm(xFolioCanc)
     Call SqlFree(c9)
     serr9 = SqlFetch1(c9, sqlst, bxFeFolio, LenB(bxFeFolio))
     Call SqlFree(c9)

     If serr9 <> 0 Or (serr9 = 0 And VBA.Trim$(bxFeFolio.FolioAct) = "") Then
        Call MessBox("No se han generado folios para este prefijo.", vbInformation + vbOKOnly, "Factura Electronica")
        Exit Sub
     Else
        xFoliotxt = VBA.Trim$(bxFeFolio.FolioAct)
     End If
  Else
     Call MessBox("Este tipo de Embarque no genera Factura Electronica.", vbInformation + vbOKOnly, "Factura Electronica")
     Exit Sub
  End If
' Fin Datos Folio
  
' Datos Compania
  sqlst = "Select * from xFESucursal Where rtrim(titulo) = 'MATRIZ'"
  Call SqlFree(c3)
  serr3 = SqlFetch1(c3, sqlst, bxMatriz, LenB(bxMatriz))
  Call SqlFree(c3)
  
' Datos Sucursal
  sqlst = "Select * from xFESucursal where suc=" & Sparm(xSucursal)
  Call SqlFree(c5)
  serr5 = SqlFetch1(c5, sqlst, bxSucursal, LenB(bxSucursal))
  Call SqlFree(c5)
  
' Datos Sitio2
  sqlst = "Select * from xFESucursal where suc=" & Sparm(bxSucursal.Sitio2)
  Call SqlFree(c5)
  serr5 = SqlFetch1(c5, sqlst, bxSitio2, LenB(bxSitio2))
  Call SqlFree(c5)
  
' Datos Sitio3
  sqlst = "Select * from xFESucursal where suc=" & Sparm(bxSucursal.Sitio3)
  Call SqlFree(c5)
  serr5 = SqlFetch1(c5, sqlst, bxSitio3, LenB(bxSitio3))
  Call SqlFree(c5)
  
   xTipoEmbarque = Trim(bxFePref.SubDocumento)
  
   xNumPedido = ""
   xDescr2 = ""
   If xTipoEmbarque = "NUEVOS" Then
       xInvtID = Trim(sivMyApp.Controls("cinvtid_1"))
       Let xNumSerie = Trim(GetObjectValue("cLotSerNbr_8"))
       Let xNumInventario = Trim(GetObjectValue("cMfgrLotSerNbr_8"))
       Let xNumPedido = Trim(GetObjectValue("xPedido"))
       sqlst = "Select ClaveVehicular = cast(I.Size as varchar(30)), Color = A.Attrib02, NoMotor = A.Attrib13, Transmision = cast(I.User6 as varchar(30)), cast((case when (N.Diameter) <> 0 THEN (N.Diameter) else (N.Gauge) end) as varchar(30)), "
       sqlst = sqlst & " Anio = A.Attrib01, Combustible = cast((Case When N.HeightUOM = '0' then 'DIESEL' When N.HeightUOM = '1' then 'GASOLINA' When N.HeightUOM = '2' then 'ELECTRICO' When N.HeightUOM = 'GAS' then 'GASOLINA' Else 'GASOLINA' End) as varchar(30)), Puertas = cast(N.Depth as varchar(30)), Cilindros = cast(N.Density as varchar(30)), ImportadoDe = Cast('' as varchar(30)), "
       sqlst = sqlst & " NumeroPedimento = A.Attrib14, FechaPedimento = A.Attrib15, Aduana = A.Attrib16, Marca = cast(P.Descr as varchar(10)), Modelo = cast(I.Descr as varchar(60)), Cast (S.sNoteText as varchar(500)) as Comentario  "
       sqlst = sqlst & " From AuSerieAtribs A Inner Join Inventory I ON A.User1 = I.Invtid Left Outer Join Snote S ON A.NoteID = S.nID "
       sqlst = sqlst & " Left Outer Join  InventoryAdg N on I.Invtid = N.Invtid Left Outer Join ProdMgr P on I.ProdMgrId= P.ProdMgrId "
       sqlst = sqlst & " Where A.Invtid = " & Sparm(xInvtID) & " and A.LotSert = " & Sparm(xNumSerie)
       Call SqlFree(c3)
       serr3 = SqlFetch1(c3, sqlst, bxAtribNvos, LenB(bxAtribNvos))
       Call SqlFree(c3)
       If serr3 = 9 Then
          Call MessBox("ERROR La unidad a Facturar no tiene atributos.", vbInformation + vbOKOnly, "Factura Electronica")
          Exit Sub
       End If
    
       xDescr2 = " MARCA: " & Trim(bxAtribNvos.Marca)
       xDescr2 = xDescr2 & " MODELO: " & Trim(bxAtribNvos.Modelo)
       xDescr2 = xDescr2 & " COLOR: " & Trim(bxAtribNvos.Color)
       xDescr2 = xDescr2 & " MOTOR: " & Trim(bxAtribNvos.NoMotor)
       xDescr2 = xDescr2 & " SERIE: " & Trim(xNumSerie)
       xDescr2 = xDescr2 & " AÑO: " & Trim(bxAtribNvos.Anio)
       xDescr2 = xDescr2 & " COMBUSTIBLE: " & Trim(bxAtribNvos.Combustible)
       xDescr2 = xDescr2 & " TRANSMISION: " & Trim(bxAtribNvos.Transmision)
       xDescr2 = xDescr2 & " PUERTAS: " & Trim(bxAtribNvos.Puertas)
       xDescr2 = xDescr2 & " CILINDROS: " & Trim(bxAtribNvos.Cilindros)
       xDescr2 = xDescr2 & " CLAVE_VEHICULAR: " & Trim(bxAtribNvos.ClaveVehicular)
    End If
  
    Parametros.TxtCorreo.Text = RTrim(EmailCte)
    Parametros.txtCopias.Text = bxFeFolio.Copias
    Parametros.Show vbModal

   'Valida exista directorio

   'Crea folio al embarque
   If xStatusFac = "1" Then
      Call GetBufferValue("bsoshipheader.nextfunctionid", SigFunc)
      Call GetBufferValue("bsoshipheader.nextfunctionclass", SigFuncClas)
      Call GetBufferValue("bsoshipheader.SoTypeID", tipoOrden)
        
      serr1 = SqlFetch1(c1, "xFEFuncionSigMC " & Sparm(SigFunc) & "," & Sparm(SigFuncClas) & "," & Sparm(tipoOrden) & Sparm(sivMyApp.Controls("cCpnyID_0")), bxFEFuncionSig, LenB(bxFEFuncionSig))
      Sentencia = "xFECreaFolio_Embarque " & Sparm(xembarque) & "," & Sparm(xFoliotxt) & "," & Sparm(xFechaFactxt) & "," & Sparm(xPeriodo) & "," & Sparm(bxFEFuncionSig.NextFunctionId) & "," & Sparm(bxFEFuncionSig.NextFunctionClass) & "," & Sparm(usuario) & "," & Sparm(xNumPedido) & "," & Sparm(xTipoDoc)
  
      Call TranBeg(True)
      Call SqlFree(c1)
      Call sql(c1, Sentencia)
      serr1 = SqlErr()
      Call TranEnd
      If serr1 <> 0 Then
         Call SqlFree(c1)
         DoEvents
         Call MessBox("No guardó folio en documento, intentar de nuevo ", vbInformation + vbOKOnly, "Factura Electronica")
         Exit Sub
      End If
      Call SqlFree(c1)
   End If
   
   'Let wkRuta = VBA.Trim$(bxFeFolio.Ruta) & xFoliotxt & "_" & VBA.Format$(Now, "yymmdd") & "_" & xStatusFac & ".PRN"
   Let wkRuta = VBA.Trim$(bxFeFolio.Ruta) & "Temp\" & xFoliotxt & "_" & VBA.Format$(Now, "yymmdd") & "_" & xStatusFac & ".PRN"
   Let wkRuta2 = VBA.Trim$(bxFeFolio.Ruta) & xFoliotxt & "_" & VBA.Format$(Now, "yymmdd") & "_" & xStatusFac & ".TXT"
  
   Open wkRuta For Append As #1
   'If Trim(usuario) = "SYSADMIN" Then Stop

'  Excepciones
   If bxDatoCte.CustId = "N05416" Then bxDatoCte.Razonsocial = "RUIZ RUIZ VELASCO MARIA MILAGROS DE LA CONCEPCION"


   Print #1, "#InicioComprobante"
   ' Imprime Tipo Comprobante para addenda de Mapfre
   If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" And Trim(sivMyApp.Controls("csotypeid_0")) = "ACRM" Then
      Print #1, "tipoDocumento=FACTURA"
      Print #1, "subDocumento=SERVICIO"
   Else
      Print #1, "tipoDocumento=" & VBA.Trim$(bxFePref.Documento)
      Print #1, "subDocumento=" & VBA.Trim$(bxFePref.SubDocumento)
   End If
   Print #1, "com:serie=" & xprefijo
   Print #1, "com:folio=" & VBA.Mid$(xFoliotxt, Len(xprefijo) + 1, 8)
   Print #1, "com:fecha=" & xFechaFactxt & xHoratxt
   Print #1, "com:noAprobacion=" & VBA.Trim$(bxFeFolio.NoAprobacion)
   Print #1, "com:anoAprobacion=" & VBA.Trim$(bxFeFolio.AnioAprob)
   ' Imprime forma de pago
   If Trim(sivMyApp.Controls("ccertid_0")) = "02" Then
      Print #1, "com:formaDePago=PAGO EN PARCIALIDADES"
   Else
      Print #1, "com:formaDePago=PAGO EN UNA SOLA EXHIBICION"
   End If
   Print #1, "com:noCertificado=" & VBA.Trim$(bxFeFolio.Certificado)
   Print #1, "com:condicionesDePago=" & VBA.Trim$(bxEmb.descr)
   Print #1, "com:subTotal=" & Str(xSubtot)
   Print #1, "com:descuento=" & Str(xImpDesc)
   Print #1, "com:motivoDescuento="
   Print #1, "com:total=" & Str(xTotalFac)
   Print #1, "moneda=" & "MXN"
   Print #1, "tipoCambio=" & "1.0"
   Print #1, "com:tipoDeComprobante=" & xTipoComp
   Print #1, "com:Banco=" & xBanco
   Print #1, "com:metodoPago=" & xFPagos
   Print #1, "com:NumCtaPago=" & xCuenta
   Print #1, ""

   Print #1, "#Emisor"
   Print #1, "em:rfc=" & VBA.Trim$(bxMatriz.RFC)
   Print #1, "em:nombre=" & VBA.Trim$(bxMatriz.Nombre)
   Print #1, "em:calle=" & VBA.Trim$(bxMatriz.Domicilio)
   Print #1, "em:noExterior=" & VBA.Trim$(bxMatriz.Noext)
   Print #1, "em:noInterior=" & VBA.Trim$(bxMatriz.Noint)
   Print #1, "em:colonia=" & VBA.Trim$(bxMatriz.Colonia)
   Print #1, "em:localidad=" & VBA.Trim$(bxMatriz.Ciudad)
   Print #1, "em:referencia="
   Print #1, "em:municipio=" & VBA.Trim$(bxMatriz.Ciudad)
   Print #1, "em:estado=" & VBA.Trim$(bxMatriz.Estado)
   Print #1, "em:pais=" & VBA.Trim$(bxMatriz.Pais)
   Print #1, "em:codigoPostal=" & VBA.Trim$(bxMatriz.Cp)
   Print #1, "em:telefono=" & VBA.Trim$(bxMatriz.TelOfi)
   Print #1, "em:regimen=Regimen General de las Personas Morales"
   Print #1, "em:gln="
'   Print #1, "em:LugarExpedicion=ZAPOPAN, JALISCO"
   Print #1, ""

   Print #1, "#ExpedidoEn"
   Print #1, "ex:rfc=" & Trim(bxSucursal.RFC)
   Print #1, "ex:nombre=" & Trim(bxSucursal.Nombre)
   Print #1, "ex:calle=" & Trim(bxSucursal.Domicilio)
   Print #1, "ex:noExterior=" & Trim(bxSucursal.Noext)
   Print #1, "ex:noInterior=" & Trim(bxSucursal.Noint)
   Print #1, "ex:colonia=" & Trim(bxSucursal.Colonia)
   Print #1, "ex:localidad=" & Trim(bxSucursal.Ciudad)
   Print #1, "ex:referencia="
   Print #1, "ex:municipio=" & Trim(bxSucursal.Ciudad)
   Print #1, "ex:estado=" & Trim(bxSucursal.Estado)
   Print #1, "ex:pais=" & Trim(bxSucursal.Pais)
   Print #1, "ex:codigoPostal=" & Trim(bxSucursal.Cp)
   Print #1, "ex:telefono=" & Trim(bxSucursal.TelOfi)
   Print #1, "ex:gln="
   Print #1, "ex:titulo=" & Trim(bxSucursal.Titulo)
   Print #1, "ex:internet=" & Trim(bxSucursal.Internet)
   Print #1, "ex:LugarExpedicion=" & Trim(bxSucursal.Ciudad) & ", " & Trim(bxSucursal.Estado)
   Print #1, "ex:distribuidor=" & Trim(bxSucursal.Distribuidor)
   Print #1, "ex:lineagratuita=" & Trim(bxSucursal.LineaGratuita)
   Print #1, ""

   Print #1, "#Sitio2"
   Print #1, "sa:nombre=" & Trim(bxSitio2.Nombre)
   Print #1, "sa:calle=" & Trim(bxSitio2.Domicilio)
   Print #1, "sa:noExterior=" & Trim(bxSitio2.Noext)
   Print #1, "sa:noInterior=" & Trim(bxSitio2.Noint)
   Print #1, "sa:colonia=" & Trim(bxSitio2.Colonia)
   Print #1, "sa:localidad=" & Trim(bxSitio2.Ciudad)
   Print #1, "sa:referencia="
   Print #1, "sa:municipio=" & Trim(bxSitio2.Ciudad)
   Print #1, "sa:estado=" & Trim(bxSitio2.Estado)
   Print #1, "sa:pais=" & Trim(bxSitio2.Pais)
   Print #1, "sa:codigoPostal=" & Trim(bxSitio2.Cp)
   Print #1, "sa:telefono=" & Trim(bxSitio2.TelOfi)
   Print #1, "sa:gln="
   Print #1, "sa:titulo=" & Trim(bxSitio2.Titulo)
   Print #1, "sa:internet=" & Trim(bxSitio2.Internet)
   Print #1, ""

   Print #1, "#Sitio3"
   Print #1, "sb:nombre=" & Trim(bxSitio3.Nombre)
   Print #1, "sb:calle=" & Trim(bxSitio3.Domicilio)
   Print #1, "sb:noExterior=" & Trim(bxSitio3.Noext)
   Print #1, "sb:noInterior=" & Trim(bxSitio3.Noint)
   Print #1, "sb:colonia=" & Trim(bxSitio3.Colonia)
   Print #1, "sb:localidad=" & Trim(bxSitio3.Ciudad)
   Print #1, "sb:referencia="
   Print #1, "sb:municipio=" & Trim(bxSitio3.Ciudad)
   Print #1, "sb:estado=" & Trim(bxSitio3.Estado)
   Print #1, "sb:pais=" & Trim(bxSitio3.Pais)
   Print #1, "sb:codigoPostal=" & Trim(bxSitio3.Cp)
   Print #1, "sb:telefono=" & Trim(bxSitio3.TelOfi)
   Print #1, "sb:gln="
   Print #1, "sb:titulo=" & Trim(bxSitio3.Titulo)
   Print #1, "sb:internet=" & Trim(bxSitio3.Internet)
   Print #1, ""

   Print #1, "#Receptor"
   Print #1, "re:rfc=" & VBA.Trim$(xRfc)
   Print #1, "re:nombre=" & VBA.Trim$(bxDatoCte.Razonsocial)
   Print #1, "re:calle=" & VBA.Trim$(Replace(bxDatoCte.Domicilio, "#", " "))
   Print #1, "re:noExterior=" & VBA.Trim$(bxDatoCte.Numero)
   Print #1, "re:noInterior="
   Print #1, "re:colonia=" & VBA.Trim$(bxDatoCte.Colonia)
   Print #1, "re:localidad=" & VBA.Trim$(bxDatoCte.City)
   Print #1, "re:referencia="
   If xRfc = "MTE440316E54" Then
      Print #1, "re:municipio=" & VBA.Trim$(bxDatoCte.Colonia)
   Else
      Print #1, "re:municipio=" & VBA.Trim$(bxDatoCte.City)
   End If
   Print #1, "re:estado=" & VBA.Trim$(bxDatoCte.State)
   Print #1, "re:pais=" & VBA.Trim$(bxDatoCte.Country)
   Print #1, "re:codigoPostal=" & VBA.Trim$(bxDatoCte.Zip)
   Print #1, "re:numCliente=" & VBA.Trim$(bxDatoCte.CustId)
   Print #1, "re:telefono=" & VBA.RTrim$(bxDatoCte.LadaCasa) & "" & VBA.Trim$(bxDatoCte.TelefonoCasa)
   Print #1, "re:gln="
   Print #1, ""

   Print #1, "#EntregadoEn"
   Print #1, "ent:nombre=" & VBA.Trim$(bxDatoCte.Razonsocial)
   Print #1, "ent:calle=" & VBA.Trim$(Replace(bxDatoCte.Domicilio, "#", " "))
   Print #1, "ent:noExterior=" & VBA.Trim$(bxDatoCte.Numero)
   Print #1, "ent:noInterior="
   Print #1, "ent:colonia=" & VBA.Trim$(bxDatoCte.Colonia)
   Print #1, "ent:localidad=" & VBA.Trim$(bxDatoCte.City)
   Print #1, "ent:referencia="
   If xRfc = "MTE440316E54" Then
      Print #1, "ent:municipio=" & VBA.Trim$(bxDatoCte.Colonia)
   Else
      Print #1, "ent:municipio=" & VBA.Trim$(bxDatoCte.City)
   End If
   Print #1, "ent:estado=" & VBA.Trim$(bxDatoCte.State)
   Print #1, "ent:pais=" & VBA.Trim$(bxDatoCte.Country)
   Print #1, "ent:codigoPostal=" & VBA.Trim$(bxDatoCte.Zip)
   Print #1, "ent:telefono=" & VBA.RTrim$(bxDatoCte.LadaCasa) & "" & VBA.Trim$(bxDatoCte.TelefonoCasa)
   Print #1, "ent:gln="
   Print #1, ""

   Print #1, "#IniImpuestosTraslados"
   Print #1, "Impuesto   Tasa       Importe"
   Print #1, xtCodImpto & xtPorcImpto & LTrim(Str(xIva))
   Print #1, "#FinImpuestosTraslados"
   Print #1, ""

   Print #1, "#TotalImpuestos"
   Print #1, "imp:totalDeImpuestosRetenidos="
   Print #1, "imp:totalDeImpuestosTrasladados=" & Str(xIva)
   Print #1, ""

   Print #1, "#Descuentos"
   Print #1, "des:porcentajeDeDescuentoFinanciero="
   Print #1, "des:porcentajeDeDescuentoTotal="
   Print #1, "des:descuentoFinaciero="
   Print #1, "des:importeDescuentoTotal="
   Print #1, ""

   Print #1, "#Totales"
   'Print #1, "tot:subtotalSinDescuentosSinIva=" & Str((xTotalFac - xtIva) + xImpDesc)
   Print #1, "tot:subtotalSinDescuentosSinIva=" & Str((xTotalFac - xtiva) + xImpDesc)
   Print #1, "tot:subTotal=" & VBA.Format$(val(xtsubtot), "##,###,##0.00")
   Print #1, "tot:total=" & Str(xTotalFac)
   Print #1, "tot:cantidadConLetra=" & UCase(ImporteConLetra(xTotalFac, "MN", 80, 1))
   Print #1, "tot:IVA=" & xtiva
   Print #1, "tot:refacciones=" & xtsubtot
   Print #1, ""
 
   Print #1, "#Addenda"
   Print #1, "add:status=" & xStatusFac
 ' Imprime formato solo a ctes de credito
   If Trim(sivMyApp.Controls("ccustid_0")) <> "000004" And Valida_Usuario("REFCANCELV") = True Then
      Prmsep = Chr(9)
      embarque = Trim(sivMyApp.Controls("cshipperid_0"))
      Parmstr = "ROI.EXE " + Prmsep + "40FE1/RUN" + Prmsep + "{soshipheader.shipperid} =" + Sparm(embarque) + "/WHERE" + Prmsep + "/PSCRN"
      serr1 = Launch(Parmstr, True, True, 0)
      Print #1, "add:impresora=" & RTrim(bxImprimir.Impresora)
   Else
      Print #1, "add:impresora=" & RTrim(bxImprimir.Impresora)
   End If
  
   Print #1, "add:numeroCopiasPorImprimir=" & Copias
   Print #1, "add:email=" & IIf(RTrim(bxFeFolio.Email) <> "", RTrim(bxFeFolio.Email), "") & IIf(RTrim(EmailCte) <> "", ";" & RTrim(EmailCte), "")
   Print #1, ""
    
   Print #1, "#Datos de la Empresa"
   'datos para addenda de Mapfre
   If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" And Trim(sivMyApp.Controls("csotypeid_0")) = "ACRM" Then
      Print #1, "emp:torre=40 ROJO"
      Print #1, "emp:noOrden=" & RTrim(bxEmb.shipperid)
      Print #1, "emp:manodeobra=0.00"
      Print #1, "emp:hojalateria=0.00"
      Print #1, "emp:pintura=0.00"
      Print #1, "emp:ordenVta=" & RTrim(bxEmb.OrdNbr)
      Print #1, "emp:embarque=" & RTrim(bxEmb.shipperid)
      Print #1, "emp:fecha=" & Mid(xtFechaVta, 1, 11)
      Print #1, "emp:lubricantes=0.00"
      Print #1, "emp:compradirecta=0.00"
      Print #1, "emp:otroscargos=0.00"
      Print #1, "emp:titPoliza="
      Print #1, "emp:titSiniestro="
      Print #1, "emp:poliza=" & Trim(bxFEDatAddenda.NumeroPoliza)
      Print #1, "emp:siniestro=" & Trim(bxFEDatAddenda.NumeroSiniestro)
      Print #1, "emp:titDeducible="
      Print #1, "emp:titSaldod="
      Print #1, "emp:deducible="
      Print #1, "emp:saldod="
      Print #1, "emp:titsaldoConLetra="
      Print #1, "emp:saldoConLetra="
   Else
      Print #1, "emp:ordenVta=" & RTrim(bxEmb.OrdNbr)
      Print #1, "emp:embarque=" & RTrim(bxEmb.shipperid)
'      Print #1, "emp:fecha=" & Mid(xtFechaletra, 1, 11)
      Print #1, "emp:fecha=" & xFechaFactxt
   End If
  
'   Print #1, "emp:fechavenc=" & xtFechaVenc
   Print #1, "emp:fechavenc=" & xFechaVenctxt
   If xTipoEmbarque = "NUEVOS" Then
      Print #1, "emp:vendedor=" & Trim(bxEmb.SlsperId)
   Else
      Print #1, "emp:vendedor=" & Trim(bxEmb.Name)
   End If
   Print #1, "emp:cobrador=" & Trim(xrcn)
   Print #1, "emp:refacciones=" & xtsubtot
  
   If xTipoEmbarque = "NUEVOS" Then
      Print #1, "emp:clavevehicular=" & Trim(bxAtribNvos.ClaveVehicular)
      Print #1, "emp:Embarque=" & Trim(xembarque)
      Print #1, "emp:pedido=" & Trim(xNumPedido)
      Print #1, "emp:noinv=" & Trim(xNumInventario)
    ' Imprime tipo de venta
      If Trim(sivMyApp.Controls("csiteid_0")) = Trim(Obtiene_Almacen("AUTOSSEMINUEVOS")) Then
         Print #1, "emp:tipounidad=Seminuevo"
      Else
         Print #1, "emp:tipounidad=Nuevo"
      End If
      Print #1, "emp:marca=" & bxAtribNvos.Marca
      Print #1, "emp:modelo=" & Trim(bxAtribNvos.Modelo)
      Print #1, "emp:color=" & Trim(bxAtribNvos.Color)
      Print #1, "emp:noMotor=" & Trim(bxAtribNvos.NoMotor)
      Print #1, "emp:serie=" & Trim(xNumSerie)
      Print #1, "emp:transmision=" & Trim(bxAtribNvos.Transmision)
      Print #1, "emp:capacidad=" & Trim(bxAtribNvos.Capacidad)
      Print #1, "emp:anio=" & Trim(bxAtribNvos.Anio)
      Print #1, "emp:combustible=" & Trim(bxAtribNvos.Combustible)
      Print #1, "emp:puertas=" & Trim(bxAtribNvos.Puertas)
      Print #1, "emp:cilindros=" & Trim(bxAtribNvos.Cilindros)
      Print #1, "emp:importadoDe=" & Trim(bxAtribNvos.ImportadoDe)
      Print #1, "emp:NumeroPedimento=" & Trim(bxAtribNvos.NumeroPedimento)
      Print #1, "emp:FechaPedimento=" & Trim(bxAtribNvos.FechaPedimento)
      Print #1, "emp:Aduana=" & Trim(bxAtribNvos.Aduana)
         ' Imprime Leyenda para Seminuevos
      If Trim(sivMyApp.Controls("csiteid_0")) = Trim(Obtiene_Almacen("AUTOSSEMINUEVOS")) Then
         Print #1, "emp:leyenda=SE VENDE EN EL ESTADO QUE SE ENCUENTRA"
      Else
         Print #1, "emp:leyenda="
      End If
      'Print #1, "emp:leyenda=SE INCLUYE EL IVA DE ESTA FACTURA DE ACUERDO AL CODIGO 20 ...."
      Print #1, "emp:leyenda1=" & "La transmisión de la propiedad del bien al que se refiere la presente factura se formaliza a través delcontrato de adhesión EFN0000002, conforme a las disposiciones de la Norma Oficial Mexicana 160  SCFI-2003"
      Print #1, "emp:leyenda2=Esta es la primera impresión, del CFD"
   End If
      
   Print #1, "emp:Banco=" & xBanco
   Print #1, "emp:FormadePago=" & xFPagos
   Print #1, "emp:NumCtaPago=" & xCuenta
   Print #1, "#FinDatos de la Empresa"
   Print #1, ""

   If xImpAddenda = "SI" Then
      Print #1, "#MAPFRE"
      Print #1, "map:id=T" & xTipoDoc & xFoliotxt
      Print #1, "map:TpoCdgIntEmisor=" & bxFEDatAddenda.TpoCdgIntEmisor
      Print #1, "map:CdgIntEmisor=" & bxFEDatAddenda.CdgIntEmisor
     ' Imprime Moneda para addenda de Mapfre
     If xRfc = "MTE440316E54" Then 'And Trim(SivMyApp.Controls("csotypeid_0")) = "ACRM" Then
        Print #1, "map:moneda=MN"
     ElseIf xRfc = "GNP9211244P0" Or xRfc = "QCS931209G49" Or xRfc = "ASE931116231" Then
        Print #1, "map:moneda=MXN"
     Else
         Print #1, "map:moneda=" & Trim(bxEmb.CuryId)
      End If
      Print #1, "map:MntBase=" & Str(xTotalFac - xIva)
      Print #1, "map:TotQtyItem=" & Str(xTotItem)
      Print #1, "map:TipoImp=IVA"
      Print #1, "map:TasaImp=" & xtPorcImpto
      Print #1, "map:MontoImp=" & Str(xIva)
      Print #1, "map:TipoSector=AUTOS"
      Print #1, "map:NumeroPoliza=" & Trim(bxFEDatAddenda.NumeroPoliza)
      Print #1, "map:INC=" & Trim(bxFEDatAddenda.Inc)
      Print #1, "map:TpoCliente=" & IIf(Trim(bxFEDatAddenda.TipoCliente) = "", "0", Trim(bxFEDatAddenda.TipoCliente))
      Print #1, "map:NroReporte=" & Trim(bxFEDatAddenda.NumeroReporte)
      Print #1, "map:NroSiniestro=" & Trim(bxFEDatAddenda.NumeroSiniestro)
      Print #1, "map:NmbAseg=" & Trim(bxFEDatAddenda.NombreAsegurado)
      Print #1, "map:tipoVehiculo=" & Trim(bxFEDatAddenda.TipoVehiculo)
      Print #1, "map:marcaVehiculo=" & Trim(bxEmb.Marca)
      Print #1, "map:modeloVehiculo=" & Trim(bxEmb.Modelo)
      Print #1, "map:anoVehiculo=" & Trim(bxEmb.Year)
      Print #1, "map:colorVehiculo=" & Trim(bxEmb.Color)
      Print #1, "map:noSerieVehiculo=" & Trim(bxEmb.Serie)
      Print #1, "map:placaVehiculo=" & Trim(bxEmb.Placas)
      Print #1, "map:tipoDoctoReferencia=" & Trim(xTipoRef)
      Print #1, "map:serieReferencia=" & Mid(xFoliotxt, 1, 2)
      Print #1, "map:folioReferencia=" & Mid(xFoliotxt, 3, 8)
    
      If xRfc = "GNP9211244P0" Then
         Print #1, "map:TipoCtoEm=" & Trim(bxFEDatAddenda.TipoContactoEm)
         Print #1, "map:NombreCtoEm=" & Trim(bxFEDatAddenda.NombreContactoEm)
         Print #1, "map:EmailCtoEm=" & Trim(bxFEDatAddenda.EmailContactoEm)
         Print #1, "map:TelCtoEm=" & Trim(bxFEDatAddenda.TelContactoEm)
         Print #1, "map:ExtTelCtoEm=" & Trim(bxFEDatAddenda.ExtTelContactoEm)
         Print #1, "map:AreaCtoEm=" & Trim(bxFEDatAddenda.AreaContactoEm)
         Print #1, "map:TpoCdgIntRecep=EXT"
         Print #1, "map:CdgIntRecep="
         Print #1, "map:TipoCtoRe=" & Trim(bxFEDatAddenda.TipoContactoRe)
         Print #1, "map:EmailCtoRe="
      End If
    
      Print #1, "map:Traccion=" & Trim(bxFEDatAddenda.Traccion)
      Print #1, "map:Transmision=" & Trim(bxFEDatAddenda.Transmision)
      Print #1, "map:Motor=" & Trim(bxFEDatAddenda.Motor)
      Print #1, "map:Kilometraje=" & Trim(bxEmb.Kms)
      Print #1, "map:TipoCobro=" & xTipoCobro
      Print #1, "map:Asesor=" & Trim(bxEmb.Name)
      Print #1, "map:montoDeducible=" & Trim(Str(bxFEDatAddenda.MontoDeducible))
      Print #1, "map:porcientoDeducible=" & Trim(Str(bxFEDatAddenda.PorcDeducible))
    
      If xRfc = "GNP9211244P0" Then
         Print #1, "map:TipoPol=AUTOS="
         Print #1, "map:NumeroPol=" & Trim(bxFEDatAddenda.NumeroPoliza)
      End If
    
      Print #1, "map:noTramitador=" & Trim(bxFEDatAddenda.NumeroTramitador)
      Print #1, "map:tipoContactoEmisor=" & Trim(bxFEDatAddenda.TipoContactoEm)
      Print #1, "map:nombreContactoEmisor=" & Trim(bxFEDatAddenda.NombreContactoEm)
      Print #1, "map:emailContactoEmisor=" & Trim(bxFEDatAddenda.EmailContactoEm)
      Print #1, "map:telContactoEmisor=" & Trim(bxFEDatAddenda.TelContactoEm)
      Print #1, "map:tipoContactoReceptor=" & Trim(bxFEDatAddenda.TipoContactoRe)
      Print #1, "map:nombreContactoReceptor=" & Trim(bxFEDatAddenda.NombreContactoRe)
    
      If xRfc = "GNP9211244P0" Then
         Print #1, "map:ExtTelCtoEmisor=" & Trim(bxFEDatAddenda.ExtTelContactoEm)
         Print #1, "map:AreaCtoEmisor=" & Trim(bxFEDatAddenda.AreaContactoEm)
         Print #1, "map:emailContactoReceptor=" & Trim(bxFEDatAddenda.EmailContactoRe)
         Print #1, "map:telContactoReceptor=" & Trim(bxFEDatAddenda.TelContactoRe)
         Print #1, "map:OficinaEntregaFactura=" & Trim(bxFEDatAddenda.OficinaEntregaFactura)
      End If
    If xRfc = "QCS931209G49" Or _
       xRfc = "ASE931116231" Or _
       xRfc = "MTE440316E54" Or _
       xRfc = "GNP9211244P0" Then  'Qualitas
       Print #1, "map:OficinaEntregaFactura=" & Trim(bxFEDatAddenda.OficinaEntregaFactura)
       Print #1, "map:FolioElectronico=" & IIf(Trim(bxFEDatAddenda.FolioElectronicoR) = "" Or IsNull(bxFEDatAddenda.FolioElectronicoR), "000000000000", Trim(bxFEDatAddenda.FolioElectronicoR))
       Print #1, "map:FolioElectronicoR=" & IIf(Trim(bxFEDatAddenda.FolioElectronicoR) = "" Or IsNull(bxFEDatAddenda.FolioElectronicoR), "000000000000", Trim(bxFEDatAddenda.FolioElectronicoR))
       Print #1, "map:FolioElectronicoV=" & IIf(Trim(bxFEDatAddenda.FolioElectronicoV) = "" Or IsNull(bxFEDatAddenda.FolioElectronicoV), "000000000000", Trim(bxFEDatAddenda.FolioElectronicoV))
       Print #1, "map:bancoDepositoDeducible=" & IIf(bxFEDatAddenda.MontoDeducible > 0, Trim(bxFEDatAddenda.BancoDepositoDeducible), "X")
       Print #1, "map:FechaDepositoDeducible=" & IIf(bxFEDatAddenda.MontoDeducible > 0, Trim(bxFEDatAddenda.FechaDepositoDeducible), "0000-00-00")
       Print #1, "map:folioFicha_ReferenciaDeducible=" & IIf(Trim(bxFEDatAddenda.FolioFichaReferenciaDeducible) = "" Or IsNull(bxFEDatAddenda.FolioFichaReferenciaDeducible), Trim(bxFEDatAddenda.FolioElectronicoR), "") 'IIf(bxFEDatAddenda.MontoDeducible > 0, Trim(bxFEDatAddenda.FolioFichaReferenciaDeducible), "")
       Print #1, "map:montoDemerito_Recupero=" & Format(bxFEDatAddenda.MontoDemeritoRecupero, "#######0.00")
       Print #1, "map:bancoDepositoDemerito_Recupero=" & IIf(bxFEDatAddenda.MontoDemeritoRecupero > 0, Trim(bxFEDatAddenda.BancoDepositoDemeritoRecupero), "X")
       Print #1, "map:fechaDepositoDemerito_Recupero=" & IIf(bxFEDatAddenda.MontoDemeritoRecupero > 0, Trim(bxFEDatAddenda.FechaDepositoDemeritoRecupero), "0000-00-00")
       Print #1, "map:folioFicha_ReferenciaDemerito=" & IIf(Trim(bxFEDatAddenda.FolioFichaReferenciaDemerito) = "" Or IsNull(bxFEDatAddenda.FolioFichaReferenciaDemerito), Trim(bxFEDatAddenda.FolioElectronicoR), "") 'IIf(bxFEDatAddenda.MontoDemeritoRecupero > 0, Trim(bxFEDatAddenda.FolioFichaReferenciaDemerito), "")
    End If
    
      Print #1, "#FinMAPFRE"
      Print #1, ""
   End If
 
   If Trim(xRfc) = "ABA920310QW0" Then
      Print #1, "#ABA"
      Print #1, "ABA:Area=" & Str(8)
      Print #1, "ABA:SubArea=" & Str(19)
      Print #1, "ABA:OrdenCompraID=" & Trim(bxFEDatAddenda.NumeroTramitador)
      Print #1, "ABA:SiniestroID=" & Trim(bxFEDatAddenda.NumeroSiniestro)
      Print #1, "ABA:BienSec= " & IIf(Len(Trim(bxFEDatAddenda.NumeroReporte)) = 0, "0", Trim(bxFEDatAddenda.NumeroReporte))
      Print #1, "ABA:Mes=" & IIf(Len(Trim(Str(Month(xFechaFac)))) = 1, "0" + Trim(Str(Month(xFechaFac))), Trim(Str(Month(xFechaFac))))
      Print #1, "ABA:Anio=" & Str(Year(xFechaFac))
      Print #1, "ABA:CorreoElectronico=" & Trim(" ")
      Print #1, "ABA:Referencia1NoPoliza=" & Trim(bxFEDatAddenda.NumeroPoliza)
      Print #1, "ABA:Referencia2NombreAsegurado=" & Trim(bxFEDatAddenda.NombreAsegurado)
      Print #1, "ABA:Referencia3Comentarios=" & Trim(" ")
      Print #1, "#FinABA"
      Print #1, ""
   End If
 
   If xTipoEmbarque = "NUEVOS" Then
      Print #1, "#COMPLEMENTO"
      Print #1, "sis:Complemento=ComplementoAutosNuevos"
      Print #1, "vv:CveVehic=" & Trim(bxAtribNvos.ClaveVehicular)
      Print #1, "vv:Niv=" & Trim(xNumSerie)
      Print #1, "#FinCOMPLEMENTO"
      Print #1, ""
   End If
 
'  If (Trim(SivMyApp.Controls("ccustid_0")) = "P00033" Or Trim(SivMyApp.Controls("ccustid_0")) = "P00198") And Trim(SivMyApp.Controls("csotypeid_0")) = "ACRM" Then
   If xRfc = "QCS931209G49" Or xRfc = "ASE931116231" Or xRfc = "MTE440316E54" Then
      Print #1, "#InicioAseguradoraD"
      Print #1, "NroLinDet TpoCodigo VlrCodigo           DscLang DscItem                                           QtyItem UnmdItem  PrcBrutoItem PrcNetoItem TipoImp TasaImp MontoImp MontoBrutoItem MontoNetoItem MontoTotalItem"
      
      GridHandle = GetGridHandle("Spread1")
      Renglon = MGetRowNum(GridHandle)
      i = 1
      RecFound = MFirst(GridHandle, MemMaintFlag)
      While RecFound = 0
         Call GetBufferValue("bSoShipLine.qtyship", xCant)
         Call GetBufferValue("bSoShipLine.invtid", xInvtID)
         Call GetBufferValue("bSoShipLine.descr", xDescr)
         Call GetBufferValue("bSoShipLine.unitdesc", xUDesc)      'Descripción de la unidad (Unidad de medida)
         Call GetBufferValue("bsoshipline.curytaxamt00", mIva)   'IVA
         Call GetBufferValue("bsoshipline.curytotinvc", mNeto)
         
         If Abs(xCant) > 0 Then
            xInvtID = Mid(Trim(xInvtID), 1, 21)
            xDescr = Mid(Trim(xDescr), 1, 49)
            If Trim(xDescr) = "" Then xDescr = "REFACCION"
            xCant = Abs(xCant)
'            xUDesc = SivMyApp.Controls("cunitdesc_1")                'Descripción de la unidad (Unidad de medida)
           
            mIva = Abs(mIva)
            mBruto = mNeto + mIva
            mTotal = mBruto
            xUIva = IIf(xCant > 0, (mIva / xCant), mIva)
            xPUBruto = IIf(xCant > 0, (mBruto / xCant), mBruto)
            xPUNeto = IIf(xCant > 0, (mNeto / xCant), mNeto)
           
            If Left(xInvtID, 1) = "R" Then
               Let Linea = LTrim(Str(i)) & String(12 - Len(LTrim(Str(i))), " ") & "INT      "
            Else
               Let Linea = LTrim(Str(i)) & String(12 - Len(LTrim(Str(i))), " ") & "SRV      "
            End If
            Let Linea = Linea & Trim(xInvtID) & String(21 - Len(Trim(xInvtID)), " ") & "ES     "
            Let Linea = Linea & Mid(Trim(xDescr), 1, 49) & String(49 - Len(Mid(Trim(xDescr), 1, 49)), " ")
            Let Linea = Linea & CStr(Format(Abs(xCant), "#0.00")) & String(9 - Len(CStr(Format(Abs(xCant), "#0.00"))), " ")
            Let Linea = Linea & Trim(xUDesc) & String(9 - Len(Trim(xUDesc)), " ")
            Let Linea = Linea & String(12 - Len(CStr(Format(Abs(xPUBruto), "#0.00"))), " ") & CStr(Format(Abs(xPUBruto), "#0.00"))
            Let Linea = Linea & String(12 - Len(CStr(Format(Abs(xPUNeto), "#0.00"))), " ") & CStr(Format(Abs(xPUNeto), "#0.00"))
            Let Linea = Linea & "    IVA     16  "
            Let Linea = Linea & String(9 - Len(CStr(Format(Abs(xUIva), "#0.00"))), " ") & CStr(Format(Abs(xUIva), "#0.00"))
            Let Linea = Linea & String(15 - Len(CStr(Format(Abs(mBruto), "#0.00"))), " ") & CStr(Format(Abs(mBruto), "#0.00"))
            Let Linea = Linea & String(14 - Len(CStr(Format(Abs(mNeto), "#0.00"))), " ") & CStr(Format(Abs(mNeto), "#0.00"))
            Let Linea = Linea & String(14 - Len(CStr(Format(Abs(mTotal), "#0.00"))), " ") & CStr(Format(Abs(mTotal), "#0.00"))
            Print #1, Linea
         End If
         i = i + 1
         RecFound = MNext(GridHandle, MemMaintFlag)
      Wend
      Call msetrownum(GridHandle, Renglon)
      
      Print #1, "#FinAseguradoraD"
      Print #1, ""
   End If
  
   Print #1, "#Comentarios"
   Dim lPosicion As Long
   Dim sTemporal As String
   If xTipoEmbarque = "NUEVOS" Then
      lPosicion = InStr(1, bxAtribNvos.Comentario, vbNullChar)
       If lPosicion <> 0 Then
          sTemporal = VBA.Left$(bxAtribNvos.Comentario, lPosicion - 1)
       Else
          sTemporal = bxAtribNvos.Comentario
       End If
       Print #1, RTrim(sTemporal)
       xConc = "Concepto"
   Else
     lPosicion = InStr(1, bxEmb.note + bxEmb.note2, vbNullChar)
     If lPosicion <> 0 Then
        sTemporal = VBA.Left$(bxEmb.note + bxEmb.note2, lPosicion - 1)
     Else
        sTemporal = bxEmb.note + bxEmb.note2
     End If
 
     Print #1, RTrim(sTemporal)
     xConc = ""
   End If
   Print #1, "#FinComentarios"
   Print #1, ""
  
 ' Inicia Detalle para el SAT
   GridHandle = GetGridHandle("Spread1")
   Renglon = MGetRowNum(GridHandle)
  
   Print #1, "#InicioDetalle"
   If bxEmb.curytotinvc < 0 Then
'     Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      Print #1, "Linea   Codigo              Descripcion                                                                                                                                                                                                                                                                                                 Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      xtClaseTec = "              "
   Else
'     Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      Print #1, "Linea   Codigo              Descripcion                                                                                                                                                                                                                                                                                                 Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      xtClaseTec = ""
   End If
  
   i = 1
   RecFound = MFirst(GridHandle, MemMaintFlag)
   While RecFound = 0
      Call GetBufferValue("bSoShipLine.qtyship", xCant)
      Call GetBufferValue("bSoShipLine.invtid", xInvtID)
      Call GetBufferValue("bSoShipLine.descr", xDescr)
      Call GetBufferValue("bSoShipLine.unitdesc", xUDesc)      'Descripción de la unidad (Unidad de medida)
      Call GetBufferValue("bsoshipline.curytaxamt00", mIva)   'IVA
      Call GetBufferValue("bsoshipline.curytotinvc", xImp)
      Call GetBufferValue("bsoshipline.curyslsprice", xPU)
      Call GetBufferValue("bsoshipline.discpct", detDiscPct)
      Call GetBufferValue("bsoshipline.lineref", LineRef)
      Sentencia = "xFEEmbarque_WhSeLoc " & Sparm(sivMyApp.Controls("cCpnyID_0")) & "," & Sparm(xembarque) & "," & Sparm(xInvtID) & "," & Sparm(LineRef)
      Call SqlFree(c1)
      serr1 = SqlFetch1(c1, Sentencia, bWhSeLoc, LenB(bWhSeLoc))
      If serr1 = 0 Then
         xUbicacion = Trim(bWhSeLoc.whseloc)
      Else
         xUbicacion = ""
      End If
      
      If Abs(xCant) > 0 Then
         xInvtID = Mid(Trim(xInvtID), 1, 16)
         If xTipoEmbarque = "NUEVOS" Then
            xDescr = Mid(Trim(bxAtribNvos.Modelo), 1, 41)
         Else
            xDescr = Mid(Trim(xDescr), 1, 41)
         End If
         If Trim(xDescr) = "" Then xDescr = "REFACCION"
         xCant = Abs(xCant)
         xtCant = Format(xCant, "########0.00")
   
' Para que corrija ISAN Ctes Especiales
    If xTipoEmbarque = "NUEVOS" And (VBA.Trim$(bxDatoCte.CustId) = "N20361" Or VBA.Trim$(bxDatoCte.CustId) = "N20008" Or VBA.Trim$(bxDatoCte.CustId) = "N57106" Or VBA.Trim$(bxDatoCte.CustId) = "N05627" Or VBA.Trim$(bxDatoCte.CustId) = "N58097" Or VBA.Trim$(bxDatoCte.CustId) = "N62924" Or VBA.Trim$(bxDatoCte.CustId) = "N08369" Or VBA.Trim$(bxDatoCte.CustId) = "N02196" Or VBA.Trim$(bxDatoCte.CustId) = "N14287" Or VBA.Trim$(bxDatoCte.CustId) = "N02353") Then
         xtImp = xtsubtot
         xtPU = xtsubtot
    Else
         xImp = Abs(xImp)
         xtImp = Format(xImp, "########0.00")
    
         xPU = Abs(xPU)
         xtPU = Format(xPU, "########0.00")
    End If
' Fin Corregir ISan Ctes Especiales.
    
   '      xUDesc = SivMyApp.Controls("cunitdesc_1")
    
         xUDiscPct = val(Mid(Trim(detDiscPct), 1, 10))
         If xUDiscPct = 0 Then
            xtUDiscPct = ""
            xtPUDesc = ""
         Else
            xtUDiscPct = Format(xUDiscPct, "########0.00")
            xPUDesc = (xImp / xCant)
            xtPUDesc = Format(xPUDesc, "########0.00")
         End If
         xUbicacion = Mid(Trim(xUbicacion), 1, 8)
    
         Let Linea = LTrim(Str(i)) & String(8 - Len(LTrim(Str(i))), " ")
         Let Linea = Linea & xInvtID & String(20 - Len(xInvtID), " ")
         Let Linea = Linea & xDescr & String(50 - Len(xDescr), " ")
         Let Linea = Linea & xDescr2 & String(250 - Len(xDescr2), " ")
         Let Linea = Linea & xUDesc & String(10 - Len(xUDesc), " ")
         Let Linea = Linea & String(10 - Len(xtCant), " ") & xtCant
         Let Linea = Linea & String(12 - Len(xtPU), " ") & LTrim(xtPU)
         Let Linea = Linea & String(10 - Len(xtUDiscPct), " ") & xtUDiscPct
         Let Linea = Linea & String(12 - Len(xtPUDesc), " ") & LTrim(xtPUDesc)
         Let Linea = Linea & String(12 - Len(xtImp), " ") & xtImp
         Let Linea = Linea & " " & xtClaseTec
         Let Linea = Linea & " " & xUbicacion
         Print #1, Linea
      End If
      i = i + 1
      RecFound = MNext(GridHandle, MemMaintFlag)
   Wend
   Call msetrownum(GridHandle, Renglon)
  
   Print #1, "#FinDetalle"
  
   Print #1, ""
 ' Fin Detalle para el SAT

 ' Inicia Detalle para Impresion
   Print #1, "#InicioDetalleImpresion"
   If bxEmb.curytotinvc < 0 Then
      Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      xtClaseTec = "              "
   Else
      ' Imprime detalle para addenda de Mapfre
      If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" And Trim(sivMyApp.Controls("csotypeid_0")) = "ACRM" Then
         Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion IvaD       TotalD"
      Else
         Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      End If
      xtClaseTec = ""
   End If
   
   GridHandle = GetGridHandle("Spread1")
   Renglon = MGetRowNum(GridHandle)
  
   i = 1
   RecFound = MFirst(GridHandle, MemMaintFlag)
   While RecFound = 0
      Call GetBufferValue("bSoShipLine.qtyship", xCant)
      Call GetBufferValue("bSoShipLine.invtid", xInvtID)
      Call GetBufferValue("bSoShipLine.descr", xDescr)
      Call GetBufferValue("bSoShipLine.unitdesc", xUDesc)      'Descripción de la unidad (Unidad de medida)
      Call GetBufferValue("bsoshipline.curytotinvc", xImp)
      Call GetBufferValue("bsoshipline.curyslsprice", xPU)
      Call GetBufferValue("bsoshipline.discpct", detDiscPct)
      Call GetBufferValue("bsoshipline.curytaxamt00", xIvaD)
      Call GetBufferValue("bsoshipline.lineref", LineRef)
      Sentencia = "xFEEmbarque_WhSeLoc " & Sparm(sivMyApp.Controls("cCpnyID_0")) & "," & Sparm(xembarque) & "," & Sparm(xInvtID) & "," & Sparm(LineRef)
      Call SqlFree(c1)
      serr1 = SqlFetch1(c1, Sentencia, bWhSeLoc, LenB(bWhSeLoc))
      If serr1 = 0 Then
         xUbicacion = Trim(bWhSeLoc.whseloc)
      Else
         xUbicacion = ""
      End If
      
      If Abs(xCant) > 0 Then
   
         xInvtID = Mid(Trim(xInvtID), 1, 16)
         If xTipoEmbarque = "NUEVOS" Then
            xDescr = Mid(Trim(bxAtribNvos.Modelo), 1, 41)
         Else
            xDescr = Mid(Trim(xDescr), 1, 41)
         End If
         If Trim(xDescr) = "" Then xDescr = "REFACCION"
         xCant = Abs(xCant)
     '    xUDesc = SivMyApp.Controls("cunitdesc_1")
         xtCant = Format(xCant, "########0.00")
         xPU = Abs(xPU)
         xUDiscPct = val(Mid(Trim(detDiscPct), 1, 10))
         xUbicacion = Mid(Trim(xUbicacion), 1, 8)
     
         xIvaD = Abs(xIvaD)
         xImp = Abs(xImp)
    
         If xRfc = "XAXX010101000" Then
            xImp = xImp + xIvaD
         End If
         xPUDesc = (xImp / xCant)
         xPU = xPU * (1 + (xPorcImpto / 100))
         
'Para corregir Isan de Ctes Especiales
        If xTipoEmbarque = "NUEVOS" And (VBA.Trim$(bxDatoCte.CustId) = "N20361" Or VBA.Trim$(bxDatoCte.CustId) = "N20008" Or VBA.Trim$(bxDatoCte.CustId) = "N57106" Or VBA.Trim$(bxDatoCte.CustId) = "N05627" Or VBA.Trim$(bxDatoCte.CustId) = "N58097" Or VBA.Trim$(bxDatoCte.CustId) = "N62924" Or VBA.Trim$(bxDatoCte.CustId) = "N08369" Or VBA.Trim$(bxDatoCte.CustId) = "N02196" Or VBA.Trim$(bxDatoCte.CustId) = "N14287" Or VBA.Trim$(bxDatoCte.CustId) = "N02353") Then
            xtImp = xtsubtot
            xtPU = xtsubtot
            xtUDiscPct = ""
        Else
            xtImp = Format(xImp, "########0.00")
    
            If xUser1 = "2" And xUDiscPct <> 0 Then
             xtPU = Format(xPU, "########0.00")
             xtUDiscPct = Format(xUDiscPct, "########0.00")
            Else
             xtPU = Format(xPUDesc, "########0.00")
             xtUDiscPct = ""
            End If
        End If
'Fin Corregir Isan Ctes Especiales
        
         xtPUDesc = ""
       
         Let Linea = LTrim(Str(i)) & String(8 - Len(LTrim(Str(i))), " ")
         Let Linea = Linea & xInvtID & String(20 - Len(xInvtID), " ")
         Let Linea = Linea & xDescr & String(50 - Len(xDescr), " ")
         Let Linea = Linea & xUDesc & String(10 - Len(xUDesc), " ")
         Let Linea = Linea & String(10 - Len(xtCant), " ") & xtCant
         Let Linea = Linea & String(12 - Len(xtPU), " ") & LTrim(xtPU)
         Let Linea = Linea & String(10 - Len(xtUDiscPct), " ") & xtUDiscPct
         Let Linea = Linea & String(12 - Len(xtPUDesc), " ") & LTrim(xtPUDesc)
         Let Linea = Linea & String(12 - Len(xtImp), " ") & xtImp
         Let Linea = Linea & " " & xtClaseTec
         Let Linea = Linea & " " & xUbicacion
       
       ' imprime detalle para mapfre
         If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" Then
            Call GetBufferValue("bsoshipline.curytaxamt00", xIvaD)
            xtIvaD = Format(xIvaD, "########0.00")
            xtTotD = Format(xImp + xIvaD, "########0.00")
    
            Let Linea = Linea & "          " & String(11 - Len(LTrim(xtIvaD)), " ") & LTrim(xtIvaD)
            Let Linea = Linea & String(12 - Len(LTrim(xtTotD)), " ") & LTrim(xtTotD)
   
         Else
           Let Linea = Linea & " " & xUbicacion
         End If
    
         Print #1, Linea
      End If
      i = i + 1
      RecFound = MNext(GridHandle, MemMaintFlag)
   Wend
   Call msetrownum(GridHandle, Renglon)
  
   Print #1, "#FinDetalleImpresion"
   Print #1, ""
'  Fin Detalle para Impresion

   Close #1
  
   Name wkRuta As wkRuta2

   Call MessBox("Archivo Generado: " & wkRuta2, vbInformation + vbOKOnly, "Proceso Terminado...")
  
   Call SqlFree(c1)
   Call SqlFree(c2)
   Call SqlFree(c3)
   Call SqlFree(c4)
   Call SqlFree(c5)
   Call SqlFree(c6)
   Call SqlFree(c7)
   Call SqlFree(c8)
   Call SqlFree(c9)
  
   If TestLevelChg(LEVEL0) <> NOTCHANGED Or _
      TestLevelChg(LEVEL1) <> NOTCHANGED Or _
      TestLevelChg(LEVEL2) <> NOTCHANGED Or _
      TestLevelChg(LEVEL3) <> NOTCHANGED Or _
      TestLevelChg(LEVEL4) <> NOTCHANGED Or _
      TestLevelChg(LEVEL5) <> NOTCHANGED Or _
      TestLevelChg(LEVEL6) <> NOTCHANGED Or _
      TestLevelChg(LEVEL7) <> NOTCHANGED Or _
      TestLevelChg(LEVEL8) <> NOTCHANGED Then
      Call SetLevelChg(LEVEL0, NOTCHANGED)
      Call SetLevelChg(LEVEL1, NOTCHANGED)
      Call SetLevelChg(LEVEL2, NOTCHANGED)
      Call SetLevelChg(LEVEL3, NOTCHANGED)
      Call SetLevelChg(LEVEL4, NOTCHANGED)
      Call SetLevelChg(LEVEL5, NOTCHANGED)
      Call SetLevelChg(LEVEL6, NOTCHANGED)
      Call SetLevelChg(LEVEL7, NOTCHANGED)
      Call SetLevelChg(LEVEL8, NOTCHANGED)
   End If
  
   'carga de nuevo el embarque a pantalla
   Call SetObjectValue("cshipperid_0", xembarque)
End Sub


' End VBComponent **********************************************************



' VBComponent: xFEAddendaDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "xFEAddendaDH"
Option Explicit

Type xFEAddenda
    Crtd_DateTime As Sdate
    Crtd_Prog As String * 10
    Crtd_User As String * 10
    LUpd_DateTime As Sdate
    LUpd_Prog As String * 10
    LUpd_User As String * 10
    MontoDeducible As Double
    Motor As String * 30
    NombreAsegurado As String * 60
    NumeroPoliza As String * 20
    NumeroReporte As String * 20
    NumeroSiniestro As String * 20
    NumeroTramitador As String * 20
    QFolioElectRef As String * 30
    QFolioElectMO As String * 30
    QBancoDeposito As String * 10
    QFechaDeposito As Sdate
    QFolioFichaRef As String * 30
    QDemeritoMonto As Double
    QDBancoDeposito As String * 10
    QDFechaDeposito As Sdate
    QDolioFechaRef As String * 30
    QUser01 As String * 30
    QUser02 As String * 30
    QUser03 As Double
    QUser04 As Double
    QUser05 As String * 10
    QUser06 As String * 10
    QUser07 As Sdate
    QUser08 As Sdate
    PorcDeducible As Double
    ServiceCallId As String * 10
    TDocRef As String * 2
    TipoCliente As String * 10
    TipoVehiculo As String * 10
    Traccion As String * 10
    Transmision As String * 10
    User01 As String * 30
    User02 As String * 30
    User03 As Double
    User04 As Double
    User05 As String * 10
    User06 As String * 10
    User07 As Sdate
    User08 As Sdate
    zFuture01 As String * 30
    zFuture02 As String * 30
    zFuture03 As Double
    zFuture04 As Double
    zFuture05 As String * 10
    zFuture06 As String * 10
    zFuture07 As Sdate
    zFuture08 As Sdate
End Type

Public bxFEAddenda As xFEAddenda, nxFEAddenda As xFEAddenda
Public csr_xFEAddenda As Integer, serr_xFEAddenda As Integer

' End VBComponent **********************************************************



' VBComponent: xFEClientes_DH, ComponentType: 1 **********************************************************
Attribute VB_Name = "xFEClientes_DH"
Option Explicit

Type xFEClientes
    CdgIntEmisor As String * 10
    Crtd_DateTime As Sdate
    Crtd_Prog As String * 10
    Crtd_User As String * 10
    CustId As String * 15
    EmailContactoEm As String * 65
    EmailContactoRe As String * 65
    Futuro01 As String * 30
    Futuro02 As String * 30
    Futuro03 As Double
    Futuro04 As Double
    Futuro05 As String * 10
    Futuro06 As String * 10
    Futuro07 As Sdate
    Futuro08 As Sdate
    Inc As String * 5
    LUpd_DateTime As Sdate
    LUpd_Prog As String * 10
    LUpd_User As String * 10
    NombreContactoEm As String * 60
    NombreContactoRe As String * 60
    TelContactoEm As String * 20
    TelContactoRe As String * 20
    TipoContactoEm As String * 15
    TipoContactoRe As String * 15
    TpoCdgIntEmisor As String * 10
    User01 As String * 30
    User02 As String * 30
    User03 As Double
    User04 As Double
    User05 As String * 10
    User06 As String * 10
    User07 As Sdate
    User08 As Sdate
End Type

Public bxFEClientes As xFEClientes, nxFEClientes As xFEClientes

Public csr_xFEClientes As Integer



' End VBComponent **********************************************************



' VBComponent: UserForm2.FRX, ComponentType: 3 **********************************************************
EncodedDataLength = 4335
DecodedDataLength = 3096
M3$((```,`````````````,`2``#H"```T,\1X*&Q&N$`````````````````
M````/@`#`/[_"0`&```````````````!`````0``````````$````@````$`
M``#^____``````````#_________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M_______________________________________________________]____
M_O____[___\$````_O__________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M_________________U(`;P!O`'0`(`!%`&X`=`!R`'D`````````````````
M```````````````````````````````````````````6``4`__________\"
M````\&DJQMP6SA&>F`"J`%=*3P```````````````*#6;>:F]=(!`P```$`"
M````````9@``````````````````````````````````````````````````
M``````````````````````````````````0``@#_______________\`````
M````````````````````````````````````````````````ZP````````!O
M````````````````````````````````````````````````````````````
M````````````````````````!``"`0$````#````_____P``````````````
M``````````````````````````````````(```"X``````````$`0P!O`&T`
M<`!/`&(`:@``````````````````````````````````````````````````
M```````````````2``(`________________````````````````````````
M````````````````````````!P```&X``````````0````4````#````!```
M`/[___\&````_O___P@```#^____________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M____________________________________________________________
M__\`!"@`2`P0#`,````$0```__\```4`````?0``="```"`-````````````
M``-2XPN1C\X1G>,`J@!+N%$!````D`%$0@$`!E1A:&]M80```P```(0`````
M@P%O```D`.4!```(``"``0```#@``````!<`='AT0VQA=F6)$```(@`"&``!
M`P"``````!M(@"PJ````E`L``'L"`````A@`-0````8``("E``````(``%1A
M:&]M87(*``(H`"@````6``"`0VQA=F4@9&4@075T;W)I>F%C:6]N.@``DPL`
M`*<!`````A@`-0````8``("E``````(``%1A:&]M87(*``(8`"@````'``"`
M06-E<'1A<@H.#@``3@,````"&`!U````!@``@*4``````@,`5&%H;VUA<@H`
M``````````0`````*`#U`0``!@``@`(````R````2`````$`%0!,86)E;#%V
M92($```B!``````H`.4!```*``"``P```#@````"`!$`8VUD06-E<'1A<@``
M[`D``$4(`````@P`&0```/-_`0#_`0``````````````````````````````
M`0#^_P,*``#_____\&DJQMP6SA&>F`"J`%=*3QD```!-:6-R;W-O9G0@1F]R
M;7,@,BXP($9O<FT`$````$5M8F5D9&5D($]B:F5C=``-````1F]R;7,N1F]R
M;2XQ`/0YLG$`````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
M````````````````````````````````````````````````````````````
D````````````````````````````````````````````````
' End VBComponent **********************************************************



' VBComponent: UserForm2, ComponentType: 3 **********************************************************
VERSION 5.00
Begin {C62A69F0-16DC-11CE-9E98-00AA00574A4F} UserForm2 
   Caption         =   "UserForm2"
   ClientHeight    =   1905
   ClientLeft      =   45
   ClientTop       =   330
   ClientWidth     =   4710
   OleObjectBlob   =   "UserForm2.frx":0000
   StartUpPosition =   1  'CenterOwner
End
Attribute VB_Name = "UserForm2"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False























Private Sub cmdAceptar_Click()
  Let Clave2 = RTrim(txtClave.Text)
  Unload Me
End Sub

Private Sub txtClave_Change()
  Let Clave2 = ""
End Sub

' End VBComponent **********************************************************



' VBComponent: Module1, ComponentType: 1 **********************************************************
Attribute VB_Name = "Module1"
Option Explicit

Type xCveVend
     Vend     As String * 10
     Cve     As String * 10
End Type
Public bxCveVend As xCveVend

Type xDist
     Dist     As String * 10
End Type
Public bxDist As xDist

Public Clave2 As String * 10

Public Sub Verif_Impresion(Verif As Boolean)
  Dim Sentencia  As String
  Dim vShipperID As String

  UserForm2.Show
  
  Call GetBufferValue("bSoShipHeader.ShipperID", vShipperID)
  
  Let Sentencia = "Select slsperid, User5 From SalesPerson where User5=" & Sparm(Clave2)
  Let serr1 = SqlFetch1(c1, Sentencia, bxCveVend, LenB(bxCveVend))
  If serr1 = 0 And Trim(Clave2) <> "" Then
     Sentencia = "Update SoShipHeader Set User8 = " & Sparm(bxCveVend.Vend) & " Where ShipperID = " & Sparm(vShipperID)
     Call SqlFree(c1)
     Call TranBeg(True)
     Call sql(c1, Sentencia)
     serr1 = SqlErr()
     Call TranEnd
     Call SqlFree(c1)
    
'    Call setprop("xVend", PROP_ENABLED, True)
'    SivMyApp.Controls("xVend") = Trim(bxCveVend.Vend)
'    Call setprop("xVend", PROP_ENABLED, False)
    Verif = True
  Else
     Sentencia = "Update SoShipHeader Set User8 = '' Where ShipperID = " & Sparm(vShipperID)
     Call SqlFree(c1)
     Call TranBeg(True)
     Call sql(c1, Sentencia)
     serr1 = SqlErr()
     Call TranEnd
     Call SqlFree(c1)
    
'    Call setprop("xVend", PROP_ENABLED, True)
'    SivMyApp.Controls("xVend") = ""
'    Call setprop("xVend", PROP_ENABLED, False)
    Verif = False
  End If
  Call SqlFree(c1)

End Sub
' End VBComponent **********************************************************



' VBComponent: Module2, ComponentType: 1 **********************************************************
Attribute VB_Name = "Module2"
Option Explicit

Public vCambiaVend As Boolean

Type ItemSite
        ABCCode As String * 2
        AllocQty As Double
        AutoPODropShip As Integer
        AutoPOPolicy As String * 2
        AvgCost As Double
        BMIAvgCost As Double
        BMIDirStdCst As Double
        BMIFOvhStdCst As Double
        BMILastCost As Double
        BMIPDirStdCst As Double
        BMIPFOvhStdCst As Double
        BMIPStdCst As Double
        BMIPVOvhStdCst As Double
        BMIStdCost As Double
        BMITotCost As Double
        BMIVOvhStdCst As Double
        Buyer As String * 10
        COGSAcct As String * 10
        COGSSub As String * 24
        CountStatus As String * 1
        CpnyId As String * 10
        Crtd_DateTime As Sdate
        Crtd_Prog As String * 8
        Crtd_User As String * 10
        CycleID As String * 10
        DfltPickBin As String * 10
        DfltPOUnit As String * 6
        DfltPutAwayBin As String * 10
        DfltRepairBin As String * 10
        DfltSOUnit As String * 6
        DfltVendorBin As String * 10
        DfltWhseLoc As String * 10
        DirStdCst As Double
        EOQ As Double
        FOvhStdCst As Double
        InvtAcct As String * 10
        invtid As String * 30
        InvtSub As String * 24
        IRCalcDailyUsage As Double
        IRCalcEOQ As Double
        IRCalcLeadTime As Double
        IRCalcLinePt As Double
        IRCalcRCycDays As Long
        IRCalcReOrdPt As Double
        IRCalcReOrdQty As Double
        IRCalcSafetyStk As Double
        IRDailyUsage As Double
        IRDaysSupply As Double
        IRDemandID As String * 10
        IRFutureDate As Sdate
        IRFuturePolicy As String * 1
        IRLeadTimeID As String * 10
        IRLinePt As Double
        IRManualDailyUsage As Integer
        IRManualEOQ As Integer
        IRManualLeadTime As Integer
        IRManualLinePt As Integer
        IRManualRCycDays As Integer
        IRManualReOrdPt As Integer
        IRManualReOrdQty As Integer
        IRManualSafetyStk As Integer
        IRMaxDailyUsage As Double
        IRMaxEOQ As Double
        IRMaxLeadTime As Double
        IRMaxLinePt As Double
        IRMaxRCycDays As Double
        IRMaxReOrdPt As Double
        IRMaxReOrdQty As Double
        IRMaxSafetyStk As Double
        IRMinDailyUsage As Double
        IRMinEOQ As Double
        IRMinLeadTime As Double
        IRMinLinePt As Double
        IRMinOnHand As Double
        IRMinRCycDays As Double
        IRMinReOrdPt As Double
        IRMinReOrdQty As Double
        IRMinSafetyStk As Double
        IRModelInvtID As String * 30
        IRRCycDays As Integer
        IRSeasonEndDay As Integer
        IRSeasonEndMon As Integer
        IRSeasonStrtDay As Integer
        IRSeasonStrtMon As Integer
        IRServiceLevel As Double
        IRSftyStkDays As Double
        IRSftyStkPct As Double
        IRSftyStkPolicy As String * 1
        IRSourceCode As String * 1
        IRTargetOrdMethod As String * 1
        IRTargetOrdReq As Double
        IRTransferSiteID As String * 10
        LastBookQty As Double
        LastCost As Double
        LastCountDate As Sdate
        LastPurchaseDate As Sdate
        LastPurchasePrice As Double
        LastStdCost As Double
        LastVarAmt As Double
        LastVarPct As Double
        LastVarQty As Double
        LastVendor As String * 15
        LeadTime As Double
        LUpd_DateTime As Sdate
        LUpd_Prog As String * 8
        LUpd_User As String * 10
        MaxOnHand As Double
        MfgClassID As String * 10
        MfgLeadTime As Double
        MoveClass As String * 10
        NoteId As Long
        PDirStdCst As Double
        PFOvhStdCst As Double
        PrimVendID As String * 15
        ProdMgrID As String * 10
        PStdCostDate As Sdate
        PStdCst As Double
        PVOvhStdCst As Double
        QtyAlloc As Double
        qtyavail As Double
        QtyCustOrd As Double
        QtyInTransit As Double
        QtyNotAvail As Double
        QtyOnBO As Double
        QtyOnDP As Double
        qtyonhand As Double
        QtyOnKitAssyOrders As Double
        QtyOnPO As Double
        QtyOnTransferOrders As Double
        QtyShipNotInv As Double
        QtyWOFirmDemand As Double
        QtyWOFirmSupply As Double
        QtyWORlsedDemand As Double
        QtyWORlsedSupply As Double
        ReordInterval As Integer
        ReordPt As Double
        ReordPtCalc As Double
        ReordQty As Double
        ReordQtyCalc As Double
        ReplMthd As String * 1
        S4Future01 As String * 30
        S4Future02 As String * 30
        S4Future03 As Double
        S4Future04 As Double
        S4Future05 As Double
        S4Future06 As Double
        S4Future07 As Sdate
        S4Future08 As Sdate
        S4Future09 As Long
        S4Future10 As Long
        S4Future11 As String * 10
        S4Future12 As String * 10
        SafetyStk As Double
        SafetyStkCalc As Double
        SalesAcct As String * 10
        SalesSub As String * 24
        SecondVendID As String * 15
        Selected As Integer
        ShipNotInvAcct As String * 10
        ShipNotInvSub As String * 24
        SiteID As String * 10
        StdCost As Double
        StdCostDate As Sdate
        StkItem As Integer
        TotCost As Double
        Turns As Double
        UsageRate As Double
        User1 As String * 30
        User2 As String * 30
        User3 As Double
        User4 As Double
        User5 As String * 10
        User6 As String * 10
        User7 As Sdate
        User8 As Sdate
        VOvhStdCst As Double
        YTDUsage As Double
End Type

Global bItemSite As ItemSite, nItemSite As ItemSite

Type Invent
   QtyExi As Double
   QtyDis As Double
End Type
Public bInvent As Invent

Type Ubica
   whseloc As String * 10
End Type
Public bUbica As Ubica

Type Intercambio
    Alterno As String * 30
    DescrX As String * 60
    DescrI As String * 60
End Type

Public bAltId As Intercambio

Type xTMValida
    Codigo  As String * 60
    invtid  As String * 30
    Linea   As Long
End Type

Public bxTMValida As xTMValida, nxTMValida As xTMValida

Type xCtoNis
  Codigo As String * 12
  preciod As Double
End Type

Public bxCtoNis As xCtoNis, nxCtoNis As xCtoNis

Type xProNis
  Codigo As String * 30
  preprom As Double
End Type

Public bxProNis As xProNis, nxProNis As xProNis

Type xInPrecio
  precio As Double
  precioAA As Double
End Type

Public bxInPrecio As xInPrecio, nxInPrecio As xInPrecio

Type xCte
  ClassId As String * 6
End Type

Public bxCte As xCte, nxCte As xCte


Type xPreciosN
   Codigo   As String * 30
   Cto90    As Double
   Cto92    As Double
   May      As Double
   Seg      As Double
   Pub      As Double
   AAA      As Double
   AA       As Double
   FEMSA    As Double
   SEGCON   As Double
End Type
Public bxPreciosN As xPreciosN





' End VBComponent **********************************************************



' VBComponent: Module3, ComponentType: 1 **********************************************************
Attribute VB_Name = "Module3"
Option Explicit
Dim xtsubtot As Double
Dim xtiva As Double
Public Sub Imprime_FE_PBAREF(xStatusFac As String, xFechaFac As Date, xFolioCanc As String)
   Dim FileSystem As Object
   Dim Destino As Object
   Dim GridHandle As Integer
   Dim Linea As String
   Dim Renglon As Double
   Dim wkRuta As String
   Dim wkRuta2 As String
   Dim ImpLin As Double
   Dim xHora As Stime
   Dim xFechaFactxt$, xHoratxt$, xFechaVenctxt$
   Dim sqlst$, Condic$, dCondic$, xCustid$, xShiptoid$, xembarque$, xNota$, xrcn$
   Dim xIva As Double, xTotalFac As Double, xSubtot As Double
   Dim xImpDesc As Double, xPorDesc As Double
   Dim sDataEntity As String
   Dim Rows As Integer
   Dim i As Integer, NoDec As Integer
   Dim xInvtID$, xDescr$, xUDesc$, xtCant$, xtImp$, xtPU$, Fraccion$, xtPUDesc$, xtUDiscPct$
   Dim xCant As Double, xPU As Double, xImp As Double, xPUDesc As Double
   Dim xsiteid$, xSotypeId$, xprefijo$, xFolio As Double, xFoliotxt$
   Dim xCodImp As Double, xPorImp As Double, xUDiscPct As Double
   Dim xTipoComp$, xCodImpto$, xtCodImpto, xPorcImpto As Double, xtPorcImpto$, xComentario$, xImpAddenda$
   Dim xTipoDoc$, xSucursal$, xTotItem As Double, xTipoRef$, xTipoCobro$
   Dim xRfc$, xUser1$, xImpDto As Double
   Dim xtFechaVta$, xFechaVta2 As Sdate, xFechaVenc As Sdate, xtFechaVenc$
   Dim xUbicacion$, usuario As String * 47, xtClaseTec$, xtFechaletra$, xMeses$, xTipoEmbarque, xConc$
   Dim xIvaD As Double, xtIvaD$, xtTotD$
   Dim xBanco$, xFPagos$, xCuenta$
   Dim mIva As Double, mNeto As Double, mBruto As Double, mTotal As Double, xUIva As Double, xPUBruto As Double, xPUNeto As Double
   Dim SigFunc$, SigFuncClas$, tipoOrden$
   Dim RecFound         As Integer
   Dim MemMaintFlag     As Integer
   Dim RegFetch         As Integer
   Dim Prmsep$, Parmstr$, embarque$
   Dim xNumSerie As String, xNumInventario As String, xNumPedido As String
   Dim detDiscPct As String
   Dim LineRef    As String
   Dim xDescr2    As String
    
   Call GetBufferValue("bsoshipheader.user2", xrcn)
   Call GetBufferValue("bsoshipheader.shipperid", xembarque)
   Call GetBufferValue("bpes.UserId", usuario)
   'If Trim(usuario) = "SYSADMIN" Then Stop
   
   usuario = Mid(RTrim(usuario), 1, 10)
   xMeses = "  EneFebMarAbrMayJunJulAgoSepOctNovDic"
   
   xBanco = IIf(Trim(sivMyApp.Controls("dBanco")) = "", "NO IDENTIFICADO", Trim(sivMyApp.Controls("dBanco")))
   'xFPagos = IIf(Trim(sivMyApp.Controls("dFPagos")) = "", "NO IDENTIFICADO", Trim(sivMyApp.Controls("dFPagos")))
   xFPagos = IIf(Trim(sivMyApp.Controls("dFPagos")) = "", "99", Left(Trim(sivMyApp.Controls("dFPagos")), 2))
   xFPagos = IIf(xFPagos = "98", "NA", xFPagos)
   xCuenta = IIf(Trim(sivMyApp.Controls("dCuenta")) = "", "", Trim(sivMyApp.Controls("dCuenta")))
    
' Datos Embarque
  sqlst = "select a.custid, a.shiptoid, a.curytottax, a.curytotinvc, a.curywholeorddisc, a.shipperid, a.slsperid, b.name, b.emailaddr, isnull(c.snotetext,''), isnull(c.snotetext2,''), a.curyid, a.termsid, e.dueintrv, e.Descr "
  sqlst = sqlst & ",marca=isnull(d.marca,''), modelo=isnull(d.modelo,''), year=isnull(d.year,''), color=isnull(d.color,''), serie=isnull(d.serie,''), placas=isnull(d.placas,''), kms=isnull(d.kms,0), cl.User1, a.ordnbr, Chasis=isnull(d.otu,'') "
  sqlst = sqlst & "from soshipheader a left outer join salesperson b on a.slsperid = b.slsperid "
  sqlst = sqlst & "left outer join auordadic d on a.shipperid = d.servcallid "
  sqlst = sqlst & "left outer join xFENotas1000 c on a.noteid = c.nid "
  sqlst = sqlst & "left outer join terms e on a.termsid = e.termsid "
  sqlst = sqlst & "left outer join Customer cl on a.Custid = cl.Custid "
  sqlst = sqlst & "where a.shipperid=" & Sparm(xembarque)
  Call SqlFree(c4)
  serr4 = SqlFetch1(c4, sqlst, bxEmb, LenB(bxEmb))
  Call SqlFree(c4)
  If serr4 = 0 Then
     xFechaFactxt = Year(xFechaFac) & "-" & VBA.Right$((100 + Month(xFechaFac)), 2) & "-" & VBA.Right$((100 + Day(xFechaFac)), 2)
     Call GetSysTime(xHora)
     xHoratxt = "T" & VBA.Left$(TimeToStr(xHora), 2) & ":" & VBA.Mid$(TimeToStr(xHora), 3, 2) & ":" & VBA.Mid$(TimeToStr(xHora), 5, 2)
     xtFechaVta = Right((100 + Day(xFechaFac)), 2) & "-" & Right((100 + Month(xFechaFac)), 2) & "-" & Year(xFechaFac) & " " & Mid(xHoratxt, 2, 5)
     xtFechaletra = Right((100 + Day(xFechaFac)), 2) & "-" & Mid(xMeses, (Month(xFechaFac) * 3), 3) & "-" & Year(xFechaFac) & " " & Mid(xHoratxt, 2, 5)
     Call StrToDate(Right((100 + Month(xFechaFac)), 2) & Right((100 + Day(xFechaFac)), 2) & Year(xFechaFac), xFechaVta2)
     Call DatePlusDays(xFechaVta2, bxEmb.dueintrv, xFechaVenc)
     xtFechaVenc = DateToStr(xFechaVenc)
     xtFechaVenc = Mid(xtFechaVenc, 3, 2) & "-" & Mid(xtFechaVenc, 1, 2) & "-" & Mid(xtFechaVenc, 5, 4)
     xFechaVenctxt = Mid(xtFechaVenc, 7, 4) & "-" & Mid(xtFechaVenc, 4, 2) & "-" & Mid(xtFechaVenc, 1, 2)
     xCustid = VBA.Trim$(bxEmb.CustId)
     xShiptoid = VBA.Trim$(bxEmb.shiptoid)
     xIva = Abs(bxEmb.curytottax)
     xSubtot = (Abs(bxEmb.curytotinvc) - xIva)
     xTotalFac = Abs(bxEmb.curytotinvc)
     xImpDesc = Abs(bxEmb.curywholeorddisc)
     If xImpDesc > 0 Then
        xPorDesc = (xImpDesc / xTotalFac)
     Else
        xPorDesc = 0
     End If
     If bxEmb.dueintrv = 0 Then
        xTipoCobro = "CONTADO"
     Else
        xTipoCobro = "CREDITO"
     End If
     xUser1 = VBA.RTrim$(bxEmb.User1)
   End If
   If bxEmb.curytotinvc < 0 Then
      xTipoComp = "EGRESO"
   Else
      xTipoComp = "INGRESO"
   End If
  
' Metodo de Pago
   dCondic = ""
   Condic = VBA.Trim$(GetObjectValue("cpmttypeid_5"))
   If Condic <> "" Then
      sqlst = "select descr from PmtType where CpnyID = " & Sparm(sivMyApp.Controls("cCpnyID_0")) & " And pmttypeid =" & Sparm(Condic)
      Call SqlFree(c1)
      serr1 = SqlFetch1(c1, sqlst, bxfCondic, LenB(bxfCondic))
      Call SqlFree(c1)
      If serr1 = 0 Then
         dCondic = bxfCondic.descr
      End If
   End If
  
'  Total de Items
   sqlst = "select count(invtid) from soshipline where shipperid=" & Sparm(xembarque)
   Call SqlFree(c1)
   serr1 = SqlFetch1(c1, sqlst, bxTotItems, LenB(bxTotItems))
   xTotItem = Round(bxTotItems.Cant, 0)
   Call SqlFree(c1)
  
' Datos Facturacion
  sqlst = "xFEDatoCte " & Sparm(xCustid) & "," & Sparm(xShiptoid) & ", 'FRM'"
  Call SqlFree(c1)
  serr2 = SqlFetch1(c1, sqlst, bxDatoCte, LenB(bxDatoCte))
  Call SqlFree(c1)
  If Len(VBA.RTrim$(VBA.LTrim$(bxDatoCte.TaxLocId))) < 12 Or Mid(VBA.RTrim$(VBA.LTrim$(bxDatoCte.TaxLocId)), 5, 6) = "010101" Then
     xRfc = "XAXX010101000"
     xtsubtot = Str(xTotalFac)
     xtiva = "0.00"
  Else
     xRfc = VBA.RTrim$(VBA.LTrim$(bxDatoCte.TaxLocId))
     xtsubtot = Str(xSubtot)
     xtiva = Str(xIva)
  End If

'Revisa si imprime Addenda
  sqlst = "Select count(Custid) from xFEClientes where CdgIntEmisor <> '' and Custid=" & Sparm(xCustid)
  Call SqlFree(c1)
  serr1 = SqlFetch1(c1, sqlst, bxImpAddenda, LenB(bxImpAddenda))
  Call SqlFree(c1)
  If serr1 = 0 And bxImpAddenda.Imprime > 0 Then
     xImpAddenda = "SI"
  Else
     xImpAddenda = "NO"
  End If
  
' Datos Addenda
'  sqlst = "Select a.ServiceCallid, a.MontoDeducible,a.Motor,a.NombreAsegurado,a.NumeroPoliza,a.NumeroReporte,a.NumeroSiniestro,"
'  sqlst = sqlst & "a.NumeroTramitador,a.PorcDeducible,a.TDocRef,a.TipoCliente,a.Traccion,a.Transmision,"
'  sqlst = sqlst & "b.CustId,b.CdgIntEmisor,b.EmailContactoEm,b.EmailContactoRe,b.Inc,b.NombreContactoEm,b.NombreContactoRe,b.TelContactoEm,b.TelContactoRe,b.TipoContactoEm,"
'  sqlst = sqlst & "b.TipoContactoRe,a.TipoVehiculo,b.TpoCdgIntEmisor, "
'  sqlst = sqlst & " cast(isnull(gnp.Custgnp,'') as char(15)), cast(isnull(b.User05,'') as char(3)), cast(isnull(b.Futuro05,'') as char(10)), cast(isnull(b.Futuro01,'') as char(30)) "
'  sqlst = sqlst & "from xFEAddenda a inner join Soshipheader c  on a.servicecallid=c.shipperid "
'  sqlst = sqlst & "inner join xFEClientes b on c.Custid=b.CustId and a.servicecallid=" & Sparm(xembarque)
'  sqlst = sqlst & "Left join xFEGNP gnp on c.Custid=gnp.Custgnp"
  
  Call SqlFree(c1)
  sqlst = "xFEDatosAddendaRef_sp " & Sparm(xembarque)
  serr1 = SqlFetch1(c1, sqlst, bxFEDatAddenda, LenB(bxFEDatAddenda))
  Call SqlFree(c1)
  
' Datos Impresion
  sqlst = "Select Impresora from xFEImpresora where userid= " & Sparm(usuario)
  Call SqlFree(c3)
  serr3 = SqlFetch1(c3, sqlst, bxImprimir, LenB(bxImprimir))
  Call SqlFree(c3)
  
' Datos Cod Impuesto.
  sqlst = "select  a.taxid, b.taxrate from soshiptax a inner join salestax b on a.taxid = b.taxid where "
  sqlst = sqlst & "a.shipperid=" & Sparm(xembarque)
  sqlst = sqlst & " order by b.taxrate desc"
  Call SqlFree(c9)
  serr9 = SqlFetch1(c9, sqlst, bxCodImp, LenB(bxCodImp))
  Call SqlFree(c9)
  If serr9 = 0 Then
     xCodImpto = VBA.Trim$(bxCodImp.TaxID)
     xPorcImpto = bxCodImp.taxrate
     xtPorcImpto = VBA.Format$(xPorcImpto, "#######0.00")
  Else
     xCodImpto = ""
     xPorcImpto = 0
  End If
  xtCodImpto = "IVA" & VBA.Space$(11 - Len("IVA"))
  xtPorcImpto = xtPorcImpto & VBA.Space$(11 - Len(xtPorcImpto))

' Datos Folio
  xsiteid = VBA.Trim$(sivMyApp.Controls("cSiteid_0"))
  xSotypeId = VBA.Trim$(sivMyApp.Controls("cSoTypeId_0"))
  
  sqlst = "Select siteid, sotypeid, prefijo, tipodoc, suc, documento, subdocumento from xFEPrefijos where Siteid=" & Sparm(xsiteid) & " and Sotypeid=" & Sparm(xSotypeId)
  Call SqlFree(c6)
  serr6 = SqlFetch1(c6, sqlst, bxFePref, LenB(bxFePref))
  Call SqlFree(c6)
  If serr6 = 0 Then
     xprefijo = Replace(bxFePref.Prefijo, " ", "")
    
     Select Case VBA.Trim$(bxFePref.TipoDoc)
       Case "NOTA CARGO"
          xTipoDoc = "56"
          xTipoRef = "FE"
       Case "NOTA CREDITO"
          xTipoDoc = "61"
          xTipoRef = "NC"
       Case Else
          xTipoDoc = "33"
          xTipoRef = "FE"
     End Select

     xSucursal = VBA.Trim$(bxFePref.Sucursal)

 '   Busca y Asigna Folio
     sqlst = "xFEGeneraFolio " & Sparm(xprefijo) & "," & Sparm(sivMyApp.Controls("cCpnyID_0")) & "," & Sparm(xFolioCanc)
     Call SqlFree(c9)
     serr9 = SqlFetch1(c9, sqlst, bxFeFolio, LenB(bxFeFolio))
     Call SqlFree(c9)

     'Call GetBufferValue("bpes.userid", usuario)
    'If RTrim(usuario) = "SYSADMIN" Then Stop
    If serr9 <> 0 Or (serr9 = 0 And VBA.Trim$(bxFeFolio.FolioAct) = "") Then
       Call MessBox("No se han generado folios para este prefijo.", vbInformation + vbOKOnly, "Factura Electronica")
       Exit Sub
    Else
       xFoliotxt = VBA.Trim$(bxFeFolio.FolioAct)
    End If
  Else
    Call MessBox("Este tipo de Embarque no genera Factura Electronica.", vbInformation + vbOKOnly, "Factura Electronica")
    Exit Sub
  End If
' Fin Datos Folio
  
' Datos Compania
  sqlst = "Select * from xFESucursal Where rtrim(titulo) = 'MATRIZ'"
  Call SqlFree(c3)
  serr3 = SqlFetch1(c3, sqlst, bxMatriz, LenB(bxMatriz))
  Call SqlFree(c3)
  
' Datos Sucursal
  sqlst = "Select * from xFESucursal where suc=" & Sparm(xSucursal)
  Call SqlFree(c5)
  serr5 = SqlFetch1(c5, sqlst, bxSucursal, LenB(bxSucursal))
  Call SqlFree(c5)
  
' Datos Sitio2
  sqlst = "Select * from xFESucursal where suc=" & Sparm(bxSucursal.Sitio2)
  Call SqlFree(c5)
  serr5 = SqlFetch1(c5, sqlst, bxSitio2, LenB(bxSitio2))
  Call SqlFree(c5)
  
' Datos Sitio3
  sqlst = "Select * from xFESucursal where suc=" & Sparm(bxSucursal.Sitio3)
  Call SqlFree(c5)
  serr5 = SqlFetch1(c5, sqlst, bxSitio3, LenB(bxSitio3))
  Call SqlFree(c5)
  
   xTipoEmbarque = Trim(bxFePref.SubDocumento)
  
   xDescr2 = ""
   If xTipoEmbarque = "NUEVOS" Then
       xInvtID = Trim(sivMyApp.Controls("cinvtid_1"))
       Let xNumSerie = Trim(GetObjectValue("cLotSerNbr_8"))
       Let xNumInventario = Trim(GetObjectValue("cMfgrLotSerNbr_8"))
       Let xNumPedido = Trim(GetObjectValue("xPedido"))
       sqlst = "Select ClaveVehicular = cast(I.Size as varchar(30)), Color = A.Attrib02, NoMotor = A.Attrib13, Transmision = cast(I.User6 as varchar(30)), cast((case when (N.Diameter) <> 0 THEN (N.Diameter) else (N.Gauge) end) as varchar(30)), "
       sqlst = sqlst & " Anio = A.Attrib01, Combustible = cast((Case When N.HeightUOM = '0' then 'DIESEL' When N.HeightUOM = '1' then 'GASOLINA' When N.HeightUOM = '2' then 'ELECTRICO' When N.HeightUOM = 'GAS' then 'GASOLINA' Else 'GASOLINA' End) as varchar(30)), Puertas = cast(N.Depth as varchar(30)), Cilindros = cast(N.Density as varchar(30)), ImportadoDe = Cast('' as varchar(30)), "
       sqlst = sqlst & " NumeroPedimento = A.Attrib14, FechaPedimento = A.Attrib15, Aduana = A.Attrib16, Marca = cast(P.Descr as varchar(10)), Modelo = cast(I.Descr as varchar(60)), Cast (S.sNoteText as varchar(500)) as Comentario  "
       sqlst = sqlst & " From AuSerieAtribs A Inner Join Inventory I ON A.User1 = I.Invtid Left Outer Join Snote S ON A.NoteID = S.nID "
       sqlst = sqlst & " Left Outer Join  InventoryAdg N on I.Invtid = N.Invtid Left Outer Join ProdMgr P on I.ProdMgrId= P.ProdMgrId "
       sqlst = sqlst & " Where A.Invtid = " & Sparm(xInvtID) & " and A.LotSert = " & Sparm(xNumSerie)
       Call SqlFree(c3)
       serr3 = SqlFetch1(c3, sqlst, bxAtribNvos, LenB(bxAtribNvos))
       Call SqlFree(c3)
       If serr3 = 9 Then
          Call MessBox("ERROR La unidad a Facturar no tiene atributos.", vbInformation + vbOKOnly, "Factura Electronica")
          Exit Sub
       End If
    
       xDescr2 = " MARCA: " & Trim(bxAtribNvos.Marca)
       xDescr2 = xDescr2 & " MODELO: " & Trim(bxAtribNvos.Modelo)
       xDescr2 = xDescr2 & " COLOR: " & Trim(bxAtribNvos.Color)
       xDescr2 = xDescr2 & " MOTOR: " & Trim(bxAtribNvos.NoMotor)
       xDescr2 = xDescr2 & " SERIE: " & Trim(xNumSerie)
       xDescr2 = xDescr2 & " AÑO: " & Trim(bxAtribNvos.Anio)
       xDescr2 = xDescr2 & " COMBUSTIBLE: " & Trim(bxAtribNvos.Combustible)
       xDescr2 = xDescr2 & " TRANSMISION: " & Trim(bxAtribNvos.Transmision)
       xDescr2 = xDescr2 & " PUERTAS: " & Trim(bxAtribNvos.Puertas)
       xDescr2 = xDescr2 & " CILINDROS: " & Trim(bxAtribNvos.Cilindros)
       xDescr2 = xDescr2 & " CLAVE_VEHICULAR: " & Trim(bxAtribNvos.ClaveVehicular)
    End If
  
    
    Parametros.TxtCorreo.Text = RTrim(EmailCte)
    Parametros.txtCopias.Text = bxFeFolio.Copias
    Parametros.Show vbModal

   'Valida exista directorio
  
  'Let wkRuta = VBA.Trim$(bxFeFolio.Ruta) & xFoliotxt & "_" & VBA.Format$(xFechaFac, "yymmdd") & "_" & xStatusFac & ".PRN"
  Let wkRuta = VBA.Trim$(bxFeFolio.Ruta) & "Temp\" & xFoliotxt & "_" & VBA.Format$(xFechaFac, "yymmdd") & "_" & xStatusFac & ".PRN"
  Let wkRuta2 = VBA.Trim$(bxFeFolio.Ruta) & xFoliotxt & "_" & VBA.Format$(xFechaFac, "yymmdd") & "_" & xStatusFac & ".TXT"
  
'   If Trim(usuario) = "SYSADMIN" Then
'     Stop
'     Let wkRuta = VBA.Trim$(bxFeFolio.Ruta) & "respaldo\" & xFoliotxt & "_" & VBA.Format$(xFechaFac, "yymmdd") & "_" & xStatusFac & "0.PRN"
'     Let wkRuta2 = VBA.Trim$(bxFeFolio.Ruta) & "respaldo\" & xFoliotxt & "_" & VBA.Format$(xFechaFac, "yymmdd") & "_" & xStatusFac & "0.TXT"
'   End If
  
  
  Open wkRuta For Append As #1
  'If Trim(usuario) = "SYSADMIN" Then Stop

'  Excepciones
  If bxDatoCte.CustId = "N05416" Then bxDatoCte.Razonsocial = "RUIZ RUIZ VELASCO MARIA MILAGROS DE LA CONCEPCION"
  
     Print #1, "#InicioComprobante"
   ' Imprime Tipo Comprobante para addenda de Mapfre
     If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" And Trim(sivMyApp.Controls("csotypeid_0")) = "ACRM" Then
        Print #1, "tipoDocumento=FACTURA"
        Print #1, "subDocumento=SERVICIO"
     Else
        Print #1, "tipoDocumento=" & VBA.Trim$(bxFePref.Documento)
        Print #1, "subDocumento=" & VBA.Trim$(bxFePref.SubDocumento)
     End If
  Print #1, "com:serie=" & xprefijo
  Print #1, "com:folio=" & VBA.Mid$(xFoliotxt, Len(xprefijo) + 1, 8)
  Print #1, "com:fecha=" & xFechaFactxt & xHoratxt
  Print #1, "com:noAprobacion=" & VBA.Trim$(bxFeFolio.NoAprobacion)
  Print #1, "com:anoAprobacion=" & VBA.Trim$(bxFeFolio.AnioAprob)
  ' Imprime forma de pago
  If Trim(sivMyApp.Controls("ccertid_0")) = "02" Then
     Print #1, "com:formaDePago=PAGO EN PARCIALIDADES"
  Else
     Print #1, "com:formaDePago=PAGO EN UNA SOLA EXHIBICION"
  End If
  Print #1, "com:noCertificado=" & VBA.Trim$(bxFeFolio.Certificado)
  Print #1, "com:condicionesDePago=" & VBA.Trim$(bxEmb.descr)
  Print #1, "com:subTotal=" & Str(xSubtot)
  Print #1, "com:descuento=" & Str(xImpDesc)
  Print #1, "com:motivoDescuento="
  Print #1, "com:total=" & Str(xTotalFac)
  Print #1, "moneda=" & "MXN"
  Print #1, "tipoCambio=" & "1.0"
  Print #1, "com:tipoDeComprobante=" & xTipoComp
  Print #1, "com:Banco=" & xBanco
  Print #1, "com:metodoPago=" & xFPagos
  Print #1, "com:NumCtaPago=" & xCuenta
  Print #1, ""

   Print #1, "#Emisor"
   Print #1, "em:rfc=" & VBA.Trim$(bxMatriz.RFC)
   Print #1, "em:nombre=" & VBA.Trim$(bxMatriz.Nombre)
   Print #1, "em:calle=" & VBA.Trim$(bxMatriz.Domicilio)
   Print #1, "em:noExterior=" & VBA.Trim$(bxMatriz.Noext)
   Print #1, "em:noInterior=" & VBA.Trim$(bxMatriz.Noint)
   Print #1, "em:colonia=" & VBA.Trim$(bxMatriz.Colonia)
   Print #1, "em:localidad=" & VBA.Trim$(bxMatriz.Ciudad)
   Print #1, "em:referencia="
   Print #1, "em:municipio=" & VBA.Trim$(bxMatriz.Ciudad)
   Print #1, "em:estado=" & VBA.Trim$(bxMatriz.Estado)
   Print #1, "em:pais=" & VBA.Trim$(bxMatriz.Pais)
   Print #1, "em:codigoPostal=" & VBA.Trim$(bxMatriz.Cp)
   Print #1, "em:telefono=" & VBA.Trim$(bxMatriz.TelOfi)
   Print #1, "em:regimen=Regimen General de las Personas Morales"
   Print #1, "em:gln="
'   Print #1, "em:LugarExpedicion=ZAPOPAN, JALISCO"
   Print #1, ""

   Print #1, "#ExpedidoEn"
   Print #1, "ex:rfc=" & Trim(bxSucursal.RFC)
   Print #1, "ex:nombre=" & Trim(bxSucursal.Nombre)
   Print #1, "ex:calle=" & Trim(bxSucursal.Domicilio)
   Print #1, "ex:noExterior=" & Trim(bxSucursal.Noext)
   Print #1, "ex:noInterior=" & Trim(bxSucursal.Noint)
   Print #1, "ex:colonia=" & Trim(bxSucursal.Colonia)
   Print #1, "ex:localidad=" & Trim(bxSucursal.Ciudad)
   Print #1, "ex:referencia="
   Print #1, "ex:municipio=" & Trim(bxSucursal.Ciudad)
   Print #1, "ex:estado=" & Trim(bxSucursal.Estado)
   Print #1, "ex:pais=" & Trim(bxSucursal.Pais)
   Print #1, "ex:codigoPostal=" & Trim(bxSucursal.Cp)
   Print #1, "ex:telefono=" & Trim(bxSucursal.TelOfi)
   Print #1, "ex:gln="
   Print #1, "ex:titulo=" & Trim(bxSucursal.Titulo)
   Print #1, "ex:internet=" & Trim(bxSucursal.Internet)
   Print #1, "ex:LugarExpedicion=" & Trim(bxSucursal.Ciudad) & ", " & Trim(bxSucursal.Estado)
   Print #1, "ex:distribuidor=" & Trim(bxSucursal.Distribuidor)
   Print #1, "ex:lineagratuita=" & Trim(bxSucursal.LineaGratuita)
   Print #1, ""

   Print #1, "#Sitio2"
   Print #1, "sa:nombre=" & Trim(bxSitio2.Nombre)
   Print #1, "sa:calle=" & Trim(bxSitio2.Domicilio)
   Print #1, "sa:noExterior=" & Trim(bxSitio2.Noext)
   Print #1, "sa:noInterior=" & Trim(bxSitio2.Noint)
   Print #1, "sa:colonia=" & Trim(bxSitio2.Colonia)
   Print #1, "sa:localidad=" & Trim(bxSitio2.Ciudad)
   Print #1, "sa:referencia="
   Print #1, "sa:municipio=" & Trim(bxSitio2.Ciudad)
   Print #1, "sa:estado=" & Trim(bxSitio2.Estado)
   Print #1, "sa:pais=" & Trim(bxSitio2.Pais)
   Print #1, "sa:codigoPostal=" & Trim(bxSitio2.Cp)
   Print #1, "sa:telefono=" & Trim(bxSitio2.TelOfi)
   Print #1, "sa:gln="
   Print #1, "sa:titulo=" & Trim(bxSitio2.Titulo)
   Print #1, "sa:internet=" & Trim(bxSitio2.Internet)
   Print #1, ""

   Print #1, "#Sitio3"
   Print #1, "sb:nombre=" & Trim(bxSitio3.Nombre)
   Print #1, "sb:calle=" & Trim(bxSitio3.Domicilio)
   Print #1, "sb:noExterior=" & Trim(bxSitio3.Noext)
   Print #1, "sb:noInterior=" & Trim(bxSitio3.Noint)
   Print #1, "sb:colonia=" & Trim(bxSitio3.Colonia)
   Print #1, "sb:localidad=" & Trim(bxSitio3.Ciudad)
   Print #1, "sb:referencia="
   Print #1, "sb:municipio=" & Trim(bxSitio3.Ciudad)
   Print #1, "sb:estado=" & Trim(bxSitio3.Estado)
   Print #1, "sb:pais=" & Trim(bxSitio3.Pais)
   Print #1, "sb:codigoPostal=" & Trim(bxSitio3.Cp)
   Print #1, "sb:telefono=" & Trim(bxSitio3.TelOfi)
   Print #1, "sb:gln="
   Print #1, "sb:titulo=" & Trim(bxSitio3.Titulo)
   Print #1, "sb:internet=" & Trim(bxSitio3.Internet)
   Print #1, ""
   
  Print #1, "#Receptor"
  Print #1, "re:rfc=" & VBA.Trim$(xRfc)
  Print #1, "re:nombre=" & VBA.Trim$(bxDatoCte.Razonsocial)
  Print #1, "re:calle=" & VBA.Trim$(bxDatoCte.Domicilio)
  Print #1, "re:noExterior=" & VBA.Trim$(bxDatoCte.Numero)
  Print #1, "re:noInterior="
  Print #1, "re:colonia=" & VBA.Trim$(bxDatoCte.Colonia)
  Print #1, "re:localidad=" & VBA.Trim$(bxDatoCte.City)
  Print #1, "re:referencia="
  If xRfc = "MTE440316E54" Then
     Print #1, "re:municipio=" & VBA.Trim$(bxDatoCte.Colonia)
  Else
     Print #1, "re:municipio=" & VBA.Trim$(bxDatoCte.City)
  End If
  Print #1, "re:estado=" & VBA.Trim$(bxDatoCte.State)
  Print #1, "re:pais=" & VBA.Trim$(bxDatoCte.Country)
  Print #1, "re:codigoPostal=" & VBA.Trim$(bxDatoCte.Zip)
  Print #1, "re:numCliente=" & VBA.Trim$(bxDatoCte.CustId)
  Print #1, "re:telefono=" & VBA.RTrim$(bxDatoCte.LadaCasa) & "" & VBA.Trim$(bxDatoCte.TelefonoCasa)
  Print #1, "re:gln="
  Print #1, ""

  Print #1, "#EntregadoEn"
  Print #1, "ent:nombre=" & VBA.Trim$(bxDatoCte.Razonsocial)
  Print #1, "ent:calle=" & VBA.Trim$(bxDatoCte.Domicilio)
  Print #1, "ent:noExterior=" & VBA.Trim$(bxDatoCte.Numero)
  Print #1, "ent:noInterior="
  Print #1, "ent:colonia=" & VBA.Trim$(bxDatoCte.Colonia)
  Print #1, "ent:localidad=" & VBA.Trim$(bxDatoCte.City)
  Print #1, "ent:referencia="
  If xRfc = "MTE440316E54" Then
     Print #1, "ent:municipio=" & VBA.Trim$(bxDatoCte.Colonia)
  Else
     Print #1, "ent:municipio=" & VBA.Trim$(bxDatoCte.City)
  End If
  Print #1, "ent:estado=" & VBA.Trim$(bxDatoCte.State)
  Print #1, "ent:pais=" & VBA.Trim$(bxDatoCte.Country)
  Print #1, "ent:codigoPostal=" & VBA.Trim$(bxDatoCte.Zip)
  Print #1, "ent:telefono=" & VBA.RTrim$(bxDatoCte.LadaCasa) & "" & VBA.Trim$(bxDatoCte.TelefonoCasa)
  Print #1, "ent:gln="
  Print #1, ""

  Print #1, "#IniImpuestosTraslados"
  Print #1, "Impuesto   Tasa       Importe"
  Print #1, xtCodImpto & xtPorcImpto & LTrim(Str(xIva))
  Print #1, "#FinImpuestosTraslados"
  Print #1, ""

  Print #1, "#TotalImpuestos"
  Print #1, "imp:totalDeImpuestosRetenidos="
  Print #1, "imp:totalDeImpuestosTrasladados=" & Str(xIva)
  Print #1, ""

  Print #1, "#Descuentos"
  Print #1, "des:porcentajeDeDescuentoFinanciero="
  Print #1, "des:porcentajeDeDescuentoTotal="
  Print #1, "des:descuentoFinaciero="
  Print #1, "des:importeDescuentoTotal="
  Print #1, ""

  Print #1, "#Totales"
  'Print #1, "tot:subtotalSinDescuentosSinIva=" & Str((xTotalFac - xtIva) + xImpDesc)
  Print #1, "tot:subtotalSinDescuentosSinIva=" & Str((xTotalFac - xtiva) + xImpDesc)
  Print #1, "tot:subTotal=" & VBA.Format$(val(xtsubtot), "##,###,##0.00")
  Print #1, "tot:total=" & Str(xTotalFac)
  Print #1, "tot:cantidadConLetra=" & UCase(ImporteConLetra(xTotalFac, "MN", 80, 1))
  Print #1, "tot:IVA=" & xtiva
  Print #1, "tot:refacciones=" & xtsubtot
  Print #1, ""
 
  Print #1, "#Addenda"
  Print #1, "add:status=" & xStatusFac
' Imprime formato solo a ctes de credito
  If Trim(sivMyApp.Controls("ccustid_0")) <> "000004" And Valida_Usuario("REFCANCELV") = True Then
     Prmsep = Chr(9)
     embarque = Trim(sivMyApp.Controls("cshipperid_0"))
     Parmstr = "ROI.EXE " + Prmsep + "40FE1/RUN" + Prmsep + "{soshipheader.shipperid} =" + Sparm(embarque) + "/WHERE" + Prmsep + "/PSCRN"
     serr1 = Launch(Parmstr, True, True, 0)
     Print #1, "add:impresora=" & RTrim(bxImprimir.Impresora)
  Else
     Print #1, "add:impresora=" & RTrim(bxImprimir.Impresora)
  End If
  
  Print #1, "add:numeroCopiasPorImprimir=" & Copias
  Print #1, "add:email=" & IIf(RTrim(bxFeFolio.Email) <> "", RTrim(bxFeFolio.Email), "") & IIf(RTrim(EmailCte) <> "", ";" & RTrim(EmailCte), "")
  Print #1, ""
    
  Print #1, "#Datos de la Empresa"
  'datos para addenda de Mapfre
  If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" And Trim(sivMyApp.Controls("csotypeid_0")) = "ACRM" Then
     Print #1, "emp:torre=40 ROJO"
     Print #1, "emp:noOrden=" & RTrim(bxEmb.shipperid)
     Print #1, "emp:manodeobra=0.00"
     Print #1, "emp:hojalateria=0.00"
     Print #1, "emp:pintura=0.00"
     Print #1, "emp:ordenVta=" & RTrim(bxEmb.OrdNbr)
     Print #1, "emp:embarque=" & RTrim(bxEmb.shipperid)
     Print #1, "emp:fecha=" & Mid(xtFechaVta, 1, 11)
     Print #1, "emp:lubricantes=0.00"
     Print #1, "emp:compradirecta=0.00"
     Print #1, "emp:otroscargos=0.00"
     Print #1, "emp:titPoliza="
     Print #1, "emp:titSiniestro="
     Print #1, "emp:poliza=" & Trim(bxFEDatAddenda.NumeroPoliza)
     Print #1, "emp:siniestro=" & Trim(bxFEDatAddenda.NumeroSiniestro)
     Print #1, "emp:titDeducible="
     Print #1, "emp:titSaldod="
     Print #1, "emp:deducible="
     Print #1, "emp:saldod="
     Print #1, "emp:titsaldoConLetra="
     Print #1, "emp:saldoConLetra="
  Else
     Print #1, "emp:ordenVta=" & RTrim(bxEmb.OrdNbr)
     Print #1, "emp:embarque=" & RTrim(bxEmb.shipperid)
'      Print #1, "emp:fecha=" & Mid(xtFechaletra, 1, 11)
      Print #1, "emp:fecha=" & xFechaFactxt
   End If
  
'   Print #1, "emp:fechavenc=" & xtFechaVenc
   Print #1, "emp:fechavenc=" & xFechaVenctxt
  If xTipoEmbarque = "NUEVOS" Then
     Print #1, "emp:vendedor=" & Trim(bxEmb.SlsperId)
  Else
     Print #1, "emp:vendedor=" & Trim(bxEmb.Name)
  End If
  Print #1, "emp:cobrador=" & Trim(xrcn)
  Print #1, "emp:refacciones=" & xtsubtot
  
    If xTipoEmbarque = "NUEVOS" Then
       Print #1, "emp:clavevehicular=" & Trim(bxAtribNvos.ClaveVehicular)
       Print #1, "emp:Embarque=" & Trim(xembarque)
       Print #1, "emp:pedido=" & Trim(xNumPedido)
       Print #1, "emp:noinv=" & Trim(xNumInventario)
     ' Imprime tipo de venta
      If Trim(sivMyApp.Controls("csiteid_0")) = Trim(Obtiene_Almacen("AUTOSSEMINUEVOS")) Then
         Print #1, "emp:tipounidad=Seminuevo"
      Else
         Print #1, "emp:tipounidad=Nuevo"
      End If
      Print #1, "emp:marca=" & bxAtribNvos.Marca
      Print #1, "emp:modelo=" & Trim(bxAtribNvos.Modelo)
      Print #1, "emp:color=" & Trim(bxAtribNvos.Color)
      Print #1, "emp:noMotor=" & Trim(bxAtribNvos.NoMotor)
      Print #1, "emp:serie=" & Trim(xNumSerie)
      Print #1, "emp:transmision=" & Trim(bxAtribNvos.Transmision)
      Print #1, "emp:capacidad=" & Trim(bxAtribNvos.Capacidad)
      Print #1, "emp:anio=" & Trim(bxAtribNvos.Anio)
      Print #1, "emp:combustible=" & Trim(bxAtribNvos.Combustible)
      Print #1, "emp:puertas=" & Trim(bxAtribNvos.Puertas)
      Print #1, "emp:cilindros=" & Trim(bxAtribNvos.Cilindros)
      Print #1, "emp:importadoDe=" & Trim(bxAtribNvos.ImportadoDe)
      Print #1, "emp:NumeroPedimento=" & Trim(bxAtribNvos.NumeroPedimento)
      Print #1, "emp:FechaPedimento=" & Trim(bxAtribNvos.FechaPedimento)
      Print #1, "emp:Aduana=" & Trim(bxAtribNvos.Aduana)
            ' Imprime Leyenda para Seminuevos
      If Trim(sivMyApp.Controls("csiteid_0")) = Trim(Obtiene_Almacen("AUTOSSEMINUEVOS")) Then
         Print #1, "emp:leyenda=SE VENDE EN EL ESTADO QUE SE ENCUENTRA"
      Else
         Print #1, "emp:leyenda="
      End If
      'Print #1, "emp:leyenda=SE INCLUYE EL IVA DE ESTA FACTURA DE ACUERDO AL CODIGO 20 ...."
      Print #1, "emp:leyenda1=" & "La transmisión de la propiedad del bien al que se refiere la presente factura se formaliza a través delcontrato de adhesión EFN0000002, conforme a las disposiciones de la Norma Oficial Mexicana 160  SCFI-2003"
      Print #1, "emp:leyenda2=Esta es la primea impresión, del CFD"
   End If
      
   Print #1, "emp:Banco=" & xBanco
   Print #1, "emp:FormadePago=" & xFPagos
   Print #1, "emp:NumCtaPago=" & xCuenta
   Print #1, "#FinDatos de la Empresa"
   Print #1, ""

  If xImpAddenda = "SI" Then
     Print #1, "#MAPFRE"
     Print #1, "map:id=T" & xTipoDoc & xFoliotxt
     Print #1, "map:TpoCdgIntEmisor=" & bxFEDatAddenda.TpoCdgIntEmisor
     Print #1, "map:CdgIntEmisor=" & bxFEDatAddenda.CdgIntEmisor
     ' Imprime Moneda para addenda de Mapfre
     If xRfc = "MTE440316E54" Then 'And Trim(SivMyApp.Controls("csotypeid_0")) = "ACRM" Then
        Print #1, "map:moneda=MN"
     ElseIf xRfc = "GNP9211244P0" Or xRfc = "QCS931209G49" Or xRfc = "ASE931116231" Then
        Print #1, "map:moneda=MXN"
     Else
        Print #1, "map:moneda=" & Trim(bxEmb.CuryId)
     End If
     Print #1, "map:MntBase=" & Str(xTotalFac - xIva)
     Print #1, "map:TotQtyItem=" & Str(xTotItem)
     Print #1, "map:TipoImp=IVA"
     Print #1, "map:TasaImp=" & xtPorcImpto
     Print #1, "map:MontoImp=" & Str(xIva)
     Print #1, "map:TipoSector=AUTOS"
     Print #1, "map:NumeroPoliza=" & Trim(bxFEDatAddenda.NumeroPoliza)
     Print #1, "map:INC=" & Trim(bxFEDatAddenda.Inc)
     Print #1, "map:TpoCliente=" & IIf(Trim(bxFEDatAddenda.TipoCliente) = "", "0", Trim(bxFEDatAddenda.TipoCliente))
     Print #1, "map:NroReporte=" & Trim(bxFEDatAddenda.NumeroReporte)
     Print #1, "map:NroSiniestro=" & Trim(bxFEDatAddenda.NumeroSiniestro)
     Print #1, "map:NmbAseg=" & Trim(bxFEDatAddenda.NombreAsegurado)
     Print #1, "map:tipoVehiculo=" & Trim(bxFEDatAddenda.TipoVehiculo)
     Print #1, "map:marcaVehiculo=" & Trim(bxEmb.Marca)
     Print #1, "map:modeloVehiculo=" & Trim(bxEmb.Modelo)
     Print #1, "map:anoVehiculo=" & Trim(bxEmb.Year)
     Print #1, "map:colorVehiculo=" & Trim(bxEmb.Color)
     Print #1, "map:noSerieVehiculo=" & Trim(bxEmb.Serie)
     Print #1, "map:placaVehiculo=" & Trim(bxEmb.Placas)
     Print #1, "map:tipoDoctoReferencia=" & Trim(xTipoRef)
     Print #1, "map:serieReferencia=" & Mid(xFoliotxt, 1, 2)
     Print #1, "map:folioReferencia=" & Mid(xFoliotxt, 3, 8)
    
     If xRfc = "GNP9211244P0" Then
        Print #1, "map:TipoCtoEm=" & Trim(bxFEDatAddenda.TipoContactoEm)
        Print #1, "map:NombreCtoEm=" & Trim(bxFEDatAddenda.NombreContactoEm)
        Print #1, "map:EmailCtoEm=" & Trim(bxFEDatAddenda.EmailContactoEm)
        Print #1, "map:TelCtoEm=" & Trim(bxFEDatAddenda.TelContactoEm)
        Print #1, "map:ExtTelCtoEm=" & Trim(bxFEDatAddenda.ExtTelContactoEm)
        Print #1, "map:AreaCtoEm=" & Trim(bxFEDatAddenda.AreaContactoEm)
        Print #1, "map:TpoCdgIntRecep=EXT"
        Print #1, "map:CdgIntRecep="
        Print #1, "map:TipoCtoRe=" & Trim(bxFEDatAddenda.TipoContactoRe)
        Print #1, "map:EmailCtoRe="
     End If
    
     Print #1, "map:Traccion=" & Trim(bxFEDatAddenda.Traccion)
     Print #1, "map:Transmision=" & Trim(bxFEDatAddenda.Transmision)
     Print #1, "map:Motor=" & Trim(bxFEDatAddenda.Motor)
     Print #1, "map:Kilometraje=" & Trim(bxEmb.Kms)
     Print #1, "map:TipoCobro=" & xTipoCobro
     Print #1, "map:Asesor=" & Trim(bxEmb.Name)
     Print #1, "map:montoDeducible=" & Trim(Str(bxFEDatAddenda.MontoDeducible))
     Print #1, "map:porcientoDeducible=" & Trim(Str(bxFEDatAddenda.PorcDeducible))
    
     If xRfc = "GNP9211244P0" Then
        Print #1, "map:TipoPol=AUTOS="
        Print #1, "map:NumeroPol=" & Trim(bxFEDatAddenda.NumeroPoliza)
     End If
    
     Print #1, "map:noTramitador=" & Trim(bxFEDatAddenda.NumeroTramitador)
     Print #1, "map:tipoContactoEmisor=" & Trim(bxFEDatAddenda.TipoContactoEm)
     Print #1, "map:nombreContactoEmisor=" & Trim(bxFEDatAddenda.NombreContactoEm)
     Print #1, "map:emailContactoEmisor=" & Trim(bxFEDatAddenda.EmailContactoEm)
     Print #1, "map:telContactoEmisor=" & Trim(bxFEDatAddenda.TelContactoEm)
     Print #1, "map:tipoContactoReceptor=" & Trim(bxFEDatAddenda.TipoContactoRe)
     Print #1, "map:nombreContactoReceptor=" & Trim(bxFEDatAddenda.NombreContactoRe)
    
     If xRfc = "GNP9211244P0" Then
        Print #1, "map:ExtTelCtoEmisor=" & Trim(bxFEDatAddenda.ExtTelContactoEm)
        Print #1, "map:AreaCtoEmisor=" & Trim(bxFEDatAddenda.AreaContactoEm)
        Print #1, "map:emailContactoReceptor=" & Trim(bxFEDatAddenda.EmailContactoRe)
        Print #1, "map:telContactoReceptor=" & Trim(bxFEDatAddenda.TelContactoRe)
        Print #1, "map:OficinaEntregaFactura=" & Trim(bxFEDatAddenda.OficinaEntregaFactura)
     End If
    If xRfc = "QCS931209G49" Or _
       xRfc = "ASE931116231" Or _
       xRfc = "MTE440316E54" Or _
       xRfc = "GNP9211244P0" Then  'Qualitas
       Print #1, "map:OficinaEntregaFactura=" & Trim(bxFEDatAddenda.OficinaEntregaFactura)
       Print #1, "map:FolioElectronico=" & IIf(Trim(bxFEDatAddenda.FolioElectronicoR) = "" Or IsNull(bxFEDatAddenda.FolioElectronicoR), "000000000000", Trim(bxFEDatAddenda.FolioElectronicoR))
       Print #1, "map:FolioElectronicoR=" & IIf(Trim(bxFEDatAddenda.FolioElectronicoR) = "" Or IsNull(bxFEDatAddenda.FolioElectronicoR), "000000000000", Trim(bxFEDatAddenda.FolioElectronicoR))
       Print #1, "map:FolioElectronicoV=" & IIf(Trim(bxFEDatAddenda.FolioElectronicoV) = "" Or IsNull(bxFEDatAddenda.FolioElectronicoV), "000000000000", Trim(bxFEDatAddenda.FolioElectronicoV))
       Print #1, "map:bancoDepositoDeducible=" & IIf(bxFEDatAddenda.MontoDeducible > 0, Trim(bxFEDatAddenda.BancoDepositoDeducible), "X")
       Print #1, "map:FechaDepositoDeducible=" & IIf(bxFEDatAddenda.MontoDeducible > 0, Trim(bxFEDatAddenda.FechaDepositoDeducible), "0000-00-00")
       Print #1, "map:folioFicha_ReferenciaDeducible=" & IIf(Trim(bxFEDatAddenda.FolioFichaReferenciaDeducible) = "" Or IsNull(bxFEDatAddenda.FolioFichaReferenciaDeducible), Trim(bxFEDatAddenda.FolioElectronicoR), "") 'IIf(bxFEDatAddenda.MontoDeducible > 0, Trim(bxFEDatAddenda.FolioFichaReferenciaDeducible), "")
       Print #1, "map:montoDemerito_Recupero=" & Format(bxFEDatAddenda.MontoDemeritoRecupero, "#######0.00")
       Print #1, "map:bancoDepositoDemerito_Recupero=" & IIf(bxFEDatAddenda.MontoDemeritoRecupero > 0, Trim(bxFEDatAddenda.BancoDepositoDemeritoRecupero), "X")
       Print #1, "map:fechaDepositoDemerito_Recupero=" & IIf(bxFEDatAddenda.MontoDemeritoRecupero > 0, Trim(bxFEDatAddenda.FechaDepositoDemeritoRecupero), "0000-00-00")
       Print #1, "map:folioFicha_ReferenciaDemerito=" & IIf(Trim(bxFEDatAddenda.FolioFichaReferenciaDemerito) = "" Or IsNull(bxFEDatAddenda.FolioFichaReferenciaDemerito), Trim(bxFEDatAddenda.FolioElectronicoR), "") 'IIf(bxFEDatAddenda.MontoDemeritoRecupero > 0, Trim(bxFEDatAddenda.FolioFichaReferenciaDemerito), "")
    End If
    
     Print #1, "#FinMAPFRE"
     Print #1, ""
  End If
  
  If Trim(xRfc) = "ABA920310QW0" Then
     Print #1, "#ABA"
     Print #1, "ABA:Area=" & Str(8)
     Print #1, "ABA:SubArea=" & Str(19)
     Print #1, "ABA:OrdenCompraID=" & Trim(bxFEDatAddenda.NumeroTramitador)
     Print #1, "ABA:SiniestroID=" & Trim(bxFEDatAddenda.NumeroSiniestro)
     Print #1, "ABA:BienSec= " & IIf(Len(Trim(bxFEDatAddenda.NumeroReporte)) = 0, "0", Trim(bxFEDatAddenda.NumeroReporte))
     Print #1, "ABA:Mes=" & IIf(Len(Trim(Str(Month(xFechaFac)))) = 1, "0" + Trim(Str(Month(xFechaFac))), Trim(Str(Month(xFechaFac))))
     Print #1, "ABA:Anio=" & Str(Year(xFechaFac))
     Print #1, "ABA:CorreoElectronico=" & Trim(" ")
     Print #1, "ABA:Referencia1NoPoliza=" & Trim(bxFEDatAddenda.NumeroPoliza)
     Print #1, "ABA:Referencia2NombreAsegurado=" & Trim(bxFEDatAddenda.NombreAsegurado)
     Print #1, "ABA:Referencia3Comentarios=" & Trim(" ")
     Print #1, "#FinABA"
     Print #1, ""
  End If
  
   If xTipoEmbarque = "NUEVOS" Then
      Print #1, "#COMPLEMENTO"
      Print #1, "sis:Complemento=ComplementoAutosNuevos"
      Print #1, "vv:CveVehic=" & Trim(bxAtribNvos.ClaveVehicular)
      Print #1, "vv:Niv=" & Trim(xNumSerie)
      Print #1, "#FinCOMPLEMENTO"
      Print #1, ""
   End If
  
'  If (Trim(SivMyApp.Controls("ccustid_0")) = "P00033" Or Trim(SivMyApp.Controls("ccustid_0")) = "P00198") And Trim(SivMyApp.Controls("csotypeid_0")) = "ACRM" Then
   If xRfc = "QCS931209G49" Or xRfc = "ASE931116231" Or xRfc = "MTE440316E54" Then
     Print #1, "#InicioAseguradoraD"
     Print #1, "NroLinDet TpoCodigo VlrCodigo           DscLang DscItem                                           QtyItem UnmdItem  PrcBrutoItem PrcNetoItem TipoImp TasaImp MontoImp MontoBrutoItem MontoNetoItem MontoTotalItem"
      
      GridHandle = GetGridHandle("Spread1")
      Renglon = MGetRowNum(GridHandle)
      i = 1
      RecFound = MFirst(GridHandle, MemMaintFlag)
      While RecFound = 0
         Call GetBufferValue("bSoShipLine.qtyship", xCant)
         Call GetBufferValue("bSoShipLine.invtid", xInvtID)
         Call GetBufferValue("bSoShipLine.descr", xDescr)
         Call GetBufferValue("bSoShipLine.unitdesc", xUDesc)      'Descripción de la unidad (Unidad de medida)
         Call GetBufferValue("bsoshipline.curytaxamt00", mIva)   'IVA
         Call GetBufferValue("bsoshipline.curytotinvc", mNeto)
         
         If Abs(xCant) > 0 Then
            xInvtID = Mid(Trim(xInvtID), 1, 21)
            xDescr = Mid(Trim(xDescr), 1, 49)
            If Trim(xDescr) = "" Then xDescr = "REFACCION"
            xCant = Abs(xCant)
'            xUDesc = SivMyApp.Controls("cunitdesc_1")                'Descripción de la unidad (Unidad de medida)
           
            mIva = Abs(mIva)
            mBruto = mNeto + mIva
            mTotal = mBruto
            xUIva = IIf(xCant > 0, (mIva / xCant), mIva)
            xPUBruto = IIf(xCant > 0, (mBruto / xCant), mBruto)
            xPUNeto = IIf(xCant > 0, (mNeto / xCant), mNeto)
           
            If Left(xInvtID, 1) = "R" Then
               Let Linea = LTrim(Str(i)) & String(12 - Len(LTrim(Str(i))), " ") & "INT      "
            Else
               Let Linea = LTrim(Str(i)) & String(12 - Len(LTrim(Str(i))), " ") & "SRV      "
            End If
            Let Linea = Linea & Trim(xInvtID) & String(21 - Len(Trim(xInvtID)), " ") & "ES     "
            Let Linea = Linea & Mid(Trim(xDescr), 1, 49) & String(49 - Len(Mid(Trim(xDescr), 1, 49)), " ")
            Let Linea = Linea & CStr(Format(Abs(xCant), "#0.00")) & String(9 - Len(CStr(Format(Abs(xCant), "#0.00"))), " ")
            Let Linea = Linea & Trim(xUDesc) & String(9 - Len(Trim(xUDesc)), " ")
            Let Linea = Linea & String(12 - Len(CStr(Format(Abs(xPUBruto), "#0.00"))), " ") & CStr(Format(Abs(xPUBruto), "#0.00"))
            Let Linea = Linea & String(12 - Len(CStr(Format(Abs(xPUNeto), "#0.00"))), " ") & CStr(Format(Abs(xPUNeto), "#0.00"))
            Let Linea = Linea & "    IVA     16  "
            Let Linea = Linea & String(9 - Len(CStr(Format(Abs(xUIva), "#0.00"))), " ") & CStr(Format(Abs(xUIva), "#0.00"))
            Let Linea = Linea & String(15 - Len(CStr(Format(Abs(mBruto), "#0.00"))), " ") & CStr(Format(Abs(mBruto), "#0.00"))
            Let Linea = Linea & String(14 - Len(CStr(Format(Abs(mNeto), "#0.00"))), " ") & CStr(Format(Abs(mNeto), "#0.00"))
            Let Linea = Linea & String(14 - Len(CStr(Format(Abs(mTotal), "#0.00"))), " ") & CStr(Format(Abs(mTotal), "#0.00"))
            Print #1, Linea
         End If
         i = i + 1
         RecFound = MNext(GridHandle, MemMaintFlag)
      Wend
      Call msetrownum(GridHandle, Renglon)
      
      Print #1, "#FinAseguradoraD"
      Print #1, ""
   End If

   Print #1, "#Comentarios"
   Dim lPosicion As Long
   Dim sTemporal As String
   If xTipoEmbarque = "NUEVOS" Then
      lPosicion = InStr(1, bxAtribNvos.Comentario, vbNullChar)
      If lPosicion <> 0 Then
         sTemporal = VBA.Left$(bxAtribNvos.Comentario, lPosicion - 1)
      Else
         sTemporal = bxAtribNvos.Comentario
      End If
      Print #1, RTrim(sTemporal)
      xConc = "Concepto"
   Else
      lPosicion = InStr(1, bxEmb.note + bxEmb.note2, vbNullChar)
      If lPosicion <> 0 Then
         sTemporal = VBA.Left$(bxEmb.note + bxEmb.note2, lPosicion - 1)
      Else
         sTemporal = bxEmb.note + bxEmb.note2
      End If

      Print #1, RTrim(sTemporal)
      xConc = ""
   End If
   Print #1, "#FinComentarios"
   Print #1, ""
  
' Inicia Detalle para el SAT
   GridHandle = GetGridHandle("Spread1")
   Renglon = MGetRowNum(GridHandle)
  
   Print #1, "#InicioDetalle"
   If bxEmb.curytotinvc < 0 Then
'     Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      Print #1, "Linea   Codigo              Descripcion                                                                                                                                                                                                                                                                                                 Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      xtClaseTec = "              "
   Else
'     Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      Print #1, "Linea   Codigo              Descripcion                                                                                                                                                                                                                                                                                                 Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      xtClaseTec = ""
   End If
  
   i = 1
   RecFound = MFirst(GridHandle, MemMaintFlag)
   While RecFound = 0
      Call GetBufferValue("bSoShipLine.qtyship", xCant)
      Call GetBufferValue("bSoShipLine.invtid", xInvtID)
      Call GetBufferValue("bSoShipLine.descr", xDescr)
      Call GetBufferValue("bSoShipLine.unitdesc", xUDesc)      'Descripción de la unidad (Unidad de medida)
      Call GetBufferValue("bsoshipline.curytaxamt00", mIva)   'IVA
      Call GetBufferValue("bsoshipline.curytotinvc", xImp)
      Call GetBufferValue("bsoshipline.curyslsprice", xPU)
      Call GetBufferValue("bsoshipline.discpct", detDiscPct)
      Call GetBufferValue("bsoshipline.lineref", LineRef)
      Sentencia = "xFEEmbarque_WhSeLoc " & Sparm(sivMyApp.Controls("cCpnyID_0")) & "," & Sparm(xembarque) & "," & Sparm(xInvtID) & "," & Sparm(LineRef)
      Call SqlFree(c1)
      serr1 = SqlFetch1(c1, Sentencia, bWhSeLoc, LenB(bWhSeLoc))
      If serr1 = 0 Then
         xUbicacion = Trim(bWhSeLoc.whseloc)
      Else
         xUbicacion = ""
      End If
      
      If Abs(xCant) > 0 Then
         xInvtID = Mid(Trim(xInvtID), 1, 16)
         If xTipoEmbarque = "NUEVOS" Then
            xDescr = Mid(Trim(bxAtribNvos.Modelo), 1, 41)
         Else
            xDescr = Mid(Trim(xDescr), 1, 41)
         End If
         If Trim(xDescr) = "" Then xDescr = "REFACCION"
         xCant = Abs(xCant)
         xtCant = Format(xCant, "########0.00")
   
' Para que corrija ISAN Ctes Especiales
    If xTipoEmbarque = "NUEVOS" And (VBA.Trim$(bxDatoCte.CustId) = "N20361" Or VBA.Trim$(bxDatoCte.CustId) = "N20008" Or VBA.Trim$(bxDatoCte.CustId) = "N57106" Or VBA.Trim$(bxDatoCte.CustId) = "N05627" Or VBA.Trim$(bxDatoCte.CustId) = "N58097" Or VBA.Trim$(bxDatoCte.CustId) = "N62924" Or VBA.Trim$(bxDatoCte.CustId) = "N02196" Or VBA.Trim$(bxDatoCte.CustId) = "N14287" Or VBA.Trim$(bxDatoCte.CustId) = "N02353") Then
         xtImp = xtsubtot
         xtPU = xtsubtot
    Else
         xImp = Abs(xImp)
         xtImp = Format(xImp, "########0.00")
    
         xPU = Abs(xPU)
         xtPU = Format(xPU, "########0.00")
    End If
' Fin Corregir ISan Ctes Especiales.
    
   '      xUDesc = SivMyApp.Controls("cunitdesc_1")
    
         xUDiscPct = val(Mid(Trim(detDiscPct), 1, 10))
         If xUDiscPct = 0 Then
            xtUDiscPct = ""
            xtPUDesc = ""
         Else
            xtUDiscPct = Format(xUDiscPct, "########0.00")
            xPUDesc = (xImp / xCant)
            xtPUDesc = Format(xPUDesc, "########0.00")
         End If
         xUbicacion = Mid(Trim(xUbicacion), 1, 8)
    
         Let Linea = LTrim(Str(i)) & String(8 - Len(LTrim(Str(i))), " ")
         Let Linea = Linea & xInvtID & String(20 - Len(xInvtID), " ")
         Let Linea = Linea & xDescr & String(50 - Len(xDescr), " ")
         Let Linea = Linea & xDescr2 & String(250 - Len(xDescr2), " ")
         Let Linea = Linea & xUDesc & String(10 - Len(xUDesc), " ")
         Let Linea = Linea & String(10 - Len(xtCant), " ") & xtCant
         Let Linea = Linea & String(12 - Len(xtPU), " ") & LTrim(xtPU)
         Let Linea = Linea & String(10 - Len(xtUDiscPct), " ") & xtUDiscPct
         Let Linea = Linea & String(12 - Len(xtPUDesc), " ") & LTrim(xtPUDesc)
         Let Linea = Linea & String(12 - Len(xtImp), " ") & xtImp
         Let Linea = Linea & " " & xtClaseTec
         Let Linea = Linea & " " & xUbicacion
         Print #1, Linea
      End If
      i = i + 1
      RecFound = MNext(GridHandle, MemMaintFlag)
   Wend
   Call msetrownum(GridHandle, Renglon)
  
   Print #1, "#FinDetalle"
  
   Print #1, ""
 ' Fin Detalle para el SAT
  
 ' Inicia Detalle para Impresion
   Print #1, "#InicioDetalleImpresion"
   If bxEmb.curytotinvc < 0 Then
      Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      xtClaseTec = "              "
   Else
      ' Imprime detalle para addenda de Mapfre
      If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" And Trim(sivMyApp.Controls("csotypeid_0")) = "ACRM" Then
         Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacio IvaD       TotalD"
      Else
         Print #1, "Linea   Codigo              Descripcion                                       Unidad      Cantidad   Prec Unit   %Descto Prec C/Desc     Importe Clase  Tecnico Ubicacion"
      End If
      xtClaseTec = ""
   End If

   GridHandle = GetGridHandle("Spread1")
   Renglon = MGetRowNum(GridHandle)
  
   i = 1
   RecFound = MFirst(GridHandle, MemMaintFlag)
   While RecFound = 0

      Call GetBufferValue("bSoShipLine.qtyship", xCant)
      Call GetBufferValue("bSoShipLine.invtid", xInvtID)
      Call GetBufferValue("bSoShipLine.descr", xDescr)
      Call GetBufferValue("bSoShipLine.unitdesc", xUDesc)      'Descripción de la unidad (Unidad de medida)
      Call GetBufferValue("bsoshipline.curytotinvc", xImp)
      Call GetBufferValue("bsoshipline.curyslsprice", xPU)
      Call GetBufferValue("bsoshipline.discpct", detDiscPct)
      Call GetBufferValue("bsoshipline.curytaxamt00", xIvaD)
      Call GetBufferValue("bsoshipline.lineref", LineRef)
      Sentencia = "xFEEmbarque_WhSeLoc " & Sparm(sivMyApp.Controls("cCpnyID_0")) & "," & Sparm(xembarque) & "," & Sparm(xInvtID) & "," & Sparm(LineRef)
      Call SqlFree(c1)
      serr1 = SqlFetch1(c1, Sentencia, bWhSeLoc, LenB(bWhSeLoc))
      If serr1 = 0 Then
         xUbicacion = Trim(bWhSeLoc.whseloc)
      Else
         xUbicacion = ""
      End If
      
      If Abs(xCant) > 0 Then
   
         xInvtID = Mid(Trim(xInvtID), 1, 16)
         If xTipoEmbarque = "NUEVOS" Then
            xDescr = Mid(Trim(bxAtribNvos.Modelo), 1, 41)
         Else
            xDescr = Mid(Trim(xDescr), 1, 41)
         End If
         If Trim(xDescr) = "" Then xDescr = "REFACCION"
         xCant = Abs(xCant)
     '    xUDesc = SivMyApp.Controls("cunitdesc_1")
         xtCant = Format(xCant, "########0.00")
         xPU = Abs(xPU)
         xUDiscPct = val(Mid(Trim(detDiscPct), 1, 10))
         xUbicacion = Mid(Trim(xUbicacion), 1, 8)
     
         xIvaD = Abs(xIvaD)
         xImp = Abs(xImp)
    
         If xRfc = "XAXX010101000" Then
            xImp = xImp + xIvaD
         End If
         xPUDesc = (xImp / xCant)
         xPU = xPU * (1 + (xPorcImpto / 100))
         
'Para corregir Isan de Ctes Especiales
        If xTipoEmbarque = "NUEVOS" And (VBA.Trim$(bxDatoCte.CustId) = "N20361" Or VBA.Trim$(bxDatoCte.CustId) = "N20008" Or VBA.Trim$(bxDatoCte.CustId) = "N57106" Or VBA.Trim$(bxDatoCte.CustId) = "N05627" Or VBA.Trim$(bxDatoCte.CustId) = "N58097" Or VBA.Trim$(bxDatoCte.CustId) = "N62924" Or VBA.Trim$(bxDatoCte.CustId) = "N02196" Or VBA.Trim$(bxDatoCte.CustId) = "N14287" Or VBA.Trim$(bxDatoCte.CustId) = "N02353") Then
            xtImp = xtsubtot
            xtPU = xtsubtot
            xtUDiscPct = ""
        Else
            xtImp = Format(xImp, "########0.00")
    
            If xUser1 = "2" And xUDiscPct <> 0 Then
             xtPU = Format(xPU, "########0.00")
             xtUDiscPct = Format(xUDiscPct, "########0.00")
            Else
             xtPU = Format(xPUDesc, "########0.00")
             xtUDiscPct = ""
            End If
        End If
'Fin Corregir Isan Ctes Especiales
        
         xtPUDesc = ""
         Let Linea = LTrim(Str(i)) & String(8 - Len(LTrim(Str(i))), " ")
         Let Linea = Linea & xInvtID & String(20 - Len(xInvtID), " ")
         Let Linea = Linea & xDescr & String(50 - Len(xDescr), " ")
         Let Linea = Linea & xUDesc & String(10 - Len(xUDesc), " ")
         Let Linea = Linea & String(10 - Len(xtCant), " ") & xtCant
         Let Linea = Linea & String(12 - Len(xtPU), " ") & LTrim(xtPU)
         Let Linea = Linea & String(10 - Len(xtUDiscPct), " ") & xtUDiscPct
         Let Linea = Linea & String(12 - Len(xtPUDesc), " ") & LTrim(xtPUDesc)
         Let Linea = Linea & String(12 - Len(xtImp), " ") & xtImp
         Let Linea = Linea & " " & xtClaseTec
         Let Linea = Linea & " " & xUbicacion
       
       ' imprime detalle para mapfre
         If Trim(sivMyApp.Controls("ccustid_0")) = "P00033" Then
            Call GetBufferValue("bsoshipline.curytaxamt00", xIvaD)
            xtIvaD = Format(xIvaD, "########0.00")
            xtTotD = Format(xImp + xIvaD, "########0.00")
    
            Let Linea = Linea & "          " & String(11 - Len(LTrim(xtIvaD)), " ") & LTrim(xtIvaD)
            Let Linea = Linea & String(12 - Len(LTrim(xtTotD)), " ") & LTrim(xtTotD)
   
         Else
           Let Linea = Linea & " " & xUbicacion
         End If
    
         Print #1, Linea
      End If
      i = i + 1
      RecFound = MNext(GridHandle, MemMaintFlag)
   Wend
   Call msetrownum(GridHandle, Renglon)
  
   Print #1, "#FinDetalleImpresion"
   Print #1, ""
'  Fin Detalle para Impresion

   Close #1
'   If Trim(usuario) = "SYSADMIN" Then
'     wkRuta = "z:\FRM0034438_150327_2.PRN"
'   End If
   Name wkRuta As wkRuta2

   Call MessBox("Archivo Generado: " & wkRuta2, vbInformation + vbOKOnly, "Proceso Terminado...")
  
   Call SqlFree(c1)
   Call SqlFree(c2)
   Call SqlFree(c3)
   Call SqlFree(c4)
   Call SqlFree(c5)
   Call SqlFree(c6)
   Call SqlFree(c7)
   Call SqlFree(c8)
   Call SqlFree(c9)
  
   If TestLevelChg(LEVEL0) <> NOTCHANGED Or _
      TestLevelChg(LEVEL1) <> NOTCHANGED Or _
      TestLevelChg(LEVEL2) <> NOTCHANGED Or _
      TestLevelChg(LEVEL3) <> NOTCHANGED Or _
      TestLevelChg(LEVEL4) <> NOTCHANGED Or _
      TestLevelChg(LEVEL5) <> NOTCHANGED Or _
      TestLevelChg(LEVEL6) <> NOTCHANGED Or _
      TestLevelChg(LEVEL7) <> NOTCHANGED Or _
      TestLevelChg(LEVEL8) <> NOTCHANGED Then
      Call SetLevelChg(LEVEL0, NOTCHANGED)
      Call SetLevelChg(LEVEL1, NOTCHANGED)
      Call SetLevelChg(LEVEL2, NOTCHANGED)
      Call SetLevelChg(LEVEL3, NOTCHANGED)
      Call SetLevelChg(LEVEL4, NOTCHANGED)
      Call SetLevelChg(LEVEL5, NOTCHANGED)
      Call SetLevelChg(LEVEL6, NOTCHANGED)
      Call SetLevelChg(LEVEL7, NOTCHANGED)
      Call SetLevelChg(LEVEL8, NOTCHANGED)
   End If
  
   'carga de nuevo el embarque a pantalla
   Call SetObjectValue("cshipperid_0", xembarque)
End Sub


' End VBComponent **********************************************************



' VBComponent: InterCompania, ComponentType: 1 **********************************************************
Attribute VB_Name = "InterCompania"
Option Explicit

Type Almacen_Type
   SiteID As String * 10
End Type

Public bAlmacen As Almacen_Type

Type Adapta_Type
   Pantalla As String * 8
   UserId   As String * 47
   adapta   As String * 10
End Type

Public bAdapta As Adapta_Type

Public Function Obtiene_Almacen(varTipo As String) As String
   Dim Sentencia As String
   Dim Compania  As String
   Dim vTipo     As String
   Dim vCat      As String
   
   Obtiene_Almacen = ""
   Call GetBufferValue("bpes.cpnyid", Compania)

   If varTipo = "AUTOSNUEVOS" Then
      vTipo = "AUTOS"
      vCat = "P"
   End If
   
   If varTipo = "AUTOSSEMINUEVOS" Then
      vTipo = "AUTOS"
      vCat = "S"
   End If
      
   If varTipo = "REFACCIONES" Then
      vTipo = "REFAC"
      vCat = "P"
   End If
      
   If varTipo = "SERVICIO" Then
      vTipo = "SERVICIO"
      vCat = "P"
   End If
      
   Sentencia = "xMCSite_Obtiene " & Sparm(Compania) & "," & Sparm(vTipo) & "," & Sparm(vCat)
   Call SqlFree(c1)
   serr1 = SqlFetch1(c1, Sentencia, bAlmacen, LenB(bAlmacen))
   If serr1 = 0 Then
      Obtiene_Almacen = bAlmacen.SiteID
   End If
End Function


Public Function Valida_Usuario(vAdapta As String) As Boolean
   Dim Sentencia As String
   Dim vUsuario   As String
   
   Valida_Usuario = False
   Call GetBufferValue("bpes.userid", vUsuario)
   
   Sentencia = "Select Pantalla, UserID, Adapta From xVTAdaptaciones Where Pantalla = '4011000' And UserID = " & Sparm(vUsuario) & " And Adapta = " & Sparm(vAdapta)
   Call SqlFree(c1)
   serr1 = SqlFetch1(c1, Sentencia, bAdapta, LenB(bAdapta))
   If serr1 = 0 Then
      Valida_Usuario = True
   End If
   Call SqlFree(c1)
End Function

' End VBComponent **********************************************************



' VBComponent: CustomerDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "CustomerDH"
Option Explicit
 
Type Customer
    AccrRevAcct                     As String * 10
    AccrRevSub                      As String * 24
    AcctNbr                         As String * 30
    Addr1                           As String * 60
    Addr2                           As String * 60
    AgentID                         As String * 10
    ApplFinChrg                     As Integer
    ArAcct                          As String * 10
    ArSub                           As String * 24
    Attn                            As String * 30
    AutoApply                       As Integer
    BankID                          As String * 10
    BillAddr1                       As String * 60
    BillAddr2                       As String * 60
    BillAttn                        As String * 30
    BillCity                        As String * 30
    BillCountry                     As String * 3
    BillFax                         As String * 30
    BillName                        As String * 60
    BillPhone                       As String * 30
    BillSalut                       As String * 30
    BillState                       As String * 3
    BillThruProject                 As Integer
    BillZip                         As String * 10
    CardExpDate                     As Sdate
    CardHldrName                    As String * 60
    CardNbr                         As String * 20
    CardType                        As String * 1
    City                            As String * 30
    ClassId                         As String * 6
    ConsolInv                       As Integer
    Country                         As String * 3
    CrLmt                           As Double
    Crtd_DateTime                   As Sdate
    Crtd_Prog                       As String * 8
    Crtd_User                       As String * 10
    CuryId                          As String * 4
    CuryPrcLvlRtTp                  As String * 6
    CuryRateType                    As String * 6
    CustFillPriority                As Integer
    CustId                          As String * 15
    DfltShipToId                    As String * 10
    DocPublishingFlag               As String * 1
    DunMsg                          As Integer
    EMailAddr                       As String * 80
    Fax                             As String * 30
    InvtSubst                       As Integer
    LanguageID                      As String * 4
    LUpd_DateTime                   As Sdate
    LUpd_Prog                       As String * 8
    LUpd_User                       As String * 10
    Name                            As String * 60
    NoteId                          As Long
    OneDraft                        As Integer
    PerNbr                          As String * 6
    Phone                           As String * 30
    PmtMethod                       As String * 1
    PrcLvlId                        As String * 10
    PrePayAcct                      As String * 10
    PrePaySub                       As String * 24
    PriceClassID                    As String * 6
    PrtMCStmt                       As Integer
    PrtStmt                         As Integer
    S4Future01                      As String * 30
    S4Future02                      As String * 30
    S4Future03                      As Double
    S4Future04                      As Double
    S4Future05                      As Double
    S4Future06                      As Double
    S4Future07                      As Sdate
    S4Future08                      As Sdate
    S4Future09                      As Long
    S4Future10                      As Long
    S4Future11                      As String * 10
    S4Future12                      As String * 10
    Salut                           As String * 30
    SetupDate                       As Sdate
    ShipCmplt                       As Integer
    ShipPctAct                      As String * 1
    ShipPctMax                      As Double
    SICCode1                        As String * 4
    SICCode2                        As String * 4
    SingleInvoice                   As Integer
    SlsAcct                         As String * 10
    SlsperId                        As String * 10
    SlsSub                          As String * 24
    State                           As String * 3
    Status                          As String * 1
    StmtCycleId                     As String * 2
    StmtType                        As String * 1
    TaxDflt                         As String * 1
    TaxExemptNbr                    As String * 15
    TaxID(0 To 3)                   As String * 10
    TaxLocId                        As String * 15
    TaxRegNbr                       As String * 15
    Terms                           As String * 2
    Territory                       As String * 10
    TradeDisc                       As Double
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    User5                           As String * 10
    User6                           As String * 10
    User7                           As Sdate
    User8                           As Sdate
    Zip                             As String * 10
End Type
 
Public bCustomer As Customer, nCustomer As Customer
' End VBComponent **********************************************************



' VBComponent: INSetup_dh, ComponentType: 1 **********************************************************
Attribute VB_Name = "INSetup_dh"
Option Explicit

Type INSetup
        ActivateLang As Integer
        AdjustmentsAcct As String * 10
        AdjustmentsSub As String * 24
        AllowCostEntry As Integer
        APClearingAcct As String * 10
        APClearingSub As String * 24
        ARClearingAcct As String * 10
        ARClearingSub As String * 24
        AutoAdjustEntry As Integer
        AutoBatRpt As Integer
        AutoRelease As String * 1
        BMICuryID As String * 4
        BMIDfltRtTp As String * 6
        BMIEnabled As Integer
        CPSOnOff As Integer
        Crtd_DateTime As Sdate
        Crtd_Prog As String * 8
        Crtd_User As String * 10
        CurrPerNbr As String * 6
        DecPlPrcCst As Integer
        DecPlQty As Integer
        DfltChkOrdQty As String * 1
        DfltCOGSAcct As String * 10
        DfltCOGSSub As String * 24
        DfltDIscPrc As String * 1
        DfltInvtAcct As String * 10
        DfltInvtLeadTime As Double
        DfltInvtMfgLeadTime As Double
        DfltInvtSub As String * 24
        DfltInvtType As String * 1
        DfltItmSiteAcct As String * 10
        DfltLCVarianceAcct As String * 10
        DfltLCVarianceSub As String * 24
        DfltLotAssign As String * 1
        DfltlotFxdLen As Integer
        DfltLotFxdTyp As String * 1
        DfltLotFxdVal As String * 12
        DfltLotMthd As String * 1
        DfltLotNumLen As Integer
        DfltLotNumVal As String * 25
        DfltLotSerTrack As String * 1
        DfltLotShelfLife As Integer
        DfltPhysQty As Integer
        DfltPPVAcct As String * 10
        DfltPPVSub As String * 24
        DfltProdClass As String * 6
        DfltSalesAcct As String * 10
        DfltSalesSub As String * 24
        DfltSerAssign As String * 1
        DfltSerFxdLen As Integer
        DfltSerFxdTyp As String * 1
        DfltSerFxdVal As String * 12
        DfltSerMethod As String * 1
        DfltSerNumLen As Integer
        DfltSerNumVal As String * 25
        DfltSerShelfLife As Integer
        DfltShpnotInvAcct As String * 10
        DfltShpnotInvSub As String * 24
        DfltSite As String * 10
        DfltSlsTaxCat As String * 10
        DfltSource As String * 1
        DfltStatus As String * 1
        DfltStatusQtyZero As String * 1
        DfltStkItem As Integer
        DfltValMthd As String * 1
        DfltVarAcct As String * 10
        DfltVarSub As String * 24
        ExplInvoice As Integer
        ExplOrder As Integer
        ExplPackSlip As Integer
        ExplPickList As Integer
        ExplShipping As Integer
        ExprdLotNbrs As Integer
        ExprdSerNbrs As Integer
        GLPostOpt As String * 1
        InclAllocQty As Integer
        INClearingAcct As String * 10
        INClearingSub As String * 24
        InclQtyAllocWO As Integer
        InclQtyCustOrd As Integer
        InclQtyInTransit As Integer
        InclQtyOnBO As Integer
        InclQtyOnPO As Integer
        InclQtyOnWO As Integer
        InclWOFirmDemand As Integer
        InclWOFirmSupply As Integer
        InclWORlsedDemand As Integer
        InclWORlsedSupply As Integer
        Init As Integer
        InTransitAcct As String * 10
        InTransitSub As String * 24
        IssuesAcct As String * 10
        IssuesSub As String * 24
        LanguageID As String * 4
        LastArchiveDate As Sdate
        LastBatNbr As String * 10
        LastCountDate As Sdate
        LastTagNbr As Long
        LotSerRetHist As Integer
        LstSlsPrcID As String * 10
        LstTrnsfrDocNbr As String * 10
        LUpd_DateTime As Sdate
        LUpd_Prog As String * 8
        LUpd_User As String * 10
        MaterialType As String * 10
        MatlOvhCalc As String * 1
        MatlOvhOffAcct As String * 10
        MatlOvhOffSub As String * 24
        MatlOvhRatePct As String * 1
        MatlOvhVarAcct As String * 10
        MatlOvhVarSub As String * 24
        MfgClassID As String * 10
        MinGrossProfit As Double
        MultWhse As Integer
        NbrCounts As Integer
        NbrCycleCounts As Integer
        NegQty As Integer
        NonKitAssy As Integer
        NoteId As Long
        OverSoldCostLayers As Integer
        PerNbr As String * 6
        PerRetPITrans As Integer
        PerRetTran As Integer
        PhysAdjVarAcct As String * 10
        PhysAdjVarSub As String * 24
        PIABC As String * 1
        PMAvail As Integer
        RollBackBatches As Integer
        RollupCost As Integer
        RollupPrice As Integer
        S4Future01 As String * 30
        S4Future02 As String * 30
        S4Future03 As Double
        S4Future04 As Double
        S4Future05 As Double
        S4Future06 As Double
        S4Future07 As Sdate
        S4Future08 As Sdate
        S4Future09 As Long
        S4Future10 As Long
        S4Future11 As String * 10
        S4Future12 As String * 10
        SerAssign As String * 1
        SetupId As String * 2
        SiteID As String * 10
        SpecChar As String * 24
        StdCstRevalAcct As String * 10
        StdCstRevalSub As String * 24
        TableBypass As Integer
        Tagged As Integer
        TranCOGSSub As String * 1
        UpdateGL As Integer
        User1 As String * 30
        User2 As String * 30
        User3 As Double
        User4 As Double
        User5 As String * 10
        User6 As String * 10
        User7 As Sdate
        User8 As Sdate
        VolUnit As String * 6
        WhseLocValid As String * 1
        WtUnit As String * 6
        YrsRetArchTran As Integer
        YrsRetHist As Integer
End Type

Global bINSetup As INSetup, nINSetup As INSetup

' End VBComponent **********************************************************



' VBComponent: UserRecDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "UserRecDH"
Option Explicit
 
Type UserRec
    AlignFormGrid                   As Integer
    AppServerUser                   As Integer
    AutoDecimal                     As Integer
    AutoTab                         As Integer
    BrowserOnTop                    As Integer
    CacheFavorite                   As Integer
    CacheMenu                       As Integer

    CodeOnTop                       As Integer
    CodeFont                        As String * 32
    CodeFontSize                    As Integer
    CodeTabWidth                    As Integer
    
    'added by bezell
    'CR: 208094
    'Added this to allow the color of the required fields to be modifiable
    'and savable
    ColorPref                       As Long
    ColorPrefPV                     As Long
    CustomGrp                       As String * 30
    DefaultUser                     As Integer
    
    EMailAddress                    As String * 255
    EnterForTab                     As Integer
    FormGridHeigth                  As Integer
    FormGridWidth                   As Integer
    HomePage                        As String * 255
    IntLogon                        As Integer
    LastDatabase                    As String * 20
    Location                        As String * 60
    MenuGroup                       As String * 47
    OutputFileName                  As String * 8
    OutputPath                      As String * 41
    OutputRouting                   As String * 1
    Password                        As String * 256
    Phone                           As String * 30
    PropertiesOnTop                 As Integer
    RecType                         As String * 1
    Role                            As Integer
    S4Future01                      As String * 128
    S4Future02                      As String * 30
    S4Future03                      As Double
    S4Future04                      As Double
    S4Future05                      As Double
    S4Future06                      As Double
    S4Future07                      As Sdate
    S4Future08                      As Sdate
    S4Future09                      As Long
    S4Future10                      As Long
    SaveSettingsOnExit              As Integer
    ShowFormGrid                    As Integer
    ShowGridLines                   As Integer
    ShowGridRowNbrs                 As Integer
    SQMOptIn                        As String * 1
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    UserId                          As String * 47
    UserName                        As String * 30
    WindowsUserAcct                 As String * 85
End Type
 
Public bUserRec As UserRec, nUserRec As UserRec
Public csr_UserRec As Integer, serr_Userrec As Integer
' End VBComponent **********************************************************



' VBComponent: ARSetupDH, ComponentType: 1 **********************************************************
Attribute VB_Name = "ARSetupDH"
Option Explicit
 
Type ARSetup
    AnnFinChrg                      As Double
    ArAcct                          As String * 10
    ArSub                           As String * 24
    AutoApplyWO                     As Integer
    AutoBatRpt                      As Integer
    AutoNSF                         As Integer
    AutoRef                         As Integer
    ChkAcct                         As String * 10
    ChkSub                          As String * 24
    ChrgMin                         As Integer
    CompdFinChrg                    As Integer
    CreditHoldType                  As String * 1
    Crtd_DateTime                   As Sdate
    Crtd_Prog                       As String * 8
    Crtd_User                       As String * 10
    CurrPerNbr                      As String * 6
    CustViewDflt                    As String * 1
    DaysPastDue                     As Integer
    DecPlPrcCst                     As Integer
    DecPlQty                        As Integer
    DfltAutoApply                   As Integer
    DfltClass                       As String * 6
    DfltNSFAcct                     As String * 10
    DfltNSFSub                      As String * 24
    DfltSBWOAcct                    As String * 10
    DfltSBWOSub                     As String * 24
    DfltSCWOAcct                    As String * 10
    DfltSCWOSub                     As String * 24
    DfltStmtCycle                   As String * 2
    DfltStmtType                    As String * 1
    DiscAcct                        As String * 10
    DiscSub                         As String * 24
    DiscCpnyFromInvc                As Integer
    FinChrgAcct                     As String * 10
    FinChrgFirst                    As String * 1
    FinChrgSub                      As String * 24
    GLPostOpt                       As String * 1
    IncAcct                         As String * 10
    IncSub                          As String * 24
    Init                            As Integer
    LastBatNbr                      As String * 10
    LastCrMemoNbr                   As String * 10
    LastDrMemoNbr                   As String * 10
    LastFinChrgRefNbr               As String * 10
    LastRefNbr                      As String * 10
    LastWORefNbr                    As String * 10
    LUpd_DateTime                   As Sdate
    LUpd_Prog                       As String * 8
    LUpd_User                       As String * 10
    MCuryBatRpt                     As Integer
    MinFinChrg                      As Double
    Nbr0803Docs                     As Integer
    NoteId                          As Long
    NSFChrg                         As Double
    OverLimitAmt                    As Double
    OverLimitType                   As String * 1
    PASortDflt                      As String * 1
    PerNbr                          As String * 6
    PerRetHist                      As Integer
    PerRetStmtDtl                   As Integer
    PerRetTran                      As Integer
    PrePayAcct                      As String * 10
    PrePaySub                       As String * 24
    RetAllowAcct                    As String * 10
    RetAllowSub                     As String * 24
    RetAvgDay                       As Integer
    RfndAcct                        As String * 10
    RfndSub                         As String * 24
    S4Future01                      As String * 30
    S4Future02                      As String * 30
    S4Future03                      As Double
    S4Future04                      As Double
    S4Future05                      As Double
    S4Future06                      As Double
    S4Future07                      As Sdate
    S4Future08                      As Sdate
    S4Future09                      As Long
    S4Future10                      As Long
    S4Future11                      As String * 10
    S4Future12                      As String * 10
    S4Future13                      As String * 10
    SBLimit                         As Double
    SetupId                         As String * 2
    SlsTax                          As Integer
    SlsTaxDflt                      As String * 1
    TranDescDflt                    As String * 1
    User1                           As String * 30
    User2                           As String * 30
    User3                           As Double
    User4                           As Double
    User5                           As String * 10
    User6                           As String * 10
    User7                           As Sdate
    User8                           As Sdate
    WarningLvlLimit                 As Integer
End Type
 
Public bARSetup As ARSetup, nARSetup As ARSetup
' End VBComponent **********************************************************



' VBComponent: Embarque_, ComponentType: 1 **********************************************************
Attribute VB_Name = "Embarque_"
Option Explicit

Type shipper
    shipperid As String * 15
End Type

Public bshipper As shipper, nshipper As shipper


Type localizacion
    servicioSiteid As String * 10
    refaccionesiteId As String * 10
End Type

Public blocalizacion As localizacion, nlocalizacion As localizacion


Type refacciones
    invtid As String * 30
    precio As Double
    codigointerv As String * 10
    whseloc As String * 10
    towhseloc As String * 6
    qty As Double
    unitDesc As String * 6
End Type
Public brefacciones As refacciones, bErefacciones As refacciones

Type sumaEmbarque
    suma As Double
End Type

Public bsumaEmbarque As sumaEmbarque, nsumaEmbarque As sumaEmbarque


Type invtidError
    i As Double
End Type
Public binvtidError As invtidError


Type cantidadNecesaria
    qty As Double
End Type
Public bcantidadNecesaria As cantidadNecesaria
    

Type cantidadLocation
    qtyonhand As Double
    qtyavail As Double
End Type

Public bcantidadLocation As cantidadLocation

Type mensajeError
    invtid As String * 30
    whseloc As String * 15
    qtyonhand As Double
    qtyavail As Double
End Type

Public bmensajeError As mensajeError

Type TransfersDescto
    invtid As String * 30
    qtyinvt As Double
    unitprice As Double
    whseloc As String * 6
End Type
Public bTransfersDescto As TransfersDescto


Type adapatacion
    adapta As String * 10
End Type

Public bAdaptacion As adapatacion


Type correoRefacciones
    correo As String * 30
End Type

Public bcorreoRefacciones As correoRefacciones

Type responseMail
    response As String * 1
    message As String * 255
End Type

Public bresponseMail As responseMail

Type loteTransf
    lote As String * 10
End Type
Public bLoteTransf As loteTransf




Function insertError(invtid As String, servicioSiteid As String, OrdenServicio As String, towhseloc As String, qtyonhand As Double, qty As Double)
    Dim SentenciaError As String
    SentenciaError = "Insert into tempTransError Values(" & Sparm(invtid) & _
        "," & Sparm(OrdenServicio) & "," & Sparm(servicioSiteid) & "," & _
        Sparm(towhseloc) & "," & qtyonhand & "," & _
        qty & ")"
    Call sql(c2, SentenciaError)
End Function



' End VBComponent **********************************************************



' VBComponent: MetodosPago_, ComponentType: 1 **********************************************************
Attribute VB_Name = "MetodosPago_"
Option Explicit

Type xmetodoPago
    metodoid As String * 10
    descr As String * 30
End Type

Public bxMetodoPago As xmetodoPago


Type xformaPago
    banco As String * 40
    metodoPago As String * 30
    DigitosCuenta As String * 4
End Type

Public bxFormaPago As xformaPago
' End VBComponent **********************************************************



' VBComponent: Module4, ComponentType: 1 **********************************************************
Attribute VB_Name = "Module4"
Option Explicit

Type classInventory
    Class As String * 6
End Type

Public bclassInventory As classInventory
' End VBComponent **********************************************************



' Reference: Name=VBA, Guid={000204EF-0000-0000-C000-000000000046}, Major=4, Minor=2
' Reference: Name=SWIMAPI, Guid={F4B33A61-96B4-11CF-B04B-0020AFDCBD63}, Major=1, Minor=1
' Reference: Name=stdole, Guid={00020430-0000-0000-C000-000000000046}, Major=2, Minor=0
' Reference: Name=SWIMAPIEx, Guid={C97F43B1-4A73-11D3-BF6C-006008C7915A}, Major=1, Minor=1
' Reference: Name=SAF, Guid={DA357F2F-39C1-11D1-88AA-00609731B697}, Major=6, Minor=8
' Reference: Name=SolVBWrappedControlsLib, Guid={A88846F2-6638-11D3-8154-00104B2E8513}, Major=1, Minor=0
' Reference: Name=MSForms, Guid={0D452EE1-E08F-101A-852E-02608C4D0BB4}, Major=2, Minor=0

' End Macro Text

' End Customization
